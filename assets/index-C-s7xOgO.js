const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/hls-CRjxKjhq.js","assets/index-DC_zVENO.js","assets/index-C7kgsswY.css"])))=>i.map(i=>d[i]);
import{r as l,u as J,c as Gf,a as Se,_ as ce,D as on,V as T,O as Vt,P as It,b as _e,d as Wm,e as Lo,f as Di,g as Hf,Q as Fe,M as ue,h as Qn,C as ze,i as Qt,E as En,S as tc,j as Yl,T as Xm,k as Su,l as Fn,m as De,v as Vf,n as be,I as qf,o as Ki,R as Lt,F as pt,p as os,N as dt,B as tn,q as Mt,s as sn,t as Nn,w as jt,U as ka,x as us,y as ki,z as Km,A as bo,G as Zr,H as dr,J as Ot,K as nc,L as So,W as uo,X as Vn,Y as Yt,Z as Xe,$ as nr,a0 as fi,a1 as ko,a2 as Yf,a3 as _c,a4 as Eo,a5 as Et,a6 as Cc,a7 as Zm,a8 as ic,a9 as Gi,aa as Tt,ab as Mu,ac as $m,ad as lt,ae as Jm,af as jf,ag as e2,ah as hs,ai as t2,aj as gi,ak as Zi,al as Ln,am as un,an as Ic,ao as Tu,ap as Wf,aq as C0,ar as Oa,as as I0,at as n2,au as i2,av as Xf,aw as r2,ax as s2,ay as o2,az as a2,aA as c2,aB as l2,aC as u2,aD as Kf,aE as Oi,aF as rc,aG as Zf,aH as qt,aI as Pu,aJ as h2,aK as f2,aL as A2,aM as d2,aN as m2,aO as p2,aP as g2,aQ as y2,aR as v2,aS as xt,aT as $r,aU as pi,aV as B0,aW as $f,aX as Jr,aY as x2,aZ as E2,a_ as Jf,a$ as Bc,b0 as eA,b1 as jl,b2 as es,b3 as w2,b4 as Wl,b5 as yi,b6 as _2,b7 as C2,b8 as tA,b9 as mr,ba as I2,bb as Du,bc as Pt,bd as B2,be as Xt,bf as ti,bg as Cn,bh as b2,bi as nA,bj as pr,bk as Xl,bl as S2,bm as iA,bn as rA,bo as Ua,bp as ur,bq as sc,br as oc,bs as sA,bt as M2,bu as T2,bv as Ji,bw as oA,bx as Qu,by as P2,bz as D2,bA as aA,bB as cA,bC as Q2,bD as R2,bE as Ru,bF as zu,bG as ac,bH as lA,bI as Na,bJ as Mo,bK as Qa,bL as Kl,bM as uA,bN as hA,bO as z2,bP as io,bQ as gs,bR as F2,bS as fA,bT as AA,bU as vn,bV as L2,bW as k2,bX as Ga,bY as O2,bZ as Zl,b_ as U2,b$ as b0,c0 as N2,c1 as G2,c2 as H2,c3 as V2,c4 as q2,c5 as Y2,c6 as j2,c7 as W2,c8 as bc,c9 as X2,ca as K2,cb as Sc,cc as Ha,cd as Z2}from"./index-DC_zVENO.js";import{ci as AE,cl as dE,ce as mE,ck as pE,cg as gE,cp as yE,cn as vE,co as xE,ch as EE,cm as wE,cj as _E,cf as CE}from"./index-DC_zVENO.js";const To=new T,Fu=new T,$2=new T,S0=new _e;function J2(n,e,t){const i=To.setFromMatrixPosition(n.matrixWorld);i.project(e);const r=t.width/2,s=t.height/2;return[i.x*r+r,-(i.y*s)+s]}function ep(n,e){const t=To.setFromMatrixPosition(n.matrixWorld),i=Fu.setFromMatrixPosition(e.matrixWorld),r=t.sub(i),s=e.getWorldDirection($2);return r.angleTo(s)>Math.PI/2}function tp(n,e,t,i){const r=To.setFromMatrixPosition(n.matrixWorld),s=r.clone();s.project(e),S0.set(s.x,s.y),t.setFromCamera(S0,e);const o=t.intersectObjects(i,!0);if(o.length){const a=o[0].distance;return r.distanceTo(t.ray.origin)<a}return!0}function np(n,e){if(e instanceof Vt)return e.zoom;if(e instanceof It){const t=To.setFromMatrixPosition(n.matrixWorld),i=Fu.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,s=t.distanceTo(i);return 1/(2*Math.tan(r/2)*s)}else return 1}function ip(n,e,t){if(e instanceof It||e instanceof Vt){const i=To.setFromMatrixPosition(n.matrixWorld),r=Fu.setFromMatrixPosition(e.matrixWorld),s=i.distanceTo(r),o=(t[1]-t[0])/(e.far-e.near),a=t[1]-o*e.far;return Math.round(o*s+a)}}const $l=n=>Math.abs(n)<1e-10?0:n;function dA(n,e,t=""){let i="matrix3d(";for(let r=0;r!==16;r++)i+=$l(e[r]*n.elements[r])+(r!==15?",":")");return t+i}const rp=(n=>e=>dA(e,n))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),sp=(n=>(e,t)=>dA(e,n(t),"translate(-50%,-50%)"))(n=>[1/n,1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1]);function op(n){return n&&typeof n=="object"&&"current"in n}const cc=l.forwardRef(({children:n,eps:e=.001,style:t,className:i,prepend:r,center:s,fullscreen:o,portal:a,distanceFactor:c,sprite:u=!1,transform:f=!1,occlude:h,onOcclude:A,castShadow:y,receiveShadow:x,material:d,geometry:v,zIndexRange:g=[16777271,0],calculatePosition:p=J2,as:m="div",wrapperClass:E,pointerEvents:w="auto",..._},C)=>{const{gl:I,camera:b,scene:B,size:Q,raycaster:S,events:k,viewport:L}=J(),[O]=l.useState(()=>document.createElement(m)),G=l.useRef(),V=l.useRef(null),N=l.useRef(0),j=l.useRef([0,0]),Y=l.useRef(null),H=l.useRef(null),X=(a==null?void 0:a.current)||k.connected||I.domElement.parentNode,W=l.useRef(null),P=l.useRef(!1),z=l.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&op(h[0]),[h]);l.useLayoutEffect(()=>{const Z=I.domElement;h&&h==="blending"?(Z.style.zIndex=`${Math.floor(g[0]/2)}`,Z.style.position="absolute",Z.style.pointerEvents="none"):(Z.style.zIndex=null,Z.style.position=null,Z.style.pointerEvents=null)},[h]),l.useLayoutEffect(()=>{if(V.current){const Z=G.current=Gf(O);if(B.updateMatrixWorld(),f)O.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const oe=p(V.current,b,Q);O.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${oe[0]}px,${oe[1]}px,0);transform-origin:0 0;`}return X&&(r?X.prepend(O):X.appendChild(O)),()=>{X&&X.removeChild(O),Z.unmount()}}},[X,f]),l.useLayoutEffect(()=>{E&&(O.className=E)},[E]);const D=l.useMemo(()=>f?{position:"absolute",top:0,left:0,width:Q.width,height:Q.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...o&&{top:-Q.height/2,left:-Q.width/2,width:Q.width,height:Q.height},...t},[t,s,o,Q,f]),R=l.useMemo(()=>({position:"absolute",pointerEvents:w}),[w]);l.useLayoutEffect(()=>{if(P.current=!1,f){var Z;(Z=G.current)==null||Z.render(l.createElement("div",{ref:Y,style:D},l.createElement("div",{ref:H,style:R},l.createElement("div",{ref:C,className:i,style:t,children:n}))))}else{var oe;(oe=G.current)==null||oe.render(l.createElement("div",{ref:C,style:D,className:i,children:n}))}});const $=l.useRef(!0);Se(Z=>{if(V.current){b.updateMatrixWorld(),V.current.updateWorldMatrix(!0,!1);const oe=f?j.current:p(V.current,b,Q);if(f||Math.abs(N.current-b.zoom)>e||Math.abs(j.current[0]-oe[0])>e||Math.abs(j.current[1]-oe[1])>e){const Ae=ep(V.current,b);let de=!1;z&&(Array.isArray(h)?de=h.map(Be=>Be.current):h!=="blending"&&(de=[B]));const le=$.current;if(de){const Be=tp(V.current,b,S,de);$.current=Be&&!Ae}else $.current=!Ae;le!==$.current&&(A?A(!$.current):O.style.display=$.current?"block":"none");const he=Math.floor(g[0]/2),Ie=h?z?[g[0],he]:[he-1,0]:g;if(O.style.zIndex=`${ip(V.current,b,Ie)}`,f){const[Be,K]=[Q.width/2,Q.height/2],U=b.projectionMatrix.elements[5]*K,{isOrthographicCamera:ge,top:Ue,left:yt,bottom:bt,right:Me}=b,Qe=rp(b.matrixWorldInverse),je=ge?`scale(${U})translate(${$l(-(Me+yt)/2)}px,${$l((Ue+bt)/2)}px)`:`translateZ(${U}px)`;let Ve=V.current.matrixWorld;u&&(Ve=b.matrixWorldInverse.clone().transpose().copyPosition(Ve).scale(V.current.scale),Ve.elements[3]=Ve.elements[7]=Ve.elements[11]=0,Ve.elements[15]=1),O.style.width=Q.width+"px",O.style.height=Q.height+"px",O.style.perspective=ge?"":`${U}px`,Y.current&&H.current&&(Y.current.style.transform=`${je}${Qe}translate(${Be}px,${K}px)`,H.current.style.transform=sp(Ve,1/((c||10)/400)))}else{const Be=c===void 0?1:np(V.current,b)*c;O.style.transform=`translate3d(${oe[0]}px,${oe[1]}px,0) scale(${Be})`}j.current=oe,N.current=b.zoom}}if(!z&&W.current&&!P.current)if(f){if(Y.current){const oe=Y.current.children[0];if(oe!=null&&oe.clientWidth&&oe!=null&&oe.clientHeight){const{isOrthographicCamera:Ae}=b;if(Ae||v)_.scale&&(Array.isArray(_.scale)?_.scale instanceof T?W.current.scale.copy(_.scale.clone().divideScalar(1)):W.current.scale.set(1/_.scale[0],1/_.scale[1],1/_.scale[2]):W.current.scale.setScalar(1/_.scale));else{const de=(c||10)/400,le=oe.clientWidth*de,he=oe.clientHeight*de;W.current.scale.set(le,he,1)}P.current=!0}}}else{const oe=O.children[0];if(oe!=null&&oe.clientWidth&&oe!=null&&oe.clientHeight){const Ae=1/L.factor,de=oe.clientWidth*Ae,le=oe.clientHeight*Ae;W.current.scale.set(de,le,1),P.current=!0}W.current.lookAt(Z.camera.position)}});const se=l.useMemo(()=>({vertexShader:f?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[f]);return l.createElement("group",ce({},_,{ref:V}),h&&!z&&l.createElement("mesh",{castShadow:y,receiveShadow:x,ref:W},v||l.createElement("planeGeometry",null),d||l.createElement("shaderMaterial",{side:on,vertexShader:se.vertexShader,fragmentShader:se.fragmentShader})))});function B7({onChanged:n,portal:e,preventDefault:t=!0,scroll:i=!0,keyCode:r=9}){const s=l.useRef(0),o=J(u=>u.setEvents),a=J(u=>u.get),c=J(u=>u.gl);return l.useEffect(()=>{var u;let f=[],h;const A=a().events.filter,y=(u=e==null?void 0:e.current)!==null&&u!==void 0?u:c.domElement.parentNode,x=()=>y&&n&&n(f,Math.round(s.current)%f.length);o({filter:(m,E)=>{let w=[...m];(w.length!==f.length||!f.every(_=>w.map(C=>C.object.uuid).includes(_.object.uuid)))&&(s.current=0,f=w,x()),A&&(w=A(w,E));for(let _=0;_<Math.round(s.current)%w.length;_++){const C=w.shift();w=[...w,C]}return w}});const d=m=>{var E,w;s.current=m(s.current),(E=a().events.handlers)==null||E.onPointerCancel(void 0),(w=a().events.handlers)==null||w.onPointerMove(h),x()},v=m=>{(m.keyCode||m.which)===r&&(t&&m.preventDefault(),f.length>1&&d(E=>E+1))},g=m=>{t&&m.preventDefault();let E=0;m||(m=window.event),m.wheelDelta?E=m.wheelDelta/120:m.detail&&(E=-m.detail/3),f.length>1&&d(w=>Math.abs(w-E))},p=m=>h=m;return document.addEventListener("pointermove",p,{passive:!0}),i&&document.addEventListener("wheel",g),r!==void 0&&document.addEventListener("keydown",v),()=>{o({filter:A}),r!==void 0&&document.removeEventListener("keydown",v),i&&document.removeEventListener("wheel",g),document.removeEventListener("pointermove",p)}},[c,a,o,t,i,r]),null}function b7(n,e="pointer",t="auto",i=document.body){l.useEffect(()=>{if(n)return i.style.cursor=e,()=>void(i.style.cursor=t)},[n])}let ys=0;const mA=Wm(n=>(Lo.onStart=(e,t,i)=>{n({active:!0,item:e,loaded:t,total:i,progress:(t-ys)/(i-ys)*100})},Lo.onLoad=()=>{n({active:!1})},Lo.onError=e=>n(t=>({errors:[...t.errors,e]})),Lo.onProgress=(e,t,i)=>{t===i&&(ys=i),n({active:!0,item:e,loaded:t,total:i,progress:(t-ys)/(i-ys)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function S7({children:n}){const e=mA();return l.createElement(l.Fragment,null,n==null?void 0:n(e))}const ap=n=>`Loading ${n.toFixed(2)}%`;function M7({containerStyles:n,innerStyles:e,barStyles:t,dataStyles:i,dataInterpolation:r=ap,initialState:s=o=>o}){const{active:o,progress:a}=mA(),c=l.useRef(0),u=l.useRef(0),f=l.useRef(null),[h,A]=l.useState(s(o));l.useEffect(()=>{let x;return o!==h&&(x=setTimeout(()=>A(o),300)),()=>clearTimeout(x)},[h,o]);const y=l.useCallback(()=>{f.current&&(c.current+=(a-c.current)/2,(c.current>.95*a||a===100)&&(c.current=a),f.current.innerText=r(c.current),c.current<a&&(u.current=requestAnimationFrame(y)))},[r,a]);return l.useEffect(()=>(y(),()=>cancelAnimationFrame(u.current)),[y]),h?l.createElement("div",{style:{...Oo.container,opacity:o?1:0,...n}},l.createElement("div",null,l.createElement("div",{style:{...Oo.inner,...e}},l.createElement("div",{style:{...Oo.bar,transform:`scaleX(${a/100})`,...t}}),l.createElement("span",{ref:f,style:{...Oo.data,...i}})))):null}const Oo={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}},Mc=new T,M0=new _e,ir=new T,Uo=new T,vs=new T,T0=new Di,T7=l.forwardRef(({autoTransform:n=!0,matrix:e,axisLock:t,dragLimits:i,onHover:r,onDragStart:s,onDrag:o,onDragEnd:a,children:c,dragConfig:u,...f},h)=>{const A=J(m=>m.controls),{camera:y,size:x,raycaster:d,invalidate:v}=J(),g=l.useRef(null),p=Hf({onHover:({hovering:m})=>r&&r(m??!1),onDragStart:({event:m})=>{A&&(A.enabled=!1);const{point:E}=m;g.current.matrix.decompose(Mc,new Fe,new T),ir.copy(E),Uo.copy(ir).sub(Mc),s&&s(Mc),v()},onDrag:({xy:[m,E],intentional:w})=>{if(!w)return;const _=(m-x.left)/x.width*2-1,C=-((E-x.top)/x.height)*2+1;if(M0.set(_,C),d.setFromCamera(M0,y),!t)y.getWorldDirection(vs).negate();else switch(t){case"x":vs.set(1,0,0);break;case"y":vs.set(0,1,0);break;case"z":vs.set(0,0,1);break}T0.setFromNormalAndCoplanarPoint(vs,ir),d.ray.intersectPlane(T0,ir);const I=g.current.matrix.clone(),b=g.current.matrixWorld.clone(),B=new T(ir.x-Uo.x,ir.y-Uo.y,ir.z-Uo.z);if(i&&(B.x=i[0]?Math.max(Math.min(B.x,i[0][1]),i[0][0]):B.x,B.y=i[1]?Math.max(Math.min(B.y,i[1][1]),i[1][0]):B.y,B.z=i[2]?Math.max(Math.min(B.z,i[2][1]),i[2][0]):B.z),n){g.current.matrix.setPosition(B);const Q=g.current.matrix.clone().multiply(I.invert()),S=g.current.matrix.clone().multiply(b.invert());o&&o(g.current.matrix,Q,g.current.matrixWorld,S)}else{const Q=new ue().copy(g.current.matrix);Q.setPosition(B);const S=Q.clone().multiply(I.invert()),k=Q.clone().multiply(b.invert());o&&o(Q,S,g.current.matrixWorld,k)}v()},onDragEnd:()=>{A&&(A.enabled=!0),a&&a(),v()}},{drag:{filterTaps:!0,threshold:1,...typeof u=="object"?u:{}}});return l.useImperativeHandle(h,()=>g.current,[]),l.useLayoutEffect(()=>{e&&(g.current.matrix=e)},[e]),l.createElement("group",ce({ref:g},p(),{matrix:e,matrixAutoUpdate:!1},f),c)});function ho(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Jl(n,e){return Jl=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},Jl(n,e)}function cp(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function lp(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],f=e[7],h=e[8];return i*a*h+r*c*u+s*o*f-s*a*u-r*o*h-i*c*f}function P0(n,e){for(var t=[],i=n.toArray(),r=e.toArray(),s=0;s<i.length;s++)t[s]=i[s]+r[s];return new Qn().fromArray(t)}function up(n){if(Array.isArray(n))return n}function hp(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var i=[],r=!0,s=!1,o,a;try{for(t=t.call(n);!(r=(o=t.next()).done)&&(i.push(o.value),!(e&&i.length===e));r=!0);}catch(c){s=!0,a=c}finally{try{!r&&t.return!=null&&t.return()}finally{if(s)throw a}}return i}}function eu(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}function pA(n,e){if(n){if(typeof n=="string")return eu(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return eu(n,e)}}function fp(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vi(n,e){return up(n)||hp(n,e)||pA(n,e)||fp()}function Ap(n){if(Array.isArray(n))return eu(n)}function dp(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function mp(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Va(n){return Ap(n)||dp(n)||pA(n)||mp()}function Ra(n,e,t){return cp()?Ra=Reflect.construct:Ra=function(r,s,o){var a=[null];a.push.apply(a,s);var c=Function.bind.apply(r,a),u=new c;return o&&Jl(u,o.prototype),u},Ra.apply(null,arguments)}function pp(n){var e=vi(n[0],2),t=e[0],i=e[1],r=vi(n[1],2),s=r[0],o=r[1],a=vi(n[2],2),c=a[0],u=a[1];return lp(t,i,1,s,o,1,c,u,1)}function gp(n){return pp(n)===0}var yp=new _e,vp=new _e;function D0(n){var e=n.map(function(u){return Array.isArray(u)?Ra(_e,Va(u)):u}),t=vi(e,3),i=t[0],r=t[1],s=t[2];if(gp(n))return!1;var o=yp.subVectors(r,i),a=vp.subVectors(s,i),c=a.cross(o);return c>0}function gA(n,e,t){return Math.max(e,Math.min(t,n))}function yA(n,e){return gA(n-Math.floor(n/e)*e,0,e)}function vA(n,e){var t=yA(e-n,Math.PI*2);return t>Math.PI&&(t-=Math.PI*2),t}function xp(n){return n/180*Math.PI}function Ep(n){return n*180/Math.PI}function wp(n,e){for(var t=e.radius,i=t===void 0?1:t,r=n.length/3,s=2/r,o=Math.PI*(3-2.2360679775),a=0;a<n.length;a+=3){var c=a*s-1+s/2,u=Math.sqrt(1-Math.pow(c,2)),f=a%r*o,h=Math.cos(f)*u,A=Math.sin(f)*u;n[a]=h*i,n[a+1]=c*i,n[a+2]=A*i}}function _p(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.EPSILON;return Math.abs(n.x-e.x)<t&&Math.abs(n.y-e.y)<t&&Math.abs(n.z-e.z)<t}function xA(n,e){return n.x===e.x?typeof n.z<"u"&&n.y===e.y?n.z-e.z:n.y-e.y:n.x-e.x}function Cp(n){for(var e=n.sort(xA),t=[e[0],e[1]],i=2;i<e.length;i++)for(t.push(e[i]);t.length>2&&D0(Va(t.slice(-3)));)t.splice(t.length-2,1);for(var r=[e[e.length-1],e[e.length-2]],s=e.length-3;s>=0;s--)for(r.push(e[s]);r.length>2&&D0(Va(r.slice(-3)));)r.splice(r.length-2,1);r.splice(0,1),r.splice(r.length-1,1);var o=[].concat(t,r);return o}function Ip(n,e,t){var i=vi(e,2),r=i[0],s=i[1],o=vi(t,2),a=o[0],c=o[1];return a+(n-r)*(c-a)/(s-r)}function Bp(n){return n*n*n*(n*(n*6-15)+10)}function bp(n,e,t){return n*(1-t)+e*t}function EA(n,e,t){return(t-n)/(e-n)}function Sp(n,e,t){var i=Math.sqrt(n*n+e*e+t*t);return[n/i,e/i,t/i]}function Mp(n,e,t){var i=n*n,r=e*e,s=t*t,o=n*Math.sqrt(1-(r+s)/2+r*s/3),a=e*Math.sqrt(1-(s+i)/2+s*i/3),c=t*Math.sqrt(1-(i+r)/2+i*r/3);return[o,a,c]}function wA(n,e){var t=new T().crossVectors(n,e),i=n.dot(e),r=new Qn().identity(),s=new Qn().set(0,-t.z,t.y,t.z,0,-t.x,-t.y,t.x,0),o=new Qn().multiplyMatrices(s,s).multiplyScalar(1/(1+i)),a=P0(P0(r,s),o);return a}function Tp(n,e,t){var i=Math.asin(e),r=Math.atan2(n,-t);return[i,r]}function Pp(n,e){var t=Math.sin(n),i=Math.cos(n),r=Math.sin(e)*i,s=-Math.cos(e)*i;return[r,t,s]}function Dp(n,e){var t=vi(e,2),i=t[0],r=t[1],s=wA(n.normal,new T(0,1,0)),o=EA(i.clone().applyMatrix3(s).y,r.clone().applyMatrix3(s).y,0);return new T().lerpVectors(i,r,o)}function Qp(n,e){var t=e.normal.dot(n);return t}function Rp(n,e){var t=vi(n,3),i=t[0],r=t[1],s=t[2],o=vi(e,2),a=o[0],c=o[1];return s*a*c+r*a+i}function zp(n,e){var t=vi(e,2),i=t[0],r=t[1],s=i*r,o=n/s,a=n-s*o,c=a/i,u=a%i;return[u,c,o]}function Fp(n,e){return n[0]+e[0]*n[1]}function Lp(n,e){var t=n%e,i=Math.floor(n/e);return[t,i]}var Tc=Object.freeze({__proto__:null,clamp:gA,repeat:yA,deltaAngle:vA,degToRad:xp,radToDeg:Ep,fibonacciOnSphere:wp,vectorEquals:_p,lexicographic:xA,convexHull:Cp,remap:Ip,fade:Bp,lerp:bp,inverseLerp:EA,normalize:Sp,pointOnCubeToPointOnSphere:Mp,rotateVectorOnVector:wA,pointToCoordinate:Tp,coordinateToPoint:Pp,planeSegmentIntersection:Dp,pointToPlaneDistance:Qp,getIndexFrom3D:Rp,get3DFromIndex:zp,getIndexFrom2D:Fp,get2DFromIndex:Lp});function _A(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var bn=function n(e,t,i){var r=this;_A(this,n),ho(this,"dot2",function(s,o){return r.x*s+r.y*o}),ho(this,"dot3",function(s,o,a){return r.x*s+r.y*o+r.z*a}),this.x=e,this.y=t,this.z=i},kp=[new bn(1,1,0),new bn(-1,1,0),new bn(1,-1,0),new bn(-1,-1,0),new bn(1,0,1),new bn(-1,0,1),new bn(1,0,-1),new bn(-1,0,-1),new bn(0,1,1),new bn(0,-1,1),new bn(0,1,-1),new bn(0,-1,-1)],Q0=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],R0=new Array(512),z0=new Array(512),Op=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var t=0;t<256;t++){var i;t&1?i=Q0[t]^e&255:i=Q0[t]^e>>8&255,R0[t]=R0[t+256]=i,z0[t]=z0[t+256]=kp[i%12]}};Op(0);function Up(n){if(typeof n=="number")n=Math.abs(n);else if(typeof n=="string"){var e=n;n=0;for(var t=0;t<e.length;t++)n=(n+(t+1)*(e.charCodeAt(t)%96))%2147483647}return n===0&&(n=311),n}function F0(n){var e=Up(n);return function(){var t=e*48271%2147483647;return e=t,t/2147483647}}var Np=function n(e){var t=this;_A(this,n),ho(this,"seed",0),ho(this,"init",function(i){t.seed=i,t.value=F0(i)}),ho(this,"value",F0(this.seed)),this.init(e)};new Np(Math.random());var Gp=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return i/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*r)/t)},CA=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)},Hp=function(e){return e},Vp={in:function(e){return 1-Math.cos(e*Math.PI/2)},out:function(e){return Math.sin(e*Math.PI/2)},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},qp={in:function(e){return e*e*e},out:function(e){return 1-Math.pow(1-e,3)},inOut:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}},Yp={in:function(e){return e*e*e*e*e},out:function(e){return 1-Math.pow(1-e,5)},inOut:function(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}},jp={in:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},out:function(e){return Math.sqrt(1-Math.pow(e-1,2))},inOut:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}},Wp={in:function(e){return e*e*e*e},out:function(e){return 1- --e*e*e*e},inOut:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}},Xp={in:function(e){return e===0?0:Math.pow(2,10*e-10)},out:function(e){return e===1?1:1-Math.pow(2,-10*e)},inOut:function(e){return e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}};function kt(n,e,t){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:CA,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,c="velocity_"+e;if(n.__damp===void 0&&(n.__damp={}),n.__damp[c]===void 0&&(n.__damp[c]=0),Math.abs(n[e]-t)<=a)return n[e]=t,!1;i=Math.max(1e-4,i);var u=2/i,f=o(u*r),h=n[e]-t,A=t,y=s*i;h=Math.min(Math.max(h,-y),y),t=n[e]-h;var x=(n.__damp[c]+u*h)*r;n.__damp[c]=(n.__damp[c]-u*x)*f;var d=t+(h+x)*f;return A-n[e]>0==d>A&&(d=A,n.__damp[c]=(d-A)/r),n[e]=d,!0}var Kp=function(e){return e&&e.isCamera},Zp=function(e){return e&&e.isLight},xs=new T,L0=new Fe,k0=new Fe,Es=new ue,Pc=new T;function $p(n,e,t,i,r,s,o){typeof e=="number"?xs.setScalar(e):Array.isArray(e)?xs.set(e[0],e[1],e[2]):xs.copy(e);var a=n.parent;n.updateWorldMatrix(!0,!1),Pc.setFromMatrixPosition(n.matrixWorld),Kp(n)||Zp(n)?Es.lookAt(Pc,xs,n.up):Es.lookAt(xs,Pc,n.up),qa(n.quaternion,k0.setFromRotationMatrix(Es),t,i,r,s,o),a&&(Es.extractRotation(a.matrixWorld),L0.setFromRotationMatrix(Es),qa(n.quaternion,k0.copy(n.quaternion).premultiply(L0.invert()),t,i,r,s,o))}function ns(n,e,t,i,r,s,o,a){return kt(n,e,n[e]+vA(n[e],t),i,r,s,o,a)}var ws=new _e,O0,U0;function Jp(n,e,t,i,r,s,o){return typeof e=="number"?ws.setScalar(e):Array.isArray(e)?ws.set(e[0],e[1]):ws.copy(e),O0=kt(n,"x",ws.x,t,i,r,s,o),U0=kt(n,"y",ws.y,t,i,r,s,o),O0||U0}var vr=new T,N0,G0,H0;function tu(n,e,t,i,r,s,o){return typeof e=="number"?vr.setScalar(e):Array.isArray(e)?vr.set(e[0],e[1],e[2]):vr.copy(e),N0=kt(n,"x",vr.x,t,i,r,s,o),G0=kt(n,"y",vr.y,t,i,r,s,o),H0=kt(n,"z",vr.z,t,i,r,s,o),N0||G0||H0}var rr=new Qt,V0,q0,Y0,j0;function e3(n,e,t,i,r,s,o){return typeof e=="number"?rr.setScalar(e):Array.isArray(e)?rr.set(e[0],e[1],e[2],e[3]):rr.copy(e),V0=kt(n,"x",rr.x,t,i,r,s,o),q0=kt(n,"y",rr.y,t,i,r,s,o),Y0=kt(n,"z",rr.z,t,i,r,s,o),j0=kt(n,"w",rr.w,t,i,r,s,o),V0||q0||Y0||j0}var _s=new En,W0,X0,K0;function t3(n,e,t,i,r,s,o){return Array.isArray(e)?_s.set(e[0],e[1],e[2],e[3]):_s.copy(e),W0=ns(n,"x",_s.x,t,i,r,s,o),X0=ns(n,"y",_s.y,t,i,r,s,o),K0=ns(n,"z",_s.z,t,i,r,s,o),W0||X0||K0}var xr=new ze,Z0,$0,J0;function n3(n,e,t,i,r,s,o){return e instanceof ze?xr.copy(e):Array.isArray(e)?xr.setRGB(e[0],e[1],e[2]):xr.set(e),Z0=kt(n,"r",xr.r,t,i,r,s,o),$0=kt(n,"g",xr.g,t,i,r,s,o),J0=kt(n,"b",xr.b,t,i,r,s,o),Z0||$0||J0}var qn=new Fe,_i=new Qt,eh=new Qt,Cs=new Qt,th,nh,ih,rh;function qa(n,e,t,i,r,s,o){var a=n;Array.isArray(e)?qn.set(e[0],e[1],e[2],e[3]):qn.copy(e);var c=n.dot(qn)>0?1:-1;return qn.x*=c,qn.y*=c,qn.z*=c,qn.w*=c,th=kt(n,"x",qn.x,t,i,r,s,o),nh=kt(n,"y",qn.y,t,i,r,s,o),ih=kt(n,"z",qn.z,t,i,r,s,o),rh=kt(n,"w",qn.w,t,i,r,s,o),_i.set(n.x,n.y,n.z,n.w).normalize(),eh.set(a.__damp.velocity_x,a.__damp.velocity_y,a.__damp.velocity_z,a.__damp.velocity_w),Cs.copy(_i).multiplyScalar(eh.dot(_i)/_i.dot(_i)),a.__damp.velocity_x-=Cs.x,a.__damp.velocity_y-=Cs.y,a.__damp.velocity_z-=Cs.z,a.__damp.velocity_w-=Cs.w,n.set(_i.x,_i.y,_i.z,_i.w),th||nh||ih||rh}var Is=new tc,sh,oh,ah;function i3(n,e,t,i,r,s,o){return Array.isArray(e)?Is.set(e[0],e[1],e[2]):Is.copy(e),sh=kt(n,"radius",Is.radius,t,i,r,s,o),oh=ns(n,"phi",Is.phi,t,i,r,s,o),ah=ns(n,"theta",Is.theta,t,i,r,s,o),sh||oh||ah}var No=new ue,ch=new T,lh=new Fe,uh=new T,hh,fh,Ah;function r3(n,e,t,i,r,s,o){var a=n;return a.__damp===void 0&&(a.__damp={position:new T,rotation:new Fe,scale:new T},n.decompose(a.__damp.position,a.__damp.rotation,a.__damp.scale)),Array.isArray(e)?No.set.apply(No,Va(e)):No.copy(e),No.decompose(ch,lh,uh),hh=tu(a.__damp.position,ch,t,i,r,s,o),fh=qa(a.__damp.rotation,lh,t,i,r,s,o),Ah=tu(a.__damp.scale,uh,t,i,r,s,o),n.compose(a.__damp.position,a.__damp.rotation,a.__damp.scale),hh||fh||Ah}var as=Object.freeze({__proto__:null,rsqw:Gp,exp:CA,linear:Hp,sine:Vp,cubic:qp,quint:Yp,circ:jp,quart:Wp,expo:Xp,damp:kt,dampLookAt:$p,dampAngle:ns,damp2:Jp,damp3:tu,damp4:e3,dampE:t3,dampC:n3,dampQ:qa,dampS:i3,dampM:r3});const Lu=l.createContext(null);function IA(){return l.useContext(Lu)}function P7({eps:n=1e-5,enabled:e=!0,infinite:t,horizontal:i,pages:r=1,distance:s=1,damping:o=.25,maxSpeed:a=1/0,prepend:c=!1,style:u={},children:f}){const{get:h,setEvents:A,gl:y,size:x,invalidate:d,events:v}=J(),[g]=l.useState(()=>document.createElement("div")),[p]=l.useState(()=>document.createElement("div")),[m]=l.useState(()=>document.createElement("div")),E=y.domElement.parentNode,w=l.useRef(0),_=l.useMemo(()=>({el:g,eps:n,fill:p,fixed:m,horizontal:i,damping:o,offset:0,delta:0,scroll:w,pages:r,range(b,B,Q=0){const S=b-Q,k=S+B+Q*2;return this.offset<S?0:this.offset>k?1:(this.offset-S)/(k-S)},curve(b,B,Q=0){return Math.sin(this.range(b,B,Q)*Math.PI)},visible(b,B,Q=0){const S=b-Q,k=S+B+Q*2;return this.offset>=S&&this.offset<=k}}),[n,o,i,r]);l.useEffect(()=>{g.style.position="absolute",g.style.width="100%",g.style.height="100%",g.style[i?"overflowX":"overflowY"]="auto",g.style[i?"overflowY":"overflowX"]="hidden",g.style.top="0px",g.style.left="0px";for(const B in u)g.style[B]=u[B];m.style.position="sticky",m.style.top="0px",m.style.left="0px",m.style.width="100%",m.style.height="100%",m.style.overflow="hidden",g.appendChild(m),p.style.height=i?"100%":`${r*s*100}%`,p.style.width=i?`${r*s*100}%`:"100%",p.style.pointerEvents="none",g.appendChild(p),c?E.prepend(g):E.appendChild(g),g[i?"scrollLeft":"scrollTop"]=1;const I=v.connected||y.domElement;requestAnimationFrame(()=>v.connect==null?void 0:v.connect(g));const b=h().events.compute;return A({compute(B,Q){const{left:S,top:k}=E.getBoundingClientRect(),L=B.clientX-S,O=B.clientY-k;Q.pointer.set(L/Q.size.width*2-1,-(O/Q.size.height)*2+1),Q.raycaster.setFromCamera(Q.pointer,Q.camera)}}),()=>{E.removeChild(g),A({compute:b}),v.connect==null||v.connect(I)}},[r,s,i,g,p,m,E]),l.useEffect(()=>{if(v.connected===g){const I=x[i?"width":"height"],b=g[i?"scrollWidth":"scrollHeight"],B=b-I;let Q=0,S=!0,k=!0;const L=()=>{if(!(!e||k)&&(d(),Q=g[i?"scrollLeft":"scrollTop"],w.current=Q/B,t)){if(!S){if(Q>=B){const G=1-_.offset;g[i?"scrollLeft":"scrollTop"]=1,w.current=_.offset=-G,S=!0}else if(Q<=0){const G=1+_.offset;g[i?"scrollLeft":"scrollTop"]=b,w.current=_.offset=G,S=!0}}S&&setTimeout(()=>S=!1,40)}};g.addEventListener("scroll",L,{passive:!0}),requestAnimationFrame(()=>k=!1);const O=G=>g.scrollLeft+=G.deltaY/2;return i&&g.addEventListener("wheel",O,{passive:!0}),()=>{g.removeEventListener("scroll",L),i&&g.removeEventListener("wheel",O)}}},[g,v,x,t,_,d,i,e]);let C=0;return Se((I,b)=>{C=_.offset,as.damp(_,"offset",w.current,o,b,a,void 0,n),as.damp(_,"delta",Math.abs(C-_.offset),o,b,a,void 0,n),_.delta>n&&d()}),l.createElement(Lu.Provider,{value:_},f)}const s3=l.forwardRef(({children:n},e)=>{const t=l.useRef(null);l.useImperativeHandle(e,()=>t.current,[]);const i=IA(),{width:r,height:s}=J(o=>o.viewport);return Se(()=>{t.current.position.x=i.horizontal?-r*(i.pages-1)*i.offset:0,t.current.position.y=i.horizontal?0:s*(i.pages-1)*i.offset}),l.createElement("group",{ref:t},n)}),o3=l.forwardRef(({children:n,style:e,...t},i)=>{const r=IA(),s=l.useRef(null);l.useImperativeHandle(i,()=>s.current,[]);const{width:o,height:a}=J(f=>f.size),c=l.useContext(Yl),u=l.useMemo(()=>Gf(r.fixed),[r.fixed]);return Se(()=>{r.delta>r.eps&&(s.current.style.transform=`translate3d(${r.horizontal?-o*(r.pages-1)*r.offset:0}px,${r.horizontal?0:a*(r.pages-1)*-r.offset}px,0)`)}),u.render(l.createElement("div",ce({ref:s,style:{...e,position:"absolute",top:0,left:0,willChange:"transform"}},t),l.createElement(Lu.Provider,{value:r},l.createElement(Yl.Provider,{value:c},n)))),null}),D7=l.forwardRef(({html:n,...e},t)=>{const i=n?o3:s3;return l.createElement(i,ce({ref:t},e))});let ku=Do();const Oe=n=>Po(n,ku);let Ou=Do();Oe.write=n=>Po(n,Ou);let lc=Do();Oe.onStart=n=>Po(n,lc);let Uu=Do();Oe.onFrame=n=>Po(n,Uu);let Nu=Do();Oe.onFinish=n=>Po(n,Nu);let is=[];Oe.setTimeout=(n,e)=>{let t=Oe.now()+e,i=()=>{let s=is.findIndex(o=>o.cancel==i);~s&&is.splice(s,1),Vi-=~s?1:0},r={time:t,handler:n,cancel:i};return is.splice(BA(t),0,r),Vi+=1,bA(),r};let BA=n=>~(~is.findIndex(e=>e.time>n)||~is.length);Oe.cancel=n=>{lc.delete(n),Uu.delete(n),Nu.delete(n),ku.delete(n),Ou.delete(n)};Oe.sync=n=>{nu=!0,Oe.batchedUpdates(n),nu=!1};Oe.throttle=n=>{let e;function t(){try{n(...e)}finally{e=null}}function i(...r){e=r,Oe.onStart(t)}return i.handler=n,i.cancel=()=>{lc.delete(t),e=null},i};let Gu=typeof window<"u"?window.requestAnimationFrame:()=>{};Oe.use=n=>Gu=n;Oe.now=typeof performance<"u"?()=>performance.now():Date.now;Oe.batchedUpdates=n=>n();Oe.catch=console.error;Oe.frameLoop="always";Oe.advance=()=>{Oe.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):MA()};let Hi=-1,Vi=0,nu=!1;function Po(n,e){nu?(e.delete(n),n(0)):(e.add(n),bA())}function bA(){Hi<0&&(Hi=0,Oe.frameLoop!=="demand"&&Gu(SA))}function a3(){Hi=-1}function SA(){~Hi&&(Gu(SA),Oe.batchedUpdates(MA))}function MA(){let n=Hi;Hi=Oe.now();let e=BA(Hi);if(e&&(TA(is.splice(0,e),t=>t.handler()),Vi-=e),!Vi){a3();return}lc.flush(),ku.flush(n?Math.min(64,Hi-n):16.667),Uu.flush(),Ou.flush(),Nu.flush()}function Do(){let n=new Set,e=n;return{add(t){Vi+=e==n&&!n.has(t)?1:0,n.add(t)},delete(t){return Vi-=e==n&&n.has(t)?1:0,n.delete(t)},flush(t){e.size&&(n=new Set,Vi-=e.size,TA(e,i=>i(t)&&n.add(i)),Vi+=n.size,e=n)}}}function TA(n,e){n.forEach(t=>{try{e(t)}catch(i){Oe.catch(i)}})}function iu(){}const c3=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0}),Ee={arr:Array.isArray,obj:n=>!!n&&n.constructor.name==="Object",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",und:n=>n===void 0};function Mi(n,e){if(Ee.arr(n)){if(!Ee.arr(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}return n===e}const Je=(n,e)=>n.forEach(e);function Ti(n,e,t){if(Ee.arr(n)){for(let i=0;i<n.length;i++)e.call(t,n[i],`${i}`);return}for(const i in n)n.hasOwnProperty(i)&&e.call(t,n[i],i)}const kn=n=>Ee.und(n)?[]:Ee.arr(n)?n:[n];function fo(n,e){if(n.size){const t=Array.from(n);n.clear(),Je(t,e)}}const ro=(n,...e)=>fo(n,t=>t(...e)),Hu=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent);let Vu,PA,ji=null,DA=!1,qu=iu;const l3=n=>{n.to&&(PA=n.to),n.now&&(Oe.now=n.now),n.colors!==void 0&&(ji=n.colors),n.skipAnimation!=null&&(DA=n.skipAnimation),n.createStringInterpolator&&(Vu=n.createStringInterpolator),n.requestAnimationFrame&&Oe.use(n.requestAnimationFrame),n.batchedUpdates&&(Oe.batchedUpdates=n.batchedUpdates),n.willAdvance&&(qu=n.willAdvance),n.frameLoop&&(Oe.frameLoop=n.frameLoop)};var xi=Object.freeze({__proto__:null,get createStringInterpolator(){return Vu},get to(){return PA},get colors(){return ji},get skipAnimation(){return DA},get willAdvance(){return qu},assign:l3});const Ao=new Set;let Rn=[],Dc=[],Ya=0;const uc={get idle(){return!Ao.size&&!Rn.length},start(n){Ya>n.priority?(Ao.add(n),Oe.onStart(u3)):(QA(n),Oe(ru))},advance:ru,sort(n){if(Ya)Oe.onFrame(()=>uc.sort(n));else{const e=Rn.indexOf(n);~e&&(Rn.splice(e,1),RA(n))}},clear(){Rn=[],Ao.clear()}};function u3(){Ao.forEach(QA),Ao.clear(),Oe(ru)}function QA(n){Rn.includes(n)||RA(n)}function RA(n){Rn.splice(h3(Rn,e=>e.priority>n.priority),0,n)}function ru(n){const e=Dc;for(let t=0;t<Rn.length;t++){const i=Rn[t];Ya=i.priority,i.idle||(qu(i),i.advance(n),i.idle||e.push(i))}return Ya=0,Dc=Rn,Dc.length=0,Rn=e,Rn.length>0}function h3(n,e){const t=n.findIndex(e);return t<0?n.length:t}const f3=(n,e,t)=>Math.min(Math.max(t,n),e),A3={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},Jn="[-+]?\\d*\\.?\\d+",ja=Jn+"%";function hc(...n){return"\\(\\s*("+n.join(")\\s*,\\s*(")+")\\s*\\)"}const d3=new RegExp("rgb"+hc(Jn,Jn,Jn)),m3=new RegExp("rgba"+hc(Jn,Jn,Jn,Jn)),p3=new RegExp("hsl"+hc(Jn,ja,ja)),g3=new RegExp("hsla"+hc(Jn,ja,ja,Jn)),y3=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,v3=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,x3=/^#([0-9a-fA-F]{6})$/,E3=/^#([0-9a-fA-F]{8})$/;function w3(n){let e;return typeof n=="number"?n>>>0===n&&n>=0&&n<=4294967295?n:null:(e=x3.exec(n))?parseInt(e[1]+"ff",16)>>>0:ji&&ji[n]!==void 0?ji[n]:(e=d3.exec(n))?(Er(e[1])<<24|Er(e[2])<<16|Er(e[3])<<8|255)>>>0:(e=m3.exec(n))?(Er(e[1])<<24|Er(e[2])<<16|Er(e[3])<<8|ph(e[4]))>>>0:(e=y3.exec(n))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=E3.exec(n))?parseInt(e[1],16)>>>0:(e=v3.exec(n))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=p3.exec(n))?(dh(mh(e[1]),Go(e[2]),Go(e[3]))|255)>>>0:(e=g3.exec(n))?(dh(mh(e[1]),Go(e[2]),Go(e[3]))|ph(e[4]))>>>0:null}function Qc(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function dh(n,e,t){const i=t<.5?t*(1+e):t+e-t*e,r=2*t-i,s=Qc(r,i,n+1/3),o=Qc(r,i,n),a=Qc(r,i,n-1/3);return Math.round(s*255)<<24|Math.round(o*255)<<16|Math.round(a*255)<<8}function Er(n){const e=parseInt(n,10);return e<0?0:e>255?255:e}function mh(n){return(parseFloat(n)%360+360)%360/360}function ph(n){const e=parseFloat(n);return e<0?0:e>1?255:Math.round(e*255)}function Go(n){const e=parseFloat(n);return e<0?0:e>100?1:e/100}function gh(n){let e=w3(n);if(e===null)return n;e=e||0;let t=(e&4278190080)>>>24,i=(e&16711680)>>>16,r=(e&65280)>>>8,s=(e&255)/255;return`rgba(${t}, ${i}, ${r}, ${s})`}const wo=(n,e,t)=>{if(Ee.fun(n))return n;if(Ee.arr(n))return wo({range:n,output:e,extrapolate:t});if(Ee.str(n.output[0]))return Vu(n);const i=n,r=i.output,s=i.range||[0,1],o=i.extrapolateLeft||i.extrapolate||"extend",a=i.extrapolateRight||i.extrapolate||"extend",c=i.easing||(u=>u);return u=>{const f=C3(u,s);return _3(u,s[f],s[f+1],r[f],r[f+1],c,o,a,i.map)}};function _3(n,e,t,i,r,s,o,a,c){let u=c?c(n):n;if(u<e){if(o==="identity")return u;o==="clamp"&&(u=e)}if(u>t){if(a==="identity")return u;a==="clamp"&&(u=t)}return i===r?i:e===t?n<=e?i:r:(e===-1/0?u=-u:t===1/0?u=u-e:u=(u-e)/(t-e),u=s(u),i===-1/0?u=-u:r===1/0?u=u+i:u=u*(r-i)+i,u)}function C3(n,e){for(var t=1;t<e.length-1&&!(e[t]>=n);++t);return t-1}const I3=(n,e="end")=>t=>{t=e==="end"?Math.min(t,.999):Math.max(t,.001);const i=t*n,r=e==="end"?Math.floor(i):Math.ceil(i);return f3(0,1,r/n)},Wa=1.70158,Ho=Wa*1.525,yh=Wa+1,vh=2*Math.PI/3,xh=2*Math.PI/4.5,Vo=n=>n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375,B3={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>1-(1-n)*(1-n),easeInOutQuad:n=>n<.5?2*n*n:1-Math.pow(-2*n+2,2)/2,easeInCubic:n=>n*n*n,easeOutCubic:n=>1-Math.pow(1-n,3),easeInOutCubic:n=>n<.5?4*n*n*n:1-Math.pow(-2*n+2,3)/2,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1-Math.pow(1-n,4),easeInOutQuart:n=>n<.5?8*n*n*n*n:1-Math.pow(-2*n+2,4)/2,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1-Math.pow(1-n,5),easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1-Math.pow(-2*n+2,5)/2,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n===0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n===1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n===0?0:n===1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2,easeInCirc:n=>1-Math.sqrt(1-Math.pow(n,2)),easeOutCirc:n=>Math.sqrt(1-Math.pow(n-1,2)),easeInOutCirc:n=>n<.5?(1-Math.sqrt(1-Math.pow(2*n,2)))/2:(Math.sqrt(1-Math.pow(-2*n+2,2))+1)/2,easeInBack:n=>yh*n*n*n-Wa*n*n,easeOutBack:n=>1+yh*Math.pow(n-1,3)+Wa*Math.pow(n-1,2),easeInOutBack:n=>n<.5?Math.pow(2*n,2)*((Ho+1)*2*n-Ho)/2:(Math.pow(2*n-2,2)*((Ho+1)*(n*2-2)+Ho)+2)/2,easeInElastic:n=>n===0?0:n===1?1:-Math.pow(2,10*n-10)*Math.sin((n*10-10.75)*vh),easeOutElastic:n=>n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n*10-.75)*vh)+1,easeInOutElastic:n=>n===0?0:n===1?1:n<.5?-(Math.pow(2,20*n-10)*Math.sin((20*n-11.125)*xh))/2:Math.pow(2,-20*n+10)*Math.sin((20*n-11.125)*xh)/2+1,easeInBounce:n=>1-Vo(1-n),easeOutBounce:Vo,easeInOutBounce:n=>n<.5?(1-Vo(1-2*n))/2:(1+Vo(2*n-1))/2,steps:I3};function su(){return su=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},su.apply(this,arguments)}const cs=Symbol.for("FluidValue.get"),fr=Symbol.for("FluidValue.observers"),Ai=n=>!!(n&&n[cs]),Dn=n=>n&&n[cs]?n[cs]():n,Eh=n=>n[fr]||null;function b3(n,e){n.eventObserved?n.eventObserved(e):n(e)}function Xa(n,e){let t=n[fr];t&&t.forEach(i=>{b3(i,e)})}class S3{constructor(e){if(this[cs]=void 0,this[fr]=void 0,!e&&!(e=this.get))throw Error("Unknown getter");M3(this,e)}}const M3=(n,e)=>zA(n,cs,e);function Qo(n,e){if(n[cs]){let t=n[fr];t||zA(n,fr,t=new Set),t.has(e)||(t.add(e),n.observerAdded&&n.observerAdded(t.size,e))}return e}function Ka(n,e){let t=n[fr];if(t&&t.has(e)){const i=t.size-1;i?t.delete(e):n[fr]=null,n.observerRemoved&&n.observerRemoved(i,e)}}const zA=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0}),za=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,T3=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,wh=new RegExp(`(${za.source})(%|[a-z]+)`,"i"),P3=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,fc=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,FA=n=>{const[e,t]=D3(n);if(!e||Hu())return n;const i=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(i)return i.trim();if(t&&t.startsWith("--")){const r=window.getComputedStyle(document.documentElement).getPropertyValue(t);return r||n}else{if(t&&fc.test(t))return FA(t);if(t)return t}return n},D3=n=>{const e=fc.exec(n);if(!e)return[,];const[,t,i]=e;return[t,i]};let Rc;const Q3=(n,e,t,i,r)=>`rgba(${Math.round(e)}, ${Math.round(t)}, ${Math.round(i)}, ${r})`,LA=n=>{Rc||(Rc=ji?new RegExp(`(${Object.keys(ji).join("|")})(?!\\w)`,"g"):/^\b$/);const e=n.output.map(s=>Dn(s).replace(fc,FA).replace(T3,gh).replace(Rc,gh)),t=e.map(s=>s.match(za).map(Number)),r=t[0].map((s,o)=>t.map(a=>{if(!(o in a))throw Error('The arity of each "output" value must be equal');return a[o]})).map(s=>wo(su({},n,{output:s})));return s=>{var o;const a=!wh.test(e[0])&&((o=e.find(u=>wh.test(u)))==null?void 0:o.replace(za,""));let c=0;return e[0].replace(za,()=>`${r[c++](s)}${a||""}`).replace(P3,Q3)}},Yu="react-spring: ",kA=n=>{const e=n;let t=!1;if(typeof e!="function")throw new TypeError(`${Yu}once requires a function parameter`);return(...i)=>{t||(e(...i),t=!0)}},R3=kA(console.warn);function z3(){R3(`${Yu}The "interpolate" function is deprecated in v9 (use "to" instead)`)}const F3=kA(console.warn);function L3(){F3(`${Yu}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function Ac(n){return Ee.str(n)&&(n[0]=="#"||/\d/.test(n)||!Hu()&&fc.test(n)||n in(ji||{}))}const ju=Hu()?l.useEffect:l.useLayoutEffect,k3=()=>{const n=l.useRef(!1);return ju(()=>(n.current=!0,()=>{n.current=!1}),[]),n};function OA(){const n=l.useState()[1],e=k3();return()=>{e.current&&n(Math.random())}}function O3(n,e){const[t]=l.useState(()=>({inputs:e,result:n()})),i=l.useRef(),r=i.current;let s=r;return s?e&&s.inputs&&U3(e,s.inputs)||(s={inputs:e,result:n()}):s=t,l.useEffect(()=>{i.current=s,r==t&&(t.inputs=t.result=void 0)},[s]),s.result}function U3(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}const UA=n=>l.useEffect(n,N3),N3=[];function _h(n){const e=l.useRef();return l.useEffect(()=>{e.current=n}),e.current}const _o=Symbol.for("Animated:node"),G3=n=>!!n&&n[_o]===n,hi=n=>n&&n[_o],Wu=(n,e)=>c3(n,_o,e),dc=n=>n&&n[_o]&&n[_o].getPayload();class NA{constructor(){this.payload=void 0,Wu(this,this)}getPayload(){return this.payload||[]}}class fs extends NA{constructor(e){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=e,Ee.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new fs(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return Ee.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value===e?!1:(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,Ee.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}class ls extends fs{constructor(e){super(0),this._string=null,this._toString=void 0,this._toString=wo({output:[e,e]})}static create(e){return new ls(e)}getValue(){let e=this._string;return e??(this._string=this._toString(this._value))}setValue(e){if(Ee.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else if(super.setValue(e))this._string=null;else return!1;return!0}reset(e){e&&(this._toString=wo({output:[this.getValue(),e]})),this._value=0,super.reset()}}const Za={dependencies:null};class Xu extends NA{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return Ti(this.source,(i,r)=>{G3(i)?t[r]=i.getValue(e):Ai(i)?t[r]=Dn(i):e||(t[r]=i)}),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&Je(this.payload,e=>e.reset())}_makePayload(e){if(e){const t=new Set;return Ti(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){Za.dependencies&&Ai(e)&&Za.dependencies.add(e);const t=dc(e);t&&Je(t,i=>this.add(i))}}class Ku extends Xu{constructor(e){super(e)}static create(e){return new Ku(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const t=this.getPayload();return e.length==t.length?t.map((i,r)=>i.setValue(e[r])).some(Boolean):(super.setValue(e.map(H3)),!0)}}function H3(n){return(Ac(n)?ls:fs).create(n)}function ou(n){const e=hi(n);return e?e.constructor:Ee.arr(n)?Ku:Ac(n)?ls:fs}function $a(){return $a=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},$a.apply(this,arguments)}const Ch=(n,e)=>{const t=!Ee.fun(n)||n.prototype&&n.prototype.isReactComponent;return l.forwardRef((i,r)=>{const s=l.useRef(null),o=t&&l.useCallback(x=>{s.current=Y3(r,x)},[r]),[a,c]=q3(i,e),u=OA(),f=()=>{const x=s.current;if(t&&!x)return;(x?e.applyAnimatedValues(x,a.getValue(!0)):!1)===!1&&u()},h=new V3(f,c),A=l.useRef();ju(()=>(A.current=h,Je(c,x=>Qo(x,h)),()=>{A.current&&(Je(A.current.deps,x=>Ka(x,A.current)),Oe.cancel(A.current.update))})),l.useEffect(f,[]),UA(()=>()=>{const x=A.current;Je(x.deps,d=>Ka(d,x))});const y=e.getComponentProps(a.getValue());return l.createElement(n,$a({},y,{ref:o}))})};class V3{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){e.type=="change"&&Oe.write(this.update)}}function q3(n,e){const t=new Set;return Za.dependencies=t,n.style&&(n=$a({},n,{style:e.createAnimatedStyle(n.style)})),n=new Xu(n),Za.dependencies=null,[n,t]}function Y3(n,e){return n&&(Ee.fun(n)?n(e):n.current=e),e}const Ih=Symbol.for("AnimatedComponent"),j3=(n,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:t=r=>new Xu(r),getComponentProps:i=r=>r}={})=>{const r={applyAnimatedValues:e,createAnimatedStyle:t,getComponentProps:i},s=o=>{const a=Bh(o)||"Anonymous";return Ee.str(o)?o=s[o]||(s[o]=Ch(o,r)):o=o[Ih]||(o[Ih]=Ch(o,r)),o.displayName=`Animated(${a})`,o};return Ti(n,(o,a)=>{Ee.arr(n)&&(a=Bh(o)),s[a]=s(o)}),{animated:s}},Bh=n=>Ee.str(n)?n:n&&Ee.str(n.displayName)?n.displayName:Ee.fun(n)&&n.name||null;function Wt(){return Wt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Wt.apply(this,arguments)}function lr(n,...e){return Ee.fun(n)?n(...e):n}const mo=(n,e)=>n===!0||!!(e&&n&&(Ee.fun(n)?n(e):kn(n).includes(e))),GA=(n,e)=>Ee.obj(n)?e&&n[e]:n,HA=(n,e)=>n.default===!0?n[e]:n.default?n.default[e]:void 0,W3=n=>n,Zu=(n,e=W3)=>{let t=X3;n.default&&n.default!==!0&&(n=n.default,t=Object.keys(n));const i={};for(const r of t){const s=e(n[r],r);Ee.und(s)||(i[r]=s)}return i},X3=["config","onProps","onStart","onChange","onPause","onResume","onRest"],K3={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function Z3(n){const e={};let t=0;if(Ti(n,(i,r)=>{K3[r]||(e[r]=i,t++)}),t)return e}function VA(n){const e=Z3(n);if(e){const t={to:e};return Ti(n,(i,r)=>r in e||(t[r]=i)),t}return Wt({},n)}function Co(n){return n=Dn(n),Ee.arr(n)?n.map(Co):Ac(n)?xi.createStringInterpolator({range:[0,1],output:[n,n]})(1):n}function $3(n){for(const e in n)return!0;return!1}function au(n){return Ee.fun(n)||Ee.arr(n)&&Ee.obj(n[0])}function J3(n,e){var t;(t=n.ref)==null||t.delete(n),e==null||e.delete(n)}function eg(n,e){if(e&&n.ref!==e){var t;(t=n.ref)==null||t.delete(n),e.add(n),n.ref=e}}const tg={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},cu=Wt({},tg.default,{mass:1,damping:1,easing:B3.linear,clamp:!1});class ng{constructor(){this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,cu)}}function ig(n,e,t){t&&(t=Wt({},t),bh(t,e),e=Wt({},t,e)),bh(n,e),Object.assign(n,e);for(const o in cu)n[o]==null&&(n[o]=cu[o]);let{mass:i,frequency:r,damping:s}=n;return Ee.und(r)||(r<.01&&(r=.01),s<0&&(s=0),n.tension=Math.pow(2*Math.PI/r,2)*i,n.friction=4*Math.PI*s*i/r),n}function bh(n,e){if(!Ee.und(e.decay))n.duration=void 0;else{const t=!Ee.und(e.tension)||!Ee.und(e.friction);(t||!Ee.und(e.frequency)||!Ee.und(e.damping)||!Ee.und(e.mass))&&(n.duration=void 0,n.decay=void 0),t&&(n.frequency=void 0)}}const Sh=[];class rg{constructor(){this.changed=!1,this.values=Sh,this.toValues=null,this.fromValues=Sh,this.to=void 0,this.from=void 0,this.config=new ng,this.immediate=!1}}function qA(n,{key:e,props:t,defaultProps:i,state:r,actions:s}){return new Promise((o,a)=>{var c;let u,f,h=mo((c=t.cancel)!=null?c:i==null?void 0:i.cancel,e);if(h)x();else{Ee.und(t.pause)||(r.paused=mo(t.pause,e));let d=i==null?void 0:i.pause;d!==!0&&(d=r.paused||mo(d,e)),u=lr(t.delay||0,e),d?(r.resumeQueue.add(y),s.pause()):(s.resume(),y())}function A(){r.resumeQueue.add(y),r.timeouts.delete(f),f.cancel(),u=f.time-Oe.now()}function y(){u>0&&!xi.skipAnimation?(r.delayed=!0,f=Oe.setTimeout(x,u),r.pauseQueue.add(A),r.timeouts.add(f)):x()}function x(){r.delayed&&(r.delayed=!1),r.pauseQueue.delete(A),r.timeouts.delete(f),n<=(r.cancelId||0)&&(h=!0);try{s.start(Wt({},t,{callId:n,cancel:h}),o)}catch(d){a(d)}}})}const $u=(n,e)=>e.length==1?e[0]:e.some(t=>t.cancelled)?rs(n.get()):e.every(t=>t.noop)?YA(n.get()):$n(n.get(),e.every(t=>t.finished)),YA=n=>({value:n,noop:!0,finished:!0,cancelled:!1}),$n=(n,e,t=!1)=>({value:n,finished:e,cancelled:t}),rs=n=>({value:n,cancelled:!0,finished:!1});function jA(n,e,t,i){const{callId:r,parentId:s,onRest:o}=e,{asyncTo:a,promise:c}=t;return!s&&n===a&&!e.reset?c:t.promise=(async()=>{t.asyncId=r,t.asyncTo=n;const u=Zu(e,(v,g)=>g==="onRest"?void 0:v);let f,h;const A=new Promise((v,g)=>(f=v,h=g)),y=v=>{const g=r<=(t.cancelId||0)&&rs(i)||r!==t.asyncId&&$n(i,!1);if(g)throw v.result=g,h(v),v},x=(v,g)=>{const p=new Mh,m=new Th;return(async()=>{if(xi.skipAnimation)throw Io(t),m.result=$n(i,!1),h(m),m;y(p);const E=Ee.obj(v)?Wt({},v):Wt({},g,{to:v});E.parentId=r,Ti(u,(_,C)=>{Ee.und(E[C])&&(E[C]=_)});const w=await i.start(E);return y(p),t.paused&&await new Promise(_=>{t.resumeQueue.add(_)}),w})()};let d;if(xi.skipAnimation)return Io(t),$n(i,!1);try{let v;Ee.arr(n)?v=(async g=>{for(const p of g)await x(p)})(n):v=Promise.resolve(n(x,i.stop.bind(i))),await Promise.all([v.then(f),A]),d=$n(i.get(),!0,!1)}catch(v){if(v instanceof Mh)d=v.result;else if(v instanceof Th)d=v.result;else throw v}finally{r==t.asyncId&&(t.asyncId=s,t.asyncTo=s?a:void 0,t.promise=s?c:void 0)}return Ee.fun(o)&&Oe.batchedUpdates(()=>{o(d,i,i.item)}),d})()}function Io(n,e){fo(n.timeouts,t=>t.cancel()),n.pauseQueue.clear(),n.resumeQueue.clear(),n.asyncId=n.asyncTo=n.promise=void 0,e&&(n.cancelId=e)}class Mh extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise."),this.result=void 0}}class Th extends Error{constructor(){super("SkipAnimationSignal"),this.result=void 0}}const lu=n=>n instanceof Ju;let sg=1;class Ju extends S3{constructor(...e){super(...e),this.id=sg++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=hi(this);return e&&e.getValue()}to(...e){return xi.to(this,e)}interpolate(...e){return z3(),xi.to(this,e)}toJSON(){return this.get()}observerAdded(e){e==1&&this._attach()}observerRemoved(e){e==0&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){Xa(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||uc.sort(this),Xa(this,{type:"priority",parent:this,priority:e})}}const Ar=Symbol.for("SpringPhase"),WA=1,uu=2,hu=4,zc=n=>(n[Ar]&WA)>0,zi=n=>(n[Ar]&uu)>0,Bs=n=>(n[Ar]&hu)>0,Ph=(n,e)=>e?n[Ar]|=uu|WA:n[Ar]&=~uu,Dh=(n,e)=>e?n[Ar]|=hu:n[Ar]&=~hu;class og extends Ju{constructor(e,t){if(super(),this.key=void 0,this.animation=new rg,this.queue=void 0,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!Ee.und(e)||!Ee.und(t)){const i=Ee.obj(e)?Wt({},e):Wt({},t,{from:e});Ee.und(i.default)&&(i.default=!0),this.start(i)}}get idle(){return!(zi(this)||this._state.asyncTo)||Bs(this)}get goal(){return Dn(this.animation.to)}get velocity(){const e=hi(this);return e instanceof fs?e.lastVelocity||0:e.getPayload().map(t=>t.lastVelocity||0)}get hasAnimated(){return zc(this)}get isAnimating(){return zi(this)}get isPaused(){return Bs(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,i=!1;const r=this.animation;let{config:s,toValues:o}=r;const a=dc(r.to);!a&&Ai(r.to)&&(o=kn(Dn(r.to))),r.values.forEach((f,h)=>{if(f.done)return;const A=f.constructor==ls?1:a?a[h].lastPosition:o[h];let y=r.immediate,x=A;if(!y){if(x=f.lastPosition,s.tension<=0){f.done=!0;return}let d=f.elapsedTime+=e;const v=r.fromValues[h],g=f.v0!=null?f.v0:f.v0=Ee.arr(s.velocity)?s.velocity[h]:s.velocity;let p;const m=s.precision||(v==A?.005:Math.min(1,Math.abs(A-v)*.001));if(Ee.und(s.duration))if(s.decay){const E=s.decay===!0?.998:s.decay,w=Math.exp(-(1-E)*d);x=v+g/(1-E)*(1-w),y=Math.abs(f.lastPosition-x)<=m,p=g*w}else{p=f.lastVelocity==null?g:f.lastVelocity;const E=s.restVelocity||m/10,w=s.clamp?0:s.bounce,_=!Ee.und(w),C=v==A?f.v0>0:v<A;let I,b=!1;const B=1,Q=Math.ceil(e/B);for(let S=0;S<Q&&(I=Math.abs(p)>E,!(!I&&(y=Math.abs(A-x)<=m,y)));++S){_&&(b=x==A||x>A==C,b&&(p=-p*w,x=A));const k=-s.tension*1e-6*(x-A),L=-s.friction*.001*p,O=(k+L)/s.mass;p=p+O*B,x=x+p*B}}else{let E=1;s.duration>0&&(this._memoizedDuration!==s.duration&&(this._memoizedDuration=s.duration,f.durationProgress>0&&(f.elapsedTime=s.duration*f.durationProgress,d=f.elapsedTime+=e)),E=(s.progress||0)+d/this._memoizedDuration,E=E>1?1:E<0?0:E,f.durationProgress=E),x=v+s.easing(E)*(A-v),p=(x-f.lastPosition)/e,y=E==1}f.lastVelocity=p,Number.isNaN(x)&&(console.warn("Got NaN while animating:",this),y=!0)}a&&!a[h].done&&(y=!1),y?f.done=!0:t=!1,f.setValue(x,s.round)&&(i=!0)});const c=hi(this),u=c.getValue();if(t){const f=Dn(r.to);(u!==f||i)&&!s.decay?(c.setValue(f),this._onChange(f)):i&&s.decay&&this._onChange(u),this._stop()}else i&&this._onChange(u)}set(e){return Oe.batchedUpdates(()=>{this._stop(),this._focus(e),this._set(e)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(zi(this)){const{to:e,config:t}=this.animation;Oe.batchedUpdates(()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()})}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let i;return Ee.und(e)?(i=this.queue||[],this.queue=[]):i=[Ee.obj(e)?e:Wt({},t,{to:e})],Promise.all(i.map(r=>this._update(r))).then(r=>$u(this,r))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),Io(this._state,e&&this._lastCallId),Oe.batchedUpdates(()=>this._stop(t,e)),this}reset(){this._update({reset:!0})}eventObserved(e){e.type=="change"?this._start():e.type=="priority"&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:i,from:r}=e;i=Ee.obj(i)?i[t]:i,(i==null||au(i))&&(i=void 0),r=Ee.obj(r)?r[t]:r,r==null&&(r=void 0);const s={to:i,from:r};return zc(this)||(e.reverse&&([i,r]=[r,i]),r=Dn(r),Ee.und(r)?hi(this)||this._set(i):this._set(r)),s}_update(e,t){let i=Wt({},e);const{key:r,defaultProps:s}=this;i.default&&Object.assign(s,Zu(i,(c,u)=>/^on/.test(u)?GA(c,r):c)),Rh(this,i,"onProps"),Ss(this,"onProps",i,this);const o=this._prepareNode(i);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const a=this._state;return qA(++this._lastCallId,{key:r,props:i,defaultProps:s,state:a,actions:{pause:()=>{Bs(this)||(Dh(this,!0),ro(a.pauseQueue),Ss(this,"onPause",$n(this,bs(this,this.animation.to)),this))},resume:()=>{Bs(this)&&(Dh(this,!1),zi(this)&&this._resume(),ro(a.resumeQueue),Ss(this,"onResume",$n(this,bs(this,this.animation.to)),this))},start:this._merge.bind(this,o)}}).then(c=>{if(i.loop&&c.finished&&!(t&&c.noop)){const u=XA(i);if(u)return this._update(u,!0)}return c})}_merge(e,t,i){if(t.cancel)return this.stop(!0),i(rs(this));const r=!Ee.und(e.to),s=!Ee.und(e.from);if(r||s)if(t.callId>this._lastToId)this._lastToId=t.callId;else return i(rs(this));const{key:o,defaultProps:a,animation:c}=this,{to:u,from:f}=c;let{to:h=u,from:A=f}=e;s&&!r&&(!t.default||Ee.und(h))&&(h=A),t.reverse&&([h,A]=[A,h]);const y=!Mi(A,f);y&&(c.from=A),A=Dn(A);const x=!Mi(h,u);x&&this._focus(h);const d=au(t.to),{config:v}=c,{decay:g,velocity:p}=v;(r||s)&&(v.velocity=0),t.config&&!d&&ig(v,lr(t.config,o),t.config!==a.config?lr(a.config,o):void 0);let m=hi(this);if(!m||Ee.und(h))return i($n(this,!0));const E=Ee.und(t.reset)?s&&!t.default:!Ee.und(A)&&mo(t.reset,o),w=E?A:this.get(),_=Co(h),C=Ee.num(_)||Ee.arr(_)||Ac(_),I=!d&&(!C||mo(a.immediate||t.immediate,o));if(x){const S=ou(h);if(S!==m.constructor)if(I)m=this._set(_);else throw Error(`Cannot animate between ${m.constructor.name} and ${S.name}, as the "to" prop suggests`)}const b=m.constructor;let B=Ai(h),Q=!1;if(!B){const S=E||!zc(this)&&y;(x||S)&&(Q=Mi(Co(w),_),B=!Q),(!Mi(c.immediate,I)&&!I||!Mi(v.decay,g)||!Mi(v.velocity,p))&&(B=!0)}if(Q&&zi(this)&&(c.changed&&!E?B=!0:B||this._stop(u)),!d&&((B||Ai(u))&&(c.values=m.getPayload(),c.toValues=Ai(h)?null:b==ls?[1]:kn(_)),c.immediate!=I&&(c.immediate=I,!I&&!E&&this._set(u)),B)){const{onRest:S}=c;Je(cg,L=>Rh(this,t,L));const k=$n(this,bs(this,u));ro(this._pendingCalls,k),this._pendingCalls.add(i),c.changed&&Oe.batchedUpdates(()=>{c.changed=!E,S==null||S(k,this),E?lr(a.onRest,k):c.onStart==null||c.onStart(k,this)})}E&&this._set(w),d?i(jA(t.to,t,this._state,this)):B?this._start():zi(this)&&!x?this._pendingCalls.add(i):i(YA(w))}_focus(e){const t=this.animation;e!==t.to&&(Eh(this)&&this._detach(),t.to=e,Eh(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;Ai(t)&&(Qo(t,this),lu(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;Ai(e)&&Ka(e,this)}_set(e,t=!0){const i=Dn(e);if(!Ee.und(i)){const r=hi(this);if(!r||!Mi(i,r.getValue())){const s=ou(i);!r||r.constructor!=s?Wu(this,s.create(i)):r.setValue(i),r&&Oe.batchedUpdates(()=>{this._onChange(i,t)})}}return hi(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,Ss(this,"onStart",$n(this,bs(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),lr(this.animation.onChange,e,this)),lr(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;hi(this).reset(Dn(e.to)),e.immediate||(e.fromValues=e.values.map(t=>t.lastPosition)),zi(this)||(Ph(this,!0),Bs(this)||this._resume())}_resume(){xi.skipAnimation?this.finish():uc.start(this)}_stop(e,t){if(zi(this)){Ph(this,!1);const i=this.animation;Je(i.values,s=>{s.done=!0}),i.toValues&&(i.onChange=i.onPause=i.onResume=void 0),Xa(this,{type:"idle",parent:this});const r=t?rs(this.get()):$n(this.get(),bs(this,e??i.to));ro(this._pendingCalls,r),i.changed&&(i.changed=!1,Ss(this,"onRest",r,this))}}}function bs(n,e){const t=Co(e),i=Co(n.get());return Mi(i,t)}function XA(n,e=n.loop,t=n.to){let i=lr(e);if(i){const r=i!==!0&&VA(i),s=(r||n).reverse,o=!r||r.reset;return Bo(Wt({},n,{loop:e,default:!1,pause:void 0,to:!s||au(t)?t:void 0,from:o?n.from:void 0,reset:o},r))}}function Bo(n){const{to:e,from:t}=n=VA(n),i=new Set;return Ee.obj(e)&&Qh(e,i),Ee.obj(t)&&Qh(t,i),n.keys=i.size?Array.from(i):null,n}function ag(n){const e=Bo(n);return Ee.und(e.default)&&(e.default=Zu(e)),e}function Qh(n,e){Ti(n,(t,i)=>t!=null&&e.add(i))}const cg=["onStart","onRest","onChange","onPause","onResume"];function Rh(n,e,t){n.animation[t]=e[t]!==HA(e,t)?GA(e[t],n.key):void 0}function Ss(n,e,...t){var i,r,s,o;(i=(r=n.animation)[e])==null||i.call(r,...t),(s=(o=n.defaultProps)[e])==null||s.call(o,...t)}const lg=["onStart","onChange","onRest"];let ug=1;class hg{constructor(e,t){this.id=ug++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start(Wt({default:!0},e))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((t,i)=>e[i]=t.get()),e}set(e){for(const t in e){const i=e[t];Ee.und(i)||this.springs[t].set(i)}}update(e){return e&&this.queue.push(Bo(e)),this}start(e){let{queue:t}=this;return e?t=kn(e).map(Bo):this.queue=[],this._flush?this._flush(this,t):(ed(this,t),fu(this,t))}stop(e,t){if(e!==!!e&&(t=e),t){const i=this.springs;Je(kn(t),r=>i[r].stop(!!e))}else Io(this._state,this._lastAsyncId),this.each(i=>i.stop(!!e));return this}pause(e){if(Ee.und(e))this.start({pause:!0});else{const t=this.springs;Je(kn(e),i=>t[i].pause())}return this}resume(e){if(Ee.und(e))this.start({pause:!1});else{const t=this.springs;Je(kn(e),i=>t[i].resume())}return this}each(e){Ti(this.springs,e)}_onFrame(){const{onStart:e,onChange:t,onRest:i}=this._events,r=this._active.size>0,s=this._changed.size>0;(r&&!this._started||s&&!this._started)&&(this._started=!0,fo(e,([c,u])=>{u.value=this.get(),c(u,this,this._item)}));const o=!r&&this._started,a=s||o&&i.size?this.get():null;s&&t.size&&fo(t,([c,u])=>{u.value=a,c(u,this,this._item)}),o&&(this._started=!1,fo(i,([c,u])=>{u.value=a,c(u,this,this._item)}))}eventObserved(e){if(e.type=="change")this._changed.add(e.parent),e.idle||this._active.add(e.parent);else if(e.type=="idle")this._active.delete(e.parent);else return;Oe.onFrame(this._onFrame)}}function fu(n,e){return Promise.all(e.map(t=>KA(n,t))).then(t=>$u(n,t))}async function KA(n,e,t){const{keys:i,to:r,from:s,loop:o,onRest:a,onResolve:c}=e,u=Ee.obj(e.default)&&e.default;o&&(e.loop=!1),r===!1&&(e.to=null),s===!1&&(e.from=null);const f=Ee.arr(r)||Ee.fun(r)?r:void 0;f?(e.to=void 0,e.onRest=void 0,u&&(u.onRest=void 0)):Je(lg,d=>{const v=e[d];if(Ee.fun(v)){const g=n._events[d];e[d]=({finished:p,cancelled:m})=>{const E=g.get(v);E?(p||(E.finished=!1),m&&(E.cancelled=!0)):g.set(v,{value:null,finished:p||!1,cancelled:m||!1})},u&&(u[d]=e[d])}});const h=n._state;e.pause===!h.paused?(h.paused=e.pause,ro(e.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(e.pause=!0);const A=(i||Object.keys(n.springs)).map(d=>n.springs[d].start(e)),y=e.cancel===!0||HA(e,"cancel")===!0;(f||y&&h.asyncId)&&A.push(qA(++n._lastAsyncId,{props:e,state:h,actions:{pause:iu,resume:iu,start(d,v){y?(Io(h,n._lastAsyncId),v(rs(n))):(d.onRest=a,v(jA(f,d,h,n)))}}})),h.paused&&await new Promise(d=>{h.resumeQueue.add(d)});const x=$u(n,await Promise.all(A));if(o&&x.finished&&!(t&&x.noop)){const d=XA(e,o,r);if(d)return ed(n,[d]),KA(n,d,!0)}return c&&Oe.batchedUpdates(()=>c(x,n,n.item)),x}function zh(n,e){const t=Wt({},n.springs);return e&&Je(kn(e),i=>{Ee.und(i.keys)&&(i=Bo(i)),Ee.obj(i.to)||(i=Wt({},i,{to:void 0})),JA(t,i,r=>$A(r))}),ZA(n,t),t}function ZA(n,e){Ti(e,(t,i)=>{n.springs[i]||(n.springs[i]=t,Qo(t,n))})}function $A(n,e){const t=new og;return t.key=n,e&&Qo(t,e),t}function JA(n,e,t){e.keys&&Je(e.keys,i=>{(n[i]||(n[i]=t(i)))._prepareNode(e)})}function ed(n,e){Je(e,t=>{JA(n.springs,t,i=>$A(i,n))})}function fg(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}const Ag=["children"],mc=n=>{let{children:e}=n,t=fg(n,Ag);const i=l.useContext(Ja),r=t.pause||!!i.pause,s=t.immediate||!!i.immediate;t=O3(()=>({pause:r,immediate:s}),[r,s]);const{Provider:o}=Ja;return l.createElement(o,{value:t},e)},Ja=dg(mc,{});mc.Provider=Ja.Provider;mc.Consumer=Ja.Consumer;function dg(n,e){return Object.assign(n,l.createContext(e)),n.Provider._context=n,n.Consumer._context=n,n}const mg=()=>{const n=[],e=function(r){L3();const s=[];return Je(n,(o,a)=>{if(Ee.und(r))s.push(o.start());else{const c=t(r,o,a);c&&s.push(o.start(c))}}),s};e.current=n,e.add=function(i){n.includes(i)||n.push(i)},e.delete=function(i){const r=n.indexOf(i);~r&&n.splice(r,1)},e.pause=function(){return Je(n,i=>i.pause(...arguments)),this},e.resume=function(){return Je(n,i=>i.resume(...arguments)),this},e.set=function(i){Je(n,r=>r.set(i))},e.start=function(i){const r=[];return Je(n,(s,o)=>{if(Ee.und(i))r.push(s.start());else{const a=this._getProps(i,s,o);a&&r.push(s.start(a))}}),r},e.stop=function(){return Je(n,i=>i.stop(...arguments)),this},e.update=function(i){return Je(n,(r,s)=>r.update(this._getProps(i,r,s))),this};const t=function(r,s,o){return Ee.fun(r)?r(o,s):r};return e._getProps=t,e};function pg(n,e,t){const i=Ee.fun(e)&&e;i&&!t&&(t=[]);const r=l.useMemo(()=>i||arguments.length==3?mg():void 0,[]),s=l.useRef(0),o=OA(),a=l.useMemo(()=>({ctrls:[],queue:[],flush(g,p){const m=zh(g,p);return s.current>0&&!a.queue.length&&!Object.keys(m).some(w=>!g.springs[w])?fu(g,p):new Promise(w=>{ZA(g,m),a.queue.push(()=>{w(fu(g,p))}),o()})}}),[]),c=l.useRef([...a.ctrls]),u=[],f=_h(n)||0;l.useMemo(()=>{Je(c.current.slice(n,f),g=>{J3(g,r),g.stop(!0)}),c.current.length=n,h(f,n)},[n]),l.useMemo(()=>{h(0,Math.min(f,n))},t);function h(g,p){for(let m=g;m<p;m++){const E=c.current[m]||(c.current[m]=new hg(null,a.flush)),w=i?i(m,E):e[m];w&&(u[m]=ag(w))}}const A=c.current.map((g,p)=>zh(g,u[p])),y=l.useContext(mc),x=_h(y),d=y!==x&&$3(y);ju(()=>{s.current++,a.ctrls=c.current;const{queue:g}=a;g.length&&(a.queue=[],Je(g,p=>p())),Je(c.current,(p,m)=>{r==null||r.add(p),d&&p.start({default:y});const E=u[m];E&&(eg(p,E.ref),p.ref?p.queue.push(E):p.start(E))})}),UA(()=>()=>{Je(a.ctrls,g=>g.stop(!0))});const v=A.map(g=>Wt({},g));return r?[v,r]:v}function gg(n,e){const t=Ee.fun(n),[[i],r]=pg(1,t?n:[n],t?[]:e);return t||arguments.length==2?[i,r]:i}let Fh;(function(n){n.MOUNT="mount",n.ENTER="enter",n.UPDATE="update",n.LEAVE="leave"})(Fh||(Fh={}));class yg extends Ju{constructor(e,t){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=e,this.calc=wo(...t);const i=this._get(),r=ou(i);Wu(this,r.create(i))}advance(e){const t=this._get(),i=this.get();Mi(t,i)||(hi(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&Lh(this._active)&&Fc(this)}_get(){const e=Ee.arr(this.source)?this.source.map(Dn):kn(Dn(this.source));return this.calc(...e)}_start(){this.idle&&!Lh(this._active)&&(this.idle=!1,Je(dc(this),e=>{e.done=!1}),xi.skipAnimation?(Oe.batchedUpdates(()=>this.advance()),Fc(this)):uc.start(this))}_attach(){let e=1;Je(kn(this.source),t=>{Ai(t)&&Qo(t,this),lu(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))}),this.priority=e,this._start()}_detach(){Je(kn(this.source),e=>{Ai(e)&&Ka(e,this)}),this._active.clear(),Fc(this)}eventObserved(e){e.type=="change"?e.idle?this.advance():(this._active.add(e.parent),this._start()):e.type=="idle"?this._active.delete(e.parent):e.type=="priority"&&(this.priority=kn(this.source).reduce((t,i)=>Math.max(t,(lu(i)?i.priority:0)+1),0))}}function vg(n){return n.idle!==!1}function Lh(n){return!n.size||Array.from(n).every(vg)}function Fc(n){n.idle||(n.idle=!0,Je(dc(n),e=>{e.done=!0}),Xa(n,{type:"idle",parent:n}))}xi.assign({createStringInterpolator:LA,to:(n,e)=>new yg(n,e)});const xg=["primitive"].concat(Object.keys(Xm).filter(n=>/^[A-Z]/.test(n)).map(n=>n[0].toLowerCase()+n.slice(1)));xi.assign({createStringInterpolator:LA,colors:A3,frameLoop:"demand"});Su(()=>{Oe.advance()});const Eg=j3(xg,{applyAnimatedValues:Fn}),wg=Eg.animated;function Q7({enabled:n=!0,snap:e,global:t,domElement:i,cursor:r=!0,children:s,speed:o=1,rotation:a=[0,0,0],zoom:c=1,polar:u=[0,Math.PI/2],azimuth:f=[-1/0,1/0],config:h={mass:1,tension:170,friction:26}}){const A=J(_=>_.events),y=J(_=>_.gl),x=i||A.connected||y.domElement,{size:d}=J(),v=l.useMemo(()=>[a[0]+u[0],a[0]+u[1]],[a[0],u[0],u[1]]),g=l.useMemo(()=>[a[1]+f[0],a[1]+f[1]],[a[1],f[0],f[1]]),p=l.useMemo(()=>[De.clamp(a[0],...v),De.clamp(a[1],...g),a[2]],[a[0],a[1],a[2],v,g]),[m,E]=gg(()=>({scale:1,rotation:p,config:h}));l.useEffect(()=>void E.start({scale:1,rotation:p,config:h}),[p]),l.useEffect(()=>{if(t&&r&&n)return x.style.cursor="grab",y.domElement.style.cursor="",()=>{x.style.cursor="default",y.domElement.style.cursor="default"}},[t,r,x,n]);const w=Hf({onHover:({last:_})=>{r&&!t&&n&&(x.style.cursor=_?"auto":"grab")},onDrag:({down:_,delta:[C,I],memo:[b,B]=m.rotation.animation.to||p})=>{if(!n)return[I,C];r&&(x.style.cursor=_?"grabbing":"grab"),C=De.clamp(B+C/d.width*Math.PI*o,...g),I=De.clamp(b+I/d.height*Math.PI*o,...v);const Q=e&&!_&&typeof e!="boolean"?e:h;return E.start({scale:_&&I>v[1]/2?c:1,rotation:e&&!_?p:[I,C,0],config:S=>S==="scale"?{...Q,friction:Q.friction*3}:Q}),[I,C]}},{target:t?x:void 0});return l.createElement(wg.group,ce({},w==null?void 0:w(),m),s)}const e0=Vf>=125?"uv1":"uv2";var _g=Object.defineProperty,Cg=(n,e,t)=>e in n?_g(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ms=(n,e,t)=>(Cg(n,typeof e!="symbol"?e+"":e,t),t);const Xr=4,ss=1024,di=4,Ig=(n=1)=>{const e=new Float32Array(ss*di*n*Xr),t=new Ki(e,ss,di*n,Lt,pt);return t.wrapS=os,t.wrapT=os,t.magFilter=dt,t.needsUpdate=!0,t},Bg=(n,e,t=0)=>{const i=Math.floor(ss*(di/4));e.arcLengthDivisions=i/2,e.updateArcLengths();const r=e.getSpacedPoints(i),s=e.computeFrenetFrames(i,!0);for(let o=0;o<i;o++){const a=Math.floor(o/ss),c=o%ss;let u=r[o];qo(n,c,u.x,u.y,u.z,0+a+di*t),u=s.tangents[o],qo(n,c,u.x,u.y,u.z,1+a+di*t),u=s.normals[o],qo(n,c,u.x,u.y,u.z,2+a+di*t),u=s.binormals[o],qo(n,c,u.x,u.y,u.z,3+a+di*t)}n.needsUpdate=!0},qo=(n,e,t,i,r,s)=>{const o=n.image,{data:a}=o,c=Xr*ss*s;a[e*Xr+c+0]=t,a[e*Xr+c+1]=i,a[e*Xr+c+2]=r,a[e*Xr+c+3]=1},bg=n=>({spineTexture:{value:n},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}});function Sg(n,e,t=1){n.__ok||(n.__ok=!0,n.onBeforeCompile=i=>{if(i.__modified)return;i.__modified=!0,Object.assign(i.uniforms,e);const r=`
		uniform sampler2D spineTexture;
		uniform float pathOffset;
		uniform float pathSegment;
		uniform float spineOffset;
		uniform float spineLength;
		uniform int flow;

		float textureLayers = ${di*t}.;
		float textureStacks = ${di/4}.;

		${i.vertexShader}
		`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,`
        void main() {
        #include <beginnormal_vertex>

        vec4 worldPos = modelMatrix * vec4(position, 1.);

        bool bend = flow > 0;
        float xWeight = bend ? 0. : 1.;

        #ifdef USE_INSTANCING
        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];
        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;
        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;
        #else
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;
        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;
        #endif

        mt = mod(mt, textureStacks);
        float rowOffset = floor(mt);

        #ifdef USE_INSTANCING
        rowOffset += instanceMatrix[3][1] * ${di}.;
        #endif

        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;
        mat3 basis = mat3(a, b, c);

        vec3 transformed = basis
          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)
          + spinePos;

        vec3 transformedNormal = normalMatrix * (basis * objectNormal);
			`).replace("#include <project_vertex>",`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
				gl_Position = projectionMatrix * mvPosition;`);i.vertexShader=r})}class Mg{constructor(e,t=1){Ms(this,"curveArray"),Ms(this,"curveLengthArray"),Ms(this,"object3D"),Ms(this,"splineTexure"),Ms(this,"uniforms");const i=e.clone(),r=Ig(t),s=bg(r);i.traverse(o=>{(o instanceof be||o instanceof qf)&&(o.material=o.material.clone(),Sg(o.material,s,t))}),this.curveArray=new Array(t),this.curveLengthArray=new Array(t),this.object3D=i,this.splineTexure=r,this.uniforms=s}updateCurve(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");const i=t.getLength();this.uniforms.spineLength.value=i,this.curveLengthArray[e]=i,this.curveArray[e]=t,Bg(this.splineTexure,t,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}new ue;var zn=Uint8Array,qi=Uint16Array,Au=Uint32Array,td=new zn([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),nd=new zn([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Tg=new zn([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),id=function(n,e){for(var t=new qi(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var r=new Au(t[30]),i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)r[s]=s-t[i]<<5|i;return[t,r]},rd=id(td,2),sd=rd[0],Pg=rd[1];sd[28]=258,Pg[258]=28;var Dg=id(nd,0),Qg=Dg[0],du=new qi(32768);for(var mt=0;mt<32768;++mt){var Fi=(mt&43690)>>>1|(mt&21845)<<1;Fi=(Fi&52428)>>>2|(Fi&13107)<<2,Fi=(Fi&61680)>>>4|(Fi&3855)<<4,du[mt]=((Fi&65280)>>>8|(Fi&255)<<8)>>>1}var po=function(n,e,t){for(var i=n.length,r=0,s=new qi(e);r<i;++r)++s[n[r]-1];var o=new qi(e);for(r=0;r<e;++r)o[r]=o[r-1]+s[r-1]<<1;var a;if(t){a=new qi(1<<e);var c=15-e;for(r=0;r<i;++r)if(n[r])for(var u=r<<4|n[r],f=e-n[r],h=o[n[r]-1]++<<f,A=h|(1<<f)-1;h<=A;++h)a[du[h]>>>c]=u}else for(a=new qi(i),r=0;r<i;++r)n[r]&&(a[r]=du[o[n[r]-1]++]>>>15-n[r]);return a},Ro=new zn(288);for(var mt=0;mt<144;++mt)Ro[mt]=8;for(var mt=144;mt<256;++mt)Ro[mt]=9;for(var mt=256;mt<280;++mt)Ro[mt]=7;for(var mt=280;mt<288;++mt)Ro[mt]=8;var od=new zn(32);for(var mt=0;mt<32;++mt)od[mt]=5;var Rg=po(Ro,9,1),zg=po(od,5,1),Lc=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},Yn=function(n,e,t){var i=e/8|0;return(n[i]|n[i+1]<<8)>>(e&7)&t},kc=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},Fg=function(n){return(n/8|0)+(n&7&&1)},Lg=function(n,e,t){(t==null||t>n.length)&&(t=n.length);var i=new(n instanceof qi?qi:n instanceof Au?Au:zn)(t-e);return i.set(n.subarray(e,t)),i},kg=function(n,e,t){var i=n.length;if(!i||t&&!t.l&&i<5)return e||new zn(0);var r=!e||t,s=!t||t.i;t||(t={}),e||(e=new zn(i*3));var o=function(D){var R=e.length;if(D>R){var $=new zn(Math.max(R*2,D));$.set(e),e=$}},a=t.f||0,c=t.p||0,u=t.b||0,f=t.l,h=t.d,A=t.m,y=t.n,x=i*8;do{if(!f){t.f=a=Yn(n,c,1);var d=Yn(n,c+1,3);if(c+=3,d)if(d==1)f=Rg,h=zg,A=9,y=5;else if(d==2){var m=Yn(n,c,31)+257,E=Yn(n,c+10,15)+4,w=m+Yn(n,c+5,31)+1;c+=14;for(var _=new zn(w),C=new zn(19),I=0;I<E;++I)C[Tg[I]]=Yn(n,c+I*3,7);c+=E*3;for(var b=Lc(C),B=(1<<b)-1,Q=po(C,b,1),I=0;I<w;){var S=Q[Yn(n,c,B)];c+=S&15;var v=S>>>4;if(v<16)_[I++]=v;else{var k=0,L=0;for(v==16?(L=3+Yn(n,c,3),c+=2,k=_[I-1]):v==17?(L=3+Yn(n,c,7),c+=3):v==18&&(L=11+Yn(n,c,127),c+=7);L--;)_[I++]=k}}var O=_.subarray(0,m),G=_.subarray(m);A=Lc(O),y=Lc(G),f=po(O,A,1),h=po(G,y,1)}else throw"invalid block type";else{var v=Fg(c)+4,g=n[v-4]|n[v-3]<<8,p=v+g;if(p>i){if(s)throw"unexpected EOF";break}r&&o(u+g),e.set(n.subarray(v,p),u),t.b=u+=g,t.p=c=p*8;continue}if(c>x){if(s)throw"unexpected EOF";break}}r&&o(u+131072);for(var V=(1<<A)-1,N=(1<<y)-1,j=c;;j=c){var k=f[kc(n,c)&V],Y=k>>>4;if(c+=k&15,c>x){if(s)throw"unexpected EOF";break}if(!k)throw"invalid length/literal";if(Y<256)e[u++]=Y;else if(Y==256){j=c,f=null;break}else{var H=Y-254;if(Y>264){var I=Y-257,X=td[I];H=Yn(n,c,(1<<X)-1)+sd[I],c+=X}var W=h[kc(n,c)&N],P=W>>>4;if(!W)throw"invalid distance";c+=W&15;var G=Qg[P];if(P>3){var X=nd[P];G+=kc(n,c)&(1<<X)-1,c+=X}if(c>x){if(s)throw"unexpected EOF";break}r&&o(u+131072);for(var z=u+H;u<z;u+=4)e[u]=e[u-G],e[u+1]=e[u+1-G],e[u+2]=e[u+2-G],e[u+3]=e[u+3-G];u=z}}t.l=f,t.p=j,t.b=u,f&&(a=1,t.m=A,t.d=h,t.n=y)}while(!a);return u==e.length?e:Lg(e,0,u)},Og=new zn(0),Ug=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function so(n,e){return kg((Ug(n),n.subarray(2,-4)),e)}var Ng=typeof TextDecoder<"u"&&new TextDecoder,Gg=0;try{Ng.decode(Og,{stream:!0}),Gg=1}catch{}let Hg=class extends be{constructor(e,t,i=!1,r=!1,s=1e4){const o=new tn;super(o,t),this.isMarchingCubes=!0;const a=this,c=new Float32Array(12*3),u=new Float32Array(12*3),f=new Float32Array(12*3);this.enableUvs=i,this.enableColors=r,this.init=function(p){this.resolution=p,this.isolation=80,this.size=p,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(this.size3*3),this.palette=new Float32Array(this.size3*3),this.count=0;const m=s*3;this.positionArray=new Float32Array(m*3);const E=new Mt(this.positionArray,3);E.setUsage(sn),o.setAttribute("position",E),this.normalArray=new Float32Array(m*3);const w=new Mt(this.normalArray,3);if(w.setUsage(sn),o.setAttribute("normal",w),this.enableUvs){this.uvArray=new Float32Array(m*2);const _=new Mt(this.uvArray,2);_.setUsage(sn),o.setAttribute("uv",_)}if(this.enableColors){this.colorArray=new Float32Array(m*3);const _=new Mt(this.colorArray,3);_.setUsage(sn),o.setAttribute("color",_)}o.boundingSphere=new Nn(new T,1)};function h(p,m,E){return p+(m-p)*E}function A(p,m,E,w,_,C,I,b,B,Q){const S=(E-I)/(b-I),k=a.normal_cache;c[m+0]=w+S*a.delta,c[m+1]=_,c[m+2]=C,u[m+0]=h(k[p+0],k[p+3],S),u[m+1]=h(k[p+1],k[p+4],S),u[m+2]=h(k[p+2],k[p+5],S),f[m+0]=h(a.palette[B*3+0],a.palette[Q*3+0],S),f[m+1]=h(a.palette[B*3+1],a.palette[Q*3+1],S),f[m+2]=h(a.palette[B*3+2],a.palette[Q*3+2],S)}function y(p,m,E,w,_,C,I,b,B,Q){const S=(E-I)/(b-I),k=a.normal_cache;c[m+0]=w,c[m+1]=_+S*a.delta,c[m+2]=C;const L=p+a.yd*3;u[m+0]=h(k[p+0],k[L+0],S),u[m+1]=h(k[p+1],k[L+1],S),u[m+2]=h(k[p+2],k[L+2],S),f[m+0]=h(a.palette[B*3+0],a.palette[Q*3+0],S),f[m+1]=h(a.palette[B*3+1],a.palette[Q*3+1],S),f[m+2]=h(a.palette[B*3+2],a.palette[Q*3+2],S)}function x(p,m,E,w,_,C,I,b,B,Q){const S=(E-I)/(b-I),k=a.normal_cache;c[m+0]=w,c[m+1]=_,c[m+2]=C+S*a.delta;const L=p+a.zd*3;u[m+0]=h(k[p+0],k[L+0],S),u[m+1]=h(k[p+1],k[L+1],S),u[m+2]=h(k[p+2],k[L+2],S),f[m+0]=h(a.palette[B*3+0],a.palette[Q*3+0],S),f[m+1]=h(a.palette[B*3+1],a.palette[Q*3+1],S),f[m+2]=h(a.palette[B*3+2],a.palette[Q*3+2],S)}function d(p){const m=p*3;a.normal_cache[m]===0&&(a.normal_cache[m+0]=a.field[p-1]-a.field[p+1],a.normal_cache[m+1]=a.field[p-a.yd]-a.field[p+a.yd],a.normal_cache[m+2]=a.field[p-a.zd]-a.field[p+a.zd])}function v(p,m,E,w,_){const C=w+1,I=w+a.yd,b=w+a.zd,B=C+a.yd,Q=C+a.zd,S=w+a.yd+a.zd,k=C+a.yd+a.zd;let L=0;const O=a.field[w],G=a.field[C],V=a.field[I],N=a.field[B],j=a.field[b],Y=a.field[Q],H=a.field[S],X=a.field[k];O<_&&(L|=1),G<_&&(L|=2),V<_&&(L|=8),N<_&&(L|=4),j<_&&(L|=16),Y<_&&(L|=32),H<_&&(L|=128),X<_&&(L|=64);const W=Vg[L];if(W===0)return 0;const P=a.delta,z=p+P,D=m+P,R=E+P;W&1&&(d(w),d(C),A(w*3,0,_,p,m,E,O,G,w,C)),W&2&&(d(C),d(B),y(C*3,3,_,z,m,E,G,N,C,B)),W&4&&(d(I),d(B),A(I*3,6,_,p,D,E,V,N,I,B)),W&8&&(d(w),d(I),y(w*3,9,_,p,m,E,O,V,w,I)),W&16&&(d(b),d(Q),A(b*3,12,_,p,m,R,j,Y,b,Q)),W&32&&(d(Q),d(k),y(Q*3,15,_,z,m,R,Y,X,Q,k)),W&64&&(d(S),d(k),A(S*3,18,_,p,D,R,H,X,S,k)),W&128&&(d(b),d(S),y(b*3,21,_,p,m,R,j,H,b,S)),W&256&&(d(w),d(b),x(w*3,24,_,p,m,E,O,j,w,b)),W&512&&(d(C),d(Q),x(C*3,27,_,z,m,E,G,Y,C,Q)),W&1024&&(d(B),d(k),x(B*3,30,_,z,D,E,N,X,B,k)),W&2048&&(d(I),d(S),x(I*3,33,_,p,D,E,V,H,I,S)),L<<=4;let $,se,Z,oe=0,Ae=0;for(;Yo[L+Ae]!=-1;)$=L+Ae,se=$+1,Z=$+2,g(c,u,f,3*Yo[$],3*Yo[se],3*Yo[Z]),Ae+=3,oe++;return oe}function g(p,m,E,w,_,C){const I=a.count*3;if(a.positionArray[I+0]=p[w],a.positionArray[I+1]=p[w+1],a.positionArray[I+2]=p[w+2],a.positionArray[I+3]=p[_],a.positionArray[I+4]=p[_+1],a.positionArray[I+5]=p[_+2],a.positionArray[I+6]=p[C],a.positionArray[I+7]=p[C+1],a.positionArray[I+8]=p[C+2],a.material.flatShading===!0){const b=(m[w+0]+m[_+0]+m[C+0])/3,B=(m[w+1]+m[_+1]+m[C+1])/3,Q=(m[w+2]+m[_+2]+m[C+2])/3;a.normalArray[I+0]=b,a.normalArray[I+1]=B,a.normalArray[I+2]=Q,a.normalArray[I+3]=b,a.normalArray[I+4]=B,a.normalArray[I+5]=Q,a.normalArray[I+6]=b,a.normalArray[I+7]=B,a.normalArray[I+8]=Q}else a.normalArray[I+0]=m[w+0],a.normalArray[I+1]=m[w+1],a.normalArray[I+2]=m[w+2],a.normalArray[I+3]=m[_+0],a.normalArray[I+4]=m[_+1],a.normalArray[I+5]=m[_+2],a.normalArray[I+6]=m[C+0],a.normalArray[I+7]=m[C+1],a.normalArray[I+8]=m[C+2];if(a.enableUvs){const b=a.count*2;a.uvArray[b+0]=p[w+0],a.uvArray[b+1]=p[w+2],a.uvArray[b+2]=p[_+0],a.uvArray[b+3]=p[_+2],a.uvArray[b+4]=p[C+0],a.uvArray[b+5]=p[C+2]}a.enableColors&&(a.colorArray[I+0]=E[w+0],a.colorArray[I+1]=E[w+1],a.colorArray[I+2]=E[w+2],a.colorArray[I+3]=E[_+0],a.colorArray[I+4]=E[_+1],a.colorArray[I+5]=E[_+2],a.colorArray[I+6]=E[C+0],a.colorArray[I+7]=E[C+1],a.colorArray[I+8]=E[C+2]),a.count+=3}this.addBall=function(p,m,E,w,_,C){const I=Math.sign(w);w=Math.abs(w);const b=C!=null;let B=new ze(p,m,E);if(b)try{B=C instanceof ze?C:Array.isArray(C)?new ze(Math.min(Math.abs(C[0]),1),Math.min(Math.abs(C[1]),1),Math.min(Math.abs(C[2]),1)):new ze(C)}catch{B=new ze(p,m,E)}const Q=this.size*Math.sqrt(w/_),S=E*this.size,k=m*this.size,L=p*this.size;let O=Math.floor(S-Q);O<1&&(O=1);let G=Math.floor(S+Q);G>this.size-1&&(G=this.size-1);let V=Math.floor(k-Q);V<1&&(V=1);let N=Math.floor(k+Q);N>this.size-1&&(N=this.size-1);let j=Math.floor(L-Q);j<1&&(j=1);let Y=Math.floor(L+Q);Y>this.size-1&&(Y=this.size-1);let H,X,W,P,z,D,R,$,se,Z,oe;for(W=O;W<G;W++)for(z=this.size2*W,$=W/this.size-E,se=$*$,X=V;X<N;X++)for(P=z+this.size*X,R=X/this.size-m,Z=R*R,H=j;H<Y;H++)if(D=H/this.size-p,oe=w/(1e-6+D*D+Z+se)-_,oe>0){this.field[P+H]+=oe*I;const Ae=Math.sqrt((H-L)*(H-L)+(X-k)*(X-k)+(W-S)*(W-S))/Q,de=1-Ae*Ae*Ae*(Ae*(Ae*6-15)+10);this.palette[(P+H)*3+0]+=B.r*de,this.palette[(P+H)*3+1]+=B.g*de,this.palette[(P+H)*3+2]+=B.b*de}},this.addPlaneX=function(p,m){const E=this.size,w=this.yd,_=this.zd,C=this.field;let I,b,B,Q,S,k,L,O=E*Math.sqrt(p/m);for(O>E&&(O=E),I=0;I<O;I++)if(k=I/E,Q=k*k,S=p/(1e-4+Q)-m,S>0)for(b=0;b<E;b++)for(L=I+b*w,B=0;B<E;B++)C[_*B+L]+=S},this.addPlaneY=function(p,m){const E=this.size,w=this.yd,_=this.zd,C=this.field;let I,b,B,Q,S,k,L,O,G=E*Math.sqrt(p/m);for(G>E&&(G=E),b=0;b<G;b++)if(k=b/E,Q=k*k,S=p/(1e-4+Q)-m,S>0)for(L=b*w,I=0;I<E;I++)for(O=L+I,B=0;B<E;B++)C[_*B+O]+=S},this.addPlaneZ=function(p,m){const E=this.size,w=this.yd,_=this.zd,C=this.field;let I,b,B,Q,S,k,L,O,G=E*Math.sqrt(p/m);for(G>E&&(G=E),B=0;B<G;B++)if(k=B/E,Q=k*k,S=p/(1e-4+Q)-m,S>0)for(L=_*B,b=0;b<E;b++)for(O=L+b*w,I=0;I<E;I++)C[O+I]+=S},this.setCell=function(p,m,E,w){const _=this.size2*E+this.size*m+p;this.field[_]=w},this.getCell=function(p,m,E){const w=this.size2*E+this.size*m+p;return this.field[w]},this.blur=function(p=1){const m=this.field,E=m.slice(),w=this.size,_=this.size2;for(let C=0;C<w;C++)for(let I=0;I<w;I++)for(let b=0;b<w;b++){const B=_*b+w*I+C;let Q=E[B],S=1;for(let k=-1;k<=1;k+=2){const L=k+C;if(!(L<0||L>=w))for(let O=-1;O<=1;O+=2){const G=O+I;if(!(G<0||G>=w))for(let V=-1;V<=1;V+=2){const N=V+b;if(N<0||N>=w)continue;const j=_*N+w*G+L,Y=E[j];S++,Q+=p*(Y-Q)/S}}}m[B]=Q}},this.reset=function(){for(let p=0;p<this.size3;p++)this.normal_cache[p*3]=0,this.field[p]=0,this.palette[p*3]=this.palette[p*3+1]=this.palette[p*3+2]=0},this.update=function(){this.count=0;const p=this.size-2;for(let m=1;m<p;m++){const E=this.size2*m,w=(m-this.halfsize)/this.halfsize;for(let _=1;_<p;_++){const C=E+this.size*_,I=(_-this.halfsize)/this.halfsize;for(let b=1;b<p;b++){const B=(b-this.halfsize)/this.halfsize,Q=C+b;v(B,I,w,Q,this.isolation)}}}this.geometry.setDrawRange(0,this.count),o.getAttribute("position").needsUpdate=!0,o.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(o.getAttribute("uv").needsUpdate=!0),this.enableColors&&(o.getAttribute("color").needsUpdate=!0),this.count/3>s&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(e)}};const Vg=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),Yo=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);var qg=Object.defineProperty,Yg=(n,e,t)=>e in n?qg(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,jn=(n,e,t)=>(Yg(n,typeof e!="symbol"?e+"":e,t),t);class Oc{constructor(e=Math){jn(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),jn(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),jn(this,"p",[]),jn(this,"perm",[]),jn(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),jn(this,"dot",(t,i,r)=>t[0]*i+t[1]*r),jn(this,"dot3",(t,i,r,s)=>t[0]*i+t[1]*r+t[2]*s),jn(this,"dot4",(t,i,r,s,o)=>t[0]*i+t[1]*r+t[2]*s+t[3]*o),jn(this,"noise",(t,i)=>{let r,s,o;const a=.5*(Math.sqrt(3)-1),c=(t+i)*a,u=Math.floor(t+c),f=Math.floor(i+c),h=(3-Math.sqrt(3))/6,A=(u+f)*h,y=u-A,x=f-A,d=t-y,v=i-x;let g=0,p=1;d>v&&(g=1,p=0);const m=d-g+h,E=v-p+h,w=d-1+2*h,_=v-1+2*h,C=u&255,I=f&255,b=this.perm[C+this.perm[I]]%12,B=this.perm[C+g+this.perm[I+p]]%12,Q=this.perm[C+1+this.perm[I+1]]%12;let S=.5-d*d-v*v;S<0?r=0:(S*=S,r=S*S*this.dot(this.grad3[b],d,v));let k=.5-m*m-E*E;k<0?s=0:(k*=k,s=k*k*this.dot(this.grad3[B],m,E));let L=.5-w*w-_*_;return L<0?o=0:(L*=L,o=L*L*this.dot(this.grad3[Q],w,_)),70*(r+s+o)}),jn(this,"noise3d",(t,i,r)=>{let s,o,a,c;const f=(t+i+r)*.3333333333333333,h=Math.floor(t+f),A=Math.floor(i+f),y=Math.floor(r+f),x=1/6,d=(h+A+y)*x,v=h-d,g=A-d,p=y-d,m=t-v,E=i-g,w=r-p;let _,C,I,b,B,Q;m>=E?E>=w?(_=1,C=0,I=0,b=1,B=1,Q=0):m>=w?(_=1,C=0,I=0,b=1,B=0,Q=1):(_=0,C=0,I=1,b=1,B=0,Q=1):E<w?(_=0,C=0,I=1,b=0,B=1,Q=1):m<w?(_=0,C=1,I=0,b=0,B=1,Q=1):(_=0,C=1,I=0,b=1,B=1,Q=0);const S=m-_+x,k=E-C+x,L=w-I+x,O=m-b+2*x,G=E-B+2*x,V=w-Q+2*x,N=m-1+3*x,j=E-1+3*x,Y=w-1+3*x,H=h&255,X=A&255,W=y&255,P=this.perm[H+this.perm[X+this.perm[W]]]%12,z=this.perm[H+_+this.perm[X+C+this.perm[W+I]]]%12,D=this.perm[H+b+this.perm[X+B+this.perm[W+Q]]]%12,R=this.perm[H+1+this.perm[X+1+this.perm[W+1]]]%12;let $=.6-m*m-E*E-w*w;$<0?s=0:($*=$,s=$*$*this.dot3(this.grad3[P],m,E,w));let se=.6-S*S-k*k-L*L;se<0?o=0:(se*=se,o=se*se*this.dot3(this.grad3[z],S,k,L));let Z=.6-O*O-G*G-V*V;Z<0?a=0:(Z*=Z,a=Z*Z*this.dot3(this.grad3[D],O,G,V));let oe=.6-N*N-j*j-Y*Y;return oe<0?c=0:(oe*=oe,c=oe*oe*this.dot3(this.grad3[R],N,j,Y)),32*(s+o+a+c)}),jn(this,"noise4d",(t,i,r,s)=>{const o=this.grad4,a=this.simplex,c=this.perm,u=(Math.sqrt(5)-1)/4,f=(5-Math.sqrt(5))/20;let h,A,y,x,d;const v=(t+i+r+s)*u,g=Math.floor(t+v),p=Math.floor(i+v),m=Math.floor(r+v),E=Math.floor(s+v),w=(g+p+m+E)*f,_=g-w,C=p-w,I=m-w,b=E-w,B=t-_,Q=i-C,S=r-I,k=s-b,L=B>Q?32:0,O=B>S?16:0,G=Q>S?8:0,V=B>k?4:0,N=Q>k?2:0,j=S>k?1:0,Y=L+O+G+V+N+j;let H,X,W,P,z,D,R,$,se,Z,oe,Ae;H=a[Y][0]>=3?1:0,X=a[Y][1]>=3?1:0,W=a[Y][2]>=3?1:0,P=a[Y][3]>=3?1:0,z=a[Y][0]>=2?1:0,D=a[Y][1]>=2?1:0,R=a[Y][2]>=2?1:0,$=a[Y][3]>=2?1:0,se=a[Y][0]>=1?1:0,Z=a[Y][1]>=1?1:0,oe=a[Y][2]>=1?1:0,Ae=a[Y][3]>=1?1:0;const de=B-H+f,le=Q-X+f,he=S-W+f,Ie=k-P+f,Be=B-z+2*f,K=Q-D+2*f,U=S-R+2*f,ge=k-$+2*f,Ue=B-se+3*f,yt=Q-Z+3*f,bt=S-oe+3*f,Me=k-Ae+3*f,Qe=B-1+4*f,je=Q-1+4*f,Ve=S-1+4*f,st=k-1+4*f,ut=g&255,Nt=p&255,Gt=m&255,fn=E&255,gn=c[ut+c[Nt+c[Gt+c[fn]]]]%32,wt=c[ut+H+c[Nt+X+c[Gt+W+c[fn+P]]]]%32,Qi=c[ut+z+c[Nt+D+c[Gt+R+c[fn+$]]]]%32,Gn=c[ut+se+c[Nt+Z+c[Gt+oe+c[fn+Ae]]]]%32,nn=c[ut+1+c[Nt+1+c[Gt+1+c[fn+1]]]]%32;let ht=.6-B*B-Q*Q-S*S-k*k;ht<0?h=0:(ht*=ht,h=ht*ht*this.dot4(o[gn],B,Q,S,k));let ni=.6-de*de-le*le-he*he-Ie*Ie;ni<0?A=0:(ni*=ni,A=ni*ni*this.dot4(o[wt],de,le,he,Ie));let Ce=.6-Be*Be-K*K-U*U-ge*ge;Ce<0?y=0:(Ce*=Ce,y=Ce*Ce*this.dot4(o[Qi],Be,K,U,ge));let Hn=.6-Ue*Ue-yt*yt-bt*bt-Me*Me;Hn<0?x=0:(Hn*=Hn,x=Hn*Hn*this.dot4(o[Gn],Ue,yt,bt,Me));let er=.6-Qe*Qe-je*je-Ve*Ve-st*st;return er<0?d=0:(er*=er,d=er*er*this.dot4(o[nn],Qe,je,Ve,st)),27*(h+A+y+x+d)});for(let t=0;t<256;t++)this.p[t]=Math.floor(e.random()*256);for(let t=0;t<512;t++)this.perm[t]=this.p[t&255]}}var jg=Object.defineProperty,Wg=(n,e,t)=>e in n?jg(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ad=(n,e,t)=>(Wg(n,typeof e!="symbol"?e+"":e,t),t);const Fa={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new T},up:{value:new T(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${Vf>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},cd=new jt({name:"SkyShader",fragmentShader:Fa.fragmentShader,vertexShader:Fa.vertexShader,uniforms:ka.clone(Fa.uniforms),side:us,depthWrite:!1});let t0=class extends be{constructor(){super(new ki(1,1,1),cd)}};ad(t0,"SkyShader",Fa);ad(t0,"material",cd);const Xg=n=>n&&n.isCubeTexture;class Kg extends be{constructor(e,t){var i,r;const s=Xg(e),a=((r=s?(i=e.image[0])==null?void 0:i.width:e.image.width)!=null?r:1024)/4,c=Math.floor(Math.log2(a)),u=Math.pow(2,c),f=3*Math.max(u,16*7),h=4*u,A=[s?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/f}`,`#define CUBEUV_TEXEL_HEIGHT ${1/h}`,`#define CUBEUV_MAX_MIP ${c}.0`],y=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,x=A.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(bo.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,d={map:{value:e},height:{value:(t==null?void 0:t.height)||15},radius:{value:(t==null?void 0:t.radius)||100}},v=new Km(1,16),g=new jt({uniforms:d,fragmentShader:x,vertexShader:y,side:on});super(v,g)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}const Kt=new Zr,jo=new T;class Zg{constructor(e){let t=e.geometry;t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){const e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let s=0;s<e.count;s+=3){let o=1;t&&(o=t.getX(s)+t.getX(s+1)+t.getX(s+2)),Kt.a.fromBufferAttribute(e,s),Kt.b.fromBufferAttribute(e,s+1),Kt.c.fromBufferAttribute(e,s+2),o*=Kt.getArea(),i[s/3]=o}this.distribution=new Float32Array(e.count/3);let r=0;for(let s=0;s<i.length;s++)r+=i[s],this.distribution[s]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){const r=this.sampleFaceIndex();return this.sampleFace(r,e,t,i)}sampleFaceIndex(){const e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){const t=this.distribution;let i=0,r=t.length-1,s=-1;for(;i<=r;){const o=Math.ceil((i+r)/2);if(o===0||t[o-1]<=e&&t[o]>e){s=o;break}else e<t[o]?r=o-1:i=o+1}return s}sampleFace(e,t,i,r){let s=this.randomFunction(),o=this.randomFunction();return s+o>1&&(s=1-s,o=1-o),Kt.a.fromBufferAttribute(this.positionAttribute,e*3),Kt.b.fromBufferAttribute(this.positionAttribute,e*3+1),Kt.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(Kt.a,s).addScaledVector(Kt.b,o).addScaledVector(Kt.c,1-(s+o)),i!==void 0&&Kt.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(Kt.a.fromBufferAttribute(this.colorAttribute,e*3),Kt.b.fromBufferAttribute(this.colorAttribute,e*3+1),Kt.c.fromBufferAttribute(this.colorAttribute,e*3+2),jo.set(0,0,0).addScaledVector(Kt.a,s).addScaledVector(Kt.b,o).addScaledVector(Kt.c,1-(s+o)),r.r=jo.x,r.g=jo.y,r.b=jo.z),this}}var $g=Object.defineProperty,Jg=(n,e,t)=>e in n?$g(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ke=(n,e,t)=>(Jg(n,typeof e!="symbol"?e+"":e,t),t);const kh=new T;let e4=class extends dr{constructor(e,t){super(),ke(this,"object"),ke(this,"domElement"),ke(this,"enabled",!0),ke(this,"movementSpeed",1),ke(this,"lookSpeed",.005),ke(this,"lookVertical",!0),ke(this,"autoForward",!1),ke(this,"activeLook",!0),ke(this,"heightSpeed",!1),ke(this,"heightCoef",1),ke(this,"heightMin",0),ke(this,"heightMax",1),ke(this,"constrainVertical",!1),ke(this,"verticalMin",0),ke(this,"verticalMax",Math.PI),ke(this,"mouseDragOn",!1),ke(this,"autoSpeedFactor",0),ke(this,"mouseX",0),ke(this,"mouseY",0),ke(this,"moveForward",!1),ke(this,"moveBackward",!1),ke(this,"moveLeft",!1),ke(this,"moveRight",!1),ke(this,"moveUp",!1),ke(this,"moveDown",!1),ke(this,"viewHalfX",0),ke(this,"viewHalfY",0),ke(this,"lat",0),ke(this,"lon",0),ke(this,"lookDirection",new T),ke(this,"spherical",new tc),ke(this,"target",new T),ke(this,"connect",i=>{i.setAttribute("tabindex","-1"),i.style.touchAction="none",i.addEventListener("contextmenu",this.contextmenu),i.addEventListener("mousemove",this.onMouseMove),i.addEventListener("mousedown",this.onMouseDown),i.addEventListener("mouseup",this.onMouseUp),this.domElement=i,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize()}),ke(this,"dispose",()=>{var i,r,s,o;(i=this.domElement)==null||i.removeEventListener("contextmenu",this.contextmenu),(r=this.domElement)==null||r.removeEventListener("mousedown",this.onMouseDown),(s=this.domElement)==null||s.removeEventListener("mousemove",this.onMouseMove),(o=this.domElement)==null||o.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}),ke(this,"handleResize",()=>{this.domElement&&(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}),ke(this,"onMouseDown",i=>{var r;if((r=this.domElement)==null||r.focus(),this.activeLook)switch(i.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0;break}this.mouseDragOn=!0}),ke(this,"onMouseUp",i=>{if(this.activeLook)switch(i.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1;break}this.mouseDragOn=!1}),ke(this,"onMouseMove",i=>{this.domElement&&(this.mouseX=i.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=i.pageY-this.domElement.offsetTop-this.viewHalfY)}),ke(this,"onKeyDown",i=>{switch(i.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0;break}}),ke(this,"onKeyUp",i=>{switch(i.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1;break}}),ke(this,"lookAt",(i,r,s)=>(i instanceof T?this.target.copy(i):r&&s&&this.target.set(i,r,s),this.object.lookAt(this.target),this.setOrientation(),this)),ke(this,"update",i=>{if(!this.enabled)return;if(this.heightSpeed){const h=De.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=i*(h*this.heightCoef)}else this.autoSpeedFactor=0;const r=i*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(r+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(r),this.moveLeft&&this.object.translateX(-r),this.moveRight&&this.object.translateX(r),this.moveUp&&this.object.translateY(r),this.moveDown&&this.object.translateY(-r);let s=i*this.lookSpeed;this.activeLook||(s=0);let o=1;this.constrainVertical&&(o=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*s,this.lookVertical&&(this.lat-=this.mouseY*s*o),this.lat=Math.max(-85,Math.min(85,this.lat));let a=De.degToRad(90-this.lat);const c=De.degToRad(this.lon);this.constrainVertical&&(a=De.mapLinear(a,0,Math.PI,this.verticalMin,this.verticalMax));const u=this.object.position;kh.setFromSphericalCoords(1,a,c).add(u),this.object.lookAt(kh)}),ke(this,"contextmenu",i=>i.preventDefault()),ke(this,"setOrientation",()=>{this.lookDirection.set(0,0,-1).applyQuaternion(this.object.quaternion),this.spherical.setFromVector3(this.lookDirection),this.lat=90-De.radToDeg(this.spherical.phi),this.lon=De.radToDeg(this.spherical.theta)}),this.object=e,this.domElement=t,this.setOrientation(),t&&this.connect(t)}};var t4=Object.defineProperty,n4=(n,e,t)=>e in n?t4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,re=(n,e,t)=>(n4(n,typeof e!="symbol"?e+"":e,t),t);let i4=class extends Ot{constructor(e,t){super(),re(this,"isTransformControls",!0),re(this,"visible",!1),re(this,"domElement"),re(this,"raycaster",new nc),re(this,"gizmo"),re(this,"plane"),re(this,"tempVector",new T),re(this,"tempVector2",new T),re(this,"tempQuaternion",new Fe),re(this,"unit",{X:new T(1,0,0),Y:new T(0,1,0),Z:new T(0,0,1)}),re(this,"pointStart",new T),re(this,"pointEnd",new T),re(this,"offset",new T),re(this,"rotationAxis",new T),re(this,"startNorm",new T),re(this,"endNorm",new T),re(this,"rotationAngle",0),re(this,"cameraPosition",new T),re(this,"cameraQuaternion",new Fe),re(this,"cameraScale",new T),re(this,"parentPosition",new T),re(this,"parentQuaternion",new Fe),re(this,"parentQuaternionInv",new Fe),re(this,"parentScale",new T),re(this,"worldPositionStart",new T),re(this,"worldQuaternionStart",new Fe),re(this,"worldScaleStart",new T),re(this,"worldPosition",new T),re(this,"worldQuaternion",new Fe),re(this,"worldQuaternionInv",new Fe),re(this,"worldScale",new T),re(this,"eye",new T),re(this,"positionStart",new T),re(this,"quaternionStart",new Fe),re(this,"scaleStart",new T),re(this,"camera"),re(this,"object"),re(this,"enabled",!0),re(this,"axis",null),re(this,"mode","translate"),re(this,"translationSnap",null),re(this,"rotationSnap",null),re(this,"scaleSnap",null),re(this,"space","world"),re(this,"size",1),re(this,"dragging",!1),re(this,"showX",!0),re(this,"showY",!0),re(this,"showZ",!0),re(this,"changeEvent",{type:"change"}),re(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),re(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),re(this,"objectChangeEvent",{type:"objectChange"}),re(this,"intersectObjectWithRay",(r,s,o)=>{const a=s.intersectObject(r,!0);for(let c=0;c<a.length;c++)if(a[c].object.visible||o)return a[c];return!1}),re(this,"attach",r=>(this.object=r,this.visible=!0,this)),re(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),re(this,"reset",()=>this.enabled?(this.dragging&&this.object!==void 0&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this),re(this,"updateMatrixWorld",()=>{this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),re(this,"pointerHover",r=>{if(this.object===void 0||this.dragging===!0)return;this.raycaster.setFromCamera(r,this.camera);const s=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);s?this.axis=s.object.name:this.axis=null}),re(this,"pointerDown",r=>{if(!(this.object===void 0||this.dragging===!0||r.button!==0)&&this.axis!==null){this.raycaster.setFromCamera(r,this.camera);const s=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(s){let o=this.space;if(this.mode==="scale"?o="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(o="world"),o==="local"&&this.mode==="rotate"){const a=this.rotationSnap;this.axis==="X"&&a&&(this.object.rotation.x=Math.round(this.object.rotation.x/a)*a),this.axis==="Y"&&a&&(this.object.rotation.y=Math.round(this.object.rotation.y/a)*a),this.axis==="Z"&&a&&(this.object.rotation.z=Math.round(this.object.rotation.z/a)*a)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(s.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),re(this,"pointerMove",r=>{const s=this.axis,o=this.mode,a=this.object;let c=this.space;if(o==="scale"?c="local":(s==="E"||s==="XYZE"||s==="XYZ")&&(c="world"),a===void 0||s===null||this.dragging===!1||r.button!==-1)return;this.raycaster.setFromCamera(r,this.camera);const u=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(u){if(this.pointEnd.copy(u.point).sub(this.worldPositionStart),o==="translate")this.offset.copy(this.pointEnd).sub(this.pointStart),c==="local"&&s!=="XYZ"&&this.offset.applyQuaternion(this.worldQuaternionInv),s.indexOf("X")===-1&&(this.offset.x=0),s.indexOf("Y")===-1&&(this.offset.y=0),s.indexOf("Z")===-1&&(this.offset.z=0),c==="local"&&s!=="XYZ"?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),a.position.copy(this.offset).add(this.positionStart),this.translationSnap&&(c==="local"&&(a.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this.quaternionStart)),c==="world"&&(a.parent&&a.position.add(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld)),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld))));else if(o==="scale"){if(s.search("XYZ")!==-1){let f=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(f*=-1),this.tempVector2.set(f,f,f)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),s.search("X")===-1&&(this.tempVector2.x=1),s.search("Y")===-1&&(this.tempVector2.y=1),s.search("Z")===-1&&(this.tempVector2.z=1);a.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(s.search("X")!==-1&&(this.object.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this.offset.copy(this.pointEnd).sub(this.pointStart);const f=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));s==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):s==="XYZE"?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*f):(s==="X"||s==="Y"||s==="Z")&&(this.rotationAxis.copy(this.unit[s]),this.tempVector.copy(this.unit[s]),c==="local"&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*f),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),c==="local"&&s!=="E"&&s!=="XYZE"?(a.quaternion.copy(this.quaternionStart),a.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),a.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),re(this,"pointerUp",r=>{r.button===0&&(this.dragging&&this.axis!==null&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),re(this,"getPointer",r=>{var s;if(this.domElement&&((s=this.domElement.ownerDocument)!=null&&s.pointerLockElement))return{x:0,y:0,button:r.button};{const o=r.changedTouches?r.changedTouches[0]:r,a=this.domElement.getBoundingClientRect();return{x:(o.clientX-a.left)/a.width*2-1,y:-(o.clientY-a.top)/a.height*2+1,button:r.button}}}),re(this,"onPointerHover",r=>{if(this.enabled)switch(r.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(r));break}}),re(this,"onPointerDown",r=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(r)),this.pointerDown(this.getPointer(r)))}),re(this,"onPointerMove",r=>{this.enabled&&this.pointerMove(this.getPointer(r))}),re(this,"onPointerUp",r=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(r)))}),re(this,"getMode",()=>this.mode),re(this,"setMode",r=>{this.mode=r}),re(this,"setTranslationSnap",r=>{this.translationSnap=r}),re(this,"setRotationSnap",r=>{this.rotationSnap=r}),re(this,"setScaleSnap",r=>{this.scaleSnap=r}),re(this,"setSize",r=>{this.size=r}),re(this,"setSpace",r=>{this.space=r}),re(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),re(this,"connect",r=>{r===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=r,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),re(this,"dispose",()=>{var r,s,o,a,c,u;(r=this.domElement)==null||r.removeEventListener("pointerdown",this.onPointerDown),(s=this.domElement)==null||s.removeEventListener("pointermove",this.onPointerHover),(a=(o=this.domElement)==null?void 0:o.ownerDocument)==null||a.removeEventListener("pointermove",this.onPointerMove),(u=(c=this.domElement)==null?void 0:c.ownerDocument)==null||u.removeEventListener("pointerup",this.onPointerUp),this.traverse(f=>{const h=f;h.geometry&&h.geometry.dispose(),h.material&&h.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new r4,this.add(this.gizmo),this.plane=new s4,this.add(this.plane);const i=(r,s)=>{let o=s;Object.defineProperty(this,r,{get:function(){return o!==void 0?o:s},set:function(a){o!==a&&(o=a,this.plane[r]=a,this.gizmo[r]=a,this.dispatchEvent({type:r+"-changed",value:a}),this.dispatchEvent(this.changeEvent))}}),this[r]=s,this.plane[r]=s,this.gizmo[r]=s};i("camera",this.camera),i("object",this.object),i("enabled",this.enabled),i("axis",this.axis),i("mode",this.mode),i("translationSnap",this.translationSnap),i("rotationSnap",this.rotationSnap),i("scaleSnap",this.scaleSnap),i("space",this.space),i("size",this.size),i("dragging",this.dragging),i("showX",this.showX),i("showY",this.showY),i("showZ",this.showZ),i("worldPosition",this.worldPosition),i("worldPositionStart",this.worldPositionStart),i("worldQuaternion",this.worldQuaternion),i("worldQuaternionStart",this.worldQuaternionStart),i("cameraPosition",this.cameraPosition),i("cameraQuaternion",this.cameraQuaternion),i("pointStart",this.pointStart),i("pointEnd",this.pointEnd),i("rotationAxis",this.rotationAxis),i("rotationAngle",this.rotationAngle),i("eye",this.eye),t!==void 0&&this.connect(t)}};class r4 extends Ot{constructor(){super(),re(this,"isTransformControlsGizmo",!0),re(this,"type","TransformControlsGizmo"),re(this,"tempVector",new T(0,0,0)),re(this,"tempEuler",new En),re(this,"alignVector",new T(0,1,0)),re(this,"zeroVector",new T(0,0,0)),re(this,"lookAtMatrix",new ue),re(this,"tempQuaternion",new Fe),re(this,"tempQuaternion2",new Fe),re(this,"identityQuaternion",new Fe),re(this,"unitX",new T(1,0,0)),re(this,"unitY",new T(0,1,0)),re(this,"unitZ",new T(0,0,1)),re(this,"gizmo"),re(this,"picker"),re(this,"helper"),re(this,"rotationAxis",new T),re(this,"cameraPosition",new T),re(this,"worldPositionStart",new T),re(this,"worldQuaternionStart",new Fe),re(this,"worldPosition",new T),re(this,"worldQuaternion",new Fe),re(this,"eye",new T),re(this,"camera",null),re(this,"enabled",!0),re(this,"axis",null),re(this,"mode","translate"),re(this,"space","world"),re(this,"size",1),re(this,"dragging",!1),re(this,"showX",!0),re(this,"showY",!0),re(this,"showZ",!0),re(this,"updateMatrixWorld",()=>{let Y=this.space;this.mode==="scale"&&(Y="local");const H=Y==="local"?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let X=[];X=X.concat(this.picker[this.mode].children),X=X.concat(this.gizmo[this.mode].children),X=X.concat(this.helper[this.mode].children);for(let W=0;W<X.length;W++){const P=X[W];P.visible=!0,P.rotation.set(0,0,0),P.position.copy(this.worldPosition);let z;if(this.camera.isOrthographicCamera?z=(this.camera.top-this.camera.bottom)/this.camera.zoom:z=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),P.scale.set(1,1,1).multiplyScalar(z*this.size/7),P.tag==="helper"){P.visible=!1,P.name==="AXIS"?(P.position.copy(this.worldPositionStart),P.visible=!!this.axis,this.axis==="X"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),P.quaternion.copy(H).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(H).dot(this.eye))>.9&&(P.visible=!1)),this.axis==="Y"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),P.quaternion.copy(H).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(H).dot(this.eye))>.9&&(P.visible=!1)),this.axis==="Z"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),P.quaternion.copy(H).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(H).dot(this.eye))>.9&&(P.visible=!1)),this.axis==="XYZE"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),P.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),P.quaternion.multiply(this.tempQuaternion),P.visible=this.dragging),this.axis==="E"&&(P.visible=!1)):P.name==="START"?(P.position.copy(this.worldPositionStart),P.visible=this.dragging):P.name==="END"?(P.position.copy(this.worldPosition),P.visible=this.dragging):P.name==="DELTA"?(P.position.copy(this.worldPositionStart),P.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),P.scale.copy(this.tempVector),P.visible=this.dragging):(P.quaternion.copy(H),this.dragging?P.position.copy(this.worldPositionStart):P.position.copy(this.worldPosition),this.axis&&(P.visible=this.axis.search(P.name)!==-1));continue}P.quaternion.copy(H),this.mode==="translate"||this.mode==="scale"?((P.name==="X"||P.name==="XYZX")&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(H).dot(this.eye))>.99&&(P.scale.set(1e-10,1e-10,1e-10),P.visible=!1),(P.name==="Y"||P.name==="XYZY")&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(H).dot(this.eye))>.99&&(P.scale.set(1e-10,1e-10,1e-10),P.visible=!1),(P.name==="Z"||P.name==="XYZZ")&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(H).dot(this.eye))>.99&&(P.scale.set(1e-10,1e-10,1e-10),P.visible=!1),P.name==="XY"&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(H).dot(this.eye))<.2&&(P.scale.set(1e-10,1e-10,1e-10),P.visible=!1),P.name==="YZ"&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(H).dot(this.eye))<.2&&(P.scale.set(1e-10,1e-10,1e-10),P.visible=!1),P.name==="XZ"&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(H).dot(this.eye))<.2&&(P.scale.set(1e-10,1e-10,1e-10),P.visible=!1),P.name.search("X")!==-1&&(this.alignVector.copy(this.unitX).applyQuaternion(H).dot(this.eye)<0?P.tag==="fwd"?P.visible=!1:P.scale.x*=-1:P.tag==="bwd"&&(P.visible=!1)),P.name.search("Y")!==-1&&(this.alignVector.copy(this.unitY).applyQuaternion(H).dot(this.eye)<0?P.tag==="fwd"?P.visible=!1:P.scale.y*=-1:P.tag==="bwd"&&(P.visible=!1)),P.name.search("Z")!==-1&&(this.alignVector.copy(this.unitZ).applyQuaternion(H).dot(this.eye)<0?P.tag==="fwd"?P.visible=!1:P.scale.z*=-1:P.tag==="bwd"&&(P.visible=!1))):this.mode==="rotate"&&(this.tempQuaternion2.copy(H),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(H).invert()),P.name.search("E")!==-1&&P.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),P.name==="X"&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),P.quaternion.copy(this.tempQuaternion)),P.name==="Y"&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),P.quaternion.copy(this.tempQuaternion)),P.name==="Z"&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),P.quaternion.copy(this.tempQuaternion))),P.visible=P.visible&&(P.name.indexOf("X")===-1||this.showX),P.visible=P.visible&&(P.name.indexOf("Y")===-1||this.showY),P.visible=P.visible&&(P.name.indexOf("Z")===-1||this.showZ),P.visible=P.visible&&(P.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),P.material.tempOpacity=P.material.tempOpacity||P.material.opacity,P.material.tempColor=P.material.tempColor||P.material.color.clone(),P.material.color.copy(P.material.tempColor),P.material.opacity=P.material.tempOpacity,this.enabled?this.axis&&(P.name===this.axis?(P.material.opacity=1,P.material.color.lerp(new ze(1,1,1),.5)):this.axis.split("").some(function(D){return P.name===D})?(P.material.opacity=1,P.material.color.lerp(new ze(1,1,1),.5)):(P.material.opacity*=.25,P.material.color.lerp(new ze(1,1,1),.5))):(P.material.opacity*=.5,P.material.color.lerp(new ze(1,1,1),.5))}super.updateMatrixWorld()});const e=new So({depthTest:!1,depthWrite:!1,transparent:!0,side:on,fog:!1,toneMapped:!1}),t=new uo({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),i=e.clone();i.opacity=.15;const r=e.clone();r.opacity=.33;const s=e.clone();s.color.set(16711680);const o=e.clone();o.color.set(65280);const a=e.clone();a.color.set(255);const c=e.clone();c.opacity=.25;const u=c.clone();u.color.set(16776960);const f=c.clone();f.color.set(65535);const h=c.clone();h.color.set(16711935),e.clone().color.set(16776960);const y=t.clone();y.color.set(16711680);const x=t.clone();x.color.set(65280);const d=t.clone();d.color.set(255);const v=t.clone();v.color.set(65535);const g=t.clone();g.color.set(16711935);const p=t.clone();p.color.set(16776960);const m=t.clone();m.color.set(7895160);const E=p.clone();E.opacity=.25;const w=new Vn(0,.05,.2,12,1,!1),_=new ki(.125,.125,.125),C=new tn;C.setAttribute("position",new Yt([0,0,0,1,0,0],3));const I=(Y,H)=>{const X=new tn,W=[];for(let P=0;P<=64*H;++P)W.push(0,Math.cos(P/32*Math.PI)*Y,Math.sin(P/32*Math.PI)*Y);return X.setAttribute("position",new Yt(W,3)),X},b=()=>{const Y=new tn;return Y.setAttribute("position",new Yt([0,0,0,1,1,1],3)),Y},B={X:[[new be(w,s),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new be(w,s),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new Xe(C,y)]],Y:[[new be(w,o),[0,1,0],null,null,"fwd"],[new be(w,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new Xe(C,x),null,[0,0,Math.PI/2]]],Z:[[new be(w,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new be(w,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new Xe(C,d),null,[0,-Math.PI/2,0]]],XYZ:[[new be(new nr(.1,0),c.clone()),[0,0,0],[0,0,0]]],XY:[[new be(new fi(.295,.295),u.clone()),[.15,.15,0]],[new Xe(C,p),[.18,.3,0],null,[.125,1,1]],[new Xe(C,p),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new be(new fi(.295,.295),f.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new Xe(C,v),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new Xe(C,v),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new be(new fi(.295,.295),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new Xe(C,g),[.18,0,.3],null,[.125,1,1]],[new Xe(C,g),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},Q={X:[[new be(new Vn(.2,0,1,4,1,!1),i),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new be(new Vn(.2,0,1,4,1,!1),i),[0,.6,0]]],Z:[[new be(new Vn(.2,0,1,4,1,!1),i),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new be(new nr(.2,0),i)]],XY:[[new be(new fi(.4,.4),i),[.2,.2,0]]],YZ:[[new be(new fi(.4,.4),i),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new be(new fi(.4,.4),i),[.2,0,.2],[-Math.PI/2,0,0]]]},S={START:[[new be(new nr(.01,2),r),null,null,null,"helper"]],END:[[new be(new nr(.01,2),r),null,null,null,"helper"]],DELTA:[[new Xe(b(),r),null,null,null,"helper"]],X:[[new Xe(C,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Xe(C,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Xe(C,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},k={X:[[new Xe(I(1,.5),y)],[new be(new nr(.04,0),s),[0,0,.99],null,[1,3,1]]],Y:[[new Xe(I(1,.5),x),null,[0,0,-Math.PI/2]],[new be(new nr(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new Xe(I(1,.5),d),null,[0,Math.PI/2,0]],[new be(new nr(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new Xe(I(1.25,1),E),null,[0,Math.PI/2,0]],[new be(new Vn(.03,0,.15,4,1,!1),E),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new be(new Vn(.03,0,.15,4,1,!1),E),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new be(new Vn(.03,0,.15,4,1,!1),E),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new be(new Vn(.03,0,.15,4,1,!1),E),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new Xe(I(1,1),m),null,[0,Math.PI/2,0]]]},L={AXIS:[[new Xe(C,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},O={X:[[new be(new ko(1,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new be(new ko(1,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new be(new ko(1,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new be(new ko(1.25,.1,2,24),i)]],XYZE:[[new be(new Yf(.7,10,8),i)]]},G={X:[[new be(_,s),[.8,0,0],[0,0,-Math.PI/2]],[new Xe(C,y),null,null,[.8,1,1]]],Y:[[new be(_,o),[0,.8,0]],[new Xe(C,x),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new be(_,a),[0,0,.8],[Math.PI/2,0,0]],[new Xe(C,d),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new be(_,u),[.85,.85,0],null,[2,2,.2]],[new Xe(C,p),[.855,.98,0],null,[.125,1,1]],[new Xe(C,p),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new be(_,f),[0,.85,.85],null,[.2,2,2]],[new Xe(C,v),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new Xe(C,v),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new be(_,h),[.85,0,.85],null,[2,.2,2]],[new Xe(C,g),[.855,0,.98],null,[.125,1,1]],[new Xe(C,g),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new be(new ki(.125,.125,.125),c.clone()),[1.1,0,0]]],XYZY:[[new be(new ki(.125,.125,.125),c.clone()),[0,1.1,0]]],XYZZ:[[new be(new ki(.125,.125,.125),c.clone()),[0,0,1.1]]]},V={X:[[new be(new Vn(.2,0,.8,4,1,!1),i),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new be(new Vn(.2,0,.8,4,1,!1),i),[0,.5,0]]],Z:[[new be(new Vn(.2,0,.8,4,1,!1),i),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new be(_,i),[.85,.85,0],null,[3,3,.2]]],YZ:[[new be(_,i),[0,.85,.85],null,[.2,3,3]]],XZ:[[new be(_,i),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new be(new ki(.2,.2,.2),i),[1.1,0,0]]],XYZY:[[new be(new ki(.2,.2,.2),i),[0,1.1,0]]],XYZZ:[[new be(new ki(.2,.2,.2),i),[0,0,1.1]]]},N={X:[[new Xe(C,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Xe(C,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Xe(C,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},j=Y=>{const H=new Ot;for(let X in Y)for(let W=Y[X].length;W--;){const P=Y[X][W][0].clone(),z=Y[X][W][1],D=Y[X][W][2],R=Y[X][W][3],$=Y[X][W][4];P.name=X,P.tag=$,z&&P.position.set(z[0],z[1],z[2]),D&&P.rotation.set(D[0],D[1],D[2]),R&&P.scale.set(R[0],R[1],R[2]),P.updateMatrix();const se=P.geometry.clone();se.applyMatrix4(P.matrix),P.geometry=se,P.renderOrder=1/0,P.position.set(0,0,0),P.rotation.set(0,0,0),P.scale.set(1,1,1),H.add(P)}return H};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=j(B)),this.add(this.gizmo.rotate=j(k)),this.add(this.gizmo.scale=j(G)),this.add(this.picker.translate=j(Q)),this.add(this.picker.rotate=j(O)),this.add(this.picker.scale=j(V)),this.add(this.helper.translate=j(S)),this.add(this.helper.rotate=j(L)),this.add(this.helper.scale=j(N)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class s4 extends be{constructor(){super(new fi(1e5,1e5,2,2),new So({visible:!1,wireframe:!0,side:on,transparent:!0,opacity:.1,toneMapped:!1})),re(this,"isTransformControlsPlane",!0),re(this,"type","TransformControlsPlane"),re(this,"unitX",new T(1,0,0)),re(this,"unitY",new T(0,1,0)),re(this,"unitZ",new T(0,0,1)),re(this,"tempVector",new T),re(this,"dirVector",new T),re(this,"alignVector",new T),re(this,"tempMatrix",new ue),re(this,"identityQuaternion",new Fe),re(this,"cameraQuaternion",new Fe),re(this,"worldPosition",new T),re(this,"worldQuaternion",new Fe),re(this,"eye",new T),re(this,"axis",null),re(this,"mode","translate"),re(this,"space","world"),re(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),this.unitX.set(1,0,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion(e==="local"?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0);break}break;case"rotate":default:this.dirVector.set(0,0,0)}this.dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}var o4=Object.defineProperty,a4=(n,e,t)=>e in n?o4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,zt=(n,e,t)=>(a4(n,typeof e!="symbol"?e+"":e,t),t);const wr=new En(0,0,0,"YXZ"),_r=new T,c4={type:"change"},l4={type:"lock"},u4={type:"unlock"},Oh=Math.PI/2;let h4=class extends dr{constructor(e,t){super(),zt(this,"camera"),zt(this,"domElement"),zt(this,"isLocked"),zt(this,"minPolarAngle"),zt(this,"maxPolarAngle"),zt(this,"pointerSpeed"),zt(this,"onMouseMove",i=>{if(!this.domElement||this.isLocked===!1)return;const r=i.movementX||i.mozMovementX||i.webkitMovementX||0,s=i.movementY||i.mozMovementY||i.webkitMovementY||0;wr.setFromQuaternion(this.camera.quaternion),wr.y-=r*.002*this.pointerSpeed,wr.x-=s*.002*this.pointerSpeed,wr.x=Math.max(Oh-this.maxPolarAngle,Math.min(Oh-this.minPolarAngle,wr.x)),this.camera.quaternion.setFromEuler(wr),this.dispatchEvent(c4)}),zt(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(l4),this.isLocked=!0):(this.dispatchEvent(u4),this.isLocked=!1))}),zt(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),zt(this,"connect",i=>{this.domElement=i||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),zt(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),zt(this,"dispose",()=>{this.disconnect()}),zt(this,"getObject",()=>this.camera),zt(this,"direction",new T(0,0,-1)),zt(this,"getDirection",i=>i.copy(this.direction).applyQuaternion(this.camera.quaternion)),zt(this,"moveForward",i=>{_r.setFromMatrixColumn(this.camera.matrix,0),_r.crossVectors(this.camera.up,_r),this.camera.position.addScaledVector(_r,i)}),zt(this,"moveRight",i=>{_r.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(_r,i)}),zt(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),zt(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}};var f4=Object.defineProperty,A4=(n,e,t)=>e in n?f4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ft=(n,e,t)=>(A4(n,typeof e!="symbol"?e+"":e,t),t);let d4=class extends dr{constructor(e){super(),Ft(this,"object"),Ft(this,"changeEvent",{type:"change"}),Ft(this,"EPS",1e-6),Ft(this,"enabled",!0),Ft(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),Ft(this,"screenOrientation",0),Ft(this,"alphaOffset",0),Ft(this,"onDeviceOrientationChangeEvent",t=>{this.deviceOrientation=t}),Ft(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),Ft(this,"zee",new T(0,0,1)),Ft(this,"euler",new En),Ft(this,"q0",new Fe),Ft(this,"q1",new Fe(-Math.sqrt(.5),0,0,Math.sqrt(.5))),Ft(this,"setObjectQuaternion",(t,i,r,s,o)=>{this.euler.set(r,i,-s,"YXZ"),t.setFromEuler(this.euler),t.multiply(this.q1),t.multiply(this.q0.setFromAxisAngle(this.zee,-o))}),Ft(this,"connect",()=>{this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(t=>{t=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(t=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",t)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),Ft(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),Ft(this,"lastQuaternion",new Fe),Ft(this,"update",()=>{if(this.enabled===!1)return;const t=this.deviceOrientation;if(t){const i=t.alpha?De.degToRad(t.alpha)+this.alphaOffset:0,r=t.beta?De.degToRad(t.beta):0,s=t.gamma?De.degToRad(t.gamma):0,o=this.screenOrientation?De.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,i,r,s,o),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),Ft(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}};var m4=Object.defineProperty,p4=(n,e,t)=>e in n?m4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ve=(n,e,t)=>(p4(n,typeof e!="symbol"?e+"":e,t),t);let g4=class extends dr{constructor(e,t){super(),ve(this,"enabled",!0),ve(this,"screen",{left:0,top:0,width:0,height:0}),ve(this,"rotateSpeed",1),ve(this,"zoomSpeed",1.2),ve(this,"panSpeed",.3),ve(this,"noRotate",!1),ve(this,"noZoom",!1),ve(this,"noPan",!1),ve(this,"staticMoving",!1),ve(this,"dynamicDampingFactor",.2),ve(this,"minDistance",0),ve(this,"maxDistance",1/0),ve(this,"keys",["KeyA","KeyS","KeyD"]),ve(this,"mouseButtons",{LEFT:_c.ROTATE,MIDDLE:_c.DOLLY,RIGHT:_c.PAN}),ve(this,"object"),ve(this,"domElement"),ve(this,"cursorZoom",!1),ve(this,"target",new T),ve(this,"mousePosition",new _e),ve(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),ve(this,"EPS",1e-6),ve(this,"lastZoom",1),ve(this,"lastPosition",new T),ve(this,"cursorVector",new T),ve(this,"targetVector",new T),ve(this,"_state",this.STATE.NONE),ve(this,"_keyState",this.STATE.NONE),ve(this,"_eye",new T),ve(this,"_movePrev",new _e),ve(this,"_moveCurr",new _e),ve(this,"_lastAxis",new T),ve(this,"_lastAngle",0),ve(this,"_zoomStart",new _e),ve(this,"_zoomEnd",new _e),ve(this,"_touchZoomDistanceStart",0),ve(this,"_touchZoomDistanceEnd",0),ve(this,"_panStart",new _e),ve(this,"_panEnd",new _e),ve(this,"target0"),ve(this,"position0"),ve(this,"up0"),ve(this,"zoom0"),ve(this,"changeEvent",{type:"change"}),ve(this,"startEvent",{type:"start"}),ve(this,"endEvent",{type:"end"}),ve(this,"onScreenVector",new _e),ve(this,"getMouseOnScreen",(i,r)=>(this.onScreenVector.set((i-this.screen.left)/this.screen.width,(r-this.screen.top)/this.screen.height),this.onScreenVector)),ve(this,"onCircleVector",new _e),ve(this,"getMouseOnCircle",(i,r)=>(this.onCircleVector.set((i-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-r))/this.screen.width),this.onCircleVector)),ve(this,"axis",new T),ve(this,"quaternion",new Fe),ve(this,"eyeDirection",new T),ve(this,"objectUpDirection",new T),ve(this,"objectSidewaysDirection",new T),ve(this,"moveDirection",new T),ve(this,"angle",0),ve(this,"rotateCamera",()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)}),ve(this,"zoomCamera",()=>{let i;if(this._state===this.STATE.TOUCH_ZOOM_PAN)i=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(i):this.object.isOrthographicCamera?(this.object.zoom/=i,this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(i=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,Math.abs(i-1)>this.EPS&&i>0&&(this.object.isPerspectiveCamera?(i>1&&this._eye.length()>=this.maxDistance-this.EPS&&(i=1),this._eye.multiplyScalar(i)):this.object.isOrthographicCamera?(i>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(i=1),this.object.zoom/=i):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let r=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(r,this.target,i)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}}),ve(this,"mouseChange",new _e),ve(this,"objectUp",new T),ve(this,"pan",new T),ve(this,"panCamera",()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){const i=this.object,r=(i.right-i.left)/this.object.zoom,s=(i.top-i.bottom)/this.object.zoom;this.mouseChange.x*=r,this.mouseChange.y*=s}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}),ve(this,"checkDistances",()=>{(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}),ve(this,"handleResize",()=>{if(!this.domElement)return;const i=this.domElement.getBoundingClientRect(),r=this.domElement.ownerDocument.documentElement;this.screen.left=i.left+window.pageXOffset-r.clientLeft,this.screen.top=i.top+window.pageYOffset-r.clientTop,this.screen.width=i.width,this.screen.height=i.height}),ve(this,"update",()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")}),ve(this,"reset",()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom}),ve(this,"keydown",i=>{this.enabled!==!1&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(i.code===this.keys[this.STATE.ROTATE]&&!this.noRotate?this._keyState=this.STATE.ROTATE:i.code===this.keys[this.STATE.ZOOM]&&!this.noZoom?this._keyState=this.STATE.ZOOM:i.code===this.keys[this.STATE.PAN]&&!this.noPan&&(this._keyState=this.STATE.PAN)))}),ve(this,"onPointerDown",i=>{if(this.enabled!==!1)switch(i.pointerType){case"mouse":case"pen":this.onMouseDown(i);break}}),ve(this,"onPointerMove",i=>{if(this.enabled!==!1)switch(i.pointerType){case"mouse":case"pen":this.onMouseMove(i);break}}),ve(this,"onPointerUp",i=>{if(this.enabled!==!1)switch(i.pointerType){case"mouse":case"pen":this.onMouseUp();break}}),ve(this,"keyup",()=>{this.enabled!==!1&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))}),ve(this,"onMouseDown",i=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(i.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN;break}const r=this._keyState!==this.STATE.NONE?this._keyState:this._state;r===this.STATE.ROTATE&&!this.noRotate?(this._moveCurr.copy(this.getMouseOnCircle(i.pageX,i.pageY)),this._movePrev.copy(this._moveCurr)):r===this.STATE.ZOOM&&!this.noZoom?(this._zoomStart.copy(this.getMouseOnScreen(i.pageX,i.pageY)),this._zoomEnd.copy(this._zoomStart)):r===this.STATE.PAN&&!this.noPan&&(this._panStart.copy(this.getMouseOnScreen(i.pageX,i.pageY)),this._panEnd.copy(this._panStart)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)}),ve(this,"onMouseMove",i=>{if(this.enabled===!1)return;const r=this._keyState!==this.STATE.NONE?this._keyState:this._state;r===this.STATE.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(i.pageX,i.pageY))):r===this.STATE.ZOOM&&!this.noZoom?this._zoomEnd.copy(this.getMouseOnScreen(i.pageX,i.pageY)):r===this.STATE.PAN&&!this.noPan&&this._panEnd.copy(this.getMouseOnScreen(i.pageX,i.pageY))}),ve(this,"onMouseUp",()=>{this.domElement&&this.enabled!==!1&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))}),ve(this,"mousewheel",i=>{if(this.enabled!==!1&&this.noZoom!==!0){switch(i.preventDefault(),i.deltaMode){case 2:this._zoomStart.y-=i.deltaY*.025;break;case 1:this._zoomStart.y-=i.deltaY*.01;break;default:this._zoomStart.y-=i.deltaY*25e-5;break}this.mousePosition.x=i.offsetX/this.screen.width*2-1,this.mousePosition.y=-(i.offsetY/this.screen.height)*2+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}}),ve(this,"touchstart",i=>{if(this.enabled!==!1){switch(i.preventDefault(),i.touches.length){case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(i.touches[0].pageX,i.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this._state=this.STATE.TOUCH_ZOOM_PAN;const r=i.touches[0].pageX-i.touches[1].pageX,s=i.touches[0].pageY-i.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(r*r+s*s);const o=(i.touches[0].pageX+i.touches[1].pageX)/2,a=(i.touches[0].pageY+i.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(o,a)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(this.startEvent)}}),ve(this,"touchmove",i=>{if(this.enabled!==!1)switch(i.preventDefault(),i.touches.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(i.touches[0].pageX,i.touches[0].pageY));break;default:const r=i.touches[0].pageX-i.touches[1].pageX,s=i.touches[0].pageY-i.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(r*r+s*s);const o=(i.touches[0].pageX+i.touches[1].pageX)/2,a=(i.touches[0].pageY+i.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(o,a));break}}),ve(this,"touchend",i=>{if(this.enabled!==!1){switch(i.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(i.touches[0].pageX,i.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break}this.dispatchEvent(this.endEvent)}}),ve(this,"contextmenu",i=>{this.enabled!==!1&&i.preventDefault()}),ve(this,"connect",i=>{i===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=i,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()}),ve(this,"dispose",()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))}),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,t!==void 0&&this.connect(t),this.update()}};var y4=Object.defineProperty,v4=(n,e,t)=>e in n?y4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ee=(n,e,t)=>(v4(n,typeof e!="symbol"?e+"":e,t),t);const Pe={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},tt={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},Ge={x:0,y:0},xn={camera:new ue,gizmos:new ue},At={type:"change"},Wn={type:"start"},Sn={type:"end"};let x4=class extends dr{constructor(e,t=null,i=null){super(),ee(this,"camera"),ee(this,"domElement"),ee(this,"scene"),ee(this,"mouseActions"),ee(this,"_mouseOp"),ee(this,"_v2_1"),ee(this,"_v3_1"),ee(this,"_v3_2"),ee(this,"_m4_1"),ee(this,"_m4_2"),ee(this,"_quat"),ee(this,"_translationMatrix"),ee(this,"_rotationMatrix"),ee(this,"_scaleMatrix"),ee(this,"_rotationAxis"),ee(this,"_cameraMatrixState"),ee(this,"_cameraProjectionState"),ee(this,"_fovState"),ee(this,"_upState"),ee(this,"_zoomState"),ee(this,"_nearPos"),ee(this,"_farPos"),ee(this,"_gizmoMatrixState"),ee(this,"_up0"),ee(this,"_zoom0"),ee(this,"_fov0"),ee(this,"_initialNear"),ee(this,"_nearPos0"),ee(this,"_initialFar"),ee(this,"_farPos0"),ee(this,"_cameraMatrixState0"),ee(this,"_gizmoMatrixState0"),ee(this,"_button"),ee(this,"_touchStart"),ee(this,"_touchCurrent"),ee(this,"_input"),ee(this,"_switchSensibility"),ee(this,"_startFingerDistance"),ee(this,"_currentFingerDistance"),ee(this,"_startFingerRotation"),ee(this,"_currentFingerRotation"),ee(this,"_devPxRatio"),ee(this,"_downValid"),ee(this,"_nclicks"),ee(this,"_downEvents"),ee(this,"_clickStart"),ee(this,"_maxDownTime"),ee(this,"_maxInterval"),ee(this,"_posThreshold"),ee(this,"_movementThreshold"),ee(this,"_currentCursorPosition"),ee(this,"_startCursorPosition"),ee(this,"_grid"),ee(this,"_gridPosition"),ee(this,"_gizmos"),ee(this,"_curvePts"),ee(this,"_timeStart"),ee(this,"_animationId"),ee(this,"focusAnimationTime"),ee(this,"_timePrev"),ee(this,"_timeCurrent"),ee(this,"_anglePrev"),ee(this,"_angleCurrent"),ee(this,"_cursorPosPrev"),ee(this,"_cursorPosCurr"),ee(this,"_wPrev"),ee(this,"_wCurr"),ee(this,"adjustNearFar"),ee(this,"scaleFactor"),ee(this,"dampingFactor"),ee(this,"wMax"),ee(this,"enableAnimations"),ee(this,"enableGrid"),ee(this,"cursorZoom"),ee(this,"minFov"),ee(this,"maxFov"),ee(this,"enabled"),ee(this,"enablePan"),ee(this,"enableRotate"),ee(this,"enableZoom"),ee(this,"minDistance"),ee(this,"maxDistance"),ee(this,"minZoom"),ee(this,"maxZoom"),ee(this,"target"),ee(this,"_currentTarget"),ee(this,"_tbRadius"),ee(this,"_state"),ee(this,"onWindowResize",()=>{const r=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;if(this.camera){const u=this.calculateTbRadius(this.camera);u!==void 0&&(this._tbRadius=u)}const s=this._tbRadius/r,a=new Cc(0,0,s,s).getPoints(this._curvePts),c=new tn().setFromPoints(a);for(const u in this._gizmos.children){const f=this._gizmos.children[u];f.geometry=c}this.dispatchEvent(At)}),ee(this,"onContextMenu",r=>{if(this.enabled){for(let s=0;s<this.mouseActions.length;s++)if(this.mouseActions[s].mouse==2){r.preventDefault();break}}}),ee(this,"onPointerCancel",()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=tt.NONE}),ee(this,"onPointerDown",r=>{if(r.button==0&&r.isPrimary?(this._downValid=!0,this._downEvents.push(r)):this._downValid=!1,r.pointerType=="touch"&&this._input!=tt.CURSOR)switch(this._touchStart.push(r),this._touchCurrent.push(r),this._input){case tt.NONE:this._input=tt.ONE_FINGER,this.onSinglePanStart(r,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case tt.ONE_FINGER:case tt.ONE_FINGER_SWITCHED:this._input=tt.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case tt.TWO_FINGER:this._input=tt.MULT_FINGER,this.onTriplePanStart();break}else if(r.pointerType!="touch"&&this._input==tt.NONE){let s=null;r.ctrlKey||r.metaKey?s="CTRL":r.shiftKey&&(s="SHIFT"),this._mouseOp=this.getOpFromAction(r.button,s),this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=tt.CURSOR,this._button=r.button,this.onSinglePanStart(r,this._mouseOp))}}),ee(this,"onPointerMove",r=>{if(r.pointerType=="touch"&&this._input!=tt.CURSOR)switch(this._input){case tt.ONE_FINGER:this.updateTouchEvent(r),this.onSinglePanMove(r,Pe.ROTATE);break;case tt.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],r)*this._devPxRatio>=this._switchSensibility){this._input=tt.ONE_FINGER,this.updateTouchEvent(r),this.onSinglePanStart(r,"ROTATE");break}break;case tt.TWO_FINGER:this.updateTouchEvent(r),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case tt.MULT_FINGER:this.updateTouchEvent(r),this.onTriplePanMove();break}else if(r.pointerType!="touch"&&this._input==tt.CURSOR){let s=null;r.ctrlKey||r.metaKey?s="CTRL":r.shiftKey&&(s="SHIFT");const o=this.getOpStateFromAction(this._button,s);o&&this.onSinglePanMove(r,o)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],r)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}),ee(this,"onPointerUp",r=>{if(r.pointerType=="touch"&&this._input!=tt.CURSOR){const s=this._touchCurrent.length;for(let o=0;o<s;o++)if(this._touchCurrent[o].pointerId==r.pointerId){this._touchCurrent.splice(o,1),this._touchStart.splice(o,1);break}switch(this._input){case tt.ONE_FINGER:case tt.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=tt.NONE,this.onSinglePanEnd();break;case tt.TWO_FINGER:this.onDoublePanEnd(),this.onPinchEnd(),this.onRotateEnd(),this._input=tt.ONE_FINGER_SWITCHED;break;case tt.MULT_FINGER:this._touchCurrent.length==0&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=tt.NONE,this.onTriplePanEnd());break}}else r.pointerType!="touch"&&this._input==tt.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=tt.NONE,this.onSinglePanEnd(),this._button=-1);if(r.isPrimary)if(this._downValid)if(r.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(this._nclicks==0)this._nclicks=1,this._clickStart=performance.now();else{const o=r.timeStamp-this._clickStart,a=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;o<=this._maxInterval&&a<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(r)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length);else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}),ee(this,"onWheel",r=>{var s,o;if(this.enabled&&this.enableZoom&&this.domElement){let a=null;r.ctrlKey||r.metaKey?a="CTRL":r.shiftKey&&(a="SHIFT");const c=this.getOpFromAction("WHEEL",a);if(c){r.preventDefault(),this.dispatchEvent(Wn);const u=125;let f=r.deltaY/u,h=1;switch(f>0?h=1/this.scaleFactor:f<0&&(h=this.scaleFactor),c){case"ZOOM":if(this.updateTbState(Pe.SCALE,!0),f>0?h=1/Math.pow(this.scaleFactor,f):f<0&&(h=Math.pow(this.scaleFactor,-f)),this.cursorZoom&&this.enablePan){let A;this.camera instanceof Vt&&(A=(s=this.unprojectOnTbPlane(this.camera,r.clientX,r.clientY,this.domElement))==null?void 0:s.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position)),this.camera instanceof It&&(A=(o=this.unprojectOnTbPlane(this.camera,r.clientX,r.clientY,this.domElement))==null?void 0:o.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),A!==void 0&&this.applyTransformMatrix(this.applyScale(h,A))}else this.applyTransformMatrix(this.applyScale(h,this._gizmos.position));this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(Pe.IDLE,!1),this.dispatchEvent(At),this.dispatchEvent(Sn);break;case"FOV":if(this.camera instanceof It){this.updateTbState(Pe.FOV,!0),r.deltaX!=0&&(f=r.deltaX/u,h=1,f>0?h=1/Math.pow(this.scaleFactor,f):f<0&&(h=Math.pow(this.scaleFactor,-f))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const A=this._v3_1.distanceTo(this._gizmos.position);let y=A/h;y=De.clamp(y,this.minDistance,this.maxDistance);const x=A*Math.tan(De.DEG2RAD*this.camera.fov*.5);let d=De.RAD2DEG*(Math.atan(x/y)*2);d>this.maxFov?d=this.maxFov:d<this.minFov&&(d=this.minFov);const v=x/Math.tan(De.DEG2RAD*(d/2));h=A/v,this.setFov(d),this.applyTransformMatrix(this.applyScale(h,this._gizmos.position,!1))}this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(Pe.IDLE,!1),this.dispatchEvent(At),this.dispatchEvent(Sn);break}}}}),ee(this,"onSinglePanStart",(r,s)=>{if(this.enabled&&this.domElement)switch(this.dispatchEvent(Wn),this.setCenter(r.clientX,r.clientY),s){case"PAN":if(!this.enablePan)return;if(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(At)),this.camera){this.updateTbState(Pe.PAN,!0);const o=this.unprojectOnTbPlane(this.camera,Ge.x,Ge.y,this.domElement);o!==void 0&&this._startCursorPosition.copy(o),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(At))}break;case"ROTATE":if(!this.enableRotate)return;if(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.camera){this.updateTbState(Pe.ROTATE,!0);const o=this.unprojectOnTbSurface(this.camera,Ge.x,Ge.y,this.domElement,this._tbRadius);o!==void 0&&this._startCursorPosition.copy(o),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr)}this.dispatchEvent(At);break;case"FOV":if(!this.enableZoom)return;this.camera instanceof It&&(this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(At)),this.updateTbState(Pe.FOV,!0),this._startCursorPosition.setY(this.getCursorNDC(Ge.x,Ge.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition));break;case"ZOOM":if(!this.enableZoom)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(At)),this.updateTbState(Pe.SCALE,!0),this._startCursorPosition.setY(this.getCursorNDC(Ge.x,Ge.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition);break}}),ee(this,"onSinglePanMove",(r,s)=>{if(this.enabled&&this.domElement){const o=s!=this._state;switch(this.setCenter(r.clientX,r.clientY),s){case Pe.PAN:if(this.enablePan&&this.camera)if(o){this.dispatchEvent(Sn),this.dispatchEvent(Wn),this.updateTbState(s,!0);const a=this.unprojectOnTbPlane(this.camera,Ge.x,Ge.y,this.domElement);a!==void 0&&this._startCursorPosition.copy(a),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)}else{const a=this.unprojectOnTbPlane(this.camera,Ge.x,Ge.y,this.domElement);a!==void 0&&this._currentCursorPosition.copy(a),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))}break;case Pe.ROTATE:if(this.enableRotate&&this.camera)if(o){this.dispatchEvent(Sn),this.dispatchEvent(Wn),this.updateTbState(s,!0);const a=this.unprojectOnTbSurface(this.camera,Ge.x,Ge.y,this.domElement,this._tbRadius);a!==void 0&&this._startCursorPosition.copy(a),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0)}else{const a=this.unprojectOnTbSurface(this.camera,Ge.x,Ge.y,this.domElement,this._tbRadius);a!==void 0&&this._currentCursorPosition.copy(a);const c=this._startCursorPosition.distanceTo(this._currentCursorPosition),u=this._startCursorPosition.angleTo(this._currentCursorPosition),f=Math.max(c/this._tbRadius,u);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),f)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=f,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case Pe.SCALE:if(this.enableZoom)if(o)this.dispatchEvent(Sn),this.dispatchEvent(Wn),this.updateTbState(s,!0),this._startCursorPosition.setY(this.getCursorNDC(Ge.x,Ge.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(Ge.x,Ge.y,this.domElement).y*.5);const c=this._currentCursorPosition.y-this._startCursorPosition.y;let u=1;c<0?u=1/Math.pow(this.scaleFactor,-c*8):c>0&&(u=Math.pow(this.scaleFactor,c*8)),this.applyTransformMatrix(this.applyScale(u,this._gizmos.position))}break;case Pe.FOV:if(this.enableZoom&&this.camera instanceof It)if(o)this.dispatchEvent(Sn),this.dispatchEvent(Wn),this.updateTbState(s,!0),this._startCursorPosition.setY(this.getCursorNDC(Ge.x,Ge.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(Ge.x,Ge.y,this.domElement).y*.5);const c=this._currentCursorPosition.y-this._startCursorPosition.y;let u=1;c<0?u=1/Math.pow(this.scaleFactor,-c*8):c>0&&(u=Math.pow(this.scaleFactor,c*8)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const f=this._v3_1.distanceTo(this._gizmos.position);let h=f/u;h=De.clamp(h,this.minDistance,this.maxDistance);const A=f*Math.tan(De.DEG2RAD*this._fovState*.5);let y=De.RAD2DEG*(Math.atan(A/h)*2);y=De.clamp(y,this.minFov,this.maxFov);const x=A/Math.tan(De.DEG2RAD*(y/2));u=f/x,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(y),this.applyTransformMatrix(this.applyScale(u,this._v3_2,!1));const d=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(x/f);this._m4_1.makeTranslation(d.x,d.y,d.z)}break}this.dispatchEvent(At)}}),ee(this,"onSinglePanEnd",()=>{if(this._state==Pe.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations)if(performance.now()-this._timeCurrent<120){const s=Math.abs((this._wPrev+this._wCurr)/2),o=this;this._animationId=window.requestAnimationFrame(function(a){o.updateTbState(Pe.ANIMATION_ROTATE,!0);const c=o.calculateRotationAxis(o._cursorPosPrev,o._cursorPosCurr);o.onRotationAnim(a,c,Math.min(s,o.wMax))})}else this.updateTbState(Pe.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(At);else this.updateTbState(Pe.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(At)}else(this._state==Pe.PAN||this._state==Pe.IDLE)&&(this.updateTbState(Pe.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(At));this.dispatchEvent(Sn)}),ee(this,"onDoubleTap",r=>{if(this.enabled&&this.enablePan&&this.scene&&this.camera&&this.domElement){this.dispatchEvent(Wn),this.setCenter(r.clientX,r.clientY);const s=this.unprojectOnObj(this.getCursorNDC(Ge.x,Ge.y,this.domElement),this.camera);if(s&&this.enableAnimations){const o=this;this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(a){o.updateTbState(Pe.ANIMATION_FOCUS,!0),o.onFocusAnim(a,s,o._cameraMatrixState,o._gizmoMatrixState)})}else s&&!this.enableAnimations&&(this.updateTbState(Pe.FOCUS,!0),this.focus(s,this.scaleFactor),this.updateTbState(Pe.IDLE,!1),this.dispatchEvent(At))}this.dispatchEvent(Sn)}),ee(this,"onDoublePanStart",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.dispatchEvent(Wn),this.updateTbState(Pe.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const r=this.unprojectOnTbPlane(this.camera,Ge.x,Ge.y,this.domElement,!0);r!==void 0&&this._startCursorPosition.copy(r),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1)}}),ee(this,"onDoublePanMove",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=Pe.PAN&&(this.updateTbState(Pe.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition));const r=this.unprojectOnTbPlane(this.camera,Ge.x,Ge.y,this.domElement,!0);r!==void 0&&this._currentCursorPosition.copy(r),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(At)}}),ee(this,"onDoublePanEnd",()=>{this.updateTbState(Pe.IDLE,!1),this.dispatchEvent(Sn)}),ee(this,"onRotateStart",()=>{var r;this.enabled&&this.enableRotate&&(this.dispatchEvent(Wn),this.updateTbState(Pe.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,(r=this.camera)==null||r.getWorldDirection(this._rotationAxis),!this.enablePan&&!this.enableZoom&&this.activateGizmos(!0))}),ee(this,"onRotateMove",()=>{var r;if(this.enabled&&this.enableRotate&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let s;this._state!=Pe.ZROTATE&&(this.updateTbState(Pe.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?this.camera&&(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),s=(r=this.unprojectOnTbPlane(this.camera,Ge.x,Ge.y,this.domElement))==null?void 0:r.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):s=new T().setFromMatrixPosition(this._gizmoMatrixState);const o=De.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);s!==void 0&&this.applyTransformMatrix(this.zRotate(s,o)),this.dispatchEvent(At)}}),ee(this,"onRotateEnd",()=>{this.updateTbState(Pe.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Sn)}),ee(this,"onPinchStart",()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(Wn),this.updateTbState(Pe.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}),ee(this,"onPinchMove",()=>{var r,s;if(this.enabled&&this.enableZoom&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const o=12;this._state!=Pe.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(Pe.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),o*this._devPxRatio);const a=this._currentFingerDistance/this._startFingerDistance;let c;this.enablePan?this.camera instanceof Vt?c=(r=this.unprojectOnTbPlane(this.camera,Ge.x,Ge.y,this.domElement))==null?void 0:r.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera instanceof It&&(c=(s=this.unprojectOnTbPlane(this.camera,Ge.x,Ge.y,this.domElement))==null?void 0:s.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):c=this._gizmos.position,c!==void 0&&this.applyTransformMatrix(this.applyScale(a,c)),this.dispatchEvent(At)}}),ee(this,"onPinchEnd",()=>{this.updateTbState(Pe.IDLE,!1),this.dispatchEvent(Sn)}),ee(this,"onTriplePanStart",()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.dispatchEvent(Wn),this.updateTbState(Pe.SCALE,!0);let r=0,s=0;const o=this._touchCurrent.length;for(let a=0;a<o;a++)r+=this._touchCurrent[a].clientX,s+=this._touchCurrent[a].clientY;this.setCenter(r/o,s/o),this._startCursorPosition.setY(this.getCursorNDC(Ge.x,Ge.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition)}}),ee(this,"onTriplePanMove",()=>{if(this.enabled&&this.enableZoom&&this.camera&&this.domElement){let r=0,s=0;const o=this._touchCurrent.length;for(let v=0;v<o;v++)r+=this._touchCurrent[v].clientX,s+=this._touchCurrent[v].clientY;this.setCenter(r/o,s/o);const a=8;this._currentCursorPosition.setY(this.getCursorNDC(Ge.x,Ge.y,this.domElement).y*.5);const c=this._currentCursorPosition.y-this._startCursorPosition.y;let u=1;c<0?u=1/Math.pow(this.scaleFactor,-c*a):c>0&&(u=Math.pow(this.scaleFactor,c*a)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const f=this._v3_1.distanceTo(this._gizmos.position);let h=f/u;h=De.clamp(h,this.minDistance,this.maxDistance);const A=f*Math.tan(De.DEG2RAD*this._fovState*.5);let y=De.RAD2DEG*(Math.atan(A/h)*2);y=De.clamp(y,this.minFov,this.maxFov);const x=A/Math.tan(De.DEG2RAD*(y/2));u=f/x,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(y),this.applyTransformMatrix(this.applyScale(u,this._v3_2,!1));const d=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(x/f);this._m4_1.makeTranslation(d.x,d.y,d.z),this.dispatchEvent(At)}}),ee(this,"onTriplePanEnd",()=>{this.updateTbState(Pe.IDLE,!1),this.dispatchEvent(Sn)}),ee(this,"setCenter",(r,s)=>{Ge.x=r,Ge.y=s}),ee(this,"initializeMouseActions",()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}),ee(this,"setMouseAction",(r,s,o=null)=>{const a=["PAN","ROTATE","ZOOM","FOV"],c=[0,1,2,"WHEEL"],u=["CTRL","SHIFT",null];let f;if(!a.includes(r)||!c.includes(s)||!u.includes(o)||s=="WHEEL"&&r!="ZOOM"&&r!="FOV")return!1;switch(r){case"PAN":f=Pe.PAN;break;case"ROTATE":f=Pe.ROTATE;break;case"ZOOM":f=Pe.SCALE;break;case"FOV":f=Pe.FOV;break}const h={operation:r,mouse:s,key:o,state:f};for(let A=0;A<this.mouseActions.length;A++)if(this.mouseActions[A].mouse==h.mouse&&this.mouseActions[A].key==h.key)return this.mouseActions.splice(A,1,h),!0;return this.mouseActions.push(h),!0}),ee(this,"getOpFromAction",(r,s)=>{let o;for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==s)return o.operation;if(s){for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==null)return o.operation}return null}),ee(this,"getOpStateFromAction",(r,s)=>{let o;for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==s)return o.state;if(s){for(let a=0;a<this.mouseActions.length;a++)if(o=this.mouseActions[a],o.mouse==r&&o.key==null)return o.state}return null}),ee(this,"getAngle",(r,s)=>Math.atan2(s.clientY-r.clientY,s.clientX-r.clientX)*180/Math.PI),ee(this,"updateTouchEvent",r=>{for(let s=0;s<this._touchCurrent.length;s++)if(this._touchCurrent[s].pointerId==r.pointerId){this._touchCurrent.splice(s,1,r);break}}),ee(this,"calculateAngularSpeed",(r,s,o,a)=>{const c=s-r,u=(a-o)/1e3;return u==0?0:c/u}),ee(this,"calculatePointersDistance",(r,s)=>Math.sqrt(Math.pow(s.clientX-r.clientX,2)+Math.pow(s.clientY-r.clientY,2))),ee(this,"calculateRotationAxis",(r,s)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(r,s).applyQuaternion(this._quat),this._rotationAxis.normalize().clone())),ee(this,"calculateTbRadius",r=>{const o=r.position.distanceTo(this._gizmos.position);if(r instanceof It){const a=De.DEG2RAD*r.fov*.5,c=Math.atan(r.aspect*Math.tan(a));return Math.tan(Math.min(a,c))*o*.67}else if(r instanceof Vt)return Math.min(r.top,r.right)*.67}),ee(this,"focus",(r,s,o=1)=>{if(this.camera){const a=r.clone();a.sub(this._gizmos.position).multiplyScalar(o),this._translationMatrix.makeTranslation(a.x,a.y,a.z);const c=this._gizmoMatrixState.clone();this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);const u=this._cameraMatrixState.clone();this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.applyScale(s,this._gizmos.position)),this._gizmoMatrixState.copy(c),this._cameraMatrixState.copy(u)}}),ee(this,"drawGrid",()=>{if(this.scene){let o,a,c,u;if(this.camera instanceof Vt){const f=this.camera.right-this.camera.left,h=this.camera.bottom-this.camera.top;c=Math.max(f,h),u=c/20,o=c/this.camera.zoom*3,a=o/u*this.camera.zoom}else if(this.camera instanceof It){const f=this.camera.position.distanceTo(this._gizmos.position),h=De.DEG2RAD*this.camera.fov*.5,A=Math.atan(this.camera.aspect*Math.tan(h));c=Math.tan(Math.max(h,A))*f*2,u=c/20,o=c*3,a=o/u}this._grid==null&&this.camera&&(this._grid=new Zm(o,a,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(Math.PI*.5),this.scene.add(this._grid))}}),ee(this,"connect",r=>{r===document&&console.error('THREE.ArcballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=r,this.domElement.style.touchAction="none",this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onWheel)}),ee(this,"dispose",()=>{var r,s,o,a,c;this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),(r=this.domElement)==null||r.removeEventListener("pointerdown",this.onPointerDown),(s=this.domElement)==null||s.removeEventListener("pointercancel",this.onPointerCancel),(o=this.domElement)==null||o.removeEventListener("wheel",this.onWheel),(a=this.domElement)==null||a.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),(c=this.scene)==null||c.remove(this._gizmos),this.disposeGrid()}),ee(this,"disposeGrid",()=>{this._grid&&this.scene&&(this.scene.remove(this._grid),this._grid=null)}),ee(this,"easeOutCubic",r=>1-Math.pow(1-r,3)),ee(this,"activateGizmos",r=>{for(const s of this._gizmos.children)s.material.setValues({opacity:r?1:.6})}),ee(this,"getCursorNDC",(r,s,o)=>{const a=o.getBoundingClientRect();return this._v2_1.setX((r-a.left)/a.width*2-1),this._v2_1.setY((a.bottom-s)/a.height*2-1),this._v2_1.clone()}),ee(this,"getCursorPosition",(r,s,o)=>(this._v2_1.copy(this.getCursorNDC(r,s,o)),this.camera instanceof Vt&&(this._v2_1.x*=(this.camera.right-this.camera.left)*.5,this._v2_1.y*=(this.camera.top-this.camera.bottom)*.5),this._v2_1.clone())),ee(this,"setCamera",r=>{if(r){r.lookAt(this.target),r.updateMatrix(),r instanceof It&&(this._fov0=r.fov,this._fovState=r.fov),this._cameraMatrixState0.copy(r.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(r.projectionMatrix),this._zoom0=r.zoom,this._zoomState=this._zoom0,this._initialNear=r.near,this._nearPos0=r.position.distanceTo(this.target)-r.near,this._nearPos=this._initialNear,this._initialFar=r.far,this._farPos0=r.position.distanceTo(this.target)-r.far,this._farPos=this._initialFar,this._up0.copy(r.up),this._upState.copy(r.up),this.camera=r,this.camera.updateProjectionMatrix();const s=this.calculateTbRadius(r);s!==void 0&&(this._tbRadius=s),this.makeGizmos(this.target,this._tbRadius)}}),ee(this,"makeGizmos",(r,s)=>{const a=new Cc(0,0,s,s).getPoints(this._curvePts),c=new tn().setFromPoints(a),u=new uo({color:16744576,fog:!1,transparent:!0,opacity:.6}),f=new uo({color:8454016,fog:!1,transparent:!0,opacity:.6}),h=new uo({color:8421631,fog:!1,transparent:!0,opacity:.6}),A=new Xe(c,u),y=new Xe(c,f),x=new Xe(c,h),d=Math.PI*.5;if(A.rotation.x=d,y.rotation.y=d,this._gizmoMatrixState0.identity().setPosition(r),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera&&this.camera.zoom!=1){const v=1/this.camera.zoom;this._scaleMatrix.makeScale(v,v,v),this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(r.x,r.y,r.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(A),this._gizmos.add(y),this._gizmos.add(x)}),ee(this,"onFocusAnim",(r,s,o,a)=>{if(this._timeStart==-1&&(this._timeStart=r),this._state==Pe.ANIMATION_FOCUS){const u=(r-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(a),u>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(s,this.scaleFactor),this._timeStart=-1,this.updateTbState(Pe.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(At);else{const f=this.easeOutCubic(u),h=1-f+this.scaleFactor*f;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(s,h,f),this.dispatchEvent(At);const A=this;this._animationId=window.requestAnimationFrame(function(y){A.onFocusAnim(y,s,o,a.clone())})}}else this._animationId=-1,this._timeStart=-1}),ee(this,"onRotationAnim",(r,s,o)=>{if(this._timeStart==-1&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=r),this._state==Pe.ANIMATION_ROTATE){const a=(r-this._timeStart)/1e3;if(o+-this.dampingFactor*a>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(a,2)+o*a+0,this.applyTransformMatrix(this.rotate(s,this._angleCurrent)),this.dispatchEvent(At);const u=this;this._animationId=window.requestAnimationFrame(function(f){u.onRotationAnim(f,s,o)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(Pe.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(At)}else this._animationId=-1,this._timeStart=-1,this._state!=Pe.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(At))}),ee(this,"pan",(r,s,o=!1)=>{if(this.camera){const a=r.clone().sub(s);if(this.camera instanceof Vt&&a.multiplyScalar(1/this.camera.zoom),this.camera instanceof It&&o){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const c=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);a.multiplyScalar(1/c)}this._v3_1.set(a.x,a.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1)}return xn}),ee(this,"reset",()=>{if(this.camera){this.camera.zoom=this._zoom0,this.camera instanceof It&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix();const r=this.calculateTbRadius(this.camera);r!==void 0&&(this._tbRadius=r),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(Pe.IDLE,!1),this.dispatchEvent(At)}}),ee(this,"rotate",(r,s)=>{const o=this._gizmos.position;return this._translationMatrix.makeTranslation(-o.x,-o.y,-o.z),this._rotationMatrix.makeRotationAxis(r,-s),this._m4_1.makeTranslation(o.x,o.y,o.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),xn}),ee(this,"copyState",()=>{if(this.camera){const r=JSON.stringify(this.camera instanceof Vt?{arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}:{arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}});navigator.clipboard.writeText(r)}}),ee(this,"pasteState",()=>{const r=this;navigator.clipboard.readText().then(function(o){r.setStateFromJSON(o)})}),ee(this,"saveState",()=>{this.camera&&(this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera instanceof It&&(this._fov0=this.camera.fov))}),ee(this,"applyScale",(r,s,o=!0)=>{if(!this.camera)return;const a=s.clone();let c=1/r;if(this.camera instanceof Vt){this.camera.zoom=this._zoomState,this.camera.zoom*=r,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,c=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,c=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(c,c,c),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),a.sub(this._v3_1);const u=a.clone().multiplyScalar(c);return a.sub(u),this._m4_1.makeTranslation(a.x,a.y,a.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),xn}if(this.camera instanceof It){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let u=this._v3_1.distanceTo(a),f=u-u*c;const h=u-f;h<this.minDistance?(c=this.minDistance/u,f=u-u*c):h>this.maxDistance&&(c=this.maxDistance/u,f=u-u*c);let A=a.clone().sub(this._v3_1).normalize().multiplyScalar(f);if(this._m4_1.makeTranslation(A.x,A.y,A.z),o){const y=this._v3_2;u=y.distanceTo(a),f=u-u*c,A=a.clone().sub(this._v3_2).normalize().multiplyScalar(f),this._translationMatrix.makeTranslation(y.x,y.y,y.z),this._scaleMatrix.makeScale(c,c,c),this._m4_2.makeTranslation(A.x,A.y,A.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-y.x,-y.y,-y.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return xn}}),ee(this,"setFov",r=>{this.camera instanceof It&&(this.camera.fov=De.clamp(r,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}),ee(this,"setTarget",(r,s,o)=>{if(this.camera){this.target.set(r,s,o),this._gizmos.position.set(r,s,o);const a=this.calculateTbRadius(this.camera);a!==void 0&&(this._tbRadius=a),this.makeGizmos(this.target,this._tbRadius),this.camera.lookAt(this.target)}}),ee(this,"zRotate",(r,s)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,s),this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._m4_1.makeTranslation(r.x,r.y,r.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(r),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,s),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),xn)),ee(this,"unprojectOnObj",(r,s)=>{if(!this.scene)return null;const o=new nc;o.near=s.near,o.far=s.far,o.setFromCamera(r,s);const a=o.intersectObjects(this.scene.children,!0);for(let c=0;c<a.length;c++)if(a[c].object.uuid!=this._gizmos.uuid&&a[c].face)return a[c].point.clone();return null}),ee(this,"unprojectOnTbSurface",(r,s,o,a,c)=>{if(r instanceof Vt){this._v2_1.copy(this.getCursorPosition(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const u=Math.pow(this._v2_1.x,2),f=Math.pow(this._v2_1.y,2),h=Math.pow(this._tbRadius,2);return u+f<=h*.5?this._v3_1.setZ(Math.sqrt(h-(u+f))):this._v3_1.setZ(h*.5/Math.sqrt(u+f)),this._v3_1}if(r instanceof It){this._v2_1.copy(this.getCursorNDC(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(r.projectionMatrixInverse);const u=this._v3_1.clone().normalize(),f=r.position.distanceTo(this._gizmos.position),h=Math.pow(c,2),A=this._v3_1.z,y=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(y==0)return u.set(this._v3_1.x,this._v3_1.y,c),u;const x=A/y,d=f;let v=Math.pow(x,2)+1,g=2*x*d,p=Math.pow(d,2)-h,m=Math.pow(g,2)-4*v*p;if(m>=0&&(this._v2_1.setX((-g-Math.sqrt(m))/(2*v)),this._v2_1.setY(x*this._v2_1.x+d),De.RAD2DEG*this._v2_1.angle()>=45)){const _=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(f-this._v2_1.y,2));return u.multiplyScalar(_),u.z+=f,u}v=x,g=d,p=-h*.5,m=Math.pow(g,2)-4*v*p,this._v2_1.setX((-g-Math.sqrt(m))/(2*v)),this._v2_1.setY(x*this._v2_1.x+d);const E=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(f-this._v2_1.y,2));return u.multiplyScalar(E),u.z+=f,u}}),ee(this,"unprojectOnTbPlane",(r,s,o,a,c=!1)=>{if(r instanceof Vt)return this._v2_1.copy(this.getCursorPosition(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(r instanceof It){this._v2_1.copy(this.getCursorNDC(s,o,a)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(r.projectionMatrixInverse);const u=this._v3_1.clone().normalize(),f=this._v3_1.z,h=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let A;if(c?A=this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):A=r.position.distanceTo(this._gizmos.position),h==0)return u.set(0,0,0),u;const y=f/h,x=A,d=-x/y,v=Math.sqrt(Math.pow(x,2)+Math.pow(d,2));return u.multiplyScalar(v),u.z=0,u}}),ee(this,"updateMatrixState",()=>{this.camera&&(this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera instanceof Vt&&(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom),this.camera instanceof It&&(this._fovState=this.camera.fov))}),ee(this,"updateTbState",(r,s)=>{this._state=r,s&&this.updateMatrixState()}),ee(this,"update",()=>{if(!this.target.equals(this._currentTarget)&&this.camera){this._gizmos.position.set(this.target.x,this.target.y,this.target.z);const s=this.calculateTbRadius(this.camera);s!==void 0&&(this._tbRadius=s),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)}if(this.camera){if(this.camera instanceof Vt&&(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom)){const s=De.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.applyScale(s/this.camera.zoom,this._gizmos.position,!0))}if(this.camera instanceof It){const s=this.camera.position.distanceTo(this._gizmos.position);if(s>this.maxDistance+1e-6||s<this.minDistance-1e-6){const c=De.clamp(s,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.applyScale(c/s,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=De.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());const o=this._tbRadius,a=this.calculateTbRadius(this.camera);if(a!==void 0&&(this._tbRadius=a),o<this._tbRadius-1e-6||o>this._tbRadius+1e-6){const c=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,u=this._tbRadius/c,h=new Cc(0,0,u,u).getPoints(this._curvePts),A=new tn().setFromPoints(h);for(const y in this._gizmos.children){const x=this._gizmos.children[y];x.geometry=A}}}this.camera.lookAt(this._gizmos.position)}}),ee(this,"setStateFromJSON",r=>{const s=JSON.parse(r);if(s.arcballState&&this.camera){this._cameraMatrixState.fromArray(s.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(s.arcballState.cameraUp),this.camera.near=s.arcballState.cameraNear,this.camera.far=s.arcballState.cameraFar,this.camera.zoom=s.arcballState.cameraZoom,this.camera instanceof It&&(this.camera.fov=s.arcballState.cameraFov),this._gizmoMatrixState.fromArray(s.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix();const o=this.calculateTbRadius(this.camera);o!==void 0&&(this._tbRadius=o);const a=new ue().copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(a),this.camera.lookAt(this._gizmos.position),this.updateTbState(Pe.IDLE,!1),this.dispatchEvent(At)}}),this.camera=null,this.domElement=t,this.scene=i,this.mouseActions=[],this._mouseOp=null,this._v2_1=new _e,this._v3_1=new T,this._v3_2=new T,this._m4_1=new ue,this._m4_2=new ue,this._quat=new Fe,this._translationMatrix=new ue,this._rotationMatrix=new ue,this._scaleMatrix=new ue,this._rotationAxis=new T,this._cameraMatrixState=new ue,this._cameraProjectionState=new ue,this._fovState=1,this._upState=new T,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new ue,this._up0=new T,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new ue,this._gizmoMatrixState0=new ue,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=tt.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new T,this._startCursorPosition=new T,this._grid=null,this._gridPosition=new T,this._gizmos=new Eo,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new T,this._cursorPosCurr=new T,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.target=new T(0,0,0),this._currentTarget=new T(0,0,0),this._tbRadius=1,this._state=Pe.IDLE,this.setCamera(e),this.scene&&this.scene.add(this._gizmos),this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement&&this.connect(this.domElement),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if(e!=null&&e.camera&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),(this._state==Pe.ROTATE||this._state==Pe.ZROTATE||this._state==Pe.ANIMATION_ROTATE)&&this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),e!=null&&e.gizmos&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==Pe.SCALE||this._state==Pe.FOCUS||this._state==Pe.ANIMATION_FOCUS)&&this.camera){const t=this.calculateTbRadius(this.camera);if(t!==void 0&&(this._tbRadius=t),this.adjustNearFar){const i=this.camera.position.distanceTo(this._gizmos.position),r=new Et;r.setFromObject(this._gizmos);const s=new Nn;r.getBoundingSphere(s);const o=Math.max(this._nearPos0,s.radius+s.center.length()),a=i-this._initialNear,c=Math.min(o,a);this.camera.near=i-c;const u=Math.min(this._farPos0,-s.radius+s.center.length()),f=i-this._initialFar,h=Math.min(u,f);this.camera.far=i-h,this.camera.updateProjectionMatrix()}else{let i=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,i=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,i=!0),i&&this.camera.updateProjectionMatrix()}}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(At)}setTransformationMatrices(e=null,t=null){e?xn.camera?xn.camera.copy(e):xn.camera=e.clone():xn.camera=null,t?xn.gizmos?xn.gizmos.copy(t):xn.gizmos=t.clone():xn.gizmos=null}};var E4=Object.defineProperty,w4=(n,e,t)=>e in n?E4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,rt=(n,e,t)=>(w4(n,typeof e!="symbol"?e+"":e,t),t);function Uh(n){n.preventDefault()}let _4=class extends dr{constructor(e,t){super(),rt(this,"object"),rt(this,"domElement",null),rt(this,"movementSpeed",1),rt(this,"rollSpeed",.005),rt(this,"dragToLook",!1),rt(this,"autoForward",!1),rt(this,"changeEvent",{type:"change"}),rt(this,"EPS",1e-6),rt(this,"tmpQuaternion",new Fe),rt(this,"mouseStatus",0),rt(this,"movementSpeedMultiplier",1),rt(this,"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),rt(this,"moveVector",new T(0,0,0)),rt(this,"rotationVector",new T(0,0,0)),rt(this,"keydown",i=>{if(!i.altKey){switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}}),rt(this,"keyup",i=>{switch(i.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()}),rt(this,"pointerdown",i=>{if(this.dragToLook)this.mouseStatus++;else{switch(i.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}}),rt(this,"pointermove",i=>{if(!this.dragToLook||this.mouseStatus>0){const r=this.getContainerDimensions(),s=r.size[0]/2,o=r.size[1]/2;this.moveState.yawLeft=-(i.pageX-r.offset[0]-s)/s,this.moveState.pitchDown=(i.pageY-r.offset[1]-o)/o,this.updateRotationVector()}}),rt(this,"pointerup",i=>{if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(i.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()}),rt(this,"lastQuaternion",new Fe),rt(this,"lastPosition",new T),rt(this,"update",i=>{const r=i*this.movementSpeed,s=i*this.rollSpeed;this.object.translateX(this.moveVector.x*r),this.object.translateY(this.moveVector.y*r),this.object.translateZ(this.moveVector.z*r),this.tmpQuaternion.set(this.rotationVector.x*s,this.rotationVector.y*s,this.rotationVector.z*s,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastQuaternion.copy(this.object.quaternion),this.lastPosition.copy(this.object.position))}),rt(this,"updateMovementVector",()=>{const i=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-i+this.moveState.back}),rt(this,"updateRotationVector",()=>{this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft}),rt(this,"getContainerDimensions",()=>this.domElement!=document&&!(this.domElement instanceof Document)?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}),rt(this,"connect",i=>{this.domElement=i,i instanceof Document||i.setAttribute("tabindex",-1),this.domElement.addEventListener("contextmenu",Uh),this.domElement.addEventListener("pointermove",this.pointermove),this.domElement.addEventListener("pointerdown",this.pointerdown),this.domElement.addEventListener("pointerup",this.pointerup),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}),rt(this,"dispose",()=>{this.domElement.removeEventListener("contextmenu",Uh),this.domElement.removeEventListener("pointermove",this.pointermove),this.domElement.removeEventListener("pointerdown",this.pointerdown),this.domElement.removeEventListener("pointerup",this.pointerup),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup)}),this.object=e,t!==void 0&&this.connect(t),this.updateMovementVector(),this.updateRotationVector()}};var C4=Object.defineProperty,I4=(n,e,t)=>e in n?C4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Wo=(n,e,t)=>(I4(n,typeof e!="symbol"?e+"":e,t),t);class mu extends ic{constructor(e,t="tDiffuse"){super(),Wo(this,"textureID"),Wo(this,"uniforms"),Wo(this,"material"),Wo(this,"fsQuad"),this.textureID=t,e instanceof jt?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=ka.clone(e.uniforms),this.material=new jt({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Gi(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}const Nh={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	gl_FragColor = opacity * texel;","}"].join(`
`)};var B4=Object.defineProperty,b4=(n,e,t)=>e in n?B4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Uc=(n,e,t)=>(b4(n,typeof e!="symbol"?e+"":e,t),t);class Gh extends ic{constructor(e,t){super(),Uc(this,"scene"),Uc(this,"camera"),Uc(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const r=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),s.buffers.stencil.setFunc(r.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(r.EQUAL,1,4294967295),s.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),s.buffers.stencil.setLocked(!0)}}class S4 extends ic{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}var M4=Object.defineProperty,T4=(n,e,t)=>e in n?M4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Mn=(n,e,t)=>(T4(n,typeof e!="symbol"?e+"":e,t),t);class P4{constructor(e,t){if(Mn(this,"renderer"),Mn(this,"_pixelRatio"),Mn(this,"_width"),Mn(this,"_height"),Mn(this,"renderTarget1"),Mn(this,"renderTarget2"),Mn(this,"writeBuffer"),Mn(this,"readBuffer"),Mn(this,"renderToScreen"),Mn(this,"passes",[]),Mn(this,"copyPass"),Mn(this,"clock"),this.renderer=e,t===void 0){const i={minFilter:lt,magFilter:lt,format:Lt},r=e.getSize(new _e);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,t=new Tt(this._width*this._pixelRatio,this._height*this._pixelRatio,i),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,Nh===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),mu===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new mu(Nh),this.copyPass.material.blending=Mu,this.clock=new $m}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;const r=this.passes.length;for(let s=0;s<r;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}Gh!==void 0&&(o instanceof Gh?i=!0:o instanceof S4&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new _e);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(i,r),this.renderTarget2.setSize(i,r);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(i,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}var D4=Object.defineProperty,Q4=(n,e,t)=>e in n?D4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,sr=(n,e,t)=>(Q4(n,typeof e!="symbol"?e+"":e,t),t);class R4 extends ic{constructor(e,t,i,r,s=0){super(),sr(this,"scene"),sr(this,"camera"),sr(this,"overrideMaterial"),sr(this,"clearColor"),sr(this,"clearAlpha"),sr(this,"clearDepth",!1),sr(this,"_oldClearColor",new ze),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=s,this.clear=!0,this.needsSwap=!1}render(e,t,i){let r=e.autoClear;e.autoClear=!1;let s,o=null;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),s=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,s),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=r}}class z4 extends tn{constructor(e,t,i,r){super();const s=[],o=[],a=[],c=new T,u=new ue;u.makeRotationFromEuler(i),u.setPosition(t);const f=new ue;f.copy(u).invert(),h(),this.setAttribute("position",new Yt(s,3)),this.setAttribute("normal",new Yt(o,3)),this.setAttribute("uv",new Yt(a,2));function h(){let d,v=[];const g=new T,p=new T;if(e.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const m=e.geometry,E=m.attributes.position,w=m.attributes.normal;if(m.index!==null){const _=m.index;for(d=0;d<_.count;d++)g.fromBufferAttribute(E,_.getX(d)),p.fromBufferAttribute(w,_.getX(d)),A(v,g,p)}else for(d=0;d<E.count;d++)g.fromBufferAttribute(E,d),p.fromBufferAttribute(w,d),A(v,g,p);for(v=y(v,c.set(1,0,0)),v=y(v,c.set(-1,0,0)),v=y(v,c.set(0,1,0)),v=y(v,c.set(0,-1,0)),v=y(v,c.set(0,0,1)),v=y(v,c.set(0,0,-1)),d=0;d<v.length;d++){const _=v[d];a.push(.5+_.position.x/r.x,.5+_.position.y/r.y),_.position.applyMatrix4(u),s.push(_.position.x,_.position.y,_.position.z),o.push(_.normal.x,_.normal.y,_.normal.z)}}function A(d,v,g){v.applyMatrix4(e.matrixWorld),v.applyMatrix4(f),g.transformDirection(e.matrixWorld),d.push(new Hh(v.clone(),g.clone()))}function y(d,v){const g=[],p=.5*Math.abs(r.dot(v));for(let m=0;m<d.length;m+=3){let E,w,_,C=0,I,b,B,Q;const S=d[m+0].position.dot(v)-p,k=d[m+1].position.dot(v)-p,L=d[m+2].position.dot(v)-p;switch(E=S>0,w=k>0,_=L>0,C=(E?1:0)+(w?1:0)+(_?1:0),C){case 0:{g.push(d[m]),g.push(d[m+1]),g.push(d[m+2]);break}case 1:{if(E&&(I=d[m+1],b=d[m+2],B=x(d[m],I,v,p),Q=x(d[m],b,v,p)),w){I=d[m],b=d[m+2],B=x(d[m+1],I,v,p),Q=x(d[m+1],b,v,p),g.push(B),g.push(b.clone()),g.push(I.clone()),g.push(b.clone()),g.push(B.clone()),g.push(Q);break}_&&(I=d[m],b=d[m+1],B=x(d[m+2],I,v,p),Q=x(d[m+2],b,v,p)),g.push(I.clone()),g.push(b.clone()),g.push(B),g.push(Q),g.push(B.clone()),g.push(b.clone());break}case 2:{E||(I=d[m].clone(),b=x(I,d[m+1],v,p),B=x(I,d[m+2],v,p),g.push(I),g.push(b),g.push(B)),w||(I=d[m+1].clone(),b=x(I,d[m+2],v,p),B=x(I,d[m],v,p),g.push(I),g.push(b),g.push(B)),_||(I=d[m+2].clone(),b=x(I,d[m],v,p),B=x(I,d[m+1],v,p),g.push(I),g.push(b),g.push(B));break}}}return g}function x(d,v,g,p){const m=d.position.dot(g)-p,E=v.position.dot(g)-p,w=m/(m-E);return new Hh(new T(d.position.x+w*(v.position.x-d.position.x),d.position.y+w*(v.position.y-d.position.y),d.position.z+w*(v.position.z-d.position.z)),new T(d.normal.x+w*(v.normal.x-d.normal.x),d.normal.y+w*(v.normal.y-d.normal.y),d.normal.z+w*(v.normal.z-d.normal.z)))}}}class Hh{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}class F4 extends Jm{constructor(e,t={}){const{bevelEnabled:i=!1,bevelSize:r=8,bevelThickness:s=10,font:o,height:a=50,size:c=100,lineHeight:u=1,letterSpacing:f=0,...h}=t;if(o===void 0)super();else{const A=o.generateShapes(e,c,{lineHeight:u,letterSpacing:f});super(A,{...h,bevelEnabled:i,bevelSize:r,bevelThickness:s,depth:a})}this.type="TextGeometry"}}const L4={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","	vec4 tex = texture2D( tDiffuse, vUv );","	gl_FragColor = LinearTosRGB( tex );","}"].join(`
`)},k4={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},O4={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `},Nc=new jf,Gc=new T,Cr=new T,Xn=new T,Ci=new T,ri=new T,Ii=new T,Bi=new T,Ts=new T,Ps=new T,Ds=new T,Xo=new T,Qs=new T,Rs=new T,zs=new T;class U4{constructor(e,t,i){this.camera=e,this.scene=t,this.startPoint=new T,this.endPoint=new T,this.collection=[],this.deep=i||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(Nc,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){Cr.copy(e),Cr.x=Math.min(e.x,t.x),Cr.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),Xn.setFromMatrixPosition(this.camera.matrixWorld),Ci.copy(Cr),ri.set(t.x,Cr.y,0),Ii.copy(t),Bi.set(Cr.x,t.y,0),Ci.unproject(this.camera),ri.unproject(this.camera),Ii.unproject(this.camera),Bi.unproject(this.camera),Qs.copy(Ci).sub(Xn),Rs.copy(ri).sub(Xn),zs.copy(Ii).sub(Xn),Qs.normalize(),Rs.normalize(),zs.normalize(),Qs.multiplyScalar(this.deep),Rs.multiplyScalar(this.deep),zs.multiplyScalar(this.deep),Qs.add(Xn),Rs.add(Xn),zs.add(Xn);var i=Nc.planes;i[0].setFromCoplanarPoints(Xn,Ci,ri),i[1].setFromCoplanarPoints(Xn,ri,Ii),i[2].setFromCoplanarPoints(Ii,Bi,Xn),i[3].setFromCoplanarPoints(Bi,Ci,Xn),i[4].setFromCoplanarPoints(ri,Ii,Bi),i[5].setFromCoplanarPoints(zs,Rs,Qs),i[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const r=Math.min(e.x,t.x),s=Math.max(e.y,t.y),o=Math.max(e.x,t.x),a=Math.min(e.y,t.y);Ci.set(r,s,-1),ri.set(o,s,-1),Ii.set(o,a,-1),Bi.set(r,a,-1),Ts.set(r,s,1),Ps.set(o,s,1),Ds.set(o,a,1),Xo.set(r,a,1),Ci.unproject(this.camera),ri.unproject(this.camera),Ii.unproject(this.camera),Bi.unproject(this.camera),Ts.unproject(this.camera),Ps.unproject(this.camera),Ds.unproject(this.camera),Xo.unproject(this.camera);var i=Nc.planes;i[0].setFromCoplanarPoints(Ci,Ts,Ps),i[1].setFromCoplanarPoints(ri,Ps,Ds),i[2].setFromCoplanarPoints(Ds,Xo,Bi),i[3].setFromCoplanarPoints(Xo,Ts,Ci),i[4].setFromCoplanarPoints(ri,Ii,Bi),i[5].setFromCoplanarPoints(Ds,Ps,Ts),i[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&t.material!==void 0&&(t.geometry.boundingSphere===null&&t.geometry.computeBoundingSphere(),Gc.copy(t.geometry.boundingSphere.center),Gc.applyMatrix4(t.matrixWorld),e.containsPoint(Gc)&&this.collection.push(t)),t.children.length>0)for(let i=0;i<t.children.length;i++)this.searchChildInFrustum(e,t.children[i])}}class N4{constructor(e,t=" .:-=+*#%@",i={}){const r=i.resolution||.15,s=i.scale||1,o=i.color||!1,a=i.alpha||!1,c=i.block||!1,u=i.invert||!1,f=i.strResolution||"low";let h,A;const y=document.createElement("div");y.style.cursor="default";const x=document.createElement("table");y.appendChild(x);let d,v,g;this.setSize=function(L,O){h=L,A=O,e.setSize(L,O),p()},this.render=function(L,O){e.render(L,O),k(x)},this.domElement=y;function p(){d=Math.floor(h*r),v=Math.floor(A*r),C.width=d,C.height=v,g=e.domElement,g.style.backgroundColor&&(x.rows[0].cells[0].style.backgroundColor=g.style.backgroundColor,x.rows[0].cells[0].style.color=g.style.color),x.cellSpacing=0,x.cellPadding=0;const L=x.style;L.whiteSpace="pre",L.margin="0px",L.padding="0px",L.letterSpacing=S+"px",L.fontFamily=w,L.fontSize=B+"px",L.lineHeight=Q+"px",L.textAlign="left",L.textDecoration="none"}const m=" .,:;i1tfLCG08@".split(""),E=" CGO08@".split(""),w="courier new, monospace",_=e.domElement,C=document.createElement("canvas");if(!C.getContext)return;const I=C.getContext("2d");if(!I.getImageData)return;let b=o?E:m;t&&(b=t);const B=2/r*s,Q=2/r*s;let S=0;if(f=="low")switch(s){case 1:S=-1;break;case 2:case 3:S=-2.1;break;case 4:S=-3.1;break;case 5:S=-4.15;break}if(f=="medium")switch(s){case 1:S=0;break;case 2:S=-1;break;case 3:S=-1.04;break;case 4:case 5:S=-2.1;break}if(f=="high")switch(s){case 1:case 2:S=0;break;case 3:case 4:case 5:S=-1;break}function k(L){I.clearRect(0,0,d,v),I.drawImage(_,0,0,d,v);const O=I.getImageData(0,0,d,v).data;let G="";for(let V=0;V<v;V+=2){for(let N=0;N<d;N++){const j=(V*d+N)*4,Y=O[j],H=O[j+1],X=O[j+2],W=O[j+3];let P,z;z=(.3*Y+.59*H+.11*X)/255,W==0&&(z=1),P=Math.floor((1-z)*(b.length-1)),u&&(P=b.length-P-1);let D=b[P];(D===void 0||D==" ")&&(D="&nbsp;"),o?G+="<span style='color:rgb("+Y+","+H+","+X+");"+(c?"background-color:rgb("+Y+","+H+","+X+");":"")+(a?"opacity:"+W/255+";":"")+"'>"+D+"</span>":G+=D}G+="<br/>"}L.innerHTML=`<tr><td style="display:block;width:${h}px;height:${A}px;overflow:hidden">${G}</td></tr>`}}}function ld(n,e,t){const i=t.length-n-1;if(e>=t[i])return i-1;if(e<=t[n])return n;let r=n,s=i,o=Math.floor((r+s)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?s=o:r=o,o=Math.floor((r+s)/2);return o}function G4(n,e,t,i){const r=[],s=[],o=[];r[0]=1;for(let a=1;a<=t;++a){s[a]=e-i[n+1-a],o[a]=i[n+a]-e;let c=0;for(let u=0;u<a;++u){const f=o[u+1],h=s[a-u],A=r[u]/(f+h);r[u]=c+f*A,c=h*A}r[a]=c}return r}function H4(n,e,t,i){const r=ld(n,i,e),s=G4(r,i,n,e),o=new Qt(0,0,0,0);for(let a=0;a<=n;++a){const c=t[r-n+a],u=s[a],f=c.w*u;o.x+=c.x*f,o.y+=c.y*f,o.z+=c.z*f,o.w+=c.w*u}return o}function V4(n,e,t,i,r){const s=[];for(let h=0;h<=t;++h)s[h]=0;const o=[];for(let h=0;h<=i;++h)o[h]=s.slice(0);const a=[];for(let h=0;h<=t;++h)a[h]=s.slice(0);a[0][0]=1;const c=s.slice(0),u=s.slice(0);for(let h=1;h<=t;++h){c[h]=e-r[n+1-h],u[h]=r[n+h]-e;let A=0;for(let y=0;y<h;++y){const x=u[y+1],d=c[h-y];a[h][y]=x+d;const v=a[y][h-1]/a[h][y];a[y][h]=A+x*v,A=d*v}a[h][h]=A}for(let h=0;h<=t;++h)o[0][h]=a[h][t];for(let h=0;h<=t;++h){let A=0,y=1;const x=[];for(let d=0;d<=t;++d)x[d]=s.slice(0);x[0][0]=1;for(let d=1;d<=i;++d){let v=0;const g=h-d,p=t-d;h>=d&&(x[y][0]=x[A][0]/a[p+1][g],v=x[y][0]*a[g][p]);const m=g>=-1?1:-g,E=h-1<=p?d-1:t-h;for(let _=m;_<=E;++_)x[y][_]=(x[A][_]-x[A][_-1])/a[p+1][g+_],v+=x[y][_]*a[g+_][p];h<=p&&(x[y][d]=-x[A][d-1]/a[p+1][h],v+=x[y][d]*a[h][p]),o[d][h]=v;const w=A;A=y,y=w}}let f=t;for(let h=1;h<=i;++h){for(let A=0;A<=t;++A)o[h][A]*=f;f*=t-h}return o}function q4(n,e,t,i,r){const s=r<n?r:n,o=[],a=ld(n,i,e),c=V4(a,i,n,s,e),u=[];for(let f=0;f<t.length;++f){const h=t[f].clone(),A=h.w;h.x*=A,h.y*=A,h.z*=A,u[f]=h}for(let f=0;f<=s;++f){const h=u[a-n].clone().multiplyScalar(c[f][0]);for(let A=1;A<=n;++A)h.add(u[a-n+A].clone().multiplyScalar(c[f][A]));o[f]=h}for(let f=s+1;f<=r+1;++f)o[f]=new Qt(0,0,0);return o}function Y4(n,e){let t=1;for(let r=2;r<=n;++r)t*=r;let i=1;for(let r=2;r<=e;++r)i*=r;for(let r=2;r<=n-e;++r)i*=r;return t/i}function j4(n){const e=n.length,t=[],i=[];for(let s=0;s<e;++s){const o=n[s];t[s]=new T(o.x,o.y,o.z),i[s]=o.w}const r=[];for(let s=0;s<e;++s){const o=t[s].clone();for(let a=1;a<=s;++a)o.sub(r[s-a].clone().multiplyScalar(Y4(s,a)*i[a]));r[s]=o.divideScalar(i[0])}return r}function W4(n,e,t,i,r){const s=q4(n,e,t,i,r);return j4(s)}class Vh extends e2{constructor(e,t,i,r,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<i.length;++o){const a=i[o];this.controlPoints[o]=new Qt(a.x,a.y,a.z,a.w)}}getPoint(e,t){const i=t||new T,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=H4(this.degree,this.knots,this.controlPoints,r);return s.w!=1&&s.divideScalar(s.w),i.set(s.x,s.y,s.z)}getTangent(e,t){const i=t||new T,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=W4(this.degree,this.knots,this.controlPoints,r,1);return i.copy(s[1]).normalize(),i}}let Ye,St,dn;class n0 extends hs{constructor(e){super(e)}load(e,t,i,r){const s=this,o=s.path===""?t2.extractUrlBase(e):s.path,a=new gi(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(c){try{t(s.parse(c,o))}catch(u){r?r(u):console.error(u),s.manager.itemError(e)}},i,r)}parse(e,t){if(e5(e))Ye=new J4().parse(e);else{const r=Ad(e);if(!t5(r))throw new Error("THREE.FBXLoader: Unknown format.");if(Yh(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Yh(r));Ye=new $4().parse(r)}const i=new Zi(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new X4(i,this.manager).parse(Ye)}}class X4{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){St=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),r=this.parseDeformers(),s=new K4().parse(r);return this.parseScene(r,s,i),dn}parseConnections(){const e=new Map;return"Connections"in Ye&&Ye.Connections.connections.forEach(function(i){const r=i[0],s=i[1],o=i[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:s,relationship:o};e.get(r).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});const c={ID:r,relationship:o};e.get(s).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in Ye.Objects){const i=Ye.Objects.Video;for(const r in i){const s=i[r],o=parseInt(r);if(e[o]=s.RelativeFilename||s.Filename,"Content"in s){const a=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,c=typeof s.Content=="string"&&s.Content!=="";if(a||c){const u=this.parseImage(i[r]);t[s.RelativeFilename||s.Filename]=u}}}}for(const i in e){const r=e[i];t[r]!==void 0?e[i]=t[r]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,r=i.slice(i.lastIndexOf(".")+1).toLowerCase();let s;switch(r){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+r+'" is not supported.');return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in Ye.Objects){const i=Ye.Objects.Texture;for(const r in i){const s=this.parseTexture(i[r],e);t.set(parseInt(r),s)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const r=e.WrapModeU,s=e.WrapModeV,o=r!==void 0?r.value:0,a=s!==void 0?s.value:0;if(i.wrapS=o===0?os:Ln,i.wrapT=a===0?os:Ln,"Scaling"in e){const c=e.Scaling.value;i.repeat.x=c[0],i.repeat.y=c[1]}return i}loadTexture(e,t){let i;const r=this.textureLoader.path,s=St.get(e.id).children;s!==void 0&&s.length>0&&t[s[0].ID]!==void 0&&(i=t[s[0].ID],(i.indexOf("blob:")===0||i.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new un):(c.setPath(this.textureLoader.path),o=c.load(i))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new un):o=this.textureLoader.load(i);return this.textureLoader.setPath(r),o}parseMaterials(e){const t=new Map;if("Material"in Ye.Objects){const i=Ye.Objects.Material;for(const r in i){const s=this.parseMaterial(i[r],e);s!==null&&t.set(parseInt(r),s)}}return t}parseMaterial(e,t){const i=e.id,r=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!St.has(i))return null;const o=this.parseParameters(e,t,i);let a;switch(s.toLowerCase()){case"phong":a=new Ic;break;case"lambert":a=new Tu;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new Ic;break}return a.setValues(o),a.name=r,a}parseParameters(e,t,i){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new ze().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(r.color=new ze().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new ze().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(r.emissive=new ze().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new ze().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=new ze().fromArray(e.SpecularColor.value));const s=this;return St.get(i).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":r.bumpMap=s.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":r.aoMap=s.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=s.getTexture(t,o.ID),r.map!==void 0&&("colorSpace"in r.map?r.map.colorSpace="srgb":r.map.encoding=3001);break;case"DisplacementColor":r.displacementMap=s.getTexture(t,o.ID);break;case"EmissiveColor":r.emissiveMap=s.getTexture(t,o.ID),r.emissiveMap!==void 0&&("colorSpace"in r.emissiveMap?r.emissiveMap.colorSpace="srgb":r.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=s.getTexture(t,o.ID);break;case"ReflectionColor":r.envMap=s.getTexture(t,o.ID),r.envMap!==void 0&&(r.envMap.mapping=Wf,"colorSpace"in r.envMap?r.envMap.colorSpace="srgb":r.envMap.encoding=3001);break;case"SpecularColor":r.specularMap=s.getTexture(t,o.ID),r.specularMap!==void 0&&("colorSpace"in r.specularMap?r.specularMap.colorSpace="srgb":r.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=s.getTexture(t,o.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),r}getTexture(e,t){return"LayeredTexture"in Ye.Objects&&t in Ye.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=St.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Ye.Objects){const i=Ye.Objects.Deformer;for(const r in i){const s=i[r],o=St.get(parseInt(r));if(s.attrType==="Skin"){const a=this.parseSkeleton(o,i);a.ID=r,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[r]=a}else if(s.attrType==="BlendShape"){const a={id:r};a.rawTargets=this.parseMorphTargets(o,i),a.id=r,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(r){const s=t[r.ID];if(s.attrType!=="Cluster")return;const o={ID:r.ID,indices:[],weights:[],transformLink:new ue().fromArray(s.TransformLink.a)};"Indexes"in s&&(o.indices=s.Indexes.a,o.weights=s.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let r=0;r<e.children.length;r++){const s=e.children[r],o=t[s.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=St.get(parseInt(s.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,i.push(a)}return i}parseScene(e,t,i){dn=new Eo;const r=this.parseModels(e.skeletons,t,i),s=Ye.Objects.Model,o=this;r.forEach(function(c){const u=s[c.ID];o.setLookAtProperties(c,u),St.get(c.ID).parents.forEach(function(h){const A=r.get(h.ID);A!==void 0&&A.add(c)}),c.parent===null&&dn.add(c)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),dn.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const u=hd(c.userData.transformData);c.applyMatrix4(u),c.updateWorldMatrix()}});const a=new Z4().parse();dn.children.length===1&&dn.children[0].isGroup&&(dn.children[0].animations=a,dn=dn.children[0]),dn.animations=a}parseModels(e,t,i){const r=new Map,s=Ye.Objects.Model;for(const o in s){const a=parseInt(o),c=s[o],u=St.get(a);let f=this.buildSkeleton(u,e,a,c.attrName);if(!f){switch(c.attrType){case"Camera":f=this.createCamera(u);break;case"Light":f=this.createLight(u);break;case"Mesh":f=this.createMesh(u,t,i);break;case"NurbsCurve":f=this.createCurve(u,t);break;case"LimbNode":case"Root":f=new C0;break;case"Null":default:f=new Eo;break}f.name=c.attrName?Oa.sanitizeNodeName(c.attrName):"",f.ID=a}this.getTransformData(f,c),r.set(a,f)}return r}buildSkeleton(e,t,i,r){let s=null;return e.parents.forEach(function(o){for(const a in t){const c=t[a];c.rawBones.forEach(function(u,f){if(u.ID===o.ID){const h=s;s=new C0,s.matrixWorld.copy(u.transformLink),s.name=r?Oa.sanitizeNodeName(r):"",s.ID=i,c.bones[f]=s,h!==null&&s.add(h)}})}}),s}createCamera(e){let t,i;if(e.children.forEach(function(r){const s=Ye.Objects.NodeAttribute[r.ID];s!==void 0&&(i=s)}),i===void 0)t=new Ot;else{let r=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(r=1);let s=1;i.NearPlane!==void 0&&(s=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(a=i.AspectWidth.value,c=i.AspectHeight.value);const u=a/c;let f=45;i.FieldOfView!==void 0&&(f=i.FieldOfView.value);const h=i.FocalLength?i.FocalLength.value:null;switch(r){case 0:t=new It(f,u,s,o),h!==null&&t.setFocalLength(h);break;case 1:t=new Vt(-a/2,a/2,c/2,-c/2,s,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new Ot;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(r){const s=Ye.Objects.NodeAttribute[r.ID];s!==void 0&&(i=s)}),i===void 0)t=new Ot;else{let r;i.LightType===void 0?r=0:r=i.LightType.value;let s=16777215;i.Color!==void 0&&(s=new ze().fromArray(i.Color.value));let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let a=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?a=0:a=i.FarAttenuationEnd.value);const c=1;switch(r){case 0:t=new I0(s,o,a,c);break;case 1:t=new i2(s,o);break;case 2:let u=Math.PI/3;i.InnerAngle!==void 0&&(u=De.degToRad(i.InnerAngle.value));let f=0;i.OuterAngle!==void 0&&(f=De.degToRad(i.OuterAngle.value),f=Math.max(f,1)),t=new n2(s,o,a,u,f,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new I0(s,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let r,s=null,o=null;const a=[];return e.children.forEach(function(c){t.has(c.ID)&&(s=t.get(c.ID)),i.has(c.ID)&&a.push(i.get(c.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new Ic({color:13421772}),a.push(o)),"color"in s.attributes&&a.forEach(function(c){c.vertexColors=!0}),s.FBX_Deformer?(r=new Xf(s,o),r.normalizeSkinWeights()):r=new be(s,o),r}createCurve(e,t){const i=e.children.reduce(function(s,o){return t.has(o.ID)&&(s=t.get(o.ID)),s},null),r=new uo({color:3342591,linewidth:1});return new Xe(i,r)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=fd(t.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&St.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=Ye.Objects.Model[r.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),dn.add(e.target)):e.lookAt(new T().fromArray(o))}}})}bindSkeleton(e,t,i){const r=this.parsePoseNodes();for(const s in e){const o=e[s];St.get(parseInt(o.ID)).parents.forEach(function(c){if(t.has(c.ID)){const u=c.ID;St.get(u).parents.forEach(function(h){i.has(h.ID)&&i.get(h.ID).bind(new r2(o.bones),r[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Ye.Objects){const t=Ye.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const r=t[i].PoseNode;Array.isArray(r)?r.forEach(function(s){e[s.Node]=new ue().fromArray(s.Matrix.a)}):e[r.Node]=new ue().fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Ye&&"AmbientColor"in Ye.GlobalSettings){const e=Ye.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],r=e[2];if(t!==0||i!==0||r!==0){const s=new ze(t,i,r);dn.add(new s2(s,1))}}}}class K4{parse(e){const t=new Map;if("Geometry"in Ye.Objects){const i=Ye.Objects.Geometry;for(const r in i){const s=St.get(parseInt(r)),o=this.parseGeometry(s,i[r],e);t.set(parseInt(r),o)}}return t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const r=i.skeletons,s=[],o=e.parents.map(function(h){return Ye.Objects.Model[h.ID]});if(o.length===0)return;const a=e.children.reduce(function(h,A){return r[A.ID]!==void 0&&(h=r[A.ID]),h},null);e.children.forEach(function(h){i.morphTargets[h.ID]!==void 0&&s.push(i.morphTargets[h.ID])});const c=o[0],u={};"RotationOrder"in c&&(u.eulerOrder=fd(c.RotationOrder.value)),"InheritType"in c&&(u.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(u.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(u.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(u.scale=c.GeometricScaling.value);const f=hd(u);return this.genGeometry(t,a,s,f)}genGeometry(e,t,i,r){const s=new tn;e.attrName&&(s.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),c=new Yt(a.vertex,3);if(c.applyMatrix4(r),s.setAttribute("position",c),a.colors.length>0&&s.setAttribute("color",new Yt(a.colors,3)),t&&(s.setAttribute("skinIndex",new o2(a.weightsIndices,4)),s.setAttribute("skinWeight",new Yt(a.vertexWeights,4)),s.FBX_Deformer=t),a.normal.length>0){const u=new Qn().getNormalMatrix(r),f=new Yt(a.normal,3);f.applyNormalMatrix(u),s.setAttribute("normal",f)}if(a.uvs.forEach(function(u,f){e0==="uv2"&&f++;const h=f===0?"uv":`uv${f}`;s.setAttribute(h,new Yt(a.uvs[f],2))}),o.material&&o.material.mappingType!=="AllSame"){let u=a.materialIndex[0],f=0;if(a.materialIndex.forEach(function(h,A){h!==u&&(s.addGroup(f,A-f,u),u=h,f=A)}),s.groups.length>0){const h=s.groups[s.groups.length-1],A=h.start+h.count;A!==a.materialIndex.length&&s.addGroup(A,a.materialIndex.length-A,u)}s.groups.length===0&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,i,r),s}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(r,s){r.indices.forEach(function(o,a){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:s,weight:r.weights[a]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,r=0,s=!1,o=[],a=[],c=[],u=[],f=[],h=[];const A=this;return e.vertexIndices.forEach(function(y,x){let d,v=!1;y<0&&(y=y^-1,v=!0);let g=[],p=[];if(o.push(y*3,y*3+1,y*3+2),e.color){const m=Ko(x,i,y,e.color);c.push(m[0],m[1],m[2])}if(e.skeleton){if(e.weightTable[y]!==void 0&&e.weightTable[y].forEach(function(m){p.push(m.weight),g.push(m.id)}),p.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const m=[0,0,0,0],E=[0,0,0,0];p.forEach(function(w,_){let C=w,I=g[_];E.forEach(function(b,B,Q){if(C>b){Q[B]=C,C=b;const S=m[B];m[B]=I,I=S}})}),g=m,p=E}for(;p.length<4;)p.push(0),g.push(0);for(let m=0;m<4;++m)f.push(p[m]),h.push(g[m])}if(e.normal){const m=Ko(x,i,y,e.normal);a.push(m[0],m[1],m[2])}e.material&&e.material.mappingType!=="AllSame"&&(d=Ko(x,i,y,e.material)[0]),e.uv&&e.uv.forEach(function(m,E){const w=Ko(x,i,y,m);u[E]===void 0&&(u[E]=[]),u[E].push(w[0]),u[E].push(w[1])}),r++,v&&(A.genFace(t,e,o,d,a,c,u,f,h,r),i++,r=0,o=[],a=[],c=[],u=[],f=[],h=[])}),t}genFace(e,t,i,r,s,o,a,c,u,f){for(let h=2;h<f;h++)e.vertex.push(t.vertexPositions[i[0]]),e.vertex.push(t.vertexPositions[i[1]]),e.vertex.push(t.vertexPositions[i[2]]),e.vertex.push(t.vertexPositions[i[(h-1)*3]]),e.vertex.push(t.vertexPositions[i[(h-1)*3+1]]),e.vertex.push(t.vertexPositions[i[(h-1)*3+2]]),e.vertex.push(t.vertexPositions[i[h*3]]),e.vertex.push(t.vertexPositions[i[h*3+1]]),e.vertex.push(t.vertexPositions[i[h*3+2]]),t.skeleton&&(e.vertexWeights.push(c[0]),e.vertexWeights.push(c[1]),e.vertexWeights.push(c[2]),e.vertexWeights.push(c[3]),e.vertexWeights.push(c[(h-1)*4]),e.vertexWeights.push(c[(h-1)*4+1]),e.vertexWeights.push(c[(h-1)*4+2]),e.vertexWeights.push(c[(h-1)*4+3]),e.vertexWeights.push(c[h*4]),e.vertexWeights.push(c[h*4+1]),e.vertexWeights.push(c[h*4+2]),e.vertexWeights.push(c[h*4+3]),e.weightsIndices.push(u[0]),e.weightsIndices.push(u[1]),e.weightsIndices.push(u[2]),e.weightsIndices.push(u[3]),e.weightsIndices.push(u[(h-1)*4]),e.weightsIndices.push(u[(h-1)*4+1]),e.weightsIndices.push(u[(h-1)*4+2]),e.weightsIndices.push(u[(h-1)*4+3]),e.weightsIndices.push(u[h*4]),e.weightsIndices.push(u[h*4+1]),e.weightsIndices.push(u[h*4+2]),e.weightsIndices.push(u[h*4+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[(h-1)*3]),e.colors.push(o[(h-1)*3+1]),e.colors.push(o[(h-1)*3+2]),e.colors.push(o[h*3]),e.colors.push(o[h*3+1]),e.colors.push(o[h*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[(h-1)*3]),e.normal.push(s[(h-1)*3+1]),e.normal.push(s[(h-1)*3+2]),e.normal.push(s[h*3]),e.normal.push(s[h*3+1]),e.normal.push(s[h*3+2])),t.uv&&t.uv.forEach(function(A,y){e.uvs[y]===void 0&&(e.uvs[y]=[]),e.uvs[y].push(a[y][0]),e.uvs[y].push(a[y][1]),e.uvs[y].push(a[y][(h-1)*2]),e.uvs[y].push(a[y][(h-1)*2+1]),e.uvs[y].push(a[y][h*2]),e.uvs[y].push(a[y][h*2+1])})}addMorphTargets(e,t,i,r){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;i.forEach(function(o){o.rawTargets.forEach(function(a){const c=Ye.Objects.Geometry[a.geoID];c!==void 0&&s.genMorphGeometry(e,t,c,r,a.name)})})}genMorphGeometry(e,t,i,r,s){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=i.Vertices!==void 0?i.Vertices.a:[],c=i.Indexes!==void 0?i.Indexes.a:[],u=e.attributes.position.count*3,f=new Float32Array(u);for(let x=0;x<c.length;x++){const d=c[x]*3;f[d]=a[x*3],f[d+1]=a[x*3+1],f[d+2]=a[x*3+2]}const h={vertexIndices:o,vertexPositions:f},A=this.genBuffers(h),y=new Yt(A.vertex,3);y.name=s||i.attrName,y.applyMatrix4(r),e.morphAttributes.position.push(y)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Normals.a;let s=[];return i==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:s,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.UV.a;let s=[];return i==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:r,indices:s,mappingType:t,referenceType:i}}parseVertexColors(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Colors.a;let s=[];return i==="IndexToDirect"&&(s=e.ColorIndex.a),{dataSize:4,buffer:r,indices:s,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const r=e.Materials.a,s=[];for(let o=0;o<r.length;++o)s.push(o);return{dataSize:1,buffer:r,indices:s,mappingType:t,referenceType:i}}parseNurbsGeometry(e){if(Vh===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new tn;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new tn;const i=t-1,r=e.KnotVector.a,s=[],o=e.Points.a;for(let h=0,A=o.length;h<A;h+=4)s.push(new Qt().fromArray(o,h));let a,c;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){a=i,c=r.length-1-a;for(let h=0;h<i;++h)s.push(s[h])}const f=new Vh(i,r,s,a,c).getPoints(s.length*12);return new tn().setFromPoints(f)}}class Z4{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const r=t[i],s=this.addClip(r);e.push(s)}return e}parseClips(){if(Ye.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Ye.Objects.AnimationCurveNode,t=new Map;for(const i in e){const r=e[i];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:r.id,attr:r.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=Ye.Objects.AnimationCurve;for(const i in t){const r={id:t[i].id,times:t[i].KeyTime.a.map(n5),values:t[i].KeyValueFloat.a},s=St.get(r.id);if(s!==void 0){const o=s.parents[0].ID,a=s.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=r:a.match(/Y/)?e.get(o).curves.y=r:a.match(/Z/)?e.get(o).curves.z=r:a.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=r)}}}parseAnimationLayers(e){const t=Ye.Objects.AnimationLayer,i=new Map;for(const r in t){const s=[],o=St.get(parseInt(r));o!==void 0&&(o.children.forEach(function(c,u){if(e.has(c.ID)){const f=e.get(c.ID);if(f.curves.x!==void 0||f.curves.y!==void 0||f.curves.z!==void 0){if(s[u]===void 0){const h=St.get(c.ID).parents.filter(function(A){return A.relationship!==void 0})[0].ID;if(h!==void 0){const A=Ye.Objects.Model[h.toString()];if(A===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const y={modelName:A.attrName?Oa.sanitizeNodeName(A.attrName):"",ID:A.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};dn.traverse(function(x){x.ID===A.id&&(y.transform=x.matrix,x.userData.transformData&&(y.eulerOrder=x.userData.transformData.eulerOrder))}),y.transform||(y.transform=new ue),"PreRotation"in A&&(y.preRotation=A.PreRotation.value),"PostRotation"in A&&(y.postRotation=A.PostRotation.value),s[u]=y}}s[u]&&(s[u][f.attr]=f)}else if(f.curves.morph!==void 0){if(s[u]===void 0){const h=St.get(c.ID).parents.filter(function(g){return g.relationship!==void 0})[0].ID,A=St.get(h).parents[0].ID,y=St.get(A).parents[0].ID,x=St.get(y).parents[0].ID,d=Ye.Objects.Model[x],v={modelName:d.attrName?Oa.sanitizeNodeName(d.attrName):"",morphName:Ye.Objects.Deformer[h].attrName};s[u]=v}s[u][f.attr]=f}}}),i.set(parseInt(r),s))}return i}parseAnimStacks(e){const t=Ye.Objects.AnimationStack,i={};for(const r in t){const s=St.get(parseInt(r)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(s[0].ID);i[r]={name:t[r].attrName,layer:o}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(r){t=t.concat(i.generateTracks(r))}),new a2(e.name,-1,t)}generateTracks(e){const t=[];let i=new T,r=new Fe,s=new T;if(e.transform&&e.transform.decompose(i,r,s),i=i.toArray(),r=new En().setFromQuaternion(r,e.eulerOrder).toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");o!==void 0&&t.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&t.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");o!==void 0&&t.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&t.push(o)}return t}generateVectorTrack(e,t,i,r){const s=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(s,t,i);return new c2(e+"."+r,s,o)}generateRotationTrack(e,t,i,r,s,o){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(De.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(De.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(De.degToRad));const a=this.getTimesForAllAxes(t),c=this.getKeyframeTrackValues(a,t,i);r!==void 0&&(r=r.map(De.degToRad),r.push(o),r=new En().fromArray(r),r=new Fe().setFromEuler(r)),s!==void 0&&(s=s.map(De.degToRad),s.push(o),s=new En().fromArray(s),s=new Fe().setFromEuler(s).invert());const u=new Fe,f=new En,h=[];for(let A=0;A<c.length;A+=3)f.set(c[A],c[A+1],c[A+2],o),u.setFromEuler(f),r!==void 0&&u.premultiply(r),s!==void 0&&u.multiply(s),u.toArray(h,A/3*4);return new l2(e+".quaternion",a,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(s){return s/100}),r=dn.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new u2(e.modelName+".morphTargetInfluences["+r+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,r){return i-r}),t.length>1){let i=1,r=t[0];for(let s=1;s<t.length;s++){const o=t[s];o!==r&&(t[i]=o,r=o,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const r=i,s=[];let o=-1,a=-1,c=-1;return e.forEach(function(u){if(t.x&&(o=t.x.times.indexOf(u)),t.y&&(a=t.y.times.indexOf(u)),t.z&&(c=t.z.times.indexOf(u)),o!==-1){const f=t.x.values[o];s.push(f),r[0]=f}else s.push(r[0]);if(a!==-1){const f=t.y.values[a];s.push(f),r[1]=f}else s.push(r[1]);if(c!==-1){const f=t.z.values[c];s.push(f),r[2]=f}else s.push(r[2])}),s}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const i=e.values[t-1],r=e.values[t]-i,s=Math.abs(r);if(s>=180){const o=s/180,a=r/o;let c=i+a;const u=e.times[t-1],h=(e.times[t]-u)/o;let A=u+h;const y=[],x=[];for(;A<e.times[t];)y.push(A),A+=h,x.push(c),c+=a;e.times=jh(e.times,t,y),e.values=jh(e.values,t,x)}}}}class $4{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new ud,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(r,s){const o=r.match(/^[\s\t]*;/),a=r.match(/^[\s\t]*$/);if(o||a)return;const c=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),u=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=r.match("^\\t{"+(t.currentIndent-1)+"}}");c?t.parseNodeBegin(r,c):u?t.parseNodeProperty(r,u,i[++s]):f?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:i},o=this.parseNodeAttr(r),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,s):i in a?(i==="PoseNode"?a.PoseNode.push(s):a[i].id!==void 0&&(a[i]={},a[i][a[i].id]=a[i]),o.id!==""&&(a[i][o.id]=s)):typeof o.id=="number"?(a[i]={},a[i][o.id]=s):i!=="Properties70"&&(i==="PoseNode"?a[i]=[s]:a[i]=s),typeof o.id=="number"&&(s.id=o.id),o.name!==""&&(s.attrName=o.name),o.type!==""&&(s.attrType=o.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",r="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:i,type:r}}parseNodeProperty(e,t,i){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&s===","&&(s=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,r,s);return}if(r==="C"){const c=s.split(",").slice(1),u=parseInt(c[0]),f=parseInt(c[1]);let h=s.split(",").slice(3);h=h.map(function(A){return A.trim().replace(/^"/,"")}),r="connections",s=[u,f],r5(s,h),o[r]===void 0&&(o[r]=[])}r==="Node"&&(o.id=s),r in o&&Array.isArray(o[r])?o[r].push(s):r!=="a"?o[r]=s:o.a=s,this.setCurrentProp(o,r),r==="a"&&s.slice(-1)!==","&&(o.a=Vc(s))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Vc(t.a))}parseNodeSpecialProperty(e,t,i){const r=i.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=r[0],o=r[1],a=r[2],c=r[3];let u=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=Vc(u);break}this.getPrevNode()[s]={type:o,type2:a,flag:c,value:u},this.setCurrentProp(this.getPrevNode(),s)}}class J4{parse(e){const t=new qh(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const r=new ud;for(;!this.endOfContent(t);){const s=this.parseNode(t,i);s!==null&&r.add(s.name,s)}return r}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},r=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(r===0)return null;const c=[];for(let A=0;A<s;A++)c.push(this.parseProperty(e));const u=c.length>0?c[0]:"",f=c.length>1?c[1]:"",h=c.length>2?c[2]:"";for(i.singleProperty=s===1&&e.getOffset()===r;r>e.getOffset();){const A=this.parseNode(e,t);A!==null&&this.parseSubNode(a,i,A)}return i.propertyList=c,typeof u=="number"&&(i.id=u),f!==""&&(i.attrName=f),h!==""&&(i.attrType=h),a!==""&&(i.name=a),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const r=i.propertyList[0];Array.isArray(r)?(t[i.name]=i,i.a=r):t[i.name]=r}else if(e==="Connections"&&i.name==="C"){const r=[];i.propertyList.forEach(function(s,o){o!==0&&r.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(i.name==="Properties70")Object.keys(i).forEach(function(s){t[s]=i[s]});else if(e==="Properties70"&&i.name==="P"){let r=i.propertyList[0],s=i.propertyList[1];const o=i.propertyList[2],a=i.propertyList[3];let c;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?c=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:c=i.propertyList[4],t[r]={type:s,type2:o,flag:a,value:c}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),s=e.getUint32(),o=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}const a=so(new Uint8Array(e.getArrayBuffer(o))),c=new qh(a.buffer);switch(t){case"b":case"c":return c.getBooleanArray(r);case"d":return c.getFloat64Array(r);case"f":return c.getFloat32Array(r);case"i":return c.getInt32Array(r);case"l":return c.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class qh{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();const i=t.indexOf(0);return i>=0&&(t=t.slice(0,i)),Kf(new Uint8Array(t))}}class ud{add(e,t){this[e]=t}}function e5(n){const e="Kaydara FBX Binary  \0";return n.byteLength>=e.length&&e===Ad(n,0,e.length)}function t5(n){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function i(r){const s=n[r-1];return n=n.slice(t+r),t++,s}for(let r=0;r<e.length;++r)if(i(1)===e[r])return!1;return!0}function Yh(n){const e=/FBXVersion: (\d+)/,t=n.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function n5(n){return n/46186158e3}const i5=[];function Ko(n,e,t,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=n;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(r=i.indices[r]);const s=r*i.dataSize,o=s+i.dataSize;return s5(i5,i.buffer,s,o)}const Hc=new En,Ir=new T;function hd(n){const e=new ue,t=new ue,i=new ue,r=new ue,s=new ue,o=new ue,a=new ue,c=new ue,u=new ue,f=new ue,h=new ue,A=new ue,y=n.inheritType?n.inheritType:0;if(n.translation&&e.setPosition(Ir.fromArray(n.translation)),n.preRotation){const B=n.preRotation.map(De.degToRad);B.push(n.eulerOrder),t.makeRotationFromEuler(Hc.fromArray(B))}if(n.rotation){const B=n.rotation.map(De.degToRad);B.push(n.eulerOrder),i.makeRotationFromEuler(Hc.fromArray(B))}if(n.postRotation){const B=n.postRotation.map(De.degToRad);B.push(n.eulerOrder),r.makeRotationFromEuler(Hc.fromArray(B)),r.invert()}n.scale&&s.scale(Ir.fromArray(n.scale)),n.scalingOffset&&a.setPosition(Ir.fromArray(n.scalingOffset)),n.scalingPivot&&o.setPosition(Ir.fromArray(n.scalingPivot)),n.rotationOffset&&c.setPosition(Ir.fromArray(n.rotationOffset)),n.rotationPivot&&u.setPosition(Ir.fromArray(n.rotationPivot)),n.parentMatrixWorld&&(h.copy(n.parentMatrix),f.copy(n.parentMatrixWorld));const x=t.clone().multiply(i).multiply(r),d=new ue;d.extractRotation(f);const v=new ue;v.copyPosition(f);const g=v.clone().invert().multiply(f),p=d.clone().invert().multiply(g),m=s,E=new ue;if(y===0)E.copy(d).multiply(x).multiply(p).multiply(m);else if(y===1)E.copy(d).multiply(p).multiply(x).multiply(m);else{const Q=new ue().scale(new T().setFromMatrixScale(h)).clone().invert(),S=p.clone().multiply(Q);E.copy(d).multiply(x).multiply(S).multiply(m)}const w=u.clone().invert(),_=o.clone().invert();let C=e.clone().multiply(c).multiply(u).multiply(t).multiply(i).multiply(r).multiply(w).multiply(a).multiply(o).multiply(s).multiply(_);const I=new ue().copyPosition(C),b=f.clone().multiply(I);return A.copyPosition(b),C=A.clone().multiply(E),C.premultiply(f.invert()),C}function fd(n){n=n||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return n===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[n]}function Vc(n){return n.split(",").map(function(t){return parseFloat(t)})}function Ad(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=n.byteLength),Kf(new Uint8Array(n,e,t))}function r5(n,e){for(let t=0,i=n.length,r=e.length;t<r;t++,i++)n[i]=e[t]}function s5(n,e,t,i){for(let r=t,s=0;r<i;r++,s++)n[s]=e[r];return n}function jh(n,e,t){return n.slice(0,e).concat(t).concat(n.slice(e))}var o5=Object.defineProperty,a5=(n,e,t)=>e in n?o5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,i0=(n,e,t)=>(a5(n,typeof e!="symbol"?e+"":e,t),t);class c5 extends hs{constructor(e){super(e)}load(e,t,i,r){const s=new gi(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,o=>{if(typeof o!="string")throw new Error("unsupported data type");const a=JSON.parse(o),c=this.parse(a);t&&t(c)},i,r)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new r0(e)}}class r0{constructor(e){i0(this,"data"),this.data=e}generateShapes(e,t=100,i){const r=[],s={letterSpacing:0,lineHeight:1,...i},o=l5(e,t,this.data,s);for(let a=0,c=o.length;a<c;a++)Array.prototype.push.apply(r,o[a].toShapes(!1));return r}}i0(r0,"isFont");i0(r0,"type");function l5(n,e,t,i){const r=Array.from(n),s=e/t.resolution,o=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*s,a=[];let c=0,u=0;for(let f=0;f<r.length;f++){const h=r[f];if(h===`
`)c=0,u-=o*i.lineHeight;else{const A=u5(h,s,c,u,t);A&&(c+=A.offsetX+i.letterSpacing,a.push(A.path))}}return a}function u5(n,e,t,i,r){const s=r.glyphs[n]||r.glyphs["?"];if(!s){console.error('THREE.Font: character "'+n+'" does not exists in font family '+r.familyName+".");return}const o=new Oi;let a,c,u,f,h,A,y,x;if(s.o){const d=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let v=0,g=d.length;v<g;)switch(d[v++]){case"m":a=parseInt(d[v++])*e+t,c=parseInt(d[v++])*e+i,o.moveTo(a,c);break;case"l":a=parseInt(d[v++])*e+t,c=parseInt(d[v++])*e+i,o.lineTo(a,c);break;case"q":u=parseInt(d[v++])*e+t,f=parseInt(d[v++])*e+i,h=parseInt(d[v++])*e+t,A=parseInt(d[v++])*e+i,o.quadraticCurveTo(h,A,u,f);break;case"b":u=parseInt(d[v++])*e+t,f=parseInt(d[v++])*e+i,h=parseInt(d[v++])*e+t,A=parseInt(d[v++])*e+i,y=parseInt(d[v++])*e+t,x=parseInt(d[v++])*e+i,o.bezierCurveTo(h,A,y,x,u,f);break}}return{offsetX:s.ha*e,path:o}}class h5 extends un{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=dt,this.minFilter=dt,this.wrapR=Ln,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class f5{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:r,msg:s,transfer:o}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(s,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=i,this.workers[r].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const dd=0,Wh=2,A5=0,d5=0,m5=2,p5=0,g5=0,y5=1,pu=2,v5=0,md=1,x5=10,E5=64,pd=0,gd=9,yd=15,vd=16,xd=22,Ed=37,wd=43,_d=76,Cd=83,Id=97,Bd=100,bd=103,Sd=109,Md=165,Td=166;class w5{constructor(){this.vkFormat=pd,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=dd,this.levels=[],this.dataFormatDescriptor=[{vendorId:d5,descriptorType:A5,descriptorBlockSize:0,versionNumber:m5,colorModel:p5,colorPrimaries:md,transferFunction:pu,flags:g5,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Fs{constructor(e,t,i,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),i=e+2**32*t;return this._offset+=8,i}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){t===void 0&&(t=0);const i=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,r)}}const cn=[171,75,84,88,32,50,48,187,13,10,26,10];function Xh(n){return typeof TextDecoder<"u"?new TextDecoder().decode(n):Buffer.from(n).toString("utf8")}function _5(n){const e=new Uint8Array(n.buffer,n.byteOffset,cn.length);if(e[0]!==cn[0]||e[1]!==cn[1]||e[2]!==cn[2]||e[3]!==cn[3]||e[4]!==cn[4]||e[5]!==cn[5]||e[6]!==cn[6]||e[7]!==cn[7]||e[8]!==cn[8]||e[9]!==cn[9]||e[10]!==cn[10]||e[11]!==cn[11])throw new Error("Missing KTX 2.0 identifier.");const t=new w5,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new Fs(n,cn.length,i,!0);t.vkFormat=r._nextUint32(),t.typeSize=r._nextUint32(),t.pixelWidth=r._nextUint32(),t.pixelHeight=r._nextUint32(),t.pixelDepth=r._nextUint32(),t.layerCount=r._nextUint32(),t.faceCount=r._nextUint32();const s=r._nextUint32();t.supercompressionScheme=r._nextUint32();const o=r._nextUint32(),a=r._nextUint32(),c=r._nextUint32(),u=r._nextUint32(),f=r._nextUint64(),h=r._nextUint64(),A=s*3*8,y=new Fs(n,cn.length+i,A,!0);for(let Y=0;Y<s;Y++)t.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+y._nextUint64(),y._nextUint64()),uncompressedByteLength:y._nextUint64()});const x=new Fs(n,o,a,!0),d={vendorId:x._skip(4)._nextUint16(),descriptorType:x._nextUint16(),versionNumber:x._nextUint16(),descriptorBlockSize:x._nextUint16(),colorModel:x._nextUint8(),colorPrimaries:x._nextUint8(),transferFunction:x._nextUint8(),flags:x._nextUint8(),texelBlockDimension:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],bytesPlane:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],samples:[]},p=(d.descriptorBlockSize/4-6)/4;for(let Y=0;Y<p;Y++){const H={bitOffset:x._nextUint16(),bitLength:x._nextUint8(),channelType:x._nextUint8(),samplePosition:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};H.channelType&E5?(H.sampleLower=x._nextInt32(),H.sampleUpper=x._nextInt32()):(H.sampleLower=x._nextUint32(),H.sampleUpper=x._nextUint32()),d.samples[Y]=H}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(d);const m=new Fs(n,c,u,!0);for(;m._offset<u;){const Y=m._nextUint32(),H=m._scan(Y),X=Xh(H);if(t.keyValue[X]=m._nextUint8Array(Y-H.byteLength-1),X.match(/^ktx/i)){const P=Xh(t.keyValue[X]);t.keyValue[X]=P.substring(0,P.lastIndexOf("\0"))}const W=Y%4?4-Y%4:0;m._skip(W)}if(h<=0)return t;const E=new Fs(n,f,h,!0),w=E._nextUint16(),_=E._nextUint16(),C=E._nextUint32(),I=E._nextUint32(),b=E._nextUint32(),B=E._nextUint32(),Q=[];for(let Y=0;Y<s;Y++)Q.push({imageFlags:E._nextUint32(),rgbSliceByteOffset:E._nextUint32(),rgbSliceByteLength:E._nextUint32(),alphaSliceByteOffset:E._nextUint32(),alphaSliceByteLength:E._nextUint32()});const S=f+E._offset,k=S+C,L=k+I,O=L+b,G=new Uint8Array(n.buffer,n.byteOffset+S,C),V=new Uint8Array(n.buffer,n.byteOffset+k,I),N=new Uint8Array(n.buffer,n.byteOffset+L,b),j=new Uint8Array(n.buffer,n.byteOffset+O,B);return t.globalData={endpointCount:w,selectorCount:_,imageDescs:Q,endpointsData:G,selectorsData:V,tablesData:N,extendedData:j},t}let Ls,bi,gu;const qc={env:{emscripten_notify_memory_growth:function(n){gu=new Uint8Array(bi.exports.memory.buffer)}}};class C5{init(){return Ls||(typeof fetch<"u"?Ls=fetch("data:application/wasm;base64,"+Kh).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,qc)).then(this._init):Ls=WebAssembly.instantiate(Buffer.from(Kh,"base64"),qc).then(this._init),Ls)}_init(e){bi=e.instance,qc.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!bi)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,r=bi.exports.malloc(i);gu.set(e,r),t=t||Number(bi.exports.ZSTD_findDecompressedSize(r,i));const s=bi.exports.malloc(t),o=bi.exports.ZSTD_decompress(s,t,r,i),a=gu.slice(s,s+o);return bi.exports.free(r),bi.exports.free(s),a}}const Kh="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";class I5 extends rc{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,Zf),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class B5 extends rc{constructor(e,t,i,r,s,o){super(e,t,i,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Ln}}var b5=Object.defineProperty,S5=(n,e,t)=>e in n?b5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,pc=(n,e,t)=>(S5(n,typeof e!="symbol"?e+"":e,t),t);const Pd=3e3,Dd=3001,Zh="",M5="display-p3",T5="display-p3-linear",P5="srgb-linear",s0="srgb",Yc=new WeakMap;let jc=0,Wc;const oo=class extends hs{constructor(n){super(n),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new f5,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(n){return this.transcoderPath=n,this}setWorkerLimit(n){return this.workerPool.setWorkerLimit(n),this}detectSupport(n){return this.workerConfig={astcSupported:n.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:n.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:n.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:n.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:n.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:n.extensions.has("WEBGL_compressed_texture_pvrtc")||n.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},n.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const n=new gi(this.manager);n.setPath(this.transcoderPath),n.setWithCredentials(this.withCredentials);const e=n.loadAsync("basis_transcoder.js"),t=new gi(this.manager);t.setPath(this.transcoderPath),t.setResponseType("arraybuffer"),t.setWithCredentials(this.withCredentials);const i=t.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,i]).then(([r,s])=>{const o=oo.BasisWorker.toString(),a=["/* constants */","let _EngineFormat = "+JSON.stringify(oo.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(oo.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(oo.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a])),this.transcoderBinary=s,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),u=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:u},[u]),c})}),jc>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),jc++}return this.transcoderPending}load(n,e,t,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new gi(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(n,s=>{if(Yc.has(s))return Yc.get(s).promise.then(e).catch(i);this._createTexture(s).then(o=>e?e(o):null).catch(i)},t,i)}_createTextureFrom(n,e){const{faces:t,width:i,height:r,format:s,type:o,error:a,dfdFlags:c}=n;if(o==="error")return Promise.reject(a);let u;if(e.faceCount===6)u=new I5(t,s,qt);else{const h=t[0].mipmaps;u=e.layerCount>1?new B5(h,i,r,e.layerCount,s,qt):new rc(h,i,r,s,qt)}u.minFilter=t[0].mipmaps.length===1?lt:Pu,u.magFilter=lt,u.generateMipmaps=!1,u.needsUpdate=!0;const f=Qd(e);return"colorSpace"in u?u.colorSpace=f:u.encoding=f===s0?Dd:Pd,u.premultiplyAlpha=!!(c&y5),u}async _createTexture(n,e={}){const t=_5(new Uint8Array(n));if(t.vkFormat!==pd)return Q5(t);const i=e,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:n,taskConfig:i},[n])).then(s=>this._createTextureFrom(s.data,t));return Yc.set(n,{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),jc--,this}};let gr=oo;pc(gr,"BasisFormat",{ETC1S:0,UASTC_4x4:1});pc(gr,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16});pc(gr,"EngineFormat",{RGBAFormat:Lt,RGBA_ASTC_4x4_Format:h2,RGBA_BPTC_Format:f2,RGBA_ETC2_EAC_Format:A2,RGBA_PVRTC_4BPPV1_Format:d2,RGBA_S3TC_DXT5_Format:m2,RGB_ETC1_Format:p2,RGB_ETC2_Format:g2,RGB_PVRTC_4BPPV1_Format:y2,RGB_S3TC_DXT1_Format:v2});pc(gr,"BasisWorker",function(){let n,e,t;const i=_EngineFormat,r=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(x){const d=x.data;switch(d.type){case"init":n=d.config,o(d.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:v,buffers:g,width:p,height:m,hasAlpha:E,format:w,dfdFlags:_}=a(d.buffer);self.postMessage({type:"transcode",id:d.id,faces:v,width:p,height:m,hasAlpha:E,format:w,dfdFlags:_},g)}catch(v){console.error(v),self.postMessage({type:"error",id:d.id,error:v.message})}});break}});function o(x){e=new Promise(d=>{t={wasmBinary:x,onRuntimeInitialized:d},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(x){const d=new t.KTX2File(new Uint8Array(x));function v(){d.close(),d.delete()}if(!d.isValid())throw v(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const g=d.isUASTC()?s.UASTC_4x4:s.ETC1S,p=d.getWidth(),m=d.getHeight(),E=d.getLayers()||1,w=d.getLevels(),_=d.getFaces(),C=d.getHasAlpha(),I=d.getDFDFlags(),{transcoderFormat:b,engineFormat:B}=h(g,p,m,C);if(!p||!m||!w)throw v(),new Error("THREE.KTX2Loader:	Invalid texture");if(!d.startTranscoding())throw v(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Q=[],S=[];for(let k=0;k<_;k++){const L=[];for(let O=0;O<w;O++){const G=[];let V,N;for(let Y=0;Y<E;Y++){const H=d.getImageLevelInfo(O,Y,k);k===0&&O===0&&Y===0&&(H.origWidth%4!==0||H.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),w>1?(V=H.origWidth,N=H.origHeight):(V=H.width,N=H.height);const X=new Uint8Array(d.getImageTranscodedSizeInBytes(O,Y,0,b));if(!d.transcodeImage(X,O,Y,k,b,0,-1,-1))throw v(),new Error("THREE.KTX2Loader: .transcodeImage failed.");G.push(X)}const j=y(G);L.push({data:j,width:V,height:N}),S.push(j.buffer)}Q.push({mipmaps:L,width:p,height:m,format:B})}return v(),{faces:Q,buffers:S,width:p,height:m,hasAlpha:C,format:B,dfdFlags:I}}const c=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],u=c.sort(function(x,d){return x.priorityETC1S-d.priorityETC1S}),f=c.sort(function(x,d){return x.priorityUASTC-d.priorityUASTC});function h(x,d,v,g){let p,m;const E=x===s.ETC1S?u:f;for(let w=0;w<E.length;w++){const _=E[w];if(n[_.if]&&_.basisFormat.includes(x)&&!(g&&_.transcoderFormat.length<2)&&!(_.needsPowerOfTwo&&!(A(d)&&A(v))))return p=_.transcoderFormat[g?1:0],m=_.engineFormat[g?1:0],{transcoderFormat:p,engineFormat:m}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),p=r.RGBA32,m=i.RGBAFormat,{transcoderFormat:p,engineFormat:m}}function A(x){return x<=2?!0:(x&x-1)===0&&x!==0}function y(x){if(x.length===1)return x[0];let d=0;for(let p=0;p<x.length;p++){const m=x[p];d+=m.byteLength}const v=new Uint8Array(d);let g=0;for(let p=0;p<x.length;p++){const m=x[p];v.set(m,g),g+=m.byteLength}return v}});const D5=new Set([Lt,$r,pi]),Xc={[Sd]:Lt,[Id]:Lt,[Ed]:Lt,[wd]:Lt,[bd]:$r,[Cd]:$r,[vd]:$r,[xd]:$r,[Bd]:pi,[_d]:pi,[yd]:pi,[gd]:pi,[Td]:B0,[Md]:B0},Kc={[Sd]:pt,[Id]:xt,[Ed]:qt,[wd]:qt,[bd]:pt,[Cd]:xt,[vd]:qt,[xd]:qt,[Bd]:pt,[_d]:xt,[yd]:qt,[gd]:qt,[Td]:qt,[Md]:qt};async function Q5(n){const{vkFormat:e}=n;if(Xc[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;n.supercompressionScheme===Wh&&(Wc||(Wc=new Promise(async o=>{const a=new C5;await a.init(),o(a)})),t=await Wc);const i=[];for(let o=0;o<n.levels.length;o++){const a=Math.max(1,n.pixelWidth>>o),c=Math.max(1,n.pixelHeight>>o),u=n.pixelDepth?Math.max(1,n.pixelDepth>>o):0,f=n.levels[o];let h;if(n.supercompressionScheme===dd)h=f.levelData;else if(n.supercompressionScheme===Wh)h=t.decode(f.levelData,f.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let A;Kc[e]===pt?A=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):Kc[e]===xt?A=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):A=h,i.push({data:A,width:a,height:c,depth:u})}let r;if(D5.has(Xc[e]))r=n.pixelDepth===0?new Ki(i[0].data,n.pixelWidth,n.pixelHeight):new h5(i[0].data,n.pixelWidth,n.pixelHeight,n.pixelDepth);else{if(n.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new rc(i,n.pixelWidth,n.pixelHeight)}r.mipmaps=i,r.type=Kc[e],r.format=Xc[e],r.needsUpdate=!0;const s=Qd(n);return"colorSpace"in r?r.colorSpace=s:r.encoding=s===s0?Dd:Pd,Promise.resolve(r)}function Qd(n){const e=n.dataFormatDescriptor[0];return e.colorPrimaries===md?e.transferFunction===pu?s0:P5:e.colorPrimaries===x5?e.transferFunction===pu?M5:T5:(e.colorPrimaries===v5||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),Zh)}class R5 extends $f{constructor(e){super(e),this.type=xt}parse(e){const o=function(I,b){switch(I){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(b||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(b||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(b||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(b||""))}},f=`
`,h=function(I,b,B){b=b||1024;let S=I.pos,k=-1,L=0,O="",G=String.fromCharCode.apply(null,new Uint16Array(I.subarray(S,S+128)));for(;0>(k=G.indexOf(f))&&L<b&&S<I.byteLength;)O+=G,L+=G.length,S+=128,G+=String.fromCharCode.apply(null,new Uint16Array(I.subarray(S,S+128)));return-1<k?(I.pos+=L+k+1,O+G.slice(0,k)):!1},A=function(I){const b=/^#\?(\S+)/,B=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Q=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,S=/^\s*FORMAT=(\S+)\s*$/,k=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,L={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let O,G;for((I.pos>=I.byteLength||!(O=h(I)))&&o(1,"no header found"),(G=O.match(b))||o(3,"bad initial token"),L.valid|=1,L.programtype=G[1],L.string+=O+`
`;O=h(I),O!==!1;){if(L.string+=O+`
`,O.charAt(0)==="#"){L.comments+=O+`
`;continue}if((G=O.match(B))&&(L.gamma=parseFloat(G[1])),(G=O.match(Q))&&(L.exposure=parseFloat(G[1])),(G=O.match(S))&&(L.valid|=2,L.format=G[1]),(G=O.match(k))&&(L.valid|=4,L.height=parseInt(G[1],10),L.width=parseInt(G[2],10)),L.valid&2&&L.valid&4)break}return L.valid&2||o(3,"missing format specifier"),L.valid&4||o(3,"missing image size specifier"),L},y=function(I,b,B){const Q=b;if(Q<8||Q>32767||I[0]!==2||I[1]!==2||I[2]&128)return new Uint8Array(I);Q!==(I[2]<<8|I[3])&&o(3,"wrong scanline width");const S=new Uint8Array(4*b*B);S.length||o(4,"unable to allocate buffer space");let k=0,L=0;const O=4*Q,G=new Uint8Array(4),V=new Uint8Array(O);let N=B;for(;N>0&&L<I.byteLength;){L+4>I.byteLength&&o(1),G[0]=I[L++],G[1]=I[L++],G[2]=I[L++],G[3]=I[L++],(G[0]!=2||G[1]!=2||(G[2]<<8|G[3])!=Q)&&o(3,"bad rgbe scanline format");let j=0,Y;for(;j<O&&L<I.byteLength;){Y=I[L++];const X=Y>128;if(X&&(Y-=128),(Y===0||j+Y>O)&&o(3,"bad scanline data"),X){const W=I[L++];for(let P=0;P<Y;P++)V[j++]=W}else V.set(I.subarray(L,L+Y),j),j+=Y,L+=Y}const H=Q;for(let X=0;X<H;X++){let W=0;S[k]=V[X+W],W+=Q,S[k+1]=V[X+W],W+=Q,S[k+2]=V[X+W],W+=Q,S[k+3]=V[X+W],k+=4}N--}return S},x=function(I,b,B,Q){const S=I[b+3],k=Math.pow(2,S-128)/255;B[Q+0]=I[b+0]*k,B[Q+1]=I[b+1]*k,B[Q+2]=I[b+2]*k,B[Q+3]=1},d=function(I,b,B,Q){const S=I[b+3],k=Math.pow(2,S-128)/255;B[Q+0]=Jr.toHalfFloat(Math.min(I[b+0]*k,65504)),B[Q+1]=Jr.toHalfFloat(Math.min(I[b+1]*k,65504)),B[Q+2]=Jr.toHalfFloat(Math.min(I[b+2]*k,65504)),B[Q+3]=Jr.toHalfFloat(1)},v=new Uint8Array(e);v.pos=0;const g=A(v),p=g.width,m=g.height,E=y(v.subarray(v.pos),p,m);let w,_,C;switch(this.type){case pt:C=E.length/4;const I=new Float32Array(C*4);for(let B=0;B<C;B++)x(E,B*4,I,B*4);w=I,_=pt;break;case xt:C=E.length/4;const b=new Uint16Array(C*4);for(let B=0;B<C;B++)d(E,B*4,b,B*4);w=b,_=xt;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:p,height:m,data:w,header:g.string,gamma:g.gamma,exposure:g.exposure,type:_}}setDataType(e){return this.type=e,this}load(e,t,i,r){function s(o,a){switch(o.type){case pt:case xt:"colorSpace"in o?o.colorSpace="srgb-linear":o.encoding=3e3,o.minFilter=lt,o.magFilter=lt,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,s,i,r)}}const ks="colorSpace"in new un;class z5 extends $f{constructor(e){super(e),this.type=xt}parse(e){const b=Math.pow(2.7182818,2.2);function B(M,F){for(var q=0,te=0;te<65536;++te)(te==0||M[te>>3]&1<<(te&7))&&(F[q++]=te);for(var ne=q-1;q<65536;)F[q++]=0;return ne}function Q(M){for(var F=0;F<16384;F++)M[F]={},M[F].len=0,M[F].lit=0,M[F].p=null}const S={l:0,c:0,lc:0};function k(M,F,q,te,ne){for(;q<M;)F=F<<8|Qi(te,ne),q+=8;q-=M,S.l=F>>q&(1<<M)-1,S.c=F,S.lc=q}const L=new Array(59);function O(M){for(var F=0;F<=58;++F)L[F]=0;for(var F=0;F<65537;++F)L[M[F]]+=1;for(var q=0,F=58;F>0;--F){var te=q+L[F]>>1;L[F]=q,q=te}for(var F=0;F<65537;++F){var ne=M[F];ne>0&&(M[F]=ne|L[ne]++<<6)}}function G(M,F,q,te,ne,ie,me){for(var fe=q,xe=0,ye=0;ne<=ie;ne++){if(fe.value-q.value>te)return!1;k(6,xe,ye,M,fe);var we=S.l;if(xe=S.c,ye=S.lc,me[ne]=we,we==63){if(fe.value-q.value>te)throw"Something wrong with hufUnpackEncTable";k(8,xe,ye,M,fe);var pe=S.l+6;if(xe=S.c,ye=S.lc,ne+pe>ie+1)throw"Something wrong with hufUnpackEncTable";for(;pe--;)me[ne++]=0;ne--}else if(we>=59){var pe=we-59+2;if(ne+pe>ie+1)throw"Something wrong with hufUnpackEncTable";for(;pe--;)me[ne++]=0;ne--}}O(me)}function V(M){return M&63}function N(M){return M>>6}function j(M,F,q,te){for(;F<=q;F++){var ne=N(M[F]),ie=V(M[F]);if(ne>>ie)throw"Invalid table entry";if(ie>14){var me=te[ne>>ie-14];if(me.len)throw"Invalid table entry";if(me.lit++,me.p){var fe=me.p;me.p=new Array(me.lit);for(var xe=0;xe<me.lit-1;++xe)me.p[xe]=fe[xe]}else me.p=new Array(1);me.p[me.lit-1]=F}else if(ie)for(var ye=0,xe=1<<14-ie;xe>0;xe--){var me=te[(ne<<14-ie)+ye];if(me.len||me.p)throw"Invalid table entry";me.len=ie,me.lit=F,ye++}}return!0}const Y={c:0,lc:0};function H(M,F,q,te){M=M<<8|Qi(q,te),F+=8,Y.c=M,Y.lc=F}const X={c:0,lc:0};function W(M,F,q,te,ne,ie,me,fe,xe,ye){if(M==F){te<8&&(H(q,te,ne,me),q=Y.c,te=Y.lc),te-=8;var we=q>>te,we=new Uint8Array([we])[0];if(xe.value+we>ye)return!1;for(var pe=fe[xe.value-1];we-- >0;)fe[xe.value++]=pe}else if(xe.value<ye)fe[xe.value++]=M;else return!1;X.c=q,X.lc=te}function P(M){return M&65535}function z(M){var F=P(M);return F>32767?F-65536:F}const D={a:0,b:0};function R(M,F){var q=z(M),te=z(F),ne=te,ie=q+(ne&1)+(ne>>1),me=ie,fe=ie-ne;D.a=me,D.b=fe}function $(M,F){var q=P(M),te=P(F),ne=q-(te>>1)&65535,ie=te+ne-32768&65535;D.a=ie,D.b=ne}function se(M,F,q,te,ne,ie,me){for(var fe=me<16384,xe=q>ne?ne:q,ye=1,we;ye<=xe;)ye<<=1;for(ye>>=1,we=ye,ye>>=1;ye>=1;){for(var pe=0,_t=pe+ie*(ne-we),Te=ie*ye,Re=ie*we,Ne=te*ye,qe=te*we,nt,ot,Rt,an;pe<=_t;pe+=Re){for(var at=pe,ii=pe+te*(q-we);at<=ii;at+=qe){var ft=at+Ne,Ht=at+Te,wi=Ht+Ne;fe?(R(M[at+F],M[Ht+F]),nt=D.a,Rt=D.b,R(M[ft+F],M[wi+F]),ot=D.a,an=D.b,R(nt,ot),M[at+F]=D.a,M[ft+F]=D.b,R(Rt,an),M[Ht+F]=D.a,M[wi+F]=D.b):($(M[at+F],M[Ht+F]),nt=D.a,Rt=D.b,$(M[ft+F],M[wi+F]),ot=D.a,an=D.b,$(nt,ot),M[at+F]=D.a,M[ft+F]=D.b,$(Rt,an),M[Ht+F]=D.a,M[wi+F]=D.b)}if(q&ye){var Ht=at+Te;fe?R(M[at+F],M[Ht+F]):$(M[at+F],M[Ht+F]),nt=D.a,M[Ht+F]=D.b,M[at+F]=nt}}if(ne&ye)for(var at=pe,ii=pe+te*(q-we);at<=ii;at+=qe){var ft=at+Ne;fe?R(M[at+F],M[ft+F]):$(M[at+F],M[ft+F]),nt=D.a,M[ft+F]=D.b,M[at+F]=nt}we=ye,ye>>=1}return pe}function Z(M,F,q,te,ne,ie,me,fe,xe,ye){for(var we=0,pe=0,_t=fe,Te=Math.trunc(ne.value+(ie+7)/8);ne.value<Te;)for(H(we,pe,q,ne),we=Y.c,pe=Y.lc;pe>=14;){var Re=we>>pe-14&16383,Ne=F[Re];if(Ne.len)pe-=Ne.len,W(Ne.lit,me,we,pe,q,te,ne,xe,ye,_t),we=X.c,pe=X.lc;else{if(!Ne.p)throw"hufDecode issues";var qe;for(qe=0;qe<Ne.lit;qe++){for(var nt=V(M[Ne.p[qe]]);pe<nt&&ne.value<Te;)H(we,pe,q,ne),we=Y.c,pe=Y.lc;if(pe>=nt&&N(M[Ne.p[qe]])==(we>>pe-nt&(1<<nt)-1)){pe-=nt,W(Ne.p[qe],me,we,pe,q,te,ne,xe,ye,_t),we=X.c,pe=X.lc;break}}if(qe==Ne.lit)throw"hufDecode issues"}}var ot=8-ie&7;for(we>>=ot,pe-=ot;pe>0;){var Ne=F[we<<14-pe&16383];if(Ne.len)pe-=Ne.len,W(Ne.lit,me,we,pe,q,te,ne,xe,ye,_t),we=X.c,pe=X.lc;else throw"hufDecode issues"}return!0}function oe(M,F,q,te,ne,ie){var me={value:0},fe=q.value,xe=wt(F,q),ye=wt(F,q);q.value+=4;var we=wt(F,q);if(q.value+=4,xe<0||xe>=65537||ye<0||ye>=65537)throw"Something wrong with HUF_ENCSIZE";var pe=new Array(65537),_t=new Array(16384);Q(_t);var Te=te-(q.value-fe);if(G(M,F,q,Te,xe,ye,pe),we>8*(te-(q.value-fe)))throw"Something wrong with hufUncompress";j(pe,xe,ye,_t),Z(pe,_t,M,F,q,we,ye,ie,ne,me)}function Ae(M,F,q){for(var te=0;te<q;++te)F[te]=M[F[te]]}function de(M){for(var F=1;F<M.length;F++){var q=M[F-1]+M[F]-128;M[F]=q}}function le(M,F){for(var q=0,te=Math.floor((M.length+1)/2),ne=0,ie=M.length-1;!(ne>ie||(F[ne++]=M[q++],ne>ie));)F[ne++]=M[te++]}function he(M){for(var F=M.byteLength,q=new Array,te=0,ne=new DataView(M);F>0;){var ie=ne.getInt8(te++);if(ie<0){var me=-ie;F-=me+1;for(var fe=0;fe<me;fe++)q.push(ne.getUint8(te++))}else{var me=ie;F-=2;for(var xe=ne.getUint8(te++),fe=0;fe<me+1;fe++)q.push(xe)}}return q}function Ie(M,F,q,te,ne,ie){var ft=new DataView(ie.buffer),me=q[M.idx[0]].width,fe=q[M.idx[0]].height,xe=3,ye=Math.floor(me/8),we=Math.ceil(me/8),pe=Math.ceil(fe/8),_t=me-(we-1)*8,Te=fe-(pe-1)*8,Re={value:0},Ne=new Array(xe),qe=new Array(xe),nt=new Array(xe),ot=new Array(xe),Rt=new Array(xe);for(let it=0;it<xe;++it)Rt[it]=F[M.idx[it]],Ne[it]=it<1?0:Ne[it-1]+we*pe,qe[it]=new Float32Array(64),nt[it]=new Uint16Array(64),ot[it]=new Uint16Array(we*64);for(let it=0;it<pe;++it){var an=8;it==pe-1&&(an=Te);var at=8;for(let vt=0;vt<we;++vt){vt==we-1&&(at=_t);for(let et=0;et<xe;++et)nt[et].fill(0),nt[et][0]=ne[Ne[et]++],Be(Re,te,nt[et]),K(nt[et],qe[et]),U(qe[et]);ge(qe);for(let et=0;et<xe;++et)Ue(qe[et],ot[et],vt*64)}let rn=0;for(let vt=0;vt<xe;++vt){const et=q[M.idx[vt]].type;for(let Bn=8*it;Bn<8*it+an;++Bn){rn=Rt[vt][Bn];for(let tr=0;tr<ye;++tr){const yn=tr*64+(Bn&7)*8;ft.setUint16(rn+0*2*et,ot[vt][yn+0],!0),ft.setUint16(rn+1*2*et,ot[vt][yn+1],!0),ft.setUint16(rn+2*2*et,ot[vt][yn+2],!0),ft.setUint16(rn+3*2*et,ot[vt][yn+3],!0),ft.setUint16(rn+4*2*et,ot[vt][yn+4],!0),ft.setUint16(rn+5*2*et,ot[vt][yn+5],!0),ft.setUint16(rn+6*2*et,ot[vt][yn+6],!0),ft.setUint16(rn+7*2*et,ot[vt][yn+7],!0),rn+=8*2*et}}if(ye!=we)for(let Bn=8*it;Bn<8*it+an;++Bn){const tr=Rt[vt][Bn]+8*ye*2*et,yn=ye*64+(Bn&7)*8;for(let Ri=0;Ri<at;++Ri)ft.setUint16(tr+Ri*2*et,ot[vt][yn+Ri],!0)}}}for(var ii=new Uint16Array(me),ft=new DataView(ie.buffer),Ht=0;Ht<xe;++Ht){q[M.idx[Ht]].decoded=!0;var wi=q[M.idx[Ht]].type;if(q[Ht].type==2)for(var ps=0;ps<fe;++ps){const it=Rt[Ht][ps];for(var In=0;In<me;++In)ii[In]=ft.getUint16(it+In*2*wi,!0);for(var In=0;In<me;++In)ft.setFloat32(it+In*2*wi,Ce(ii[In]),!0)}}}function Be(M,F,q){for(var te,ne=1;ne<64;)te=F[M.value],te==65280?ne=64:te>>8==255?ne+=te&255:(q[ne]=te,ne++),M.value++}function K(M,F){F[0]=Ce(M[0]),F[1]=Ce(M[1]),F[2]=Ce(M[5]),F[3]=Ce(M[6]),F[4]=Ce(M[14]),F[5]=Ce(M[15]),F[6]=Ce(M[27]),F[7]=Ce(M[28]),F[8]=Ce(M[2]),F[9]=Ce(M[4]),F[10]=Ce(M[7]),F[11]=Ce(M[13]),F[12]=Ce(M[16]),F[13]=Ce(M[26]),F[14]=Ce(M[29]),F[15]=Ce(M[42]),F[16]=Ce(M[3]),F[17]=Ce(M[8]),F[18]=Ce(M[12]),F[19]=Ce(M[17]),F[20]=Ce(M[25]),F[21]=Ce(M[30]),F[22]=Ce(M[41]),F[23]=Ce(M[43]),F[24]=Ce(M[9]),F[25]=Ce(M[11]),F[26]=Ce(M[18]),F[27]=Ce(M[24]),F[28]=Ce(M[31]),F[29]=Ce(M[40]),F[30]=Ce(M[44]),F[31]=Ce(M[53]),F[32]=Ce(M[10]),F[33]=Ce(M[19]),F[34]=Ce(M[23]),F[35]=Ce(M[32]),F[36]=Ce(M[39]),F[37]=Ce(M[45]),F[38]=Ce(M[52]),F[39]=Ce(M[54]),F[40]=Ce(M[20]),F[41]=Ce(M[22]),F[42]=Ce(M[33]),F[43]=Ce(M[38]),F[44]=Ce(M[46]),F[45]=Ce(M[51]),F[46]=Ce(M[55]),F[47]=Ce(M[60]),F[48]=Ce(M[21]),F[49]=Ce(M[34]),F[50]=Ce(M[37]),F[51]=Ce(M[47]),F[52]=Ce(M[50]),F[53]=Ce(M[56]),F[54]=Ce(M[59]),F[55]=Ce(M[61]),F[56]=Ce(M[35]),F[57]=Ce(M[36]),F[58]=Ce(M[48]),F[59]=Ce(M[49]),F[60]=Ce(M[57]),F[61]=Ce(M[58]),F[62]=Ce(M[62]),F[63]=Ce(M[63])}function U(M){const F=.5*Math.cos(.7853975),q=.5*Math.cos(3.14159/16),te=.5*Math.cos(3.14159/8),ne=.5*Math.cos(3*3.14159/16),ie=.5*Math.cos(5*3.14159/16),me=.5*Math.cos(3*3.14159/8),fe=.5*Math.cos(7*3.14159/16);for(var xe=new Array(4),ye=new Array(4),we=new Array(4),pe=new Array(4),_t=0;_t<8;++_t){var Te=_t*8;xe[0]=te*M[Te+2],xe[1]=me*M[Te+2],xe[2]=te*M[Te+6],xe[3]=me*M[Te+6],ye[0]=q*M[Te+1]+ne*M[Te+3]+ie*M[Te+5]+fe*M[Te+7],ye[1]=ne*M[Te+1]-fe*M[Te+3]-q*M[Te+5]-ie*M[Te+7],ye[2]=ie*M[Te+1]-q*M[Te+3]+fe*M[Te+5]+ne*M[Te+7],ye[3]=fe*M[Te+1]-ie*M[Te+3]+ne*M[Te+5]-q*M[Te+7],we[0]=F*(M[Te+0]+M[Te+4]),we[3]=F*(M[Te+0]-M[Te+4]),we[1]=xe[0]+xe[3],we[2]=xe[1]-xe[2],pe[0]=we[0]+we[1],pe[1]=we[3]+we[2],pe[2]=we[3]-we[2],pe[3]=we[0]-we[1],M[Te+0]=pe[0]+ye[0],M[Te+1]=pe[1]+ye[1],M[Te+2]=pe[2]+ye[2],M[Te+3]=pe[3]+ye[3],M[Te+4]=pe[3]-ye[3],M[Te+5]=pe[2]-ye[2],M[Te+6]=pe[1]-ye[1],M[Te+7]=pe[0]-ye[0]}for(var Re=0;Re<8;++Re)xe[0]=te*M[16+Re],xe[1]=me*M[16+Re],xe[2]=te*M[48+Re],xe[3]=me*M[48+Re],ye[0]=q*M[8+Re]+ne*M[24+Re]+ie*M[40+Re]+fe*M[56+Re],ye[1]=ne*M[8+Re]-fe*M[24+Re]-q*M[40+Re]-ie*M[56+Re],ye[2]=ie*M[8+Re]-q*M[24+Re]+fe*M[40+Re]+ne*M[56+Re],ye[3]=fe*M[8+Re]-ie*M[24+Re]+ne*M[40+Re]-q*M[56+Re],we[0]=F*(M[Re]+M[32+Re]),we[3]=F*(M[Re]-M[32+Re]),we[1]=xe[0]+xe[3],we[2]=xe[1]-xe[2],pe[0]=we[0]+we[1],pe[1]=we[3]+we[2],pe[2]=we[3]-we[2],pe[3]=we[0]-we[1],M[0+Re]=pe[0]+ye[0],M[8+Re]=pe[1]+ye[1],M[16+Re]=pe[2]+ye[2],M[24+Re]=pe[3]+ye[3],M[32+Re]=pe[3]-ye[3],M[40+Re]=pe[2]-ye[2],M[48+Re]=pe[1]-ye[1],M[56+Re]=pe[0]-ye[0]}function ge(M){for(var F=0;F<64;++F){var q=M[0][F],te=M[1][F],ne=M[2][F];M[0][F]=q+1.5747*ne,M[1][F]=q-.1873*te-.4682*ne,M[2][F]=q+1.8556*te}}function Ue(M,F,q){for(var te=0;te<64;++te)F[q+te]=Jr.toHalfFloat(yt(M[te]))}function yt(M){return M<=1?Math.sign(M)*Math.pow(Math.abs(M),2.2):Math.sign(M)*Math.pow(b,Math.abs(M)-1)}function bt(M){return new DataView(M.array.buffer,M.offset.value,M.size)}function Me(M){var F=M.viewer.buffer.slice(M.offset.value,M.offset.value+M.size),q=new Uint8Array(he(F)),te=new Uint8Array(q.length);return de(q),le(q,te),new DataView(te.buffer)}function Qe(M){var F=M.array.slice(M.offset.value,M.offset.value+M.size),q=so(F),te=new Uint8Array(q.length);return de(q),le(q,te),new DataView(te.buffer)}function je(M){for(var F=M.viewer,q={value:M.offset.value},te=new Uint16Array(M.width*M.scanlineBlockSize*(M.channels*M.type)),ne=new Uint8Array(8192),ie=0,me=new Array(M.channels),fe=0;fe<M.channels;fe++)me[fe]={},me[fe].start=ie,me[fe].end=me[fe].start,me[fe].nx=M.width,me[fe].ny=M.lines,me[fe].size=M.type,ie+=me[fe].nx*me[fe].ny*me[fe].size;var xe=Hn(F,q),ye=Hn(F,q);if(ye>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(xe<=ye)for(var fe=0;fe<ye-xe+1;fe++)ne[fe+xe]=Gn(F,q);var we=new Uint16Array(65536),pe=B(ne,we),_t=wt(F,q);oe(M.array,F,q,_t,te,ie);for(var fe=0;fe<M.channels;++fe)for(var Te=me[fe],Re=0;Re<me[fe].size;++Re)se(te,Te.start+Re,Te.nx,Te.size,Te.ny,Te.nx*Te.size,pe);Ae(we,te,ie);for(var Ne=0,qe=new Uint8Array(te.buffer.byteLength),nt=0;nt<M.lines;nt++)for(var ot=0;ot<M.channels;ot++){var Te=me[ot],Rt=Te.nx*Te.size,an=new Uint8Array(te.buffer,Te.end*2,Rt*2);qe.set(an,Ne),Ne+=Rt*2,Te.end+=Rt}return new DataView(qe.buffer)}function Ve(M){var F=M.array.slice(M.offset.value,M.offset.value+M.size),q=so(F);const te=M.lines*M.channels*M.width,ne=M.type==1?new Uint16Array(te):new Uint32Array(te);let ie=0,me=0;const fe=new Array(4);for(let xe=0;xe<M.lines;xe++)for(let ye=0;ye<M.channels;ye++){let we=0;switch(M.type){case 1:fe[0]=ie,fe[1]=fe[0]+M.width,ie=fe[1]+M.width;for(let pe=0;pe<M.width;++pe){const _t=q[fe[0]++]<<8|q[fe[1]++];we+=_t,ne[me]=we,me++}break;case 2:fe[0]=ie,fe[1]=fe[0]+M.width,fe[2]=fe[1]+M.width,ie=fe[2]+M.width;for(let pe=0;pe<M.width;++pe){const _t=q[fe[0]++]<<24|q[fe[1]++]<<16|q[fe[2]++]<<8;we+=_t,ne[me]=we,me++}break}}return new DataView(ne.buffer)}function st(M){var F=M.viewer,q={value:M.offset.value},te=new Uint8Array(M.width*M.lines*(M.channels*M.type*2)),ne={version:nn(F,q),unknownUncompressedSize:nn(F,q),unknownCompressedSize:nn(F,q),acCompressedSize:nn(F,q),dcCompressedSize:nn(F,q),rleCompressedSize:nn(F,q),rleUncompressedSize:nn(F,q),rleRawSize:nn(F,q),totalAcUncompressedCount:nn(F,q),totalDcUncompressedCount:nn(F,q),acCompression:nn(F,q)};if(ne.version<2)throw"EXRLoader.parse: "+ms.compression+" version "+ne.version+" is unsupported";for(var ie=new Array,me=Hn(F,q)-2;me>0;){var fe=ut(F.buffer,q),xe=Gn(F,q),ye=xe>>2&3,we=(xe>>4)-1,pe=new Int8Array([we])[0],_t=Gn(F,q);ie.push({name:fe,index:pe,type:_t,compression:ye}),me-=fe.length+3}for(var Te=ms.channels,Re=new Array(M.channels),Ne=0;Ne<M.channels;++Ne){var qe=Re[Ne]={},nt=Te[Ne];qe.name=nt.name,qe.compression=0,qe.decoded=!1,qe.type=nt.pixelType,qe.pLinear=nt.pLinear,qe.width=M.width,qe.height=M.lines}for(var ot={idx:new Array(3)},Rt=0;Rt<M.channels;++Rt)for(var qe=Re[Rt],Ne=0;Ne<ie.length;++Ne){var an=ie[Ne];qe.name==an.name&&(qe.compression=an.compression,an.index>=0&&(ot.idx[an.index]=Rt),qe.offset=Rt)}if(ne.acCompressedSize>0)switch(ne.acCompression){case 0:var ft=new Uint16Array(ne.totalAcUncompressedCount);oe(M.array,F,q,ne.acCompressedSize,ft,ne.totalAcUncompressedCount);break;case 1:var at=M.array.slice(q.value,q.value+ne.totalAcUncompressedCount),ii=so(at),ft=new Uint16Array(ii.buffer);q.value+=ne.totalAcUncompressedCount;break}if(ne.dcCompressedSize>0){var Ht={array:M.array,offset:q,size:ne.dcCompressedSize},wi=new Uint16Array(Qe(Ht).buffer);q.value+=ne.dcCompressedSize}if(ne.rleRawSize>0){var at=M.array.slice(q.value,q.value+ne.rleCompressedSize),ii=so(at),ps=he(ii.buffer);q.value+=ne.rleCompressedSize}for(var In=0,it=new Array(Re.length),Ne=0;Ne<it.length;++Ne)it[Ne]=new Array;for(var rn=0;rn<M.lines;++rn)for(var vt=0;vt<Re.length;++vt)it[vt].push(In),In+=Re[vt].width*M.type*2;Ie(ot,it,Re,ft,wi,te);for(var Ne=0;Ne<Re.length;++Ne){var qe=Re[Ne];if(!qe.decoded)switch(qe.compression){case 2:for(var et=0,Bn=0,rn=0;rn<M.lines;++rn){for(var tr=it[Ne][et],yn=0;yn<qe.width;++yn){for(var Ri=0;Ri<2*qe.type;++Ri)te[tr++]=ps[Bn+Ri*qe.width*qe.height];Bn++}et++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(te.buffer)}function ut(M,F){for(var q=new Uint8Array(M),te=0;q[F.value+te]!=0;)te+=1;var ne=new TextDecoder().decode(q.slice(F.value,F.value+te));return F.value=F.value+te+1,ne}function Nt(M,F,q){var te=new TextDecoder().decode(new Uint8Array(M).slice(F.value,F.value+q));return F.value=F.value+q,te}function Gt(M,F){var q=gn(M,F),te=wt(M,F);return[q,te]}function fn(M,F){var q=wt(M,F),te=wt(M,F);return[q,te]}function gn(M,F){var q=M.getInt32(F.value,!0);return F.value=F.value+4,q}function wt(M,F){var q=M.getUint32(F.value,!0);return F.value=F.value+4,q}function Qi(M,F){var q=M[F.value];return F.value=F.value+1,q}function Gn(M,F){var q=M.getUint8(F.value);return F.value=F.value+1,q}const nn=function(M,F){let q;return"getBigInt64"in DataView.prototype?q=Number(M.getBigInt64(F.value,!0)):q=M.getUint32(F.value+4,!0)+Number(M.getUint32(F.value,!0)<<32),F.value+=8,q};function ht(M,F){var q=M.getFloat32(F.value,!0);return F.value+=4,q}function ni(M,F){return Jr.toHalfFloat(ht(M,F))}function Ce(M){var F=(M&31744)>>10,q=M&1023;return(M>>15?-1:1)*(F?F===31?q?NaN:1/0:Math.pow(2,F-15)*(1+q/1024):6103515625e-14*(q/1024))}function Hn(M,F){var q=M.getUint16(F.value,!0);return F.value+=2,q}function er(M,F){return Ce(Hn(M,F))}function Fm(M,F,q,te){for(var ne=q.value,ie=[];q.value<ne+te-1;){var me=ut(F,q),fe=gn(M,q),xe=Gn(M,q);q.value+=3;var ye=gn(M,q),we=gn(M,q);ie.push({name:me,pixelType:fe,pLinear:xe,xSampling:ye,ySampling:we})}return q.value+=1,ie}function Lm(M,F){var q=ht(M,F),te=ht(M,F),ne=ht(M,F),ie=ht(M,F),me=ht(M,F),fe=ht(M,F),xe=ht(M,F),ye=ht(M,F);return{redX:q,redY:te,greenX:ne,greenY:ie,blueX:me,blueY:fe,whiteX:xe,whiteY:ye}}function km(M,F){var q=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],te=Gn(M,F);return q[te]}function Om(M,F){var q=wt(M,F),te=wt(M,F),ne=wt(M,F),ie=wt(M,F);return{xMin:q,yMin:te,xMax:ne,yMax:ie}}function Um(M,F){var q=["INCREASING_Y"],te=Gn(M,F);return q[te]}function Nm(M,F){var q=ht(M,F),te=ht(M,F);return[q,te]}function Gm(M,F){var q=ht(M,F),te=ht(M,F),ne=ht(M,F);return[q,te,ne]}function Hm(M,F,q,te,ne){if(te==="string"||te==="stringvector"||te==="iccProfile")return Nt(F,q,ne);if(te==="chlist")return Fm(M,F,q,ne);if(te==="chromaticities")return Lm(M,q);if(te==="compression")return km(M,q);if(te==="box2i")return Om(M,q);if(te==="lineOrder")return Um(M,q);if(te==="float")return ht(M,q);if(te==="v2f")return Nm(M,q);if(te==="v3f")return Gm(M,q);if(te==="int")return gn(M,q);if(te==="rational")return Gt(M,q);if(te==="timecode")return fn(M,q);if(te==="preview")return q.value+=ne,"skipped";q.value+=ne}function Vm(M,F,q){const te={};if(M.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";te.version=M.getUint8(4);const ne=M.getUint8(5);te.spec={singleTile:!!(ne&2),longName:!!(ne&4),deepFormat:!!(ne&8),multiPart:!!(ne&16)},q.value=8;for(var ie=!0;ie;){var me=ut(F,q);if(me==0)ie=!1;else{var fe=ut(F,q),xe=wt(M,q),ye=Hm(M,F,q,fe,xe);ye===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${fe}'.`):te[me]=ye}}if(ne&-5)throw console.error("EXRHeader:",te),"THREE.EXRLoader: provided file is currently unsupported.";return te}function qm(M,F,q,te,ne){const ie={size:0,viewer:F,array:q,offset:te,width:M.dataWindow.xMax-M.dataWindow.xMin+1,height:M.dataWindow.yMax-M.dataWindow.yMin+1,channels:M.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:M.channels[0].pixelType,uncompress:null,getter:null,format:null,[ks?"colorSpace":"encoding"]:null};switch(M.compression){case"NO_COMPRESSION":ie.lines=1,ie.uncompress=bt;break;case"RLE_COMPRESSION":ie.lines=1,ie.uncompress=Me;break;case"ZIPS_COMPRESSION":ie.lines=1,ie.uncompress=Qe;break;case"ZIP_COMPRESSION":ie.lines=16,ie.uncompress=Qe;break;case"PIZ_COMPRESSION":ie.lines=32,ie.uncompress=je;break;case"PXR24_COMPRESSION":ie.lines=16,ie.uncompress=Ve;break;case"DWAA_COMPRESSION":ie.lines=32,ie.uncompress=st;break;case"DWAB_COMPRESSION":ie.lines=256,ie.uncompress=st;break;default:throw"EXRLoader.parse: "+M.compression+" is unsupported"}if(ie.scanlineBlockSize=ie.lines,ie.type==1)switch(ne){case pt:ie.getter=er,ie.inputSize=2;break;case xt:ie.getter=Hn,ie.inputSize=2;break}else if(ie.type==2)switch(ne){case pt:ie.getter=ht,ie.inputSize=4;break;case xt:ie.getter=ni,ie.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+ie.type+" for "+M.compression+".";ie.blockCount=(M.dataWindow.yMax+1)/ie.scanlineBlockSize;for(var me=0;me<ie.blockCount;me++)nn(F,te);ie.outputChannels=ie.channels==3?4:ie.channels;const fe=ie.width*ie.height*ie.outputChannels;switch(ne){case pt:ie.byteArray=new Float32Array(fe),ie.channels<ie.outputChannels&&ie.byteArray.fill(1,0,fe);break;case xt:ie.byteArray=new Uint16Array(fe),ie.channels<ie.outputChannels&&ie.byteArray.fill(15360,0,fe);break;default:console.error("THREE.EXRLoader: unsupported type: ",ne);break}return ie.bytesPerLine=ie.width*ie.inputSize*ie.channels,ie.outputChannels==4?ie.format=Lt:ie.format=pi,ks?ie.colorSpace="srgb-linear":ie.encoding=3e3,ie}const Fo=new DataView(e),Ym=new Uint8Array(e),ds={value:0},ms=Vm(Fo,e,ds),We=qm(ms,Fo,Ym,ds,this.type),_0={value:0},jm={R:0,G:1,B:2,A:3,Y:0};for(let M=0;M<We.height/We.scanlineBlockSize;M++){const F=wt(Fo,ds);We.size=wt(Fo,ds),We.lines=F+We.scanlineBlockSize>We.height?We.height-F:We.scanlineBlockSize;const te=We.size<We.lines*We.bytesPerLine?We.uncompress(We):bt(We);ds.value+=We.size;for(let ne=0;ne<We.scanlineBlockSize;ne++){const ie=ne+M*We.scanlineBlockSize;if(ie>=We.height)break;for(let me=0;me<We.channels;me++){const fe=jm[ms.channels[me].name];for(let xe=0;xe<We.width;xe++){_0.value=(ne*(We.channels*We.width)+me*We.width+xe)*We.inputSize;const ye=(We.height-1-ie)*(We.width*We.outputChannels)+xe*We.outputChannels+fe;We.byteArray[ye]=We.getter(te,_0)}}}}return{header:ms,width:We.width,height:We.height,data:We.byteArray,format:We.format,[ks?"colorSpace":"encoding"]:We[ks?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,i,r){function s(o,a){ks?o.colorSpace=a.colorSpace:o.encoding=a.encoding,o.minFilter=lt,o.magFilter=lt,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)}return super.load(e,s,i,r)}}const F5="srgb";class go extends hs{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,i,r){const s=this,o=new gi(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(a))}catch(c){r?r(c):console.error(c),s.manager.itemError(e)}},i,r)}parse(e){const t=this;function i(P,z){if(P.nodeType!==1)return;const D=E(P);let R=!1,$=null;switch(P.nodeName){case"svg":z=x(P,z);break;case"style":s(P);break;case"g":z=x(P,z);break;case"path":z=x(P,z),P.hasAttribute("d")&&($=r(P));break;case"rect":z=x(P,z),$=c(P);break;case"polygon":z=x(P,z),$=u(P);break;case"polyline":z=x(P,z),$=f(P);break;case"circle":z=x(P,z),$=h(P);break;case"ellipse":z=x(P,z),$=A(P);break;case"line":z=x(P,z),$=y(P);break;case"defs":R=!0;break;case"use":z=x(P,z);const oe=(P.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),Ae=P.viewportElement.getElementById(oe);Ae?i(Ae,z):console.warn("SVGLoader: 'use node' references non-existent node id: "+oe);break}$&&(z.fill!==void 0&&z.fill!=="none"&&$.color.setStyle(z.fill,F5),_($,H),S.push($),$.userData={node:P,style:z});const se=P.childNodes;for(let Z=0;Z<se.length;Z++){const oe=se[Z];R&&oe.nodeName!=="style"&&oe.nodeName!=="defs"||i(oe,z)}D&&(L.pop(),L.length>0?H.copy(L[L.length-1]):H.identity())}function r(P){const z=new Oi,D=new _e,R=new _e,$=new _e;let se=!0,Z=!1;const oe=P.getAttribute("d");if(oe===""||oe==="none")return null;const Ae=oe.match(/[a-df-z][^a-df-z]*/gi);for(let de=0,le=Ae.length;de<le;de++){const he=Ae[de],Ie=he.charAt(0),Be=he.slice(1).trim();se===!0&&(Z=!0,se=!1);let K;switch(Ie){case"M":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=2)D.x=K[U+0],D.y=K[U+1],R.x=D.x,R.y=D.y,U===0?z.moveTo(D.x,D.y):z.lineTo(D.x,D.y),U===0&&$.copy(D);break;case"H":K=v(Be);for(let U=0,ge=K.length;U<ge;U++)D.x=K[U],R.x=D.x,R.y=D.y,z.lineTo(D.x,D.y),U===0&&Z===!0&&$.copy(D);break;case"V":K=v(Be);for(let U=0,ge=K.length;U<ge;U++)D.y=K[U],R.x=D.x,R.y=D.y,z.lineTo(D.x,D.y),U===0&&Z===!0&&$.copy(D);break;case"L":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=2)D.x=K[U+0],D.y=K[U+1],R.x=D.x,R.y=D.y,z.lineTo(D.x,D.y),U===0&&Z===!0&&$.copy(D);break;case"C":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=6)z.bezierCurveTo(K[U+0],K[U+1],K[U+2],K[U+3],K[U+4],K[U+5]),R.x=K[U+2],R.y=K[U+3],D.x=K[U+4],D.y=K[U+5],U===0&&Z===!0&&$.copy(D);break;case"S":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=4)z.bezierCurveTo(d(D.x,R.x),d(D.y,R.y),K[U+0],K[U+1],K[U+2],K[U+3]),R.x=K[U+0],R.y=K[U+1],D.x=K[U+2],D.y=K[U+3],U===0&&Z===!0&&$.copy(D);break;case"Q":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=4)z.quadraticCurveTo(K[U+0],K[U+1],K[U+2],K[U+3]),R.x=K[U+0],R.y=K[U+1],D.x=K[U+2],D.y=K[U+3],U===0&&Z===!0&&$.copy(D);break;case"T":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=2){const Ue=d(D.x,R.x),yt=d(D.y,R.y);z.quadraticCurveTo(Ue,yt,K[U+0],K[U+1]),R.x=Ue,R.y=yt,D.x=K[U+0],D.y=K[U+1],U===0&&Z===!0&&$.copy(D)}break;case"A":K=v(Be,[3,4],7);for(let U=0,ge=K.length;U<ge;U+=7){if(K[U+5]==D.x&&K[U+6]==D.y)continue;const Ue=D.clone();D.x=K[U+5],D.y=K[U+6],R.x=D.x,R.y=D.y,o(z,K[U],K[U+1],K[U+2],K[U+3],K[U+4],Ue,D),U===0&&Z===!0&&$.copy(D)}break;case"m":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=2)D.x+=K[U+0],D.y+=K[U+1],R.x=D.x,R.y=D.y,U===0?z.moveTo(D.x,D.y):z.lineTo(D.x,D.y),U===0&&$.copy(D);break;case"h":K=v(Be);for(let U=0,ge=K.length;U<ge;U++)D.x+=K[U],R.x=D.x,R.y=D.y,z.lineTo(D.x,D.y),U===0&&Z===!0&&$.copy(D);break;case"v":K=v(Be);for(let U=0,ge=K.length;U<ge;U++)D.y+=K[U],R.x=D.x,R.y=D.y,z.lineTo(D.x,D.y),U===0&&Z===!0&&$.copy(D);break;case"l":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=2)D.x+=K[U+0],D.y+=K[U+1],R.x=D.x,R.y=D.y,z.lineTo(D.x,D.y),U===0&&Z===!0&&$.copy(D);break;case"c":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=6)z.bezierCurveTo(D.x+K[U+0],D.y+K[U+1],D.x+K[U+2],D.y+K[U+3],D.x+K[U+4],D.y+K[U+5]),R.x=D.x+K[U+2],R.y=D.y+K[U+3],D.x+=K[U+4],D.y+=K[U+5],U===0&&Z===!0&&$.copy(D);break;case"s":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=4)z.bezierCurveTo(d(D.x,R.x),d(D.y,R.y),D.x+K[U+0],D.y+K[U+1],D.x+K[U+2],D.y+K[U+3]),R.x=D.x+K[U+0],R.y=D.y+K[U+1],D.x+=K[U+2],D.y+=K[U+3],U===0&&Z===!0&&$.copy(D);break;case"q":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=4)z.quadraticCurveTo(D.x+K[U+0],D.y+K[U+1],D.x+K[U+2],D.y+K[U+3]),R.x=D.x+K[U+0],R.y=D.y+K[U+1],D.x+=K[U+2],D.y+=K[U+3],U===0&&Z===!0&&$.copy(D);break;case"t":K=v(Be);for(let U=0,ge=K.length;U<ge;U+=2){const Ue=d(D.x,R.x),yt=d(D.y,R.y);z.quadraticCurveTo(Ue,yt,D.x+K[U+0],D.y+K[U+1]),R.x=Ue,R.y=yt,D.x=D.x+K[U+0],D.y=D.y+K[U+1],U===0&&Z===!0&&$.copy(D)}break;case"a":K=v(Be,[3,4],7);for(let U=0,ge=K.length;U<ge;U+=7){if(K[U+5]==0&&K[U+6]==0)continue;const Ue=D.clone();D.x+=K[U+5],D.y+=K[U+6],R.x=D.x,R.y=D.y,o(z,K[U],K[U+1],K[U+2],K[U+3],K[U+4],Ue,D),U===0&&Z===!0&&$.copy(D)}break;case"Z":case"z":z.currentPath.autoClose=!0,z.currentPath.curves.length>0&&(D.copy($),z.currentPath.currentPoint.copy(D),se=!0);break;default:console.warn(he)}Z=!1}return z}function s(P){if(!(!P.sheet||!P.sheet.cssRules||!P.sheet.cssRules.length))for(let z=0;z<P.sheet.cssRules.length;z++){const D=P.sheet.cssRules[z];if(D.type!==1)continue;const R=D.selectorText.split(/,/gm).filter(Boolean).map($=>$.trim());for(let $=0;$<R.length;$++){const se=Object.fromEntries(Object.entries(D.style).filter(([,Z])=>Z!==""));k[R[$]]=Object.assign(k[R[$]]||{},se)}}}function o(P,z,D,R,$,se,Z,oe){if(z==0||D==0){P.lineTo(oe.x,oe.y);return}R=R*Math.PI/180,z=Math.abs(z),D=Math.abs(D);const Ae=(Z.x-oe.x)/2,de=(Z.y-oe.y)/2,le=Math.cos(R)*Ae+Math.sin(R)*de,he=-Math.sin(R)*Ae+Math.cos(R)*de;let Ie=z*z,Be=D*D;const K=le*le,U=he*he,ge=K/Ie+U/Be;if(ge>1){const Nt=Math.sqrt(ge);z=Nt*z,D=Nt*D,Ie=z*z,Be=D*D}const Ue=Ie*U+Be*K,yt=(Ie*Be-Ue)/Ue;let bt=Math.sqrt(Math.max(0,yt));$===se&&(bt=-bt);const Me=bt*z*he/D,Qe=-bt*D*le/z,je=Math.cos(R)*Me-Math.sin(R)*Qe+(Z.x+oe.x)/2,Ve=Math.sin(R)*Me+Math.cos(R)*Qe+(Z.y+oe.y)/2,st=a(1,0,(le-Me)/z,(he-Qe)/D),ut=a((le-Me)/z,(he-Qe)/D,(-le-Me)/z,(-he-Qe)/D)%(Math.PI*2);P.currentPath.absellipse(je,Ve,z,D,st,st+ut,se===0,R)}function a(P,z,D,R){const $=P*D+z*R,se=Math.sqrt(P*P+z*z)*Math.sqrt(D*D+R*R);let Z=Math.acos(Math.max(-1,Math.min(1,$/se)));return P*R-z*D<0&&(Z=-Z),Z}function c(P){const z=m(P.getAttribute("x")||0),D=m(P.getAttribute("y")||0),R=m(P.getAttribute("rx")||P.getAttribute("ry")||0),$=m(P.getAttribute("ry")||P.getAttribute("rx")||0),se=m(P.getAttribute("width")),Z=m(P.getAttribute("height")),oe=1-.551915024494,Ae=new Oi;return Ae.moveTo(z+R,D),Ae.lineTo(z+se-R,D),(R!==0||$!==0)&&Ae.bezierCurveTo(z+se-R*oe,D,z+se,D+$*oe,z+se,D+$),Ae.lineTo(z+se,D+Z-$),(R!==0||$!==0)&&Ae.bezierCurveTo(z+se,D+Z-$*oe,z+se-R*oe,D+Z,z+se-R,D+Z),Ae.lineTo(z+R,D+Z),(R!==0||$!==0)&&Ae.bezierCurveTo(z+R*oe,D+Z,z,D+Z-$*oe,z,D+Z-$),Ae.lineTo(z,D+$),(R!==0||$!==0)&&Ae.bezierCurveTo(z,D+$*oe,z+R*oe,D,z+R,D),Ae}function u(P){function z(se,Z,oe){const Ae=m(Z),de=m(oe);$===0?R.moveTo(Ae,de):R.lineTo(Ae,de),$++}const D=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,R=new Oi;let $=0;return P.getAttribute("points").replace(D,z),R.currentPath.autoClose=!0,R}function f(P){function z(se,Z,oe){const Ae=m(Z),de=m(oe);$===0?R.moveTo(Ae,de):R.lineTo(Ae,de),$++}const D=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,R=new Oi;let $=0;return P.getAttribute("points").replace(D,z),R.currentPath.autoClose=!1,R}function h(P){const z=m(P.getAttribute("cx")||0),D=m(P.getAttribute("cy")||0),R=m(P.getAttribute("r")||0),$=new Bc;$.absarc(z,D,R,0,Math.PI*2);const se=new Oi;return se.subPaths.push($),se}function A(P){const z=m(P.getAttribute("cx")||0),D=m(P.getAttribute("cy")||0),R=m(P.getAttribute("rx")||0),$=m(P.getAttribute("ry")||0),se=new Bc;se.absellipse(z,D,R,$,0,Math.PI*2);const Z=new Oi;return Z.subPaths.push(se),Z}function y(P){const z=m(P.getAttribute("x1")||0),D=m(P.getAttribute("y1")||0),R=m(P.getAttribute("x2")||0),$=m(P.getAttribute("y2")||0),se=new Oi;return se.moveTo(z,D),se.lineTo(R,$),se.currentPath.autoClose=!1,se}function x(P,z){z=Object.assign({},z);let D={};if(P.hasAttribute("class")){const Z=P.getAttribute("class").split(/\s/).filter(Boolean).map(oe=>oe.trim());for(let oe=0;oe<Z.length;oe++)D=Object.assign(D,k["."+Z[oe]])}P.hasAttribute("id")&&(D=Object.assign(D,k["#"+P.getAttribute("id")]));function R(Z,oe,Ae){Ae===void 0&&(Ae=function(le){return le.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),le}),P.hasAttribute(Z)&&(z[oe]=Ae(P.getAttribute(Z))),D[Z]&&(z[oe]=Ae(D[Z])),P.style&&P.style[Z]!==""&&(z[oe]=Ae(P.style[Z]))}function $(Z){return Math.max(0,Math.min(1,m(Z)))}function se(Z){return Math.max(0,m(Z))}return R("fill","fill"),R("fill-opacity","fillOpacity",$),R("fill-rule","fillRule"),R("opacity","opacity",$),R("stroke","stroke"),R("stroke-opacity","strokeOpacity",$),R("stroke-width","strokeWidth",se),R("stroke-linejoin","strokeLineJoin"),R("stroke-linecap","strokeLineCap"),R("stroke-miterlimit","strokeMiterLimit",se),R("visibility","visibility"),z}function d(P,z){return P-(z-P)}function v(P,z,D){if(typeof P!="string")throw new TypeError("Invalid input: "+typeof P);const R={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},$=0,se=1,Z=2,oe=3;let Ae=$,de=!0,le="",he="";const Ie=[];function Be(Ue,yt,bt){const Me=new SyntaxError('Unexpected character "'+Ue+'" at index '+yt+".");throw Me.partial=bt,Me}function K(){le!==""&&(he===""?Ie.push(Number(le)):Ie.push(Number(le)*Math.pow(10,Number(he)))),le="",he=""}let U;const ge=P.length;for(let Ue=0;Ue<ge;Ue++){if(U=P[Ue],Array.isArray(z)&&z.includes(Ie.length%D)&&R.FLAGS.test(U)){Ae=se,le=U,K();continue}if(Ae===$){if(R.WHITESPACE.test(U))continue;if(R.DIGIT.test(U)||R.SIGN.test(U)){Ae=se,le=U;continue}if(R.POINT.test(U)){Ae=Z,le=U;continue}R.COMMA.test(U)&&(de&&Be(U,Ue,Ie),de=!0)}if(Ae===se){if(R.DIGIT.test(U)){le+=U;continue}if(R.POINT.test(U)){le+=U,Ae=Z;continue}if(R.EXP.test(U)){Ae=oe;continue}R.SIGN.test(U)&&le.length===1&&R.SIGN.test(le[0])&&Be(U,Ue,Ie)}if(Ae===Z){if(R.DIGIT.test(U)){le+=U;continue}if(R.EXP.test(U)){Ae=oe;continue}R.POINT.test(U)&&le[le.length-1]==="."&&Be(U,Ue,Ie)}if(Ae===oe){if(R.DIGIT.test(U)){he+=U;continue}if(R.SIGN.test(U)){if(he===""){he+=U;continue}he.length===1&&R.SIGN.test(he)&&Be(U,Ue,Ie)}}R.WHITESPACE.test(U)?(K(),Ae=$,de=!1):R.COMMA.test(U)?(K(),Ae=$,de=!0):R.SIGN.test(U)?(K(),Ae=se,le=U):R.POINT.test(U)?(K(),Ae=Z,le=U):Be(U,Ue,Ie)}return K(),Ie}const g=["mm","cm","in","pt","pc","px"],p={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function m(P){let z="px";if(typeof P=="string"||P instanceof String)for(let R=0,$=g.length;R<$;R++){const se=g[R];if(P.endsWith(se)){z=se,P=P.substring(0,P.length-se.length);break}}let D;return z==="px"&&t.defaultUnit!=="px"?D=p.in[t.defaultUnit]/t.defaultDPI:(D=p[z][t.defaultUnit],D<0&&(D=p[z].in*t.defaultDPI)),D*parseFloat(P)}function E(P){if(!(P.hasAttribute("transform")||P.nodeName==="use"&&(P.hasAttribute("x")||P.hasAttribute("y"))))return null;const z=w(P);return L.length>0&&z.premultiply(L[L.length-1]),H.copy(z),L.push(z),z}function w(P){const z=new Qn,D=O;if(P.nodeName==="use"&&(P.hasAttribute("x")||P.hasAttribute("y"))){const R=m(P.getAttribute("x")),$=m(P.getAttribute("y"));z.translate(R,$)}if(P.hasAttribute("transform")){const R=P.getAttribute("transform").split(")");for(let $=R.length-1;$>=0;$--){const se=R[$].trim();if(se==="")continue;const Z=se.indexOf("("),oe=se.length;if(Z>0&&Z<oe){const Ae=se.slice(0,Z),de=v(se.slice(Z+1));switch(D.identity(),Ae){case"translate":if(de.length>=1){const le=de[0];let he=0;de.length>=2&&(he=de[1]),D.translate(le,he)}break;case"rotate":if(de.length>=1){let le=0,he=0,Ie=0;le=de[0]*Math.PI/180,de.length>=3&&(he=de[1],Ie=de[2]),G.makeTranslation(-he,-Ie),V.makeRotation(le),N.multiplyMatrices(V,G),G.makeTranslation(he,Ie),D.multiplyMatrices(G,N)}break;case"scale":if(de.length>=1){const le=de[0];let he=le;de.length>=2&&(he=de[1]),D.scale(le,he)}break;case"skewX":de.length===1&&D.set(1,Math.tan(de[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":de.length===1&&D.set(1,0,0,Math.tan(de[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":de.length===6&&D.set(de[0],de[2],de[4],de[1],de[3],de[5],0,0,1);break}}z.premultiply(D)}}return z}function _(P,z){function D(Z){Y.set(Z.x,Z.y,1).applyMatrix3(z),Z.set(Y.x,Y.y)}function R(Z){const oe=Z.xRadius,Ae=Z.yRadius,de=Math.cos(Z.aRotation),le=Math.sin(Z.aRotation),he=new T(oe*de,oe*le,0),Ie=new T(-Ae*le,Ae*de,0),Be=he.applyMatrix3(z),K=Ie.applyMatrix3(z),U=O.set(Be.x,K.x,0,Be.y,K.y,0,0,0,1),ge=G.copy(U).invert(),bt=V.copy(ge).transpose().multiply(ge).elements,Me=Q(bt[0],bt[1],bt[4]),Qe=Math.sqrt(Me.rt1),je=Math.sqrt(Me.rt2);if(Z.xRadius=1/Qe,Z.yRadius=1/je,Z.aRotation=Math.atan2(Me.sn,Me.cs),!((Z.aEndAngle-Z.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const st=G.set(Qe,0,0,0,je,0,0,0,1),ut=V.set(Me.cs,Me.sn,0,-Me.sn,Me.cs,0,0,0,1),Nt=st.multiply(ut).multiply(U),Gt=fn=>{const{x:gn,y:wt}=new T(Math.cos(fn),Math.sin(fn),0).applyMatrix3(Nt);return Math.atan2(wt,gn)};Z.aStartAngle=Gt(Z.aStartAngle),Z.aEndAngle=Gt(Z.aEndAngle),C(z)&&(Z.aClockwise=!Z.aClockwise)}}function $(Z){const oe=b(z),Ae=B(z);Z.xRadius*=oe,Z.yRadius*=Ae;const de=oe>Number.EPSILON?Math.atan2(z.elements[1],z.elements[0]):Math.atan2(-z.elements[3],z.elements[4]);Z.aRotation+=de,C(z)&&(Z.aStartAngle*=-1,Z.aEndAngle*=-1,Z.aClockwise=!Z.aClockwise)}const se=P.subPaths;for(let Z=0,oe=se.length;Z<oe;Z++){const de=se[Z].curves;for(let le=0;le<de.length;le++){const he=de[le];he.isLineCurve?(D(he.v1),D(he.v2)):he.isCubicBezierCurve?(D(he.v0),D(he.v1),D(he.v2),D(he.v3)):he.isQuadraticBezierCurve?(D(he.v0),D(he.v1),D(he.v2)):he.isEllipseCurve&&(j.set(he.aX,he.aY),D(j),he.aX=j.x,he.aY=j.y,I(z)?R(he):$(he))}}}function C(P){const z=P.elements;return z[0]*z[4]-z[1]*z[3]<0}function I(P){const z=P.elements,D=z[0]*z[3]+z[1]*z[4];if(D===0)return!1;const R=b(P),$=B(P);return Math.abs(D/(R*$))>Number.EPSILON}function b(P){const z=P.elements;return Math.sqrt(z[0]*z[0]+z[1]*z[1])}function B(P){const z=P.elements;return Math.sqrt(z[3]*z[3]+z[4]*z[4])}function Q(P,z,D){let R,$,se,Z,oe;const Ae=P+D,de=P-D,le=Math.sqrt(de*de+4*z*z);return Ae>0?(R=.5*(Ae+le),oe=1/R,$=P*oe*D-z*oe*z):Ae<0?$=.5*(Ae-le):(R=.5*le,$=-.5*le),de>0?se=de+le:se=de-le,Math.abs(se)>2*Math.abs(z)?(oe=-2*z/se,Z=1/Math.sqrt(1+oe*oe),se=oe*Z):Math.abs(z)===0?(se=1,Z=0):(oe=-.5*se/z,se=1/Math.sqrt(1+oe*oe),Z=oe*se),de>0&&(oe=se,se=-Z,Z=oe),{rt1:R,rt2:$,cs:se,sn:Z}}const S=[],k={},L=[],O=new Qn,G=new Qn,V=new Qn,N=new Qn,j=new _e,Y=new T,H=new Qn,X=new DOMParser().parseFromString(e,"image/svg+xml");return i(X.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:S,xml:X.documentElement}}static createShapes(e){const i={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},r={loc:i.ORIGIN,t:0};function s(d,v,g,p){const m=d.x,E=v.x,w=g.x,_=p.x,C=d.y,I=v.y,b=g.y,B=p.y,Q=(_-w)*(C-b)-(B-b)*(m-w),S=(E-m)*(C-b)-(I-C)*(m-w),k=(B-b)*(E-m)-(_-w)*(I-C),L=Q/k,O=S/k;if(k===0&&Q!==0||L<=0||L>=1||O<0||O>1)return null;if(Q===0&&k===0){for(let G=0;G<2;G++)if(o(G===0?g:p,d,v),r.loc==i.ORIGIN){const V=G===0?g:p;return{x:V.x,y:V.y,t:r.t}}else if(r.loc==i.BETWEEN){const V=+(m+r.t*(E-m)).toPrecision(10),N=+(C+r.t*(I-C)).toPrecision(10);return{x:V,y:N,t:r.t}}return null}else{for(let N=0;N<2;N++)if(o(N===0?g:p,d,v),r.loc==i.ORIGIN){const j=N===0?g:p;return{x:j.x,y:j.y,t:r.t}}const G=+(m+L*(E-m)).toPrecision(10),V=+(C+L*(I-C)).toPrecision(10);return{x:G,y:V,t:L}}}function o(d,v,g){const p=g.x-v.x,m=g.y-v.y,E=d.x-v.x,w=d.y-v.y,_=p*w-E*m;if(d.x===v.x&&d.y===v.y){r.loc=i.ORIGIN,r.t=0;return}if(d.x===g.x&&d.y===g.y){r.loc=i.DESTINATION,r.t=1;return}if(_<-Number.EPSILON){r.loc=i.LEFT;return}if(_>Number.EPSILON){r.loc=i.RIGHT;return}if(p*E<0||m*w<0){r.loc=i.BEHIND;return}if(Math.sqrt(p*p+m*m)<Math.sqrt(E*E+w*w)){r.loc=i.BEYOND;return}let C;p!==0?C=E/p:C=w/m,r.loc=i.BETWEEN,r.t=C}function a(d,v){const g=[],p=[];for(let m=1;m<d.length;m++){const E=d[m-1],w=d[m];for(let _=1;_<v.length;_++){const C=v[_-1],I=v[_],b=s(E,w,C,I);b!==null&&g.find(B=>B.t<=b.t+Number.EPSILON&&B.t>=b.t-Number.EPSILON)===void 0&&(g.push(b),p.push(new _e(b.x,b.y)))}}return p}function c(d,v,g){const p=new _e;v.getCenter(p);const m=[];return g.forEach(E=>{E.boundingBox.containsPoint(p)&&a(d,E.points).forEach(_=>{m.push({identifier:E.identifier,isCW:E.isCW,point:_})})}),m.sort((E,w)=>E.point.x-w.point.x),m}function u(d,v,g,p,m){(m==null||m==="")&&(m="nonzero");const E=new _e;d.boundingBox.getCenter(E);const w=[new _e(g,E.y),new _e(p,E.y)],_=c(w,d.boundingBox,v);_.sort((S,k)=>S.point.x-k.point.x);const C=[],I=[];_.forEach(S=>{S.identifier===d.identifier?C.push(S):I.push(S)});const b=C[0].point.x,B=[];let Q=0;for(;Q<I.length&&I[Q].point.x<b;)B.length>0&&B[B.length-1]===I[Q].identifier?B.pop():B.push(I[Q].identifier),Q++;if(B.push(d.identifier),m==="evenodd"){const S=B.length%2===0,k=B[B.length-2];return{identifier:d.identifier,isHole:S,for:k}}else if(m==="nonzero"){let S=!0,k=null,L=null;for(let O=0;O<B.length;O++){const G=B[O];S?(L=v[G].isCW,S=!1,k=G):L!==v[G].isCW&&(L=v[G].isCW,S=!0)}return{identifier:d.identifier,isHole:S,for:k}}else console.warn('fill-rule: "'+m+'" is currently not implemented.')}let f=999999999,h=-999999999,A=e.subPaths.map(d=>{const v=d.getPoints();let g=-999999999,p=999999999,m=-999999999,E=999999999;for(let w=0;w<v.length;w++){const _=v[w];_.y>g&&(g=_.y),_.y<p&&(p=_.y),_.x>m&&(m=_.x),_.x<E&&(E=_.x)}return h<=m&&(h=m+1),f>=E&&(f=E-1),{curves:d.curves,points:v,isCW:x2.isClockWise(v),identifier:-1,boundingBox:new E2(new _e(E,p),new _e(m,g))}});A=A.filter(d=>d.points.length>1);for(let d=0;d<A.length;d++)A[d].identifier=d;const y=A.map(d=>u(d,A,f,h,e.userData?e.userData.style.fillRule:void 0)),x=[];return A.forEach(d=>{if(!y[d.identifier].isHole){const g=new Jf;g.curves=d.curves,y.filter(m=>m.isHole&&m.for===d.identifier).forEach(m=>{const E=A[m.identifier],w=new Bc;w.curves=E.curves,g.holes.push(w)}),x.push(g)}}),x}static getStrokeStyle(e,t,i,r,s){return e=e!==void 0?e:1,t=t!==void 0?t:"#000",i=i!==void 0?i:"miter",r=r!==void 0?r:"butt",s=s!==void 0?s:4,{strokeColor:t,strokeWidth:e,strokeLineJoin:i,strokeLineCap:r,strokeMiterLimit:s}}static pointsToStroke(e,t,i,r){const s=[],o=[],a=[];if(go.pointsToStrokeWithBuffers(e,t,i,r,s,o,a)===0)return null;const c=new tn;return c.setAttribute("position",new Yt(s,3)),c.setAttribute("normal",new Yt(o,3)),c.setAttribute("uv",new Yt(a,2)),c}static pointsToStrokeWithBuffers(e,t,i,r,s,o,a,c){const u=new _e,f=new _e,h=new _e,A=new _e,y=new _e,x=new _e,d=new _e,v=new _e,g=new _e,p=new _e,m=new _e,E=new _e,w=new _e,_=new _e,C=new _e,I=new _e,b=new _e;i=i!==void 0?i:12,r=r!==void 0?r:.001,c=c!==void 0?c:0,e=de(e);const B=e.length;if(B<2)return 0;const Q=e[0].equals(e[B-1]);let S,k=e[0],L;const O=t.strokeWidth/2,G=1/(B-1);let V=0,N,j,Y,H,X=!1,W=0,P=c*3,z=c*2;D(e[0],e[1],u).multiplyScalar(O),v.copy(e[0]).sub(u),g.copy(e[0]).add(u),p.copy(v),m.copy(g);for(let le=1;le<B;le++){S=e[le],le===B-1?Q?L=e[1]:L=void 0:L=e[le+1];const he=u;if(D(k,S,he),h.copy(he).multiplyScalar(O),E.copy(S).sub(h),w.copy(S).add(h),N=V+G,j=!1,L!==void 0){D(S,L,f),h.copy(f).multiplyScalar(O),_.copy(S).sub(h),C.copy(S).add(h),Y=!0,h.subVectors(L,k),he.dot(h)<0&&(Y=!1),le===1&&(X=Y),h.subVectors(L,S),h.normalize();const Ie=Math.abs(he.dot(h));if(Ie>Number.EPSILON){const Be=O/Ie;h.multiplyScalar(-Be),A.subVectors(S,k),y.copy(A).setLength(Be).add(h),I.copy(y).negate();const K=y.length(),U=A.length();A.divideScalar(U),x.subVectors(L,S);const ge=x.length();switch(x.divideScalar(ge),A.dot(I)<U&&x.dot(I)<ge&&(j=!0),b.copy(y).add(S),I.add(S),H=!1,j?Y?(C.copy(I),w.copy(I)):(_.copy(I),E.copy(I)):se(),t.strokeLineJoin){case"bevel":Z(Y,j,N);break;case"round":oe(Y,j),Y?$(S,E,_,N,0):$(S,C,w,N,1);break;case"miter":case"miter-clip":default:const Ue=O*t.strokeMiterLimit/K;if(Ue<1)if(t.strokeLineJoin!=="miter-clip"){Z(Y,j,N);break}else oe(Y,j),Y?(x.subVectors(b,E).multiplyScalar(Ue).add(E),d.subVectors(b,_).multiplyScalar(Ue).add(_),R(E,N,0),R(x,N,0),R(S,N,.5),R(S,N,.5),R(x,N,0),R(d,N,0),R(S,N,.5),R(d,N,0),R(_,N,0)):(x.subVectors(b,w).multiplyScalar(Ue).add(w),d.subVectors(b,C).multiplyScalar(Ue).add(C),R(w,N,1),R(x,N,1),R(S,N,.5),R(S,N,.5),R(x,N,1),R(d,N,1),R(S,N,.5),R(d,N,1),R(C,N,1));else j?(Y?(R(g,V,1),R(v,V,0),R(b,N,0),R(g,V,1),R(b,N,0),R(I,N,1)):(R(g,V,1),R(v,V,0),R(b,N,1),R(v,V,0),R(I,N,0),R(b,N,1)),Y?_.copy(b):C.copy(b)):Y?(R(E,N,0),R(b,N,0),R(S,N,.5),R(S,N,.5),R(b,N,0),R(_,N,0)):(R(w,N,1),R(b,N,1),R(S,N,.5),R(S,N,.5),R(b,N,1),R(C,N,1)),H=!0;break}}else se()}else se();!Q&&le===B-1&&Ae(e[0],p,m,Y,!0,V),V=N,k=S,v.copy(_),g.copy(C)}if(!Q)Ae(S,E,w,Y,!1,N);else if(j&&s){let le=b,he=I;X!==Y&&(le=I,he=b),Y?(H||X)&&(he.toArray(s,0*3),he.toArray(s,3*3),H&&le.toArray(s,1*3)):(H||!X)&&(he.toArray(s,1*3),he.toArray(s,3*3),H&&le.toArray(s,0*3))}return W;function D(le,he,Ie){return Ie.subVectors(he,le),Ie.set(-Ie.y,Ie.x).normalize()}function R(le,he,Ie){s&&(s[P]=le.x,s[P+1]=le.y,s[P+2]=0,o&&(o[P]=0,o[P+1]=0,o[P+2]=1),P+=3,a&&(a[z]=he,a[z+1]=Ie,z+=2)),W+=3}function $(le,he,Ie,Be,K){u.copy(he).sub(le).normalize(),f.copy(Ie).sub(le).normalize();let U=Math.PI;const ge=u.dot(f);Math.abs(ge)<1&&(U=Math.abs(Math.acos(ge))),U/=i,h.copy(he);for(let Ue=0,yt=i-1;Ue<yt;Ue++)A.copy(h).rotateAround(le,U),R(h,Be,K),R(A,Be,K),R(le,Be,.5),h.copy(A);R(A,Be,K),R(Ie,Be,K),R(le,Be,.5)}function se(){R(g,V,1),R(v,V,0),R(E,N,0),R(g,V,1),R(E,N,0),R(w,N,1)}function Z(le,he,Ie){he?le?(R(g,V,1),R(v,V,0),R(E,N,0),R(g,V,1),R(E,N,0),R(I,N,1),R(E,Ie,0),R(_,Ie,0),R(I,Ie,.5)):(R(g,V,1),R(v,V,0),R(w,N,1),R(v,V,0),R(I,N,0),R(w,N,1),R(w,Ie,1),R(I,Ie,0),R(C,Ie,1)):le?(R(E,Ie,0),R(_,Ie,0),R(S,Ie,.5)):(R(w,Ie,1),R(C,Ie,0),R(S,Ie,.5))}function oe(le,he){he&&(le?(R(g,V,1),R(v,V,0),R(E,N,0),R(g,V,1),R(E,N,0),R(I,N,1),R(E,V,0),R(S,N,.5),R(I,N,1),R(S,N,.5),R(_,V,0),R(I,N,1)):(R(g,V,1),R(v,V,0),R(w,N,1),R(v,V,0),R(I,N,0),R(w,N,1),R(w,V,1),R(I,N,0),R(S,N,.5),R(S,N,.5),R(I,N,0),R(C,V,1)))}function Ae(le,he,Ie,Be,K,U){switch(t.strokeLineCap){case"round":K?$(le,Ie,he,U,.5):$(le,he,Ie,U,.5);break;case"square":if(K)u.subVectors(he,le),f.set(u.y,-u.x),h.addVectors(u,f).add(le),A.subVectors(f,u).add(le),Be?(h.toArray(s,1*3),A.toArray(s,0*3),A.toArray(s,3*3)):(h.toArray(s,1*3),a[3*2+1]===1?A.toArray(s,3*3):h.toArray(s,3*3),A.toArray(s,0*3));else{u.subVectors(Ie,le),f.set(u.y,-u.x),h.addVectors(u,f).add(le),A.subVectors(f,u).add(le);const ge=s.length;Be?(h.toArray(s,ge-1*3),A.toArray(s,ge-2*3),A.toArray(s,ge-4*3)):(A.toArray(s,ge-2*3),h.toArray(s,ge-1*3),A.toArray(s,ge-4*3))}break}}function de(le){let he=!1;for(let Be=1,K=le.length-1;Be<K;Be++)if(le[Be].distanceTo(le[Be+1])<r){he=!0;break}if(!he)return le;const Ie=[];Ie.push(le[0]);for(let Be=1,K=le.length-1;Be<K;Be++)le[Be].distanceTo(le[Be+1])>=r&&Ie.push(le[Be]);return Ie.push(le[le.length-1]),Ie}}}const $h=new Et,Zo=new T;class gc extends eA{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new Yt(e,3)),this.setAttribute("uv",new Yt(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new jl(t,6,1);return this.setAttribute("instanceStart",new es(i,3,0)),this.setAttribute("instanceEnd",new es(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,t=3){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const r=new jl(i,t*2,1);return this.setAttribute("instanceColorStart",new es(r,t,0)),this.setAttribute("instanceColorEnd",new es(r,t,t)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new w2(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Et);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),$h.setFromBufferAttribute(t),this.boundingBox.union($h))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Nn),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)Zo.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Zo)),Zo.fromBufferAttribute(t,s),r=Math.max(r,i.distanceToSquared(Zo));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class Rd extends gc{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return super.setPositions(i),this}setColors(e,t=3){const i=e.length-t,r=new Float32Array(2*i);if(t===3)for(let s=0;s<i;s+=t)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];else for(let s=0;s<i;s+=t)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5],r[2*s+6]=e[s+6],r[2*s+7]=e[s+7];return super.setColors(r,t),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class yc extends jt{constructor(e){super({type:"LineMaterial",uniforms:ka.clone(ka.merge([Wl.common,Wl.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new _e(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${parseInt(bo.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const Zc=new Qt,Jh=new T,e1=new T,Zt=new Qt,$t=new Qt,si=new Qt,$c=new T,Jc=new ue,en=new yi,t1=new T,$o=new Et,Jo=new Nn,oi=new Qt;let mi,hr;function n1(n,e,t){return oi.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),oi.multiplyScalar(1/oi.w),oi.x=hr/t.width,oi.y=hr/t.height,oi.applyMatrix4(n.projectionMatrixInverse),oi.multiplyScalar(1/oi.w),Math.abs(Math.max(oi.x,oi.y))}function L5(n,e){const t=n.matrixWorld,i=n.geometry,r=i.attributes.instanceStart,s=i.attributes.instanceEnd,o=Math.min(i.instanceCount,r.count);for(let a=0,c=o;a<c;a++){en.start.fromBufferAttribute(r,a),en.end.fromBufferAttribute(s,a),en.applyMatrix4(t);const u=new T,f=new T;mi.distanceSqToSegment(en.start,en.end,f,u),f.distanceTo(u)<hr*.5&&e.push({point:f,pointOnLine:u,distance:mi.origin.distanceTo(f),object:n,face:null,faceIndex:a,uv:null,[e0]:null})}}function k5(n,e,t){const i=e.projectionMatrix,s=n.material.resolution,o=n.matrixWorld,a=n.geometry,c=a.attributes.instanceStart,u=a.attributes.instanceEnd,f=Math.min(a.instanceCount,c.count),h=-e.near;mi.at(1,si),si.w=1,si.applyMatrix4(e.matrixWorldInverse),si.applyMatrix4(i),si.multiplyScalar(1/si.w),si.x*=s.x/2,si.y*=s.y/2,si.z=0,$c.copy(si),Jc.multiplyMatrices(e.matrixWorldInverse,o);for(let A=0,y=f;A<y;A++){if(Zt.fromBufferAttribute(c,A),$t.fromBufferAttribute(u,A),Zt.w=1,$t.w=1,Zt.applyMatrix4(Jc),$t.applyMatrix4(Jc),Zt.z>h&&$t.z>h)continue;if(Zt.z>h){const m=Zt.z-$t.z,E=(Zt.z-h)/m;Zt.lerp($t,E)}else if($t.z>h){const m=$t.z-Zt.z,E=($t.z-h)/m;$t.lerp(Zt,E)}Zt.applyMatrix4(i),$t.applyMatrix4(i),Zt.multiplyScalar(1/Zt.w),$t.multiplyScalar(1/$t.w),Zt.x*=s.x/2,Zt.y*=s.y/2,$t.x*=s.x/2,$t.y*=s.y/2,en.start.copy(Zt),en.start.z=0,en.end.copy($t),en.end.z=0;const d=en.closestPointToPointParameter($c,!0);en.at(d,t1);const v=De.lerp(Zt.z,$t.z,d),g=v>=-1&&v<=1,p=$c.distanceTo(t1)<hr*.5;if(g&&p){en.start.fromBufferAttribute(c,A),en.end.fromBufferAttribute(u,A),en.start.applyMatrix4(o),en.end.applyMatrix4(o);const m=new T,E=new T;mi.distanceSqToSegment(en.start,en.end,E,m),t.push({point:E,pointOnLine:m,distance:mi.origin.distanceTo(E),object:n,face:null,faceIndex:A,uv:null,[e0]:null})}}}class zd extends be{constructor(e=new gc,t=new yc({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let o=0,a=0,c=t.count;o<c;o++,a+=2)Jh.fromBufferAttribute(t,o),e1.fromBufferAttribute(i,o),r[a]=a===0?0:r[a-1],r[a+1]=r[a]+Jh.distanceTo(e1);const s=new jl(r,2,1);return e.setAttribute("instanceDistanceStart",new es(s,1,0)),e.setAttribute("instanceDistanceEnd",new es(s,1,1)),this}raycast(e,t){const i=this.material.worldUnits,r=e.camera;r===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;mi=e.ray;const o=this.matrixWorld,a=this.geometry,c=this.material;hr=c.linewidth+s,a.boundingSphere===null&&a.computeBoundingSphere(),Jo.copy(a.boundingSphere).applyMatrix4(o);let u;if(i)u=hr*.5;else{const h=Math.max(r.near,Jo.distanceToPoint(mi.origin));u=n1(r,h,c.resolution)}if(Jo.radius+=u,mi.intersectsSphere(Jo)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),$o.copy(a.boundingBox).applyMatrix4(o);let f;if(i)f=hr*.5;else{const h=Math.max(r.near,$o.distanceToPoint(mi.origin));f=n1(r,h,c.resolution)}$o.expandByScalar(f),mi.intersectsBox($o)!==!1&&(i?L5(this,t):k5(this,r,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(Zc),this.material.uniforms.resolution.value.set(Zc.z,Zc.w))}}class Fd extends zd{constructor(e=new Rd,t=new yc({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}function O5(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;const t=Object.keys(n);if(t.length!==Object.keys(e).length)return!1;for(let i=0;i<t.length;i++)if(!Object.prototype.hasOwnProperty.call(e,t[i])||!Object.is(n[t[i]],e[t[i]]))return!1;return!0}const Ld=l.createContext([]);function H7({box:n,multiple:e,children:t,onChange:i,onChangePointerUp:r,border:s="1px solid #55aaff",backgroundColor:o="rgba(75, 160, 255, 0.1)",filter:a=u=>u,...c}){const[u,f]=l.useState(!1),{setEvents:h,camera:A,raycaster:y,gl:x,controls:d,size:v,get:g}=J(),[p,m]=l.useState(!1),[E,w]=l.useReducer((b,{object:B,shift:Q})=>B===void 0?[]:Array.isArray(B)?B:Q?b.includes(B)?b.filter(S=>S!==B):[B,...b]:b[0]===B?[]:[B],[]);l.useEffect(()=>{u?i==null||i(E):r==null||r(E)},[E,u]);const _=l.useCallback(b=>{b.stopPropagation(),w({object:a([b.object])[0],shift:e&&b.shiftKey})},[]),C=l.useCallback(b=>!p&&w({}),[p]),I=l.useRef(null);return l.useEffect(()=>{if(!n||!e)return;const b=new U4(A,I.current),B=document.createElement("div");B.style.pointerEvents="none",B.style.border=s,B.style.backgroundColor=o,B.style.position="fixed";const Q=new _e,S=new _e,k=new _e,L=g().events.enabled,O=d==null?void 0:d.enabled;let G=!1;function V(z,D){const{offsetX:R,offsetY:$}=z,{width:se,height:Z}=v;D.set(R/se*2-1,-($/Z)*2+1)}function N(z){var D;d&&(d.enabled=!1),h({enabled:!1}),f(G=!0),(D=x.domElement.parentElement)==null||D.appendChild(B),B.style.left=`${z.clientX}px`,B.style.top=`${z.clientY}px`,B.style.width="0px",B.style.height="0px",Q.x=z.clientX,Q.y=z.clientY}function j(z){k.x=Math.max(Q.x,z.clientX),k.y=Math.max(Q.y,z.clientY),S.x=Math.min(Q.x,z.clientX),S.y=Math.min(Q.y,z.clientY),B.style.left=`${S.x}px`,B.style.top=`${S.y}px`,B.style.width=`${k.x-S.x}px`,B.style.height=`${k.y-S.y}px`}function Y(){if(G){var z;d&&(d.enabled=O),h({enabled:L}),f(G=!1),(z=B.parentElement)==null||z.removeChild(B)}}function H(z){z.shiftKey&&(N(z),V(z,b.startPoint))}let X=[];function W(z){if(G){j(z),V(z,b.endPoint);const D=b.select().sort(R=>R.uuid).filter(R=>R.isMesh);O5(D,X)||(X=D,w({object:a(D)}))}}function P(z){G&&Y()}return document.addEventListener("pointerdown",H,{passive:!0}),document.addEventListener("pointermove",W,{passive:!0,capture:!0}),document.addEventListener("pointerup",P,{passive:!0}),()=>{document.removeEventListener("pointerdown",H),document.removeEventListener("pointermove",W,!0),document.removeEventListener("pointerup",P)}},[v.width,v.height,y,A,d,x]),l.createElement("group",ce({ref:I,onClick:_,onPointerOver:()=>m(!0),onPointerOut:()=>m(!1),onPointerMissed:C},c),l.createElement(Ld.Provider,{value:E},t))}function V7(){return l.useContext(Ld)}const q7=l.forwardRef(function({children:e,follow:t=!0,lockX:i=!1,lockY:r=!1,lockZ:s=!1,...o},a){const c=l.useRef(null),u=l.useRef(null),f=new Fe;return Se(({camera:h})=>{if(!t||!u.current)return;const A=u.current.rotation.clone();u.current.updateMatrix(),u.current.updateWorldMatrix(!1,!1),u.current.getWorldQuaternion(f),h.getWorldQuaternion(c.current.quaternion).premultiply(f.invert()),i&&(u.current.rotation.x=A.x),r&&(u.current.rotation.y=A.y),s&&(u.current.rotation.z=A.z)}),l.useImperativeHandle(a,()=>u.current,[]),l.createElement("group",ce({ref:u},o),l.createElement("group",{ref:c},e))}),Y7=l.forwardRef(({children:n,depth:e=-1,...t},i)=>{const r=l.useRef(null);return l.useImperativeHandle(i,()=>r.current,[]),Se(({camera:s})=>{r.current.quaternion.copy(s.quaternion),r.current.position.copy(s.position)}),l.createElement("group",ce({ref:r},t),l.createElement("group",{"position-z":-e},n))}),U5=new T,N5=new T,G5=new T,H5=(n,e,t)=>{const i=t.width/2,r=t.height/2;e.updateMatrixWorld(!1);const s=n.project(e);return s.x=s.x*i+i,s.y=-(s.y*r)+r,s},V5=(n,e,t,i=1)=>{const r=U5.set(n.x/t.width*2-1,-(n.y/t.height)*2+1,i);return r.unproject(e),r},o0=(n,e,t,i)=>{const r=H5(G5.copy(n),t,i);let s=0;for(let o=0;o<2;++o){const a=N5.copy(r).setComponent(o,r.getComponent(o)+e),c=V5(a,t,i,a.z);s=Math.max(s,n.distanceTo(c))}return s},q5=new T,j7=l.forwardRef(({scale:n=1,...e},t)=>{const i=l.useRef(null);return l.useImperativeHandle(t,()=>i.current,[]),Se(r=>{const s=i.current;if(!s)return;const o=o0(s.getWorldPosition(q5),n,r.camera,r.size);s.scale.setScalar(o*n)}),l.createElement("object3D",ce({ref:i},e))}),Ei=l.forwardRef(function({points:e,color:t=16777215,vertexColors:i,linewidth:r,lineWidth:s,segments:o,dashed:a,...c},u){var f,h;const A=J(g=>g.size),y=l.useMemo(()=>o?new zd:new Fd,[o]),[x]=l.useState(()=>new yc),d=(i==null||(f=i[0])==null?void 0:f.length)===4?4:3,v=l.useMemo(()=>{const g=o?new gc:new Rd,p=e.map(m=>{const E=Array.isArray(m);return m instanceof T||m instanceof Qt?[m.x,m.y,m.z]:m instanceof _e?[m.x,m.y,0]:E&&m.length===3?[m[0],m[1],m[2]]:E&&m.length===2?[m[0],m[1],0]:m});if(g.setPositions(p.flat()),i){t=16777215;const m=i.map(E=>E instanceof ze?E.toArray():E);g.setColors(m.flat(),d)}return g},[e,o,i,d]);return l.useLayoutEffect(()=>{y.computeLineDistances()},[e,y]),l.useLayoutEffect(()=>{a?x.defines.USE_DASH="":delete x.defines.USE_DASH,x.needsUpdate=!0},[a,x]),l.useEffect(()=>()=>{v.dispose(),x.dispose()},[v]),l.createElement("primitive",ce({object:y,ref:u},c),l.createElement("primitive",{object:v,attach:"geometry"}),l.createElement("primitive",ce({object:x,attach:"material",color:t,vertexColors:!!i,resolution:[A.width,A.height],linewidth:(h=r??s)!==null&&h!==void 0?h:1,dashed:a,transparent:d===4},c)))}),Y5=new T,W7=l.forwardRef(function({start:e=[0,0,0],end:t=[0,0,0],mid:i,segments:r=20,...s},o){const a=l.useRef(null);l.useImperativeHandle(o,()=>a.current);const[c]=l.useState(()=>new _2(void 0,void 0,void 0)),u=l.useCallback((h,A,y,x=20)=>(h instanceof T?c.v0.copy(h):c.v0.set(...h),A instanceof T?c.v2.copy(A):c.v2.set(...A),y instanceof T?c.v1.copy(y):Array.isArray(y)?c.v1.set(...y):c.v1.copy(c.v0.clone().add(c.v2.clone().sub(c.v0)).add(Y5.set(0,c.v0.y-c.v2.y,0))),c.getPoints(x)),[]);l.useLayoutEffect(()=>{a.current.setPoints=(h,A,y)=>{const x=u(h,A,y);a.current.geometry&&a.current.geometry.setPositions(x.map(d=>d.toArray()).flat())}},[]);const f=l.useMemo(()=>u(e,t,i,r),[e,t,i,r]);return l.createElement(Ei,ce({ref:a,points:f},s))}),X7=l.forwardRef(function({start:e,end:t,midA:i,midB:r,segments:s=20,...o},a){const c=l.useMemo(()=>{const u=e instanceof T?e:new T(...e),f=t instanceof T?t:new T(...t),h=i instanceof T?i:new T(...i),A=r instanceof T?r:new T(...r);return new C2(u,h,A,f).getPoints(s)},[e,t,i,r,s]);return l.createElement(Ei,ce({ref:a,points:c},o))}),K7=l.forwardRef(function({points:e,closed:t=!1,curveType:i="centripetal",tension:r=.5,segments:s=20,vertexColors:o,...a},c){const u=l.useMemo(()=>{const A=e.map(y=>y instanceof T?y:new T(...y));return new tA(A,t,i,r)},[e,t,i,r]),f=l.useMemo(()=>u.getPoints(s),[u,s]),h=l.useMemo(()=>{if(!o||o.length<2)return;if(o.length===s+1)return o;const A=o.map(d=>d instanceof ze?d:new ze(...d));t&&A.push(A[0].clone());const y=[A[0]],x=s/(A.length-1);for(let d=1;d<s;d++){const v=d%x/x,g=Math.floor(d/x);y.push(A[g].clone().lerp(A[g+1],v))}return y.push(A[A.length-1]),y},[o,s]);return l.createElement(Ei,ce({ref:c,points:f,vertexColors:h},a))});let el=null;async function j5(n){return typeof n=="string"?await(await fetch(n)).json():n}function W5(n){return el||(el=new c5),el.parse(n)}async function kd(n){const e=await j5(n);return W5(e)}function a0(n){return mr(kd,[n])}a0.preload=n=>I2(kd,[n]);a0.clear=n=>Du([n]);const X5=["string","number"],K5=n=>{let e="";const t=[];return l.Children.forEach(n,i=>{X5.includes(typeof i)?e+=i+"":t.push(i)}),[e,...t]},Z5=l.forwardRef(({font:n,letterSpacing:e=0,lineHeight:t=1,size:i=1,height:r=.2,bevelThickness:s=.1,bevelSize:o=.01,bevelEnabled:a=!1,bevelOffset:c=0,bevelSegments:u=4,curveSegments:f=8,smooth:h,children:A,...y},x)=>{l.useMemo(()=>Pt({RenamedTextGeometry:F4}),[]);const d=l.useRef(null),v=a0(n),g=l.useMemo(()=>({font:v,size:i,height:r,bevelThickness:s,bevelSize:o,bevelEnabled:a,bevelSegments:u,bevelOffset:c,curveSegments:f,letterSpacing:e,lineHeight:t}),[v,i,r,s,o,a,u,c,f,e,t]),[p,...m]=l.useMemo(()=>K5(A),[A]),E=l.useMemo(()=>[p,g],[p,g]);return l.useLayoutEffect(()=>{h&&(d.current.geometry=B2(d.current.geometry,h),d.current.geometry.computeVertexNormals())},[E,h]),l.useImperativeHandle(x,()=>d.current,[]),l.createElement("mesh",ce({},y,{ref:d}),l.createElement("renamedTextGeometry",{args:E}),m)}),Z7=()=>{try{var n=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&n.getContext("webgl2"))}catch{return!1}},$7=l.forwardRef(({children:n,multisamping:e=8,renderIndex:t=1,disableRender:i,disableGamma:r,disableRenderPass:s,depthBuffer:o=!0,stencilBuffer:a=!1,anisotropy:c=1,encoding:u,type:f,...h},A)=>{l.useMemo(()=>Pt({EffectComposer:P4,RenderPass:R4,ShaderPass:mu}),[]);const y=l.useRef(null);l.useImperativeHandle(A,()=>y.current,[]);const{scene:x,camera:d,gl:v,size:g,viewport:p}=J(),[m]=l.useState(()=>{const w=new Tt(g.width,g.height,{type:f||xt,format:Lt,depthBuffer:o,stencilBuffer:a,anisotropy:c});return f===qt&&u!=null&&("colorSpace"in w?w.texture.colorSpace=u:w.texture.encoding=u),w.samples=e,w});l.useEffect(()=>{var w,_;(w=y.current)==null||w.setSize(g.width,g.height),(_=y.current)==null||_.setPixelRatio(p.dpr)},[v,g,p.dpr]),Se(()=>{var w;i||(w=y.current)==null||w.render()},t);const E=[];return s||E.push(l.createElement("renderPass",{key:"renderpass",attach:`passes-${E.length}`,args:[x,d]})),r||E.push(l.createElement("shaderPass",{attach:`passes-${E.length}`,key:"gammapass",args:[L4]})),l.Children.forEach(n,w=>{w&&E.push(l.cloneElement(w,{key:E.length,attach:`passes-${E.length}`}))}),l.createElement("effectComposer",ce({ref:y,args:[v,m]},h),E)});let i1=function(n){return n.Linear="linear",n.Radial="radial",n}({});function J7({stops:n,colors:e,size:t=1024,width:i=16,type:r=i1.Linear,innerCircleRadius:s=0,outerCircleRadius:o="auto",...a}){const c=J(f=>f.gl),u=l.useMemo(()=>{const f=document.createElement("canvas"),h=f.getContext("2d");f.width=i,f.height=t;let A;if(r===i1.Linear)A=h.createLinearGradient(0,0,0,t);else{const d=f.width/2,v=f.height/2,g=o!=="auto"?Math.abs(Number(o)):Math.sqrt(d**2+v**2);A=h.createRadialGradient(d,v,Math.abs(s),d,v,g)}const y=new ze;let x=n.length;for(;x--;)A.addColorStop(n[x],y.set(e[x]).getStyle());return h.save(),h.fillStyle=A,h.fillRect(0,0,i,t),h.restore(),f},[n]);return l.createElement("canvasTexture",ce({colorSpace:c.outputColorSpace,args:[u],attach:"map"},a))}const yo=n=>n===Object(n)&&!Array.isArray(n)&&typeof n!="function";function yr(n,e){const t=J(s=>s.gl),i=Xt(Zi,yo(n)?Object.values(n):n);return l.useLayoutEffect(()=>{e==null||e(i)},[e]),l.useEffect(()=>{if("initTexture"in t){let s=[];Array.isArray(i)?s=i:i instanceof un?s=[i]:yo(i)&&(s=Object.values(i)),s.forEach(o=>{o instanceof un&&t.initTexture(o)})}},[t,i]),l.useMemo(()=>{if(yo(n)){const s={};let o=0;for(const a in n)s[a]=i[o++];return s}else return i},[n,i])}yr.preload=n=>Xt.preload(Zi,n);yr.clear=n=>Xt.clear(Zi,n);const e9=({children:n,input:e,onLoad:t})=>{const i=yr(e,t);return l.createElement(l.Fragment,null,n==null?void 0:n(i))},r1=ti({color:new ze("white"),scale:new _e(1,1),imageBounds:new _e(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},`
  varying vec2 vUv;
  varying vec2 vPos;
  void main() {
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
    vUv = uv;
    vPos = position.xy;
  }
`,`
  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
  varying vec2 vUv;
  varying vec2 vPos;
  uniform vec2 scale;
  uniform vec2 imageBounds;
  uniform float resolution;
  uniform vec3 color;
  uniform sampler2D map;
  uniform float radius;
  uniform float zoom;
  uniform float grayscale;
  uniform float opacity;
  const vec3 luma = vec3(.299, 0.587, 0.114);
  vec4 toGrayscale(vec4 color, float intensity) {
    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);
  }
  vec2 aspect(vec2 size) {
    return size / min(size.x, size.y);
  }
  
  const float PI = 3.14159265;
    
  // from https://iquilezles.org/articles/distfunctions
  float udRoundBox( vec2 p, vec2 b, float r ) {
    return length(max(abs(p)-b+r,0.0))-r;
  }

  void main() {
    vec2 s = aspect(scale);
    vec2 i = aspect(imageBounds);
    float rs = s.x / s.y;
    float ri = i.x / i.y;
    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
    vec2 uv = vUv * s / new + offset;
    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);

    vec2 res = vec2(scale * resolution);
    vec2 halfRes = 0.5 * res;
    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    
	  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));
    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);
    
    #include <tonemapping_fragment>
    #include <${Cn>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`),Od=l.forwardRef(({children:n,color:e,segments:t=1,scale:i=1,zoom:r=1,grayscale:s=0,opacity:o=1,radius:a=0,texture:c,toneMapped:u,transparent:f,side:h,...A},y)=>{Pt({ImageMaterial:r1});const x=l.useRef(null),d=J(m=>m.size),v=Array.isArray(i)?[i[0],i[1]]:[i,i],g=[c.image.width,c.image.height],p=Math.max(d.width,d.height);return l.useImperativeHandle(y,()=>x.current,[]),l.useLayoutEffect(()=>{x.current.geometry.parameters&&x.current.material.scale.set(v[0]*x.current.geometry.parameters.width,v[1]*x.current.geometry.parameters.height)},[]),l.createElement("mesh",ce({ref:x,scale:Array.isArray(i)?[...i,1]:i},A),l.createElement("planeGeometry",{args:[1,1,t,t]}),l.createElement("imageMaterial",{color:e,map:c,zoom:r,grayscale:s,opacity:o,scale:v,imageBounds:g,resolution:p,radius:a,toneMapped:u,transparent:f,side:h,key:r1.key}),n)}),$5=l.forwardRef(({url:n,...e},t)=>{const i=yr(n);return l.createElement(Od,ce({},e,{texture:i,ref:t}))}),J5=l.forwardRef(({url:n,...e},t)=>l.createElement(Od,ce({},e,{ref:t}))),t9=l.forwardRef((n,e)=>{if(n.url)return l.createElement($5,ce({},n,{ref:e}));if(n.texture)return l.createElement(J5,ce({},n,{ref:e}));throw new Error("<Image /> requires a url or texture")}),ey=l.forwardRef(({threshold:n=15,geometry:e,...t},i)=>{const r=l.useRef(null);l.useImperativeHandle(i,()=>r.current,[]);const s=l.useMemo(()=>[0,0,0,1,0,0],[]),o=l.useRef(),a=l.useRef();return l.useLayoutEffect(()=>{const c=r.current.parent,u=e??(c==null?void 0:c.geometry);if(!u||o.current===u&&a.current===n)return;o.current=u,a.current=n;const h=new b2(u,n).attributes.position.array;r.current.geometry.setPositions(h),r.current.geometry.attributes.instanceStart.needsUpdate=!0,r.current.geometry.attributes.instanceEnd.needsUpdate=!0,r.current.computeLineDistances()}),l.createElement(Ei,ce({segments:!0,points:s,ref:r,raycast:()=>null},t))}),s1=ti({screenspace:!1,color:new ze("black"),opacity:1,thickness:.05,size:new _e},`#include <common>
   #include <morphtarget_pars_vertex>
   #include <skinning_pars_vertex>
   uniform float thickness;
   uniform bool screenspace;
   uniform vec2 size;
   void main() {
     #if defined (USE_SKINNING)
	     #include <beginnormal_vertex>
       #include <morphnormal_vertex>
       #include <skinbase_vertex>
       #include <skinnormal_vertex>
       #include <defaultnormal_vertex>
     #endif
     #include <begin_vertex>
	   #include <morphtarget_vertex>
	   #include <skinning_vertex>
     #include <project_vertex>
     vec4 tNormal = vec4(normal, 0.0);
     vec4 tPosition = vec4(transformed, 1.0);
     #ifdef USE_INSTANCING
       tNormal = instanceMatrix * tNormal;
       tPosition = instanceMatrix * tPosition;
     #endif
     if (screenspace) {
       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); 
     } else {
       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
       clipPosition.xy += offset;
       gl_Position = clipPosition;
     }
   }`,`uniform vec3 color;
   uniform float opacity;
   void main(){
     gl_FragColor = vec4(color, opacity);
     #include <tonemapping_fragment>
     #include <${Cn>=154?"colorspace_fragment":"encodings_fragment"}>
   }`);function n9({color:n="black",opacity:e=1,transparent:t=!1,screenspace:i=!1,toneMapped:r=!0,polygonOffset:s=!1,polygonOffsetFactor:o=0,renderOrder:a=0,thickness:c=.05,angle:u=Math.PI,...f}){const h=l.useRef(),[A]=l.useState(()=>new s1({side:us})),{gl:y}=J(),x=y.getDrawingBufferSize(new _e);l.useMemo(()=>Pt({OutlinesMaterial:s1}),[]);const d=l.useRef(0),v=l.useRef();return l.useLayoutEffect(()=>{const g=h.current;if(!g)return;const p=g.parent;if(p&&p.geometry&&(d.current!==u||v.current!==p.geometry)){var m;d.current=u,v.current=p.geometry;let E=(m=g.children)==null?void 0:m[0];E&&(u&&E.geometry.dispose(),g.remove(E)),p.skeleton?(E=new Xf,E.material=A,E.bind(p.skeleton,p.bindMatrix),g.add(E)):p.isInstancedMesh?(E=new qf(p.geometry,A,p.count),E.instanceMatrix=p.instanceMatrix,g.add(E)):(E=new be,E.material=A,g.add(E)),E.geometry=u?nA(p.geometry,u):p.geometry}}),l.useLayoutEffect(()=>{const g=h.current;if(!g)return;const p=g.children[0];p&&(p.renderOrder=a,Fn(p.material,{transparent:t,thickness:c,color:n,opacity:e,size:x,screenspace:i,toneMapped:r,polygonOffset:s,polygonOffsetFactor:o}))}),l.useEffect(()=>()=>{const g=h.current;if(!g)return;const p=g.children[0];p&&(u&&p.geometry.dispose(),g.remove(p))},[]),l.createElement("group",ce({ref:h},f))}var ty=Object.defineProperty,ny=(n,e,t)=>e in n?ty(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ze=(n,e,t)=>(ny(n,typeof e!="symbol"?e+"":e,t),t);function tl(n,e,t,i,r){let s;if(n=n.subarray||n.slice?n:n.buffer,t=t.subarray||t.slice?t:t.buffer,n=e?n.subarray?n.subarray(e,r&&e+r):n.slice(e,r&&e+r):n,t.set)t.set(n,i);else for(s=0;s<n.length;s++)t[s+i]=n[s];return t}function iy(n){return n instanceof Float32Array?n:n instanceof tn?n.getAttribute("position").array:n.map(e=>{const t=Array.isArray(e);return e instanceof T?[e.x,e.y,e.z]:e instanceof _e?[e.x,e.y,0]:t&&e.length===3?[e[0],e[1],e[2]]:t&&e.length===2?[e[0],e[1],0]:e}).flat()}class ry extends tn{constructor(){super(),Ze(this,"type","MeshLine"),Ze(this,"isMeshLine",!0),Ze(this,"positions",[]),Ze(this,"previous",[]),Ze(this,"next",[]),Ze(this,"side",[]),Ze(this,"width",[]),Ze(this,"indices_array",[]),Ze(this,"uvs",[]),Ze(this,"counters",[]),Ze(this,"widthCallback",null),Ze(this,"_attributes"),Ze(this,"_points",[]),Ze(this,"points"),Ze(this,"matrixWorld",new ue),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,t){if(e=iy(e),this._points=e,this.widthCallback=t??null,this.positions=[],this.counters=[],e.length&&e[0]instanceof T)for(let i=0;i<e.length;i++){const r=e[i],s=i/(e.length-1);this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(s),this.counters.push(s)}else for(let i=0;i<e.length;i+=3){const r=i/(e.length-1);this.positions.push(e[i],e[i+1],e[i+2]),this.positions.push(e[i],e[i+1],e[i+2]),this.counters.push(r),this.counters.push(r)}this.process()}compareV3(e,t){const i=e*6,r=t*6;return this.positions[i]===this.positions[r]&&this.positions[i+1]===this.positions[r+1]&&this.positions[i+2]===this.positions[r+2]}copyV3(e){const t=e*6;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}process(){const e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];let t,i;this.compareV3(0,e-1)?i=this.copyV3(e-2):i=this.copyV3(0),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);for(let r=0;r<e;r++){if(this.side.push(1),this.side.push(-1),this.widthCallback?t=this.widthCallback(r/(e-1)):t=1,this.width.push(t),this.width.push(t),this.uvs.push(r/(e-1),0),this.uvs.push(r/(e-1),1),r<e-1){i=this.copyV3(r),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);const s=r*2;this.indices_array.push(s,s+1,s+2),this.indices_array.push(s+2,s+1,s+3)}r>0&&(i=this.copyV3(r),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]))}this.compareV3(e-1,0)?i=this.copyV3(1):i=this.copyV3(e-1),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]),!this._attributes||this._attributes.position.count!==this.counters.length?this._attributes={position:new Mt(new Float32Array(this.positions),3),previous:new Mt(new Float32Array(this.previous),3),next:new Mt(new Float32Array(this.next),3),side:new Mt(new Float32Array(this.side),1),width:new Mt(new Float32Array(this.width),1),uv:new Mt(new Float32Array(this.uvs),2),index:new Mt(new Uint16Array(this.indices_array),1),counters:new Mt(new Float32Array(this.counters),1)}:(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:t,z:i}){const r=this._attributes.position.array,s=this._attributes.previous.array,o=this._attributes.next.array,a=r.length;tl(r,0,s,0,a),tl(r,6,r,0,a-6),r[a-6]=e,r[a-5]=t,r[a-4]=i,r[a-3]=e,r[a-2]=t,r[a-1]=i,tl(r,6,o,0,a-6),o[a-6]=e,o[a-5]=t,o[a-4]=i,o[a-3]=e,o[a-2]=t,o[a-1]=i,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}const sy=`
  #include <common>
  #include <logdepthbuf_pars_vertex>
  #include <fog_pars_vertex>
  #include <clipping_planes_pars_vertex>

  attribute vec3 previous;
  attribute vec3 next;
  attribute float side;
  attribute float width;
  attribute float counters;
  
  uniform vec2 resolution;
  uniform float lineWidth;
  uniform vec3 color;
  uniform float opacity;
  uniform float sizeAttenuation;
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
  }
  
  void main() {
    float aspect = resolution.x / resolution.y;
    vColor = vec4(color, opacity);
    vUV = uv;
    vCounters = counters;
  
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4(position, 1.0) * aspect;
    vec4 prevPos = m * vec4(previous, 1.0);
    vec4 nextPos = m * vec4(next, 1.0);
  
    vec2 currentP = fix(finalPosition, aspect);
    vec2 prevP = fix(prevPos, aspect);
    vec2 nextP = fix(nextPos, aspect);
  
    float w = lineWidth * width;
  
    vec2 dir;
    if (nextP == currentP) dir = normalize(currentP - prevP);
    else if (prevP == currentP) dir = normalize(nextP - currentP);
    else {
      vec2 dir1 = normalize(currentP - prevP);
      vec2 dir2 = normalize(nextP - currentP);
      dir = normalize(dir1 + dir2);
  
      vec2 perp = vec2(-dir1.y, dir1.x);
      vec2 miter = vec2(-dir.y, dir.x);
      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);
    }
  
    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    //normal *= projectionMatrix;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;
    }
  
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
    #include <fog_vertex>
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    #include <clipping_planes_vertex>
    #include <fog_vertex>
  }
`,oy=parseInt(bo.replace(/\D+/g,"")),ay=oy>=154?"colorspace_fragment":"encodings_fragment",cy=`
  #include <fog_pars_fragment>
  #include <logdepthbuf_pars_fragment>
  #include <clipping_planes_pars_fragment>
  
  uniform sampler2D map;
  uniform sampler2D alphaMap;
  uniform float useGradient;
  uniform float useMap;
  uniform float useAlphaMap;
  uniform float useDash;
  uniform float dashArray;
  uniform float dashOffset;
  uniform float dashRatio;
  uniform float visibility;
  uniform float alphaTest;
  uniform vec2 repeat;
  uniform vec3 gradient[2];
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  void main() {
    #include <logdepthbuf_fragment>
    vec4 diffuseColor = vColor;
    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);
    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);
    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;
    if (diffuseColor.a < alphaTest) discard;
    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));
    diffuseColor.a *= step(vCounters, visibility);
    #include <clipping_planes_fragment>
    gl_FragColor = diffuseColor;     
    #include <fog_fragment>
    #include <tonemapping_fragment>
    #include <${ay}>
  }
`;class ly extends jt{constructor(e){super({uniforms:{...Wl.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new ze(16777215)},gradient:{value:[new ze(16711680),new ze(65280)]},opacity:{value:1},resolution:{value:new _e(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new _e(1,1)}},vertexShader:sy,fragmentShader:cy}),Ze(this,"lineWidth"),Ze(this,"map"),Ze(this,"useMap"),Ze(this,"alphaMap"),Ze(this,"useAlphaMap"),Ze(this,"color"),Ze(this,"gradient"),Ze(this,"resolution"),Ze(this,"sizeAttenuation"),Ze(this,"dashArray"),Ze(this,"dashOffset"),Ze(this,"dashRatio"),Ze(this,"useDash"),Ze(this,"useGradient"),Ze(this,"visibility"),Ze(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(t){this.uniforms.color.value=t}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(t){this.uniforms.gradient.value=t}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(t){this.uniforms.dashArray.value=t,this.useDash=t!==0?1:0}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(t){this.uniforms.useDash.value=t}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(t){this.uniforms.useGradient.value=t}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(t){this.uniforms.repeat.value.copy(t)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}const Ud={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},uy=(n,e=1)=>(n.set(n.subarray(e)),n.fill(-1/0,-e),n);function hy(n,e){const{length:t,local:i,decay:r,interval:s,stride:o}={...Ud,...e},a=l.useRef(),[c]=l.useState(()=>new T);l.useLayoutEffect(()=>{n&&(a.current=Float32Array.from({length:t*10*3},(h,A)=>n.position.getComponent(A%3)))},[t,n]);const u=l.useRef(new T),f=l.useRef(0);return Se(()=>{if(n&&a.current){if(f.current===0){let h;i?h=n.position:(n.getWorldPosition(c),h=c);const A=1*r;for(let y=0;y<A;y++)h.distanceTo(u.current)<o||(uy(a.current,3),a.current.set(h.toArray(),a.current.length-3));u.current.copy(h)}f.current++,f.current=f.current%s}}),a}const i9=l.forwardRef((n,e)=>{const{children:t}=n,{width:i,length:r,decay:s,local:o,stride:a,interval:c}={...Ud,...n},{color:u="hotpink",attenuation:f,target:h}=n,A=J(E=>E.size),y=J(E=>E.scene),x=l.useRef(null),[d,v]=l.useState(null),g=hy(d,{length:r,decay:s,local:o,stride:a,interval:c});l.useEffect(()=>{const E=(h==null?void 0:h.current)||x.current.children.find(w=>w instanceof Ot);E&&v(E)},[g,h]);const p=l.useMemo(()=>new ry,[]),m=l.useMemo(()=>{var E;const w=new ly({lineWidth:.1*i,color:u,sizeAttenuation:1,resolution:new _e(A.width,A.height)});let _;if(t)if(Array.isArray(t))_=t.find(C=>{const I=C;return typeof I.type=="string"&&I.type==="meshLineMaterial"});else{const C=t;typeof C.type=="string"&&C.type==="meshLineMaterial"&&(_=C)}return typeof((E=_)==null?void 0:E.props)=="object"&&w.setValues(_.props),w},[i,u,A,t]);return l.useEffect(()=>{m.uniforms.resolution.value.set(A.width,A.height)},[A]),Se(()=>{g.current&&p.setPoints(g.current,f)}),l.createElement("group",null,pr(l.createElement("mesh",{ref:e,geometry:p,material:m}),y),l.createElement("group",{ref:x},t))});function fy(n,e=16,t,i,r){const[s,o]=l.useState(()=>{const a=Array.from({length:e},()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]).flat();return new Xl(Float32Array.from(a),16)});return l.useLayoutEffect(()=>{if(typeof n.current>"u")return;const a=new Zg(n.current);i&&a.setWeightAttribute(i),a.build();const c=new T,u=new T,f=new ze,h=new Ot;n.current.updateMatrixWorld(!0);for(let A=0;A<e;A++)a.sample(c,u,f),typeof t=="function"?t({dummy:h,sampledMesh:n.current,position:c,normal:u,color:f},A):h.position.copy(c),h.updateMatrix(),r!=null&&r.current&&r.current.setMatrixAt(A,h.matrix),h.matrix.toArray(s.array,A*16);r!=null&&r.current&&(r.current.instanceMatrix.needsUpdate=!0),s.needsUpdate=!0,o(new Xl(s.array,s.itemSize).copy(s))},[n,r,i,e,t]),s}function r9({children:n,weight:e,transform:t,instances:i,mesh:r,count:s=16,...o}){const a=l.useRef(null),c=l.useRef(null),u=l.useRef(null);return l.useLayoutEffect(()=>{var f,h;c.current=(f=i==null?void 0:i.current)!==null&&f!==void 0?f:a.current.children.find(A=>A.hasOwnProperty("instanceMatrix")),u.current=(h=r==null?void 0:r.current)!==null&&h!==void 0?h:a.current.children.find(A=>A.type==="Mesh")},[n,r==null?void 0:r.current,i==null?void 0:i.current]),fy(u,s,t,e,c),l.createElement("group",ce({ref:a},o),n)}const s9=({compute:n,name:e,...t})=>{const[i]=l.useState(()=>new Mt(new Float32Array(0),1)),r=l.useRef(null);return l.useLayoutEffect(()=>{if(r.current){var s;const o=(s=r.current.parent)!==null&&s!==void 0?s:r.current.__r3f.parent,a=n(o);r.current.copy(a)}},[n]),l.createElement("primitive",ce({ref:r,object:i,attach:`attributes-${e}`},t))},c0=l.createContext(null),o9=l.forwardRef(({resolution:n=28,maxPolyCount:e=1e4,enableUvs:t=!1,enableColors:i=!1,children:r,...s},o)=>{const a=l.useRef(null);l.useImperativeHandle(o,()=>a.current,[]);const c=l.useMemo(()=>new Hg(n,null,t,i,e),[n,e,t,i]),u=l.useMemo(()=>({getParent:()=>a}),[]);return Se(()=>{c.update(),c.reset()},-1),l.createElement(l.Fragment,null,l.createElement("primitive",ce({object:c,ref:a},s),l.createElement(c0.Provider,{value:u},r)))}),a9=l.forwardRef(({strength:n=.5,subtract:e=12,color:t,...i},r)=>{const{getParent:s}=l.useContext(c0),o=l.useMemo(()=>s(),[s]),a=l.useRef(null);l.useImperativeHandle(r,()=>a.current,[]);const c=new T;return Se(u=>{!o.current||!a.current||(a.current.getWorldPosition(c),o.current.addBall(.5+c.x*.5,.5+c.y*.5,.5+c.z*.5,n,e,t))}),l.createElement("group",ce({ref:a},i))}),c9=l.forwardRef(({planeType:n="x",strength:e=.5,subtract:t=12,...i},r)=>{const{getParent:s}=l.useContext(c0),o=l.useMemo(()=>s(),[s]),a=l.useRef(null);l.useImperativeHandle(r,()=>a.current,[]);const c=l.useMemo(()=>n==="x"?"addPlaneX":n==="y"?"addPlaneY":"addPlaneZ",[n]);return Se(()=>{!o.current||!a.current||o.current[c](e,t)}),l.createElement("group",ce({ref:a},i))});function Ay(n){return Array.isArray(n)}function nl(n=[0,0,0]){return Ay(n)?n:n instanceof T||n instanceof En?[n.x,n.y,n.z]:[n,n,n]}const l9=l.forwardRef(function({debug:e,depthTest:t=!1,polygonOffsetFactor:i=-10,map:r,mesh:s,children:o,position:a,rotation:c,scale:u,...f},h){const A=l.useRef(null);l.useImperativeHandle(h,()=>A.current);const y=l.useRef(null);return l.useLayoutEffect(()=>{const x=(s==null?void 0:s.current)||A.current.parent,d=A.current;if(!(x instanceof be))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const v={position:new T,rotation:new En,scale:new T(1,1,1)};if(x){Fn(v,{position:a,scale:u});const g=x.matrixWorld.clone();if(x.matrixWorld.identity(),!c||typeof c=="number"){const p=new Ot;p.position.copy(v.position),p.lookAt(x.position),typeof c=="number"&&p.rotateZ(c),Fn(v,{rotation:p.rotation})}else Fn(v,{rotation:c});return d.geometry=new z4(x,v.position,v.rotation,v.scale),y.current&&(Fn(y.current,v),y.current.traverse(p=>p.raycast=()=>null)),x.matrixWorld=g,()=>{d.geometry.dispose()}}},[s,...nl(a),...nl(u),...nl(c)]),l.createElement("mesh",ce({ref:A,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":t,"material-map":r},f),o,e&&l.createElement("mesh",{ref:y},l.createElement("boxGeometry",null),l.createElement("meshNormalMaterial",{wireframe:!0}),l.createElement("axesHelper",null)))}),u9=l.forwardRef(function({src:e,skipFill:t,skipStrokes:i,fillMaterial:r,strokeMaterial:s,fillMeshProps:o,strokeMeshProps:a,...c},u){const f=Xt(go,e.startsWith("<svg")?`data:image/svg+xml;utf8,${e}`:e),h=l.useMemo(()=>i?[]:f.paths.map(y=>{var x;return((x=y.userData)==null?void 0:x.style.stroke)===void 0||y.userData.style.stroke==="none"?null:y.subPaths.map(d=>go.pointsToStroke(d.getPoints(),y.userData.style))}),[f,i]);l.useEffect(()=>()=>h.forEach(y=>y&&y.map(x=>x.dispose())),[h]);let A=0;return l.createElement("object3D",ce({ref:u},c),l.createElement("object3D",{scale:[1,-1,1]},f.paths.map((y,x)=>{var d,v;return l.createElement(l.Fragment,{key:x},!t&&((d=y.userData)==null?void 0:d.style.fill)!==void 0&&y.userData.style.fill!=="none"&&go.createShapes(y).map((g,p)=>l.createElement("mesh",ce({key:p},o,{renderOrder:A++}),l.createElement("shapeGeometry",{args:[g]}),l.createElement("meshBasicMaterial",ce({color:y.userData.style.fill,opacity:y.userData.style.fillOpacity,transparent:!0,side:on,depthWrite:!1},r)))),!i&&((v=y.userData)==null?void 0:v.style.stroke)!==void 0&&y.userData.style.stroke!=="none"&&y.subPaths.map((g,p)=>l.createElement("mesh",ce({key:p,geometry:h[x][p]},a,{renderOrder:A++}),l.createElement("meshBasicMaterial",ce({color:y.userData.style.stroke,opacity:y.userData.style.strokeOpacity,transparent:!0,side:on,depthWrite:!1},s)))))})))});function h9({renderIndex:n=1,bgColor:e="black",fgColor:t="white",characters:i=" .:-+*=%@#",invert:r=!0,color:s=!1,resolution:o=.15}){const{size:a,gl:c,scene:u,camera:f}=J(),h=l.useMemo(()=>{const A=new N4(c,i,{invert:r,color:s,resolution:o});return A.domElement.style.position="absolute",A.domElement.style.top="0px",A.domElement.style.left="0px",A.domElement.style.pointerEvents="none",A},[i,r,s,o]);return l.useLayoutEffect(()=>{h.domElement.style.color=t,h.domElement.style.backgroundColor=e},[t,e]),l.useEffect(()=>(c.domElement.style.opacity="0",c.domElement.parentNode.appendChild(h.domElement),()=>{c.domElement.style.opacity="1",c.domElement.parentNode.removeChild(h.domElement)}),[h]),l.useEffect(()=>{h.setSize(a.width,a.height)},[h,a]),Se(A=>{h.render(u,f)},n),l.createElement(l.Fragment,null)}const o1=ti({alphaTest:0,viewport:new _e(1980,1080),focal:1e3,centerAndScaleTexture:null,covAndColorTexture:null},`
    precision highp sampler2D;
    precision highp usampler2D;
    out vec4 vColor;
    out vec3 vPosition;
    uniform vec2 resolution;
    uniform vec2 viewport;
    uniform float focal;
    attribute uint splatIndex;
    uniform sampler2D centerAndScaleTexture;
    uniform usampler2D covAndColorTexture;    

    vec2 unpackInt16(in uint value) {
      int v = int(value);
      int v0 = v >> 16;
      int v1 = (v & 0xFFFF);
      if((v & 0x8000) != 0)
        v1 |= 0xFFFF0000;
      return vec2(float(v1), float(v0));
    }

    void main () {
      ivec2 texSize = textureSize(centerAndScaleTexture, 0);
      ivec2 texPos = ivec2(splatIndex%uint(texSize.x), splatIndex/uint(texSize.x));
      vec4 centerAndScaleData = texelFetch(centerAndScaleTexture, texPos, 0);
      vec4 center = vec4(centerAndScaleData.xyz, 1);
      vec4 camspace = modelViewMatrix * center;
      vec4 pos2d = projectionMatrix * camspace;

      float bounds = 1.2 * pos2d.w;
      if (pos2d.z < -pos2d.w || pos2d.x < -bounds || pos2d.x > bounds
        || pos2d.y < -bounds || pos2d.y > bounds) {
        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);
        return;
      }

      uvec4 covAndColorData = texelFetch(covAndColorTexture, texPos, 0);
      vec2 cov3D_M11_M12 = unpackInt16(covAndColorData.x) * centerAndScaleData.w;
      vec2 cov3D_M13_M22 = unpackInt16(covAndColorData.y) * centerAndScaleData.w;
      vec2 cov3D_M23_M33 = unpackInt16(covAndColorData.z) * centerAndScaleData.w;
      mat3 Vrk = mat3(
        cov3D_M11_M12.x, cov3D_M11_M12.y, cov3D_M13_M22.x,
        cov3D_M11_M12.y, cov3D_M13_M22.y, cov3D_M23_M33.x,
        cov3D_M13_M22.x, cov3D_M23_M33.x, cov3D_M23_M33.y
      );

      mat3 J = mat3(
        focal / camspace.z, 0., -(focal * camspace.x) / (camspace.z * camspace.z),
        0., focal / camspace.z, -(focal * camspace.y) / (camspace.z * camspace.z),
        0., 0., 0.
      );

      mat3 W = transpose(mat3(modelViewMatrix));
      mat3 T = W * J;
      mat3 cov = transpose(T) * Vrk * T;
      vec2 vCenter = vec2(pos2d) / pos2d.w;
      float diagonal1 = cov[0][0] + 0.3;
      float offDiagonal = cov[0][1];
      float diagonal2 = cov[1][1] + 0.3;
      float mid = 0.5 * (diagonal1 + diagonal2);
      float radius = length(vec2((diagonal1 - diagonal2) / 2.0, offDiagonal));
      float lambda1 = mid + radius;
      float lambda2 = max(mid - radius, 0.1);
      vec2 diagonalVector = normalize(vec2(offDiagonal, lambda1 - diagonal1));
      vec2 v1 = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;
      vec2 v2 = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);
      uint colorUint = covAndColorData.w;
      vColor = vec4(
        float(colorUint & uint(0xFF)) / 255.0,
        float((colorUint >> uint(8)) & uint(0xFF)) / 255.0,
        float((colorUint >> uint(16)) & uint(0xFF)) / 255.0,
        float(colorUint >> uint(24)) / 255.0
      );
      vPosition = position;

      gl_Position = vec4(
        vCenter 
          + position.x * v2 / viewport * 2.0 
          + position.y * v1 / viewport * 2.0, pos2d.z / pos2d.w, 1.0);
    }
    `,`
    #include <alphatest_pars_fragment>
    #include <alphahash_pars_fragment>
    in vec4 vColor;
    in vec3 vPosition;
    void main () {
      float A = -dot(vPosition.xy, vPosition.xy);
      if (A < -4.0) discard;
      float B = exp(A) * vColor.a;
      vec4 diffuseColor = vec4(vColor.rgb, B);
      #include <alphatest_fragment>
      #include <alphahash_fragment>
      gl_FragColor = diffuseColor;
      #include <tonemapping_fragment>
      #include <${parseInt(bo.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `);function dy(n){let e=null,t=0;function i(r,s=!1){const o=e.length/16,a=-1e-4;let c=-1/0,u=1/0;const f=new Float32Array(o),h=new Int32Array(f.buffer),A=new Int32Array(o);let y=0;for(let p=0;p<o;p++){const m=r[0]*e[p*16+12]+r[1]*e[p*16+13]+r[2]*e[p*16+14]+r[3];(s||m<0&&e[p*16+15]>a*m)&&(f[y]=m,A[y]=p,y++,m>c&&(c=m),m<u&&(u=m))}const x=(256*256-1)/(c-u),d=new Uint32Array(256*256);for(let p=0;p<y;p++)h[p]=(f[p]-u)*x|0,d[h[p]]++;const v=new Uint32Array(256*256);for(let p=1;p<256*256;p++)v[p]=v[p-1]+d[p-1];const g=new Uint32Array(y);for(let p=0;p<y;p++)g[v[h[p]]++]=A[p];return g}n.onmessage=r=>{if(r.data.method=="push"){t===0&&(e=new Float32Array(r.data.length));const s=new Float32Array(r.data.matrices);e.set(s,t),t+=s.length}else if(r.data.method=="sort"&&e!==null){const s=i(new Float32Array(r.data.view),r.data.hashed);n.postMessage({indices:s,key:r.data.key},[s.buffer])}}}class my extends hs{constructor(...e){super(...e),this.gl=null,this.chunkSize=25e3}load(e,t,i,r){const s={gl:this.gl,url:this.manager.resolveURL(e),worker:new Worker(URL.createObjectURL(new Blob(["(",dy.toString(),")(self)"],{type:"application/javascript"}))),manager:this.manager,update:(o,a,c)=>yy(a,s,o,c),connect:o=>vy(s,o),loading:!1,loaded:!1,loadedVertexCount:0,chunkSize:this.chunkSize,totalDownloadBytes:0,numVertices:0,rowLength:32,maxVertexes:0,bufferTextureWidth:0,bufferTextureHeight:0,stream:null,centerAndScaleData:null,covAndColorData:null,covAndColorTexture:null,centerAndScaleTexture:null,onProgress:i};py(s).then(t).catch(o=>{r==null||r(o),s.manager.itemError(s.url)})}}async function py(n){n.manager.itemStart(n.url);const e=await fetch(n.url);if(e.body===null)throw"Failed to fetch file";let t=e.headers.get("Content-Length");const i=t?parseInt(t):void 0;if(i==null)throw"Failed to get content length";n.stream=e.body.getReader(),n.totalDownloadBytes=i,n.numVertices=Math.floor(n.totalDownloadBytes/n.rowLength);const r=n.gl.getContext();let s=r.getParameter(r.MAX_TEXTURE_SIZE);return n.maxVertexes=s*s,n.numVertices>n.maxVertexes&&(n.numVertices=n.maxVertexes),n.bufferTextureWidth=s,n.bufferTextureHeight=Math.floor((n.numVertices-1)/s)+1,n.centerAndScaleData=new Float32Array(n.bufferTextureWidth*n.bufferTextureHeight*4),n.covAndColorData=new Uint32Array(n.bufferTextureWidth*n.bufferTextureHeight*4),n.centerAndScaleTexture=new Ki(n.centerAndScaleData,n.bufferTextureWidth,n.bufferTextureHeight,Lt,pt),n.centerAndScaleTexture.needsUpdate=!0,n.covAndColorTexture=new Ki(n.covAndColorData,n.bufferTextureWidth,n.bufferTextureHeight,Ua,ur),n.covAndColorTexture.internalFormat="RGBA32UI",n.covAndColorTexture.needsUpdate=!0,n}async function gy(n){n.loading=!0;let e=0,t=0;const i=[];let r=0;const s=n.totalDownloadBytes!==0;for(;;)try{const{value:o,done:a}=await n.stream.read();if(a)break;if(e+=o.length,n.totalDownloadBytes!=null){const u=e/n.totalDownloadBytes*100;if(n.onProgress&&u-r>1){const f=new ProgressEvent("progress",{lengthComputable:s,loaded:e,total:n.totalDownloadBytes});n.onProgress(f),r=u}}i.push(o);const c=e-t;if(n.totalDownloadBytes!=null&&c>n.rowLength*n.chunkSize){let u=Math.floor(c/n.rowLength);const f=new Uint8Array(c);let h=0;for(const x of i)f.set(x,h),h+=x.length;if(i.length=0,c>u*n.rowLength){const x=new Uint8Array(c-u*n.rowLength);x.set(f.subarray(c-x.length,c),0),i.push(x)}const A=new Uint8Array(u*n.rowLength);A.set(f.subarray(0,A.byteLength),0);const y=a1(n,A.buffer,u);if(n.worker.postMessage({method:"push",src:n.url,length:n.numVertices*16,matrices:y.buffer},[y.buffer]),t+=u*n.rowLength,n.onProgress){const x=new ProgressEvent("progress",{lengthComputable:s,loaded:n.totalDownloadBytes,total:n.totalDownloadBytes});n.onProgress(x)}}}catch(o){console.error(o);break}if(e-t>0){let o=new Uint8Array(i.reduce((f,h)=>f+h.length,0)),a=0;for(const f of i)o.set(f,a),a+=f.length;let c=Math.floor(o.byteLength/n.rowLength);const u=a1(n,o.buffer,c);n.worker.postMessage({method:"push",src:n.url,length:c*16,matrices:u.buffer},[u.buffer])}n.loaded=!0,n.manager.itemEnd(n.url)}function yy(n,e,t,i){if(n.updateMatrixWorld(),e.gl.getCurrentViewport(t.viewport),t.material.viewport.x=t.viewport.z,t.material.viewport.y=t.viewport.w,t.material.focal=t.viewport.w/2*Math.abs(n.projectionMatrix.elements[5]),t.ready){if(i&&t.sorted)return;t.ready=!1;const r=new Float32Array([t.modelViewMatrix.elements[2],-t.modelViewMatrix.elements[6],t.modelViewMatrix.elements[10],t.modelViewMatrix.elements[14]]);e.worker.postMessage({method:"sort",src:e.url,key:t.uuid,view:r.buffer,hashed:i},[r.buffer]),i&&e.loaded&&(t.sorted=!0)}}function vy(n,e){n.loading||gy(n),e.ready=!1,e.pm=new ue,e.vm1=new ue,e.vm2=new ue,e.viewport=new Qt;let t=new Uint32Array(n.bufferTextureWidth*n.bufferTextureHeight);const i=new Xl(t,1,!1);i.setUsage(sn);const r=e.geometry=new eA,s=new Float32Array(6*3),o=new Mt(s,3);r.setAttribute("position",o),o.setXYZ(2,-2,2,0),o.setXYZ(1,2,2,0),o.setXYZ(0,-2,-2,0),o.setXYZ(5,-2,-2,0),o.setXYZ(4,2,2,0),o.setXYZ(3,2,-2,0),o.needsUpdate=!0,r.setAttribute("splatIndex",i),r.instanceCount=1;function a(u){if(e&&u.data.key===e.uuid){let f=new Uint32Array(u.data.indices);r.attributes.splatIndex.set(f),r.attributes.splatIndex.needsUpdate=!0,r.instanceCount=f.length,e.ready=!0}}n.worker.addEventListener("message",a);async function c(){for(;;){const u=n.gl.properties.get(n.centerAndScaleTexture),f=n.gl.properties.get(n.covAndColorTexture);if(u!=null&&u.__webglTexture&&f!=null&&f.__webglTexture&&n.loadedVertexCount>0)break;await new Promise(h=>setTimeout(h,10))}e.ready=!0}return c(),()=>n.worker.removeEventListener("message",a)}function a1(n,e,t){const i=n.gl.getContext();if(n.loadedVertexCount+t>n.maxVertexes&&(t=n.maxVertexes-n.loadedVertexCount),t<=0)throw"Failed to parse file";const r=new Uint8Array(e),s=new Float32Array(e),o=new Float32Array(t*16),a=new Uint8Array(n.covAndColorData.buffer),c=new Int16Array(n.covAndColorData.buffer);for(let u=0;u<t;u++){const f=new Fe(-(r[32*u+28+1]-128)/128,(r[32*u+28+2]-128)/128,(r[32*u+28+3]-128)/128,-(r[32*u+28+0]-128)/128);f.invert();const h=new T(s[8*u+0],s[8*u+1],-s[8*u+2]),A=new T(s[8*u+3+0],s[8*u+3+1],s[8*u+3+2]),y=new ue;y.makeRotationFromQuaternion(f),y.transpose(),y.scale(A);const x=y.clone();y.transpose(),y.premultiply(x),y.setPosition(h);const d=[0,1,2,5,6,10];let v=0;for(let m=0;m<d.length;m++)Math.abs(y.elements[d[m]])>v&&(v=Math.abs(y.elements[d[m]]));let g=n.loadedVertexCount*4+u*4;n.centerAndScaleData[g+0]=h.x,n.centerAndScaleData[g+1]=-h.y,n.centerAndScaleData[g+2]=h.z,n.centerAndScaleData[g+3]=v/32767,g=n.loadedVertexCount*8+u*4*2;for(let m=0;m<d.length;m++)c[g+m]=y.elements[d[m]]*32767/v;g=n.loadedVertexCount*16+(u*4+3)*4;const p=new ze(r[32*u+24+0]/255,r[32*u+24+1]/255,r[32*u+24+2]/255);p.convertSRGBToLinear(),a[g+0]=p.r*255,a[g+1]=p.g*255,a[g+2]=p.b*255,a[g+3]=r[32*u+24+3],y.elements[15]=Math.max(A.x,A.y,A.z)*r[32*u+24+3]/255;for(let m=0;m<16;m++)o[u*16+m]=y.elements[m]}for(;t>0;){let u=0,f=0;const h=n.loadedVertexCount%n.bufferTextureWidth,A=Math.floor(n.loadedVertexCount/n.bufferTextureWidth);n.loadedVertexCount%n.bufferTextureWidth!=0?(u=Math.min(n.bufferTextureWidth,h+t)-h,f=1):Math.floor(t/n.bufferTextureWidth)>0?(u=n.bufferTextureWidth,f=Math.floor(t/n.bufferTextureWidth)):(u=t%n.bufferTextureWidth,f=1);const y=n.gl.properties.get(n.centerAndScaleTexture);i.bindTexture(i.TEXTURE_2D,y.__webglTexture),i.texSubImage2D(i.TEXTURE_2D,0,h,A,u,f,i.RGBA,i.FLOAT,n.centerAndScaleData,n.loadedVertexCount*4);const x=n.gl.properties.get(n.covAndColorTexture);i.bindTexture(i.TEXTURE_2D,x.__webglTexture),i.texSubImage2D(i.TEXTURE_2D,0,h,A,u,f,i.RGBA_INTEGER,i.UNSIGNED_INT,n.covAndColorData,n.loadedVertexCount*4),n.gl.resetState(),n.loadedVertexCount+=u*f,t-=u*f}return o}function f9({src:n,toneMapped:e=!1,alphaTest:t=0,alphaHash:i=!1,chunkSize:r=25e3,...s}){Pt({SplatMaterial:o1});const o=l.useRef(null),a=J(f=>f.gl),c=J(f=>f.camera),u=Xt(my,n,f=>{f.gl=a,f.chunkSize=r});return l.useLayoutEffect(()=>u.connect(o.current),[n]),Se(()=>u.update(o.current,c,i)),l.createElement("mesh",ce({ref:o,frustumCulled:!1},s),l.createElement("splatMaterial",{key:`${n}/${t}/${i}${o1.key}`,transparent:!i,depthTest:!0,alphaTest:i?0:t,centerAndScaleTexture:u.centerAndScaleTexture,covAndColorTexture:u.covAndColorTexture,depthWrite:i?!0:t>0,blending:i?S2:iA,blendSrcAlpha:rA,alphaHash:!!i,toneMapped:e}))}function mn(n,e,t){const i=J(A=>A.size),r=J(A=>A.viewport),s=typeof n=="number"?n:i.width*r.dpr,o=typeof e=="number"?e:i.height*r.dpr,a=(typeof n=="number"?t:n)||{},{samples:c=0,depth:u,...f}=a,h=l.useMemo(()=>{const A=new Tt(s,o,{minFilter:lt,magFilter:lt,type:xt,...f});return u&&(A.depthTexture=new sc(s,o,pt)),A.samples=c,A},[]);return l.useLayoutEffect(()=>{h.setSize(s,o),c&&(h.samples=c)},[c,h,s,o]),l.useEffect(()=>()=>h.dispose(),[]),h}const A9=({children:n,width:e,height:t,...i})=>{const r=mn(e,t,i);return l.createElement(l.Fragment,null,n==null?void 0:n(r))},xy=n=>typeof n=="function",Ey=l.forwardRef(({envMap:n,resolution:e=256,frames:t=1/0,children:i,makeDefault:r,...s},o)=>{const a=J(({set:v})=>v),c=J(({camera:v})=>v),u=J(({size:v})=>v),f=l.useRef(null);l.useImperativeHandle(o,()=>f.current,[]);const h=l.useRef(null),A=mn(e);l.useLayoutEffect(()=>{s.manual||f.current.updateProjectionMatrix()},[u,s]),l.useLayoutEffect(()=>{f.current.updateProjectionMatrix()}),l.useLayoutEffect(()=>{if(r){const v=c;return a(()=>({camera:f.current})),()=>a(()=>({camera:v}))}},[f,r,a]);let y=0,x=null;const d=xy(i);return Se(v=>{d&&(t===1/0||y<t)&&(h.current.visible=!1,v.gl.setRenderTarget(A),x=v.scene.background,n&&(v.scene.background=n),v.gl.render(v.scene,f.current),v.scene.background=x,v.gl.setRenderTarget(null),h.current.visible=!0,y++)}),l.createElement(l.Fragment,null,l.createElement("orthographicCamera",ce({left:u.width/-2,right:u.width/2,top:u.height/2,bottom:u.height/-2,ref:f},s),!d&&i),l.createElement("group",{ref:h},d&&i(A.texture)))}),wy=n=>typeof n=="function",d9=l.forwardRef(({envMap:n,resolution:e=256,frames:t=1/0,makeDefault:i,children:r,...s},o)=>{const a=J(({set:v})=>v),c=J(({camera:v})=>v),u=J(({size:v})=>v),f=l.useRef(null);l.useImperativeHandle(o,()=>f.current,[]);const h=l.useRef(null),A=mn(e);l.useLayoutEffect(()=>{s.manual||(f.current.aspect=u.width/u.height)},[u,s]),l.useLayoutEffect(()=>{f.current.updateProjectionMatrix()});let y=0,x=null;const d=wy(r);return Se(v=>{d&&(t===1/0||y<t)&&(h.current.visible=!1,v.gl.setRenderTarget(A),x=v.scene.background,n&&(v.scene.background=n),v.gl.render(v.scene,f.current),v.scene.background=x,v.gl.setRenderTarget(null),h.current.visible=!0,y++)}),l.useLayoutEffect(()=>{if(i){const v=c;return a(()=>({camera:f.current})),()=>a(()=>({camera:v}))}},[f,i,a]),l.createElement(l.Fragment,null,l.createElement("perspectiveCamera",ce({ref:f},s),!d&&r),l.createElement("group",{ref:h},d&&r(A.texture)))});function _y({resolution:n=256,near:e=.1,far:t=1e3,envMap:i,fog:r}={}){const s=J(({gl:A})=>A),o=J(({scene:A})=>A),a=l.useMemo(()=>{const A=new oc(n);return A.texture.type=xt,A},[n]);l.useEffect(()=>()=>{a.dispose()},[a]);const c=l.useMemo(()=>new sA(e,t,a),[e,t,a]);let u,f;const h=l.useCallback(()=>{u=o.fog,f=o.background,o.background=i||f,o.fog=r||u,c.update(s,o),o.fog=u,o.background=f},[s,o,c]);return{fbo:a,camera:c,update:h}}function m9({children:n,frames:e=1/0,resolution:t,near:i,far:r,envMap:s,fog:o,...a}){const c=l.useRef(null),{fbo:u,camera:f,update:h}=_y({resolution:t,near:i,far:r,envMap:s,fog:o});let A=0;return Se(()=>{c.current&&(e===1/0||A<e)&&(c.current.visible=!1,h(),c.current.visible=!0,A++)}),l.createElement("group",a,l.createElement("primitive",{object:f}),l.createElement("group",{ref:c},n==null?void 0:n(u.texture)))}const p9=l.forwardRef((n,e)=>{const{camera:t,onChange:i,makeDefault:r,...s}=n,o=J(A=>A.camera),a=J(A=>A.invalidate),c=J(A=>A.get),u=J(A=>A.set),f=t||o,h=l.useMemo(()=>new d4(f),[f]);return l.useEffect(()=>{const A=y=>{a(),i&&i(y)};return h==null||h.addEventListener==null||h.addEventListener("change",A),()=>h==null||h.removeEventListener==null?void 0:h.removeEventListener("change",A)},[i,h,a]),Se(()=>h==null?void 0:h.update(),-1),l.useEffect(()=>{const A=h;return A==null||A.connect(),()=>A==null?void 0:A.dispose()},[h]),l.useEffect(()=>{if(r){const A=c().controls;return u({controls:h}),()=>u({controls:A})}},[r,h]),h?l.createElement("primitive",ce({ref:e,object:h},s)):null}),g9=l.forwardRef(({domElement:n,...e},t)=>{const{onChange:i,makeDefault:r,...s}=e,o=J(x=>x.invalidate),a=J(x=>x.camera),c=J(x=>x.gl),u=J(x=>x.events),f=J(x=>x.get),h=J(x=>x.set),A=n||u.connected||c.domElement,y=l.useMemo(()=>new _4(a),[a]);return l.useEffect(()=>(y.connect(A),()=>void y.dispose()),[A,y,o]),l.useEffect(()=>{const x=d=>{o(),i&&i(d)};return y.addEventListener==null||y.addEventListener("change",x),()=>y.removeEventListener==null?void 0:y.removeEventListener("change",x)},[i,o]),l.useEffect(()=>{if(r){const x=f().controls;return h({controls:y}),()=>h({controls:x})}},[r,y]),Se((x,d)=>y.update(d)),l.createElement("primitive",ce({ref:t,object:y,args:[a,A]},s))}),y9=l.forwardRef((n={enableDamping:!0},e)=>{const{domElement:t,camera:i,makeDefault:r,onChange:s,onStart:o,onEnd:a,...c}=n,u=J(p=>p.invalidate),f=J(p=>p.camera),h=J(p=>p.gl),A=J(p=>p.events),y=J(p=>p.set),x=J(p=>p.get),d=t||A.connected||h.domElement,v=i||f,g=l.useMemo(()=>new M2(v),[v]);return l.useEffect(()=>{g.connect(d);const p=m=>{u(),s&&s(m)};return g.addEventListener("change",p),o&&g.addEventListener("start",o),a&&g.addEventListener("end",a),()=>{g.dispose(),g.removeEventListener("change",p),o&&g.removeEventListener("start",o),a&&g.removeEventListener("end",a)}},[s,o,a,g,u,d]),l.useEffect(()=>{if(r){const p=x().controls;return y({controls:g}),()=>y({controls:p})}},[r,g]),Se(()=>g.update(),-1),l.createElement("primitive",ce({ref:e,object:g,enableDamping:!0},c))}),v9=l.forwardRef(({makeDefault:n,camera:e,domElement:t,regress:i,onChange:r,onStart:s,onEnd:o,...a},c)=>{const{invalidate:u,camera:f,gl:h,events:A,set:y,get:x,performance:d,viewport:v}=J(),g=e||f,p=t||A.connected||h.domElement,m=l.useMemo(()=>new g4(g),[g]);return Se(()=>{m.enabled&&m.update()},-1),l.useEffect(()=>(m.connect(p),()=>void m.dispose()),[p,i,m,u]),l.useEffect(()=>{const E=w=>{u(),i&&d.regress(),r&&r(w)};return m.addEventListener("change",E),s&&m.addEventListener("start",s),o&&m.addEventListener("end",o),()=>{s&&m.removeEventListener("start",s),o&&m.removeEventListener("end",o),m.removeEventListener("change",E)}},[r,s,o,m,u]),l.useEffect(()=>{m.handleResize()},[v]),l.useEffect(()=>{if(n){const E=x().controls;return y({controls:m}),()=>y({controls:E})}},[n,m]),l.createElement("primitive",ce({ref:c,object:m},a))}),x9=l.forwardRef(({camera:n,makeDefault:e,regress:t,domElement:i,onChange:r,onStart:s,onEnd:o,...a},c)=>{const u=J(m=>m.invalidate),f=J(m=>m.camera),h=J(m=>m.gl),A=J(m=>m.events),y=J(m=>m.set),x=J(m=>m.get),d=J(m=>m.performance),v=n||f,g=i||A.connected||h.domElement,p=l.useMemo(()=>new x4(v),[v]);return Se(()=>{p.enabled&&p.update()},-1),l.useEffect(()=>(p.connect(g),()=>void p.dispose()),[g,t,p,u]),l.useEffect(()=>{const m=E=>{u(),t&&d.regress(),r&&r(E)};return p.addEventListener("change",m),s&&p.addEventListener("start",s),o&&p.addEventListener("end",o),()=>{p.removeEventListener("change",m),s&&p.removeEventListener("start",s),o&&p.removeEventListener("end",o)}},[r,s,o]),l.useEffect(()=>{if(e){const m=x().controls;return y({controls:p}),()=>y({controls:m})}},[e,p]),l.createElement("primitive",ce({ref:c,object:p},a))}),E9=l.forwardRef(({children:n,domElement:e,onChange:t,onMouseDown:i,onMouseUp:r,onObjectChange:s,object:o,makeDefault:a,camera:c,enabled:u,axis:f,mode:h,translationSnap:A,rotationSnap:y,scaleSnap:x,space:d,size:v,showX:g,showY:p,showZ:m,...E},w)=>{const _=J(H=>H.controls),C=J(H=>H.gl),I=J(H=>H.events),b=J(H=>H.camera),B=J(H=>H.invalidate),Q=J(H=>H.get),S=J(H=>H.set),k=c||b,L=e||I.connected||C.domElement,O=l.useMemo(()=>new i4(k,L),[k,L]),G=l.useRef(null);l.useLayoutEffect(()=>(o?O.attach(o instanceof Ot?o:o.current):G.current instanceof Ot&&O.attach(G.current),()=>void O.detach()),[o,n,O]),l.useEffect(()=>{if(_){const H=X=>_.enabled=!X.value;return O.addEventListener("dragging-changed",H),()=>O.removeEventListener("dragging-changed",H)}},[O,_]);const V=l.useRef(),N=l.useRef(),j=l.useRef(),Y=l.useRef();return l.useLayoutEffect(()=>void(V.current=t),[t]),l.useLayoutEffect(()=>void(N.current=i),[i]),l.useLayoutEffect(()=>void(j.current=r),[r]),l.useLayoutEffect(()=>void(Y.current=s),[s]),l.useEffect(()=>{const H=z=>{B(),V.current==null||V.current(z)},X=z=>N.current==null?void 0:N.current(z),W=z=>j.current==null?void 0:j.current(z),P=z=>Y.current==null?void 0:Y.current(z);return O.addEventListener("change",H),O.addEventListener("mouseDown",X),O.addEventListener("mouseUp",W),O.addEventListener("objectChange",P),()=>{O.removeEventListener("change",H),O.removeEventListener("mouseDown",X),O.removeEventListener("mouseUp",W),O.removeEventListener("objectChange",P)}},[B,O]),l.useEffect(()=>{if(a){const H=Q().controls;return S({controls:O}),()=>S({controls:H})}},[a,O]),l.createElement(l.Fragment,null,l.createElement("primitive",{ref:w,object:O,enabled:u,axis:f,mode:h,translationSnap:A,rotationSnap:y,scaleSnap:x,space:d,size:v,showX:g,showY:p,showZ:m}),l.createElement("group",ce({ref:G},E),n))}),w9=l.forwardRef(({domElement:n,selector:e,onChange:t,onLock:i,onUnlock:r,enabled:s=!0,makeDefault:o,...a},c)=>{const{camera:u,...f}=a,h=J(w=>w.setEvents),A=J(w=>w.gl),y=J(w=>w.camera),x=J(w=>w.invalidate),d=J(w=>w.events),v=J(w=>w.get),g=J(w=>w.set),p=u||y,m=n||d.connected||A.domElement,E=l.useMemo(()=>new h4(p),[p]);return l.useEffect(()=>{if(s){E.connect(m);const w=v().events.compute;return h({compute(_,C){const I=C.size.width/2,b=C.size.height/2;C.pointer.set(I/C.size.width*2-1,-(b/C.size.height)*2+1),C.raycaster.setFromCamera(C.pointer,C.camera)}}),()=>{E.disconnect(),h({compute:w})}}},[s,E]),l.useEffect(()=>{const w=I=>{x(),t&&t(I)};E.addEventListener("change",w),i&&E.addEventListener("lock",i),r&&E.addEventListener("unlock",r);const _=()=>E.lock(),C=e?Array.from(document.querySelectorAll(e)):[document];return C.forEach(I=>I&&I.addEventListener("click",_)),()=>{E.removeEventListener("change",w),i&&E.removeEventListener("lock",i),r&&E.removeEventListener("unlock",r),C.forEach(I=>I?I.removeEventListener("click",_):void 0)}},[t,i,r,e,E,x]),l.useEffect(()=>{if(o){const w=v().controls;return g({controls:E}),()=>g({controls:w})}},[o,E]),l.createElement("primitive",ce({ref:c,object:E},f))}),_9=l.forwardRef(({domElement:n,makeDefault:e,...t},i)=>{const r=J(h=>h.camera),s=J(h=>h.gl),o=J(h=>h.events),a=J(h=>h.get),c=J(h=>h.set),u=n||o.connected||s.domElement,[f]=l.useState(()=>new e4(r,u));return l.useEffect(()=>{if(e){const h=a().controls;return c({controls:f}),()=>c({controls:h})}},[e,f]),Se((h,A)=>{f.update(A)},-1),f?l.createElement("primitive",ce({ref:i,object:f},t)):null});/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Ct={LEFT:1,RIGHT:2,MIDDLE:4},ae=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Br={NONE:0,IN:1,OUT:-1};function or(n){return n.isPerspectiveCamera}function Ui(n){return n.isOrthographicCamera}const br=Math.PI*2,c1=Math.PI/2,Nd=1e-5,Os=Math.PI/180;function Kn(n,e,t){return Math.max(e,Math.min(t,n))}function ct(n,e=Nd){return Math.abs(n)<e}function $e(n,e,t=Nd){return ct(n-e,t)}function l1(n,e){return Math.round(n/e)*e}function Us(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Ns(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function ea(n,e,t,i,r=1/0,s){i=Math.max(1e-4,i);const o=2/i,a=o*s,c=1/(1+a+.48*a*a+.235*a*a*a);let u=n-e;const f=e,h=r*i;u=Kn(u,-h,h),e=n-u;const A=(t.value+o*u)*s;t.value=(t.value-o*A)*c;let y=e+(u+A)*c;return f-n>0==y>f&&(y=f,t.value=(y-f)/s),y}function u1(n,e,t,i,r=1/0,s,o){i=Math.max(1e-4,i);const a=2/i,c=a*s,u=1/(1+c+.48*c*c+.235*c*c*c);let f=e.x,h=e.y,A=e.z,y=n.x-f,x=n.y-h,d=n.z-A;const v=f,g=h,p=A,m=r*i,E=m*m,w=y*y+x*x+d*d;if(w>E){const O=Math.sqrt(w);y=y/O*m,x=x/O*m,d=d/O*m}f=n.x-y,h=n.y-x,A=n.z-d;const _=(t.x+a*y)*s,C=(t.y+a*x)*s,I=(t.z+a*d)*s;t.x=(t.x-a*_)*u,t.y=(t.y-a*C)*u,t.z=(t.z-a*I)*u,o.x=f+(y+_)*u,o.y=h+(x+C)*u,o.z=A+(d+I)*u;const b=v-n.x,B=g-n.y,Q=p-n.z,S=o.x-v,k=o.y-g,L=o.z-p;return b*S+B*k+Q*L>0&&(o.x=v,o.y=g,o.z=p,t.x=(o.x-v)/s,t.y=(o.y-g)/s,t.z=(o.z-p)/s),o}function il(n,e){e.set(0,0),n.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=n.length,e.y/=n.length}function rl(n,e){return Ui(n)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Cy{constructor(){this._listeners={}}addEventListener(e,t){const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e)}}}var sl;const Iy="2.9.0",ta=1/8,By=/Mac/.test((sl=globalThis==null?void 0:globalThis.navigator)===null||sl===void 0?void 0:sl.platform);let Le,h1,na,ol,An,He,Ke,Sr,Gs,ai,ci,ar,f1,A1,Tn,Hs,Mr,d1,al,m1,cl,ll,ia,ul=class yu extends Cy{static install(e){Le=e.THREE,h1=Object.freeze(new Le.Vector3(0,0,0)),na=Object.freeze(new Le.Vector3(0,1,0)),ol=Object.freeze(new Le.Vector3(0,0,1)),An=new Le.Vector2,He=new Le.Vector3,Ke=new Le.Vector3,Sr=new Le.Vector3,Gs=new Le.Vector3,ai=new Le.Vector3,ci=new Le.Vector3,ar=new Le.Vector3,f1=new Le.Vector3,A1=new Le.Vector3,Tn=new Le.Spherical,Hs=new Le.Spherical,Mr=new Le.Box3,d1=new Le.Box3,al=new Le.Sphere,m1=new Le.Quaternion,cl=new Le.Quaternion,ll=new Le.Matrix4,ia=new Le.Raycaster}static get ACTION(){return ae}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=ae.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Br.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Le.Vector3,this._focalOffsetVelocity=new Le.Vector3,this._zoomVelocity={value:0},this._truckInternal=(g,p,m)=>{let E,w;if(or(this._camera)){const _=He.copy(this._camera.position).sub(this._target),C=this._camera.getEffectiveFOV()*Os,I=_.length()*Math.tan(C*.5);E=this.truckSpeed*g*I/this._elementRect.height,w=this.truckSpeed*p*I/this._elementRect.height}else if(Ui(this._camera)){const _=this._camera;E=g*(_.right-_.left)/_.zoom/this._elementRect.width,w=p*(_.top-_.bottom)/_.zoom/this._elementRect.height}else return;this.verticalDragToForward?(m?this.setFocalOffset(this._focalOffsetEnd.x+E,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(E,0,!0),this.forward(-w,!0)):m?this.setFocalOffset(this._focalOffsetEnd.x+E,this._focalOffsetEnd.y+w,this._focalOffsetEnd.z,!0):this.truck(E,w,!0)},this._rotateInternal=(g,p)=>{const m=br*this.azimuthRotateSpeed*g/this._elementRect.height,E=br*this.polarRotateSpeed*p/this._elementRect.height;this.rotate(m,E,!0)},this._dollyInternal=(g,p,m)=>{const E=Math.pow(.95,-g*this.dollySpeed),w=this._sphericalEnd.radius,_=this._sphericalEnd.radius*E,C=Kn(_,this.minDistance,this.maxDistance),I=C-_;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(_,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(I,!0),this._dollyToNoClamp(C,!0)):this._dollyToNoClamp(C,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?_:C)-w,this._dollyControlCoord.set(p,m)),this._lastDollyDirection=Math.sign(-g)},this._zoomInternal=(g,p,m)=>{const E=Math.pow(.95,g*this.dollySpeed),w=this._zoom,_=this._zoom*E;this.zoomTo(_,!0),this.dollyToCursor&&(this._changedZoom+=_-w,this._dollyControlCoord.set(p,m))},typeof Le>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new Le.Quaternion().setFromUnitVectors(this._camera.up,na),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=ae.NONE,this._target=new Le.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Le.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Le.Spherical().setFromVector3(He.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Le.Vector3,new Le.Vector3,new Le.Vector3,new Le.Vector3],this._updateNearPlaneCorners(),this._boundary=new Le.Box3(new Le.Vector3(-1/0,-1/0,-1/0),new Le.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Le.Vector2,this.mouseButtons={left:ae.ROTATE,middle:ae.DOLLY,right:ae.TRUCK,wheel:or(this._camera)?ae.DOLLY:Ui(this._camera)?ae.ZOOM:ae.NONE},this.touches={one:ae.TOUCH_ROTATE,two:or(this._camera)?ae.TOUCH_DOLLY_TRUCK:Ui(this._camera)?ae.TOUCH_ZOOM_TRUCK:ae.NONE,three:ae.TOUCH_TRUCK};const i=new Le.Vector2,r=new Le.Vector2,s=new Le.Vector2,o=g=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const E=this._domElement.getBoundingClientRect(),w=g.clientX/E.width,_=g.clientY/E.height;if(w<this._interactiveArea.left||w>this._interactiveArea.right||_<this._interactiveArea.top||_>this._interactiveArea.bottom)return}const p=g.pointerType!=="mouse"?null:(g.buttons&Ct.LEFT)===Ct.LEFT?Ct.LEFT:(g.buttons&Ct.MIDDLE)===Ct.MIDDLE?Ct.MIDDLE:(g.buttons&Ct.RIGHT)===Ct.RIGHT?Ct.RIGHT:null;if(p!==null){const E=this._findPointerByMouseButton(p);E&&this._disposePointer(E)}if((g.buttons&Ct.LEFT)===Ct.LEFT&&this._lockedPointer)return;const m={pointerId:g.pointerId,clientX:g.clientX,clientY:g.clientY,deltaX:0,deltaY:0,mouseButton:p};this._activePointers.push(m),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,A(g)},a=g=>{g.cancelable&&g.preventDefault();const p=g.pointerId,m=this._lockedPointer||this._findPointerById(p);if(m){if(m.clientX=g.clientX,m.clientY=g.clientY,m.deltaX=g.movementX,m.deltaY=g.movementY,this._state=0,g.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(g.buttons&Ct.LEFT)===Ct.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(g.buttons&Ct.MIDDLE)===Ct.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(g.buttons&Ct.RIGHT)===Ct.RIGHT&&(this._state=this._state|this.mouseButtons.right);y()}},c=g=>{const p=this._findPointerById(g.pointerId);if(!(p&&p===this._lockedPointer)){if(p&&this._disposePointer(p),g.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=ae.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=ae.NONE;x()}};let u=-1;const f=g=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===ae.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const _=this._domElement.getBoundingClientRect(),C=g.clientX/_.width,I=g.clientY/_.height;if(C<this._interactiveArea.left||C>this._interactiveArea.right||I<this._interactiveArea.top||I>this._interactiveArea.bottom)return}if(g.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===ae.ROTATE||this.mouseButtons.wheel===ae.TRUCK){const _=performance.now();u-_<1e3&&this._getClientRect(this._elementRect),u=_}const p=By?-1:-3,m=g.deltaMode===1?g.deltaY/p:g.deltaY/(p*10),E=this.dollyToCursor?(g.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,w=this.dollyToCursor?(g.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case ae.ROTATE:{this._rotateInternal(g.deltaX,g.deltaY),this._isUserControllingRotate=!0;break}case ae.TRUCK:{this._truckInternal(g.deltaX,g.deltaY,!1),this._isUserControllingTruck=!0;break}case ae.OFFSET:{this._truckInternal(g.deltaX,g.deltaY,!0),this._isUserControllingOffset=!0;break}case ae.DOLLY:{this._dollyInternal(-m,E,w),this._isUserControllingDolly=!0;break}case ae.ZOOM:{this._zoomInternal(-m,E,w),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},h=g=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===yu.ACTION.NONE){const p=g instanceof PointerEvent?g.pointerId:0,m=this._findPointerById(p);m&&this._disposePointer(m),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c);return}g.preventDefault()}},A=g=>{if(!this._enabled)return;if(il(this._activePointers,An),this._getClientRect(this._elementRect),i.copy(An),r.copy(An),this._activePointers.length>=2){const m=An.x-this._activePointers[1].clientX,E=An.y-this._activePointers[1].clientY,w=Math.sqrt(m*m+E*E);s.set(0,w);const _=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,C=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;r.set(_,C)}if(this._state=0,!g)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in g&&g.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(g.buttons&Ct.LEFT)===Ct.LEFT&&(this._state=this._state|this.mouseButtons.left),(g.buttons&Ct.MIDDLE)===Ct.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(g.buttons&Ct.RIGHT)===Ct.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&ae.ROTATE)===ae.ROTATE||(this._state&ae.TOUCH_ROTATE)===ae.TOUCH_ROTATE||(this._state&ae.TOUCH_DOLLY_ROTATE)===ae.TOUCH_DOLLY_ROTATE||(this._state&ae.TOUCH_ZOOM_ROTATE)===ae.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&ae.TRUCK)===ae.TRUCK||(this._state&ae.TOUCH_TRUCK)===ae.TOUCH_TRUCK||(this._state&ae.TOUCH_DOLLY_TRUCK)===ae.TOUCH_DOLLY_TRUCK||(this._state&ae.TOUCH_ZOOM_TRUCK)===ae.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&ae.DOLLY)===ae.DOLLY||(this._state&ae.TOUCH_DOLLY)===ae.TOUCH_DOLLY||(this._state&ae.TOUCH_DOLLY_TRUCK)===ae.TOUCH_DOLLY_TRUCK||(this._state&ae.TOUCH_DOLLY_OFFSET)===ae.TOUCH_DOLLY_OFFSET||(this._state&ae.TOUCH_DOLLY_ROTATE)===ae.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&ae.ZOOM)===ae.ZOOM||(this._state&ae.TOUCH_ZOOM)===ae.TOUCH_ZOOM||(this._state&ae.TOUCH_ZOOM_TRUCK)===ae.TOUCH_ZOOM_TRUCK||(this._state&ae.TOUCH_ZOOM_OFFSET)===ae.TOUCH_ZOOM_OFFSET||(this._state&ae.TOUCH_ZOOM_ROTATE)===ae.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&ae.OFFSET)===ae.OFFSET||(this._state&ae.TOUCH_OFFSET)===ae.TOUCH_OFFSET||(this._state&ae.TOUCH_DOLLY_OFFSET)===ae.TOUCH_DOLLY_OFFSET||(this._state&ae.TOUCH_ZOOM_OFFSET)===ae.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},y=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,il(this._activePointers,An);const p=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,m=p?-p.deltaX:r.x-An.x,E=p?-p.deltaY:r.y-An.y;if(r.copy(An),((this._state&ae.ROTATE)===ae.ROTATE||(this._state&ae.TOUCH_ROTATE)===ae.TOUCH_ROTATE||(this._state&ae.TOUCH_DOLLY_ROTATE)===ae.TOUCH_DOLLY_ROTATE||(this._state&ae.TOUCH_ZOOM_ROTATE)===ae.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(m,E),this._isUserControllingRotate=!0),(this._state&ae.DOLLY)===ae.DOLLY||(this._state&ae.ZOOM)===ae.ZOOM){const w=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,_=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,C=this.dollyDragInverted?-1:1;(this._state&ae.DOLLY)===ae.DOLLY?(this._dollyInternal(C*E*ta,w,_),this._isUserControllingDolly=!0):(this._zoomInternal(C*E*ta,w,_),this._isUserControllingZoom=!0)}if((this._state&ae.TOUCH_DOLLY)===ae.TOUCH_DOLLY||(this._state&ae.TOUCH_ZOOM)===ae.TOUCH_ZOOM||(this._state&ae.TOUCH_DOLLY_TRUCK)===ae.TOUCH_DOLLY_TRUCK||(this._state&ae.TOUCH_ZOOM_TRUCK)===ae.TOUCH_ZOOM_TRUCK||(this._state&ae.TOUCH_DOLLY_OFFSET)===ae.TOUCH_DOLLY_OFFSET||(this._state&ae.TOUCH_ZOOM_OFFSET)===ae.TOUCH_ZOOM_OFFSET||(this._state&ae.TOUCH_DOLLY_ROTATE)===ae.TOUCH_DOLLY_ROTATE||(this._state&ae.TOUCH_ZOOM_ROTATE)===ae.TOUCH_ZOOM_ROTATE){const w=An.x-this._activePointers[1].clientX,_=An.y-this._activePointers[1].clientY,C=Math.sqrt(w*w+_*_),I=s.y-C;s.set(0,C);const b=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,B=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&ae.TOUCH_DOLLY)===ae.TOUCH_DOLLY||(this._state&ae.TOUCH_DOLLY_ROTATE)===ae.TOUCH_DOLLY_ROTATE||(this._state&ae.TOUCH_DOLLY_TRUCK)===ae.TOUCH_DOLLY_TRUCK||(this._state&ae.TOUCH_DOLLY_OFFSET)===ae.TOUCH_DOLLY_OFFSET?(this._dollyInternal(I*ta,b,B),this._isUserControllingDolly=!0):(this._zoomInternal(I*ta,b,B),this._isUserControllingZoom=!0)}((this._state&ae.TRUCK)===ae.TRUCK||(this._state&ae.TOUCH_TRUCK)===ae.TOUCH_TRUCK||(this._state&ae.TOUCH_DOLLY_TRUCK)===ae.TOUCH_DOLLY_TRUCK||(this._state&ae.TOUCH_ZOOM_TRUCK)===ae.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(m,E,!1),this._isUserControllingTruck=!0),((this._state&ae.OFFSET)===ae.OFFSET||(this._state&ae.TOUCH_OFFSET)===ae.TOUCH_OFFSET||(this._state&ae.TOUCH_DOLLY_OFFSET)===ae.TOUCH_DOLLY_OFFSET||(this._state&ae.TOUCH_ZOOM_OFFSET)===ae.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(m,E,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},x=()=>{il(this._activePointers,An),r.copy(An),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",d),this._domElement.ownerDocument.addEventListener("pointerlockerror",v),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),A())},this.unlockPointer=()=>{var g,p,m;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(g=this._domElement)===null||g===void 0||g.ownerDocument.exitPointerLock(),(p=this._domElement)===null||p===void 0||p.ownerDocument.removeEventListener("pointerlockchange",d),(m=this._domElement)===null||m===void 0||m.ownerDocument.removeEventListener("pointerlockerror",v),this.cancel()};const d=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},v=()=>{this.unlockPointer()};this._addAllEventListeners=g=>{this._domElement=g,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",h)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",h),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("pointerlockchange",d),this._domElement.ownerDocument.removeEventListener("pointerlockerror",v))},this.cancel=()=>{this._state!==ae.NONE&&(this._state=ae.NONE,this._activePointers.length=0,x())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Kn(e.width,0,1),this._interactiveArea.height=Kn(e.height,0,1),this._interactiveArea.x=Kn(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Kn(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,i=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,i)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,i=!1){this._isUserControllingRotate=!1;const r=Kn(e,this.minAzimuthAngle,this.maxAzimuthAngle),s=Kn(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=s,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!i||$e(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&$e(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Br.NONE,this._changedDolly=0,this._dollyToNoClamp(Kn(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=$e(o,this._spherical.radius);if(!(i>e)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,o)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const s=!t||$e(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Gs).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const i=!t||$e(this._target.x,this._targetEnd.x,this.restThreshold)&&$e(this._target.y,this._targetEnd.y,this.restThreshold)&&$e(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Kn(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const i=!t||$e(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(e,t,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,i)}truck(e,t,i=!1){this._camera.updateMatrix(),ai.setFromMatrixColumn(this._camera.matrix,0),ci.setFromMatrixColumn(this._camera.matrix,1),ai.multiplyScalar(e),ci.multiplyScalar(-t);const r=He.copy(ai).add(ci),s=Ke.copy(this._targetEnd).add(r);return this.moveTo(s.x,s.y,s.z,i)}forward(e,t=!1){He.setFromMatrixColumn(this._camera.matrix,0),He.crossVectors(this._camera.up,He),He.multiplyScalar(e);const i=Ke.copy(this._targetEnd).add(He);return this.moveTo(i.x,i.y,i.z,t)}elevate(e,t=!1){return He.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+He.x,this._targetEnd.y+He.y,this._targetEnd.z+He.z,t)}moveTo(e,t,i,r=!1){this._isUserControllingTruck=!1;const s=He.set(e,t,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,s,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);const o=!r||$e(this._target.x,this._targetEnd.x,this.restThreshold)&&$e(this._target.y,this._targetEnd.y,this.restThreshold)&&$e(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,i,r=!1){const a=He.set(e,t,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,r)}fitToBox(e,t,{cover:i=!1,paddingLeft:r=0,paddingRight:s=0,paddingBottom:o=0,paddingTop:a=0}={}){const c=[],u=e.isBox3?Mr.copy(e):Mr.setFromObject(e);u.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const f=l1(this._sphericalEnd.theta,c1),h=l1(this._sphericalEnd.phi,c1);c.push(this.rotateTo(f,h,t));const A=He.setFromSpherical(this._sphericalEnd).normalize(),y=m1.setFromUnitVectors(A,ol),x=$e(Math.abs(A.y),1);x&&y.multiply(cl.setFromAxisAngle(na,f)),y.multiply(this._yAxisUpSpaceInverse);const d=d1.makeEmpty();Ke.copy(u.min).applyQuaternion(y),d.expandByPoint(Ke),Ke.copy(u.min).setX(u.max.x).applyQuaternion(y),d.expandByPoint(Ke),Ke.copy(u.min).setY(u.max.y).applyQuaternion(y),d.expandByPoint(Ke),Ke.copy(u.max).setZ(u.min.z).applyQuaternion(y),d.expandByPoint(Ke),Ke.copy(u.min).setZ(u.max.z).applyQuaternion(y),d.expandByPoint(Ke),Ke.copy(u.max).setY(u.min.y).applyQuaternion(y),d.expandByPoint(Ke),Ke.copy(u.max).setX(u.min.x).applyQuaternion(y),d.expandByPoint(Ke),Ke.copy(u.max).applyQuaternion(y),d.expandByPoint(Ke),d.min.x-=r,d.min.y-=o,d.max.x+=s,d.max.y+=a,y.setFromUnitVectors(ol,A),x&&y.premultiply(cl.invert()),y.premultiply(this._yAxisUpSpace);const v=d.getSize(He),g=d.getCenter(Ke).applyQuaternion(y);if(or(this._camera)){const p=this.getDistanceToFitBox(v.x,v.y,v.z,i);c.push(this.moveTo(g.x,g.y,g.z,t)),c.push(this.dollyTo(p,t)),c.push(this.setFocalOffset(0,0,0,t))}else if(Ui(this._camera)){const p=this._camera,m=p.right-p.left,E=p.top-p.bottom,w=i?Math.max(m/v.x,E/v.y):Math.min(m/v.x,E/v.y);c.push(this.moveTo(g.x,g.y,g.z,t)),c.push(this.zoomTo(w,t)),c.push(this.setFocalOffset(0,0,0,t))}return Promise.all(c)}fitToSphere(e,t){const i=[],s="isObject3D"in e?yu.createBoundingSphere(e,al):al.copy(e);if(i.push(this.moveTo(s.center.x,s.center.y,s.center.z,t)),or(this._camera)){const o=this.getDistanceToFitSphere(s.radius);i.push(this.dollyTo(o,t))}else if(Ui(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,c=2*s.radius,u=Math.min(o/c,a/c);i.push(this.zoomTo(u,t))}return i.push(this.setFocalOffset(0,0,0,t)),Promise.all(i)}setLookAt(e,t,i,r,s,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Br.NONE,this._changedDolly=0;const c=Ke.set(r,s,o),u=He.set(e,t,i);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(u.sub(c).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const f=!a||$e(this._target.x,this._targetEnd.x,this.restThreshold)&&$e(this._target.y,this._targetEnd.y,this.restThreshold)&&$e(this._target.z,this._targetEnd.z,this.restThreshold)&&$e(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&$e(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&$e(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(f)}lerpLookAt(e,t,i,r,s,o,a,c,u,f,h,A,y,x=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Br.NONE,this._changedDolly=0;const d=He.set(r,s,o),v=Ke.set(e,t,i);Tn.setFromVector3(v.sub(d).applyQuaternion(this._yAxisUpSpace));const g=Sr.set(f,h,A),p=Ke.set(a,c,u);Hs.setFromVector3(p.sub(g).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(d.lerp(g,y));const m=Hs.theta-Tn.theta,E=Hs.phi-Tn.phi,w=Hs.radius-Tn.radius;this._sphericalEnd.set(Tn.radius+w*y,Tn.phi+E*y,Tn.theta+m*y),this.normalizeRotations(),this._needsUpdate=!0,x||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const _=!x||$e(this._target.x,this._targetEnd.x,this.restThreshold)&&$e(this._target.y,this._targetEnd.y,this.restThreshold)&&$e(this._target.z,this._targetEnd.z,this.restThreshold)&&$e(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&$e(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&$e(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(_)}setPosition(e,t,i,r=!1){return this.setLookAt(e,t,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,i,r=!1){const s=this.getPosition(He),o=this.setLookAt(s.x,s.y,s.z,e,t,i,r);return this._sphericalEnd.phi=Kn(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,i,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,i),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);const s=!r||$e(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&$e(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&$e(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}setOrbitPoint(e,t,i){this._camera.updateMatrixWorld(),ai.setFromMatrixColumn(this._camera.matrixWorldInverse,0),ci.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ar.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const r=He.set(e,t,i),s=r.distanceTo(this._camera.position),o=r.sub(this._camera.position);ai.multiplyScalar(o.x),ci.multiplyScalar(o.y),ar.multiplyScalar(o.z),He.copy(ai).add(ci).add(ar),He.z=He.z+s,this.dollyTo(s,!1),this.setFocalOffset(-He.x,He.y,-He.z,!1),this.moveTo(e,t,i,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,i,r){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new Le.Vector4,typeof e=="number"?this._viewport.set(e,t,i,r):this._viewport.copy(e)}getDistanceToFitBox(e,t,i,r=!1){if(rl(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const s=e/t,o=this._camera.getEffectiveFOV()*Os,a=this._camera.aspect;return((r?s>a:s<a)?t:e/a)*.5/Math.tan(o*.5)+i*.5}getDistanceToFitSphere(e){if(rl(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Os,i=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,r=1<this._camera.aspect?t:i;return e/Math.sin(r*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new Le.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new Le.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new Le.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new Le.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%br,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=br),this._spherical.theta+=br*Math.round((this._sphericalEnd.theta-this._spherical.theta)/br)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!$e(this._camera.up.x,this._cameraUp0.x)||!$e(this._camera.up.y,this._cameraUp0.y)||!$e(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const i=this.getPosition(He);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,na),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=He.subVectors(this._target,this._camera.position).normalize(),t=Ke.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const i=this.getPosition(He);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,s=f1.subVectors(this._targetEnd,this._target),o=A1.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(ct(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=ea(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,e),this._needsUpdate=!0}if(ct(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=ea(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,e),this._needsUpdate=!0}if(ct(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=ea(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,e),this._needsUpdate=!0}if(ct(s.x)&&ct(s.y)&&ct(s.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;u1(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(ct(o.x)&&ct(o.y)&&ct(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;u1(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(ct(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=ea(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,e)}if(this.dollyToCursor){if(or(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,A=this._camera,y=this._getCameraDirection(Gs),x=He.copy(y).cross(A.up).normalize();x.lengthSq()===0&&(x.x=1);const d=Ke.crossVectors(x,y),v=this._sphericalEnd.radius*Math.tan(A.getEffectiveFOV()*Os*.5),p=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,m=Sr.copy(this._targetEnd).add(x.multiplyScalar(this._dollyControlCoord.x*v*A.aspect)).add(d.multiplyScalar(this._dollyControlCoord.y*v)),E=He.copy(this._targetEnd).lerp(m,p),w=this._lastDollyDirection===Br.IN&&this._spherical.radius<=this.minDistance,_=this._lastDollyDirection===Br.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(w||_)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const I=Ke.copy(y).multiplyScalar(-h);E.add(I)}this._boundary.clampPoint(E,E);const C=Ke.subVectors(E,this._targetEnd);this._targetEnd.copy(E),this._target.add(C),this._changedDolly-=h,ct(this._changedDolly)&&(this._changedDolly=0)}else if(Ui(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,A=this._camera,y=He.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(A.near+A.far)/(A.near-A.far)).unproject(A),x=Ke.set(0,0,-1).applyQuaternion(A.quaternion),d=Sr.copy(y).add(x.multiplyScalar(-y.dot(A.up))),g=-(this._zoom-h-this._zoom)/this._zoom,p=this._getCameraDirection(Gs),m=this._targetEnd.dot(p),E=He.copy(this._targetEnd).lerp(d,g),w=E.dot(p),_=p.multiplyScalar(w-m);E.sub(_),this._boundary.clampPoint(E,E);const C=Ke.subVectors(E,this._targetEnd);this._targetEnd.copy(E),this._target.add(C),this._changedZoom-=h,ct(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const c=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,c),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!ct(this._focalOffset.x)||!ct(this._focalOffset.y)||!ct(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),ai.setFromMatrixColumn(this._camera.matrix,0),ci.setFromMatrixColumn(this._camera.matrix,1),ar.setFromMatrixColumn(this._camera.matrix,2),ai.multiplyScalar(this._focalOffset.x),ci.multiplyScalar(-this._focalOffset.y),ar.multiplyScalar(this._focalOffset.z),He.copy(ai).add(ci).add(ar),this._camera.position.add(He)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),He.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const f=this._needsUpdate;return f&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):f?(this.dispatchEvent({type:"update"}),ct(t,this.restThreshold)&&ct(i,this.restThreshold)&&ct(r,this.restThreshold)&&ct(s.x,this.restThreshold)&&ct(s.y,this.restThreshold)&&ct(s.z,this.restThreshold)&&ct(o.x,this.restThreshold)&&ct(o.y,this.restThreshold)&&ct(o.z,this.restThreshold)&&ct(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!f&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=f,this._needsUpdate=!1,f}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Us(this.maxDistance),minZoom:this.minZoom,maxZoom:Us(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Us(this.maxPolarAngle),minAzimuthAngle:Us(this.minAzimuthAngle),maxAzimuthAngle:Us(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:He.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const i=JSON.parse(e);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=Ns(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=Ns(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=Ns(i.maxPolarAngle),this.minAzimuthAngle=Ns(i.minAzimuthAngle),this.maxAzimuthAngle=Ns(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],t),Tn.setFromVector3(He.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Tn.theta,Tn.phi,t),this.dollyTo(Tn.radius,t),this.zoomTo(i.zoom,t),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Iy),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,i){const r=t.lengthSq();if(r===0)return e;const s=Ke.copy(t).add(e),a=this._boundary.clampPoint(s,Sr).sub(s),c=a.lengthSq();if(c===0)return e.add(t);if(c===r)return e;if(i===0)return e.add(t).add(a);{const u=1+i*c/t.dot(a);return e.add(Ke.copy(t).multiplyScalar(u)).add(a.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(or(this._camera)){const e=this._camera,t=e.near,i=e.getEffectiveFOV()*Os,r=Math.tan(i*.5)*t,s=r*e.aspect;this._nearPlaneCorners[0].set(-s,-r,0),this._nearPlaneCorners[1].set(s,-r,0),this._nearPlaneCorners[2].set(s,r,0),this._nearPlaneCorners[3].set(-s,r,0)}else if(Ui(this._camera)){const e=this._camera,t=1/e.zoom,i=e.left*t,r=e.right*t,s=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(i,s,0),this._nearPlaneCorners[1].set(r,s,0),this._nearPlaneCorners[2].set(r,o,0),this._nearPlaneCorners[3].set(i,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||rl(this._camera,"_collisionTest"))return e;const i=this._getTargetDirection(Gs);ll.lookAt(h1,i,this._camera.up);for(let r=0;r<4;r++){const s=Ke.copy(this._nearPlaneCorners[r]);s.applyMatrix4(ll);const o=Sr.addVectors(this._target,s);ia.set(o,i),ia.far=this._spherical.radius+1;const a=ia.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const i=()=>{this.removeEventListener("rest",i),t()};this.addEventListener("rest",i)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new Le.Sphere){const i=t,r=i.center;Mr.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&Mr.expandByObject(o)}),Mr.getCenter(r);let s=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o,c=a.geometry.clone();c.applyMatrix4(a.matrixWorld);const f=c.attributes.position;for(let h=0,A=f.count;h<A;h++)He.fromBufferAttribute(f,h),s=Math.max(s,r.distanceToSquared(He))}),i.radius=Math.sqrt(s),i}};const C9=l.forwardRef((n,e)=>{l.useMemo(()=>{const w={Box3:Et,MathUtils:{clamp:De.clamp},Matrix4:ue,Quaternion:Fe,Raycaster:nc,Sphere:Nn,Spherical:tc,Vector2:_e,Vector3:T,Vector4:Qt};ul.install({THREE:w}),Pt({CameraControlsImpl:ul})},[]);const{camera:t,domElement:i,makeDefault:r,onStart:s,onEnd:o,onChange:a,regress:c,...u}=n,f=J(w=>w.camera),h=J(w=>w.gl),A=J(w=>w.invalidate),y=J(w=>w.events),x=J(w=>w.setEvents),d=J(w=>w.set),v=J(w=>w.get),g=J(w=>w.performance),p=t||f,m=i||y.connected||h.domElement,E=l.useMemo(()=>new ul(p),[p]);return Se((w,_)=>{E.enabled&&E.update(_)},-1),l.useEffect(()=>(E.connect(m),()=>void E.disconnect()),[m,E]),l.useEffect(()=>{const w=I=>{A(),c&&g.regress(),a&&a(I)},_=I=>{s&&s(I)},C=I=>{o&&o(I)};return E.addEventListener("update",w),E.addEventListener("controlstart",_),E.addEventListener("controlend",C),E.addEventListener("control",w),E.addEventListener("transitionstart",w),E.addEventListener("wake",w),()=>{E.removeEventListener("update",w),E.removeEventListener("controlstart",_),E.removeEventListener("controlend",C),E.removeEventListener("control",w),E.removeEventListener("transitionstart",w),E.removeEventListener("wake",w)}},[E,s,o,A,x,c,a]),l.useEffect(()=>{if(r){const w=v().controls;return d({controls:E}),()=>d({controls:w})}},[r,E]),l.createElement("primitive",ce({ref:e,object:E},u))}),by=n=>(n==null?void 0:n.current)instanceof Ot,Gd=l.createContext(null);function Sy(){return l.useContext(Gd)}function My({points:n=50}){const{path:e}=Sy(),[t,i]=l.useState([]),[r]=l.useState(()=>new So({color:"black"})),[s]=l.useState(()=>new Yf(.025,16,16)),o=l.useRef([]);return l.useEffect(()=>{e.curves!==o.current&&(i(e.getPoints(n)),o.current=e.curves)}),l.createElement(l.Fragment,null,t.map((a,c)=>l.createElement("mesh",{key:c,material:r,geometry:s,position:[a.x,a.y,a.z]})))}const I9=l.forwardRef(({children:n,curves:e=[],object:t,debug:i=!1,smooth:r=!1,focus:s,offset:o=void 0,eps:a=1e-5,damping:c=.1,focusDamping:u=.1,maxSpeed:f=1/0,...h},A)=>{const{camera:y}=J(),x=l.useRef(),[d]=l.useState(()=>new T2),v=l.useRef(o??0),g=l.useMemo(()=>({focus:s,object:(t==null?void 0:t.current)instanceof Ot?t:{current:y},path:d,current:v.current,offset:v.current,point:new T,tangent:new T,next:new T}),[s,t]);l.useLayoutEffect(()=>{var E;d.curves=[];const w=e.length>0?e:(E=x.current)==null?void 0:E.__r3f.objects;for(var _=0;_<w.length;_++)d.add(w[_]);if(r){const C=d.getPoints(typeof r=="number"?r:1),I=new tA(C);d.curves=[I]}d.updateArcLengths()}),l.useImperativeHandle(A,()=>x.current,[]),l.useLayoutEffect(()=>{v.current=Tc.repeat(v.current,1)},[o]);let p=0;const[m]=l.useState(()=>new T);return Se((E,w)=>{if(p=g.offset,as.damp(v,"current",o!==void 0?o:g.current,c,w,f,void 0,a),g.offset=Tc.repeat(v.current,1),d.getCurveLengths().length>0){d.getPointAt(g.offset,g.point),d.getTangentAt(g.offset,g.tangent).normalize(),d.getPointAt(Tc.repeat(v.current-(p-g.offset),1),g.next);const _=(t==null?void 0:t.current)instanceof Ot?t.current:y;_.position.copy(g.point),s&&as.dampLookAt(_,by(s)?s.current.getWorldPosition(m):s,u,w,f,void 0,a)}}),l.createElement("group",ce({ref:x},h),l.createElement(Gd.Provider,{value:g},n,i&&l.createElement(My,null)))});function Ty({defaultScene:n,defaultCamera:e,renderPriority:t=1}){const{gl:i,scene:r,camera:s}=J();let o;return Se(()=>{o=i.autoClear,t===1&&(i.autoClear=!0,i.render(n,e)),i.autoClear=!1,i.clearDepth(),i.render(r,s),i.autoClear=o},t),l.createElement("group",{onPointerOver:()=>null})}function Py({children:n,renderPriority:e=1}){const{scene:t,camera:i}=J(),[r]=l.useState(()=>new Ji);return l.createElement(l.Fragment,null,pr(l.createElement(l.Fragment,null,n,l.createElement(Ty,{defaultScene:t,defaultCamera:i,renderPriority:e})),r,{events:{priority:e+1}}))}const Hd=l.createContext({}),l0=()=>l.useContext(Hd),Dy=2*Math.PI,hl=new Ot,p1=new ue,[Tr,fl]=[new Fe,new Fe],g1=new T,y1=new T,Qy=n=>"minPolarAngle"in n,B9=({alignment:n="bottom-right",margin:e=[80,80],renderPriority:t=1,onUpdate:i,onTarget:r,children:s})=>{const o=J(_=>_.size),a=J(_=>_.camera),c=J(_=>_.controls),u=J(_=>_.invalidate),f=l.useRef(null),h=l.useRef(null),A=l.useRef(!1),y=l.useRef(0),x=l.useRef(new T(0,0,0)),d=l.useRef(new T(0,0,0));l.useEffect(()=>{d.current.copy(a.up)},[a]);const v=l.useCallback(_=>{A.current=!0,(c||r)&&(x.current=(c==null?void 0:c.target)||(r==null?void 0:r())),y.current=a.position.distanceTo(g1),Tr.copy(a.quaternion),y1.copy(_).multiplyScalar(y.current).add(g1),hl.lookAt(y1),hl.up.copy(a.up),fl.copy(hl.quaternion),u()},[c,a,r,u]);Se((_,C)=>{if(h.current&&f.current){var I;if(A.current)if(Tr.angleTo(fl)<.01)A.current=!1,Qy(c)&&a.up.copy(d.current);else{const b=C*Dy;Tr.rotateTowards(fl,b),a.position.set(0,0,1).applyQuaternion(Tr).multiplyScalar(y.current).add(x.current),a.up.set(0,1,0).applyQuaternion(Tr).normalize(),a.quaternion.copy(Tr),i?i():c&&c.update(),u()}p1.copy(a.matrix).invert(),(I=f.current)==null||I.quaternion.setFromRotationMatrix(p1)}});const g=l.useMemo(()=>({tweenCamera:v}),[v]),[p,m]=e,E=n.endsWith("-center")?0:n.endsWith("-left")?-o.width/2+p:o.width/2-p,w=n.startsWith("center-")?0:n.startsWith("top-")?o.height/2-m:-o.height/2+m;return l.createElement(Py,{renderPriority:t},l.createElement(Hd.Provider,{value:g},l.createElement(Ey,{makeDefault:!0,ref:h,position:[0,0,200]}),l.createElement("group",{ref:f,position:[E,w,0]},s)))},ao={bg:"#f0f0f0",hover:"#999",text:"black",stroke:"black"},Ry=["Right","Left","Top","Bottom","Front","Back"],Vd=n=>new T(...n).multiplyScalar(.38),zy=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(Vd),Fy=[.25,.25,.25],qd=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(Vd),Ly=qd.map(n=>n.toArray().map(e=>e==0?.5:.25)),ky=({hover:n,index:e,font:t="20px Inter var, Arial, sans-serif",faces:i=Ry,color:r=ao.bg,hoverColor:s=ao.hover,textColor:o=ao.text,strokeColor:a=ao.stroke,opacity:c=1})=>{const u=J(h=>h.gl),f=l.useMemo(()=>{const h=document.createElement("canvas");h.width=128,h.height=128;const A=h.getContext("2d");return A.fillStyle=r,A.fillRect(0,0,h.width,h.height),A.strokeStyle=a,A.strokeRect(0,0,h.width,h.height),A.font=t,A.textAlign="center",A.fillStyle=o,A.fillText(i[e].toUpperCase(),64,76),new oA(h)},[e,i,t,r,o,a]);return l.createElement("meshBasicMaterial",{map:f,"map-anisotropy":u.capabilities.getMaxAnisotropy()||1,attach:`material-${e}`,color:n?s:"white",transparent:!0,opacity:c})},Oy=n=>{const{tweenCamera:e}=l0(),[t,i]=l.useState(null),r=a=>{a.stopPropagation(),i(null)},s=a=>{a.stopPropagation(),e(a.face.normal)},o=a=>{a.stopPropagation(),i(Math.floor(a.faceIndex/2))};return l.createElement("mesh",{onPointerOut:r,onPointerMove:o,onClick:n.onClick||s},[...Array(6)].map((a,c)=>l.createElement(ky,ce({key:c,index:c,hover:t===c},n))),l.createElement("boxGeometry",null))},v1=({onClick:n,dimensions:e,position:t,hoverColor:i=ao.hover})=>{const{tweenCamera:r}=l0(),[s,o]=l.useState(!1),a=f=>{f.stopPropagation(),o(!1)},c=f=>{f.stopPropagation(),o(!0)},u=f=>{f.stopPropagation(),r(t)};return l.createElement("mesh",{scale:1.01,position:t,onPointerOver:c,onPointerOut:a,onClick:n||u},l.createElement("meshBasicMaterial",{color:s?i:"white",transparent:!0,opacity:.6,visible:s}),l.createElement("boxGeometry",{args:e}))},b9=n=>l.createElement("group",{scale:[60,60,60]},l.createElement(Oy,n),qd.map((e,t)=>l.createElement(v1,ce({key:t,position:e,dimensions:Ly[t]},n))),zy.map((e,t)=>l.createElement(v1,ce({key:t,position:e,dimensions:Fy},n))));function Al({scale:n=[.8,.05,.05],color:e,rotation:t}){return l.createElement("group",{rotation:t},l.createElement("mesh",{position:[.4,0,0]},l.createElement("boxGeometry",{args:n}),l.createElement("meshBasicMaterial",{color:e,toneMapped:!1})))}function Pr({onClick:n,font:e,disabled:t,arcStyle:i,label:r,labelColor:s,axisHeadScale:o=1,...a}){const c=J(d=>d.gl),u=l.useMemo(()=>{const d=document.createElement("canvas");d.width=64,d.height=64;const v=d.getContext("2d");return v.beginPath(),v.arc(32,32,16,0,2*Math.PI),v.closePath(),v.fillStyle=i,v.fill(),r&&(v.font=e,v.textAlign="center",v.fillStyle=s,v.fillText(r,32,41)),new oA(d)},[i,r,s,e]),[f,h]=l.useState(!1),A=(r?1:.75)*(f?1.2:1)*o,y=d=>{d.stopPropagation(),h(!0)},x=d=>{d.stopPropagation(),h(!1)};return l.createElement("sprite",ce({scale:A,onPointerOver:t?void 0:y,onPointerOut:t?void 0:n||x},a),l.createElement("spriteMaterial",{map:u,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:r?1:.75,toneMapped:!1}))}const S9=({hideNegativeAxes:n,hideAxisHeads:e,disabled:t,font:i="18px Inter var, Arial, sans-serif",axisColors:r=["#ff2060","#20df80","#2080ff"],axisHeadScale:s=1,axisScale:o,labels:a=["X","Y","Z"],labelColor:c="#000",onClick:u,...f})=>{const[h,A,y]=r,{tweenCamera:x}=l0(),d={font:i,disabled:t,labelColor:c,onClick:u,axisHeadScale:s,onPointerDown:t?void 0:v=>{x(v.object.position),v.stopPropagation()}};return l.createElement("group",ce({scale:40},f),l.createElement(Al,{color:h,rotation:[0,0,0],scale:o}),l.createElement(Al,{color:A,rotation:[0,0,Math.PI/2],scale:o}),l.createElement(Al,{color:y,rotation:[0,-Math.PI/2,0],scale:o}),!e&&l.createElement(l.Fragment,null,l.createElement(Pr,ce({arcStyle:h,position:[1,0,0],label:a[0]},d)),l.createElement(Pr,ce({arcStyle:A,position:[0,1,0],label:a[1]},d)),l.createElement(Pr,ce({arcStyle:y,position:[0,0,1],label:a[2]},d)),!n&&l.createElement(l.Fragment,null,l.createElement(Pr,ce({arcStyle:h,position:[-1,0,0]},d)),l.createElement(Pr,ce({arcStyle:A,position:[0,-1,0]},d)),l.createElement(Pr,ce({arcStyle:y,position:[0,0,-1]},d)))))},Uy=ti({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new ze,sectionColor:new ze,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new T,worldPlanePosition:new T},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${Cn>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),M9=l.forwardRef(({args:n,cellColor:e="#000000",sectionColor:t="#2080ff",cellSize:i=.5,sectionSize:r=1,followCamera:s=!1,infiniteGrid:o=!1,fadeDistance:a=100,fadeStrength:c=1,fadeFrom:u=1,cellThickness:f=.5,sectionThickness:h=1,side:A=us,...y},x)=>{Pt({GridMaterial:Uy});const d=l.useRef(null);l.useImperativeHandle(x,()=>d.current,[]);const v=new Di,g=new T(0,1,0),p=new T(0,0,0);Se(w=>{v.setFromNormalAndCoplanarPoint(g,p).applyMatrix4(d.current.matrixWorld);const _=d.current.material,C=_.uniforms.worldCamProjPosition,I=_.uniforms.worldPlanePosition;v.projectPoint(w.camera.position,C.value),I.value.set(0,0,0).applyMatrix4(d.current.matrixWorld)});const m={cellSize:i,sectionSize:r,cellColor:e,sectionColor:t,cellThickness:f,sectionThickness:h},E={fadeDistance:a,fadeStrength:c,fadeFrom:u,infiniteGrid:o,followCamera:s};return l.createElement("mesh",ce({ref:d,frustumCulled:!1},y),l.createElement("gridMaterial",ce({transparent:!0,"extensions-derivatives":!0,side:A},m,E)),l.createElement("planeGeometry",{args:n}))});function Yd(n,{path:e}){const[t]=Xt(Qu,[n],i=>i.setPath(e));return t}Yd.preload=(n,{path:e})=>Xt.preload(Qu,[n],t=>t.setPath(e));function T9({children:n,files:e,...t}){const i=Yd(e,{...t});return l.createElement(l.Fragment,null,n==null?void 0:n(i))}function u0(n){return Xt(n0,n)}u0.preload=n=>Xt.preload(n0,n);u0.clear=n=>Xt.clear(n0,n);function P9({path:n,...e}){const i=u0(n).children[0];return l.createElement(P2,ce({},e,{object:i}))}const jd="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function h0(n,e=`${jd}/basis/`){const t=J(r=>r.gl),i=Xt(gr,yo(n)?Object.values(n):n,r=>{r.detectSupport(t),r.setTranscoderPath(e)});if(l.useEffect(()=>{(Array.isArray(i)?i:[i]).forEach(t.initTexture)},[t,i]),yo(n)){const r=Object.keys(n),s={};return r.forEach(o=>Object.assign(s,{[o]:i[r.indexOf(o)]})),s}else return i}h0.preload=(n,e=`${jd}/basis/`)=>Xt.preload(gr,n,t=>{t.setTranscoderPath(e)});h0.clear=n=>Xt.clear(gr,n);const D9=({children:n,input:e,basisPath:t})=>{const i=h0(e,t);return l.createElement(l.Fragment,null,n==null?void 0:n(i))};var x1,E1;const Ny=typeof window<"u"&&typeof((x1=window.document)==null?void 0:x1.createElement)=="function"&&typeof((E1=window.navigator)==null?void 0:E1.userAgent)=="string";let ra=null;async function Gy(n,e){if(Ny&&n.pathname.endsWith(".m3u8")){var t;if((t=ra)!==null&&t!==void 0||(ra=await aA(()=>import("./hls-CRjxKjhq.js").then(i=>i.h),__vite__mapDeps([0,1,2]))),ra.default.isSupported())return new ra.default({...e})}return null}function Wd(n,{unsuspend:e="loadedmetadata",start:t=!0,crossOrigin:i="anonymous",muted:r=!0,loop:s=!0,hls:o={},...a}={}){const c=new URL(typeof n=="string"?n:"",window.location.href),u=l.useRef(null),f=l.useRef(null),h=J(y=>y.gl),A=mr(()=>new Promise(async y=>{const x=Object.assign(document.createElement("video"),{src:typeof n=="string"&&n||void 0,srcObject:n instanceof MediaStream&&n||void 0,crossOrigin:i,loop:s,muted:r,...a});if(f.current=x,typeof n=="string"){const v=u.current=await Gy(c,o);v?(v.attachMedia(x),v.on("hlsMediaAttached",()=>{v.loadSource(n)})):x.src=n}else n instanceof MediaStream&&(x.srcObject=n);const d=new D2(x);"colorSpace"in d?d.colorSpace=h.outputColorSpace:d.encoding=h.outputEncoding,x.addEventListener(e,()=>y(d))}),[n]);return l.useEffect(()=>(t&&A.image.play(),()=>{u.current&&(u.current.destroy(),u.current=null)}),[A,t]),A}const Q9=({children:n,src:e,...t})=>{const i=Wd(e,t);return l.createElement(l.Fragment,null,n==null?void 0:n(i))},Hy=n=>{if(Array.isArray(n))return n[0];if(typeof n=="object"&&n!==null){const e=Object.keys(n);return n[e[0]][0]}else return{w:0,h:0}},Vy=n=>{for(let e=3;e<n.length;e+=4)if(n[e]!==0)return!1;return!0},w1=(n,e,t,i)=>{const r=e*(i.aspect>n/e?i.width/n:i.height/e),o=n*(i.aspect>n/e?i.width/n:i.height/e)*t,a=r*t,c=1;let u=Math.min(c,o),f=Math.min(c,a);return o>c&&(u=c,f=a/o*c),new T(u,f,1)};function f0(n,e,t,i,r){const s=J(C=>C.viewport),o=l.useRef(null),a=l.useRef(0),c=.1,[u,f]=l.useState(null),[h,A]=l.useState(new un),y=new Zi,[x,d]=l.useState(null);l.useLayoutEffect(()=>(e&&n?p(e,n,m):n&&g(),()=>{n&&Xt.clear(Zi,n)}),[]);function v(C,I){I&&C?p(I,C,m):g(C)}function g(C){(C||n)&&new Promise(I=>{y.load(C??n,I)}).then(I=>{m(null,I)})}function p(C,I,b){const B=fetch(C).then(S=>S.json()),Q=new Promise(S=>{y.load(I,S)});Promise.all([B,Q]).then(S=>{b(S[0],S[1])})}const m=(C,I)=>{let b=new T(1,1,1);if(C===null){if(I&&i){const B=I.image.width,Q=I.image.height;a.current=i;const{rows:S,columns:k,frameWidth:L,frameHeight:O,emptyFrames:G}=E(I,i);o.current={frames:[],meta:{version:"1.0",size:{w:B,h:Q},rows:S,columns:k,frameWidth:L,frameHeight:O,scale:"1"}};for(let V=0;V<S;V++)for(let N=0;N<k;N++)(G??[]).some(Y=>Y.row===V&&Y.col===N)||o.current.frames.push({frame:{x:N*L,y:V*O,w:L,h:O},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:L,h:O},sourceSize:{w:L,h:O}});b=w1(L,O,c,s)}o.current.frames=_(o.current.frames)}else if(I){o.current=C,o.current.frames=w(),a.current=Array.isArray(C.frames)?C.frames.length:Object.keys(C.frames).length;const{w:B,h:Q}=Hy(C.frames).sourceSize;b=w1(B,Q,c,s)}f(o.current),"encoding"in I?I.encoding=3001:I.colorSpace=cA,A(I),d({spriteTexture:I,spriteData:o.current,aspect:b})},E=(C,I)=>{if(C.image){const b=document.createElement("canvas"),B=b.getContext("2d");b.width=C.image.width,b.height=C.image.height,B.drawImage(C.image,0,0);const Q=C.image.width,S=C.image.height,k=Math.round(Math.sqrt(I*(Q/S))),L=Math.round(I/k),O=Q/k,G=S/L,V=[];for(let N=0;N<L;N++)for(let j=0;j<k;j++){if(N*k+j>=I){V.push({row:N,col:j});continue}const H=B.getImageData(j*O,N*G,O,G).data;Vy(H)&&V.push({row:N,col:j})}return{rows:L,columns:k,frameWidth:O,frameHeight:G,emptyFrames:V}}else return{rows:0,columns:0,frameWidth:0,frameHeight:0,emptyFrames:[]}},w=()=>{const C={},I=o.current,b=t;if(b&&Array.isArray(I.frames)){for(let B=0;B<b.length;B++){C[b[B]]=[];for(const Q of I.frames){const S=Q.frame,k=S.x,L=S.y,O=S.w,G=S.h,V=Q.sourceSize.w,N=Q.sourceSize.h;typeof Q.filename=="string"&&Q.filename.toLowerCase().indexOf(b[B].toLowerCase())!==-1&&C[b[B]].push({x:k,y:L,w:O,h:G,frame:S,sourceSize:{w:V,h:N}})}}for(const B in C)C[B].frame=_(C[B]);return C}else if(b&&typeof I.frames=="object"){for(let B=0;B<b.length;B++){C[b[B]]=[];for(const Q in I.frames){const S=I.frames[Q],k=S.frame,L=k.x,O=k.y,G=k.w,V=k.h,N=S.sourceSize.w,j=S.sourceSize.h;typeof Q=="string"&&Q.toLowerCase().indexOf(b[B].toLowerCase())!==-1&&C[b[B]].push({x:L,y:O,w:G,h:V,frame:k,sourceSize:{w:N,h:j}})}}for(const B in C)C[B].frame=_(C[B]);return C}else{let B=[];for(const Q in I.frames)B.push(I.frames[Q]);return B=_(B),B}},_=C=>{let I=null;for(const Q of C){const{w:S,h:k}=Q.frame,L=S*k;(!I||L>I.area)&&(I={...Q.frame,area:L})}for(const Q of C){var b;const{w:S,h:k}=Q.frame,L=S*k;if(L===((b=I)==null?void 0:b.area))Q.scaleRatio=1;else{var B;Q.scaleRatio=Math.sqrt(L/((B=I)==null?void 0:B.area))}}return C};return l.useLayoutEffect(()=>{r==null||r(h,u)},[h,u]),{spriteObj:x,loadJsonAndTexture:v}}f0.preload=n=>Xt.preload(Zi,n);f0.clear=n=>Xt.clear(Zi,n);var Xd={exports:{}};(function(n,e){(function(t,i){n.exports=i()})(Q2,function(){var t=function(){function i(y){return o.appendChild(y.dom),y}function r(y){for(var x=0;x<o.children.length;x++)o.children[x].style.display=x===y?"block":"none";s=y}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(y){y.preventDefault(),r(++s%o.children.length)},!1);var a=(performance||Date).now(),c=a,u=0,f=i(new t.Panel("FPS","#0ff","#002")),h=i(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var A=i(new t.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:o,addPanel:i,showPanel:r,begin:function(){a=(performance||Date).now()},end:function(){u++;var y=(performance||Date).now();if(h.update(y-a,200),y>c+1e3&&(f.update(1e3*u/(y-c),100),c=y,u=0,A)){var x=performance.memory;A.update(x.usedJSHeapSize/1048576,x.jsHeapSizeLimit/1048576)}return y},update:function(){a=this.end()},domElement:o,setMode:r}};return t.Panel=function(i,r,s){var o=1/0,a=0,c=Math.round,u=c(window.devicePixelRatio||1),f=80*u,h=48*u,A=3*u,y=2*u,x=3*u,d=15*u,v=74*u,g=30*u,p=document.createElement("canvas");p.width=f,p.height=h,p.style.cssText="width:80px;height:48px";var m=p.getContext("2d");return m.font="bold "+9*u+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=s,m.fillRect(0,0,f,h),m.fillStyle=r,m.fillText(i,A,y),m.fillRect(x,d,v,g),m.fillStyle=s,m.globalAlpha=.9,m.fillRect(x,d,v,g),{dom:p,update:function(E,w){o=Math.min(o,E),a=Math.max(a,E),m.fillStyle=s,m.globalAlpha=1,m.fillRect(0,0,f,d),m.fillStyle=r,m.fillText(c(E)+" "+i+" ("+c(o)+"-"+c(a)+")",A,y),m.drawImage(p,x+u,d,v-u,g,x,d,v-u,g),m.fillRect(x+v-u,d,u,g),m.fillStyle=s,m.globalAlpha=.9,m.fillRect(x+v-u,d,u,c((1-E/w)*g))}}},t})})(Xd);var qy=Xd.exports;const Yy=R2(qy);function jy(n,e=[],t){const[i,r]=l.useState();return l.useLayoutEffect(()=>{const s=n();return r(s),()=>void 0},e),i}function R9({showPanel:n=0,className:e,parent:t}){const i=jy(()=>new Yy,[]);return l.useEffect(()=>{if(i){const r=t&&t.current||document.body;i.showPanel(n),r==null||r.appendChild(i.dom);const s=(e??"").split(" ").filter(c=>c);s.length&&i.dom.classList.add(...s);const o=Su(()=>i.begin()),a=Ru(()=>i.end());return()=>{s.length&&i.dom.classList.remove(...s),r==null||r.removeChild(i.dom),o(),a()}}},[t,i,e,n]),null}class Wy{constructor(e,t,i){this.name=e,this.fg=t,this.bg=i,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=90*this.PR,this.canvas.height=48*this.PR,this.canvas.style.width="90px",this.canvas.style.position="absolute",this.canvas.style.height="48px",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,i,r,s=0){let o=1/0,a=0;this.context&&(o=Math.min(o,e),a=Math.max(i,e),r=Math.max(r,t),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(e.toFixed(s)+" "+this.name+" ("+o.toFixed(s)+"-"+parseFloat(a.toFixed(s))+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,(1-t/r)*this.GRAPH_HEIGHT))}}const Kd=class Kr{constructor({logsPerSecond:e=20,samplesLog:t=100,samplesGraph:i=10,precision:r=2,minimal:s=!1,horizontal:o=!0,mode:a=0}={}){this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.totalFps=0,this.activeQuery=null,this.gpuQueries=[],this.renderCount=0,this.mode=a,this.horizontal=o,this.dom=document.createElement("div"),this.dom.style.cssText="position:fixed;top:0;left:0;opacity:0.9;z-index:10000;",s&&(this.dom.style.cssText+="cursor:pointer"),this.gl=null,this.query=null,this.isRunningCPUProfiling=!1,this.minimal=s,this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.frames=0,this.renderCount=0,this.threeRendererPatched=!1,this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.queryCreated=!1,this.fpsPanel=this.addPanel(new Kr.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new Kr.Panel("CPU","#0f0","#020"),1),this.gpuPanel=null,this.gpuPanelCompute=null,this.samplesLog=t,this.samplesGraph=i,this.precision=r,this.logsPerSecond=e,this.minimal?(this.dom.addEventListener("click",c=>{c.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},!1),this.mode=a,this.showPanel(this.mode)):window.addEventListener("resize",()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute,3)})}patchThreeRenderer(e){const t=e.render,i=this;e.render=function(r,s){i.begin(),t.call(this,r,s),i.end()},this.threeRendererPatched=!0}resizePanel(e,t){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=t*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=t*e.HEIGHT/e.PR+"px"))}addPanel(e,t){return e.canvas&&(this.dom.appendChild(e.canvas),this.resizePanel(e,t)),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++){const i=this.dom.children[t];i.style.display=t===e?"block":"none"}this.mode=e}async init(e){if(!e){console.error('Stats: The "canvas" parameter is undefined.');return}if(e.isWebGLRenderer&&!this.threeRendererPatched){const t=e;this.patchThreeRenderer(t),this.gl=t.getContext()}else!this.gl&&e instanceof WebGL2RenderingContext&&(this.gl=e);if(e.isWebGPURenderer){e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&(this.gpuPanel=this.addPanel(new Kr.Panel("GPU","#ff0","#220"),2),this.gpuPanelCompute=this.addPanel(new Kr.Panel("CPT","#e1e1e1","#212121"),3),this.info=e.info);return}else if(!this.gl&&e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas){if(this.gl=e.getContext("webgl2"),!this.gl){console.error("Stats: Unable to obtain WebGL2 context.");return}}else if(!this.gl){console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas.");return}this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new Kr.Panel("GPU","#ff0","#220"),2))}begin(){this.isRunningCPUProfiling||this.beginProfiling("cpu-started"),!(!this.gl||!this.ext)&&this.gl&&this.ext&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery!==null&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null)}processGpuQueries(){!this.gl||!this.ext||(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{if(this.gl){const i=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),r=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(i&&!r){const o=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT)*1e-6;this.totalGpuDuration+=o,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}}))}update(){this.info===void 0?this.processGpuQueries():(this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp,this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)),this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu),this.renderCount=0,this.totalCpuDuration===0&&this.beginProfiling("cpu-started"),this.totalCpuDuration=0,this.totalFps=0,this.beginTime=this.endInternal()}endInternal(){this.frames++;const e=(performance||Date).now();if(e>=this.prevCpuTime+1e3/this.logsPerSecond&&(this.updatePanel(this.msPanel,this.averageCpu),this.updatePanel(this.gpuPanel,this.averageGpu),this.gpuPanelCompute&&this.updatePanel(this.gpuPanelCompute,this.averageGpuCompute),this.prevCpuTime=e),e>=this.prevTime+1e3){const t=this.frames*1e3/(e-this.prevTime);this.fpsPanel.update(t,t,100,100,0),this.prevTime=e,this.frames=0}return e}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&t.logs.shift(),t.graph.push(e),t.graph.length>this.samplesGraph&&t.graph.shift()}beginProfiling(e){window.performance&&(window.performance.mark(e),this.isRunningCPUProfiling=!0)}endProfiling(e,t,i){if(window.performance&&t&&this.isRunningCPUProfiling){window.performance.mark(t);const r=performance.measure(i,e,t);this.totalCpuDuration+=r.duration,this.isRunningCPUProfiling=!1}}updatePanel(e,t){if(t.logs.length>0){let i=0,r=.01;for(let a=0;a<t.logs.length;a++)i+=t.logs[a],t.logs[a]>r&&(r=t.logs[a]);let s=0,o=.01;for(let a=0;a<t.graph.length;a++)s+=t.graph[a],t.graph[a]>o&&(o=t.graph[a]);e&&e.update(i/Math.min(t.logs.length,this.samplesLog),s/Math.min(t.graph.length,this.samplesGraph),r,o,this.precision)}}get domElement(){return this.dom}get container(){return console.warn("Stats: Deprecated! this.container as been replaced to this.dom "),this.dom}};Kd.Panel=Wy;let Xy=Kd;function z9({className:n,parent:e,...t}){const i=J(s=>s.gl),r=l.useMemo(()=>{const s=new Xy({...t});return s.init(i),s},[i]);return l.useEffect(()=>{if(r){const s=e&&e.current||document.body;s==null||s.appendChild(r.dom);const o=(n??"").split(" ").filter(c=>c);o.length&&r.dom.classList.add(...o);const a=Ru(()=>r.update());return()=>{o.length&&r.dom.classList.remove(...o),s==null||s.removeChild(r.dom),a()}}},[e,r,n]),null}function F9({size:n=256,frames:e=1/0}={}){const t=J(f=>f.viewport.dpr),{width:i,height:r}=J(f=>f.size),s=n||i*t,o=n||r*t,a=l.useMemo(()=>{const f=new sc(s,o);return f.format=zu,f.type=ac,{depthTexture:f}},[s,o]);let c=0;const u=mn(s,o,a);return Se(f=>{(e===1/0||c<e)&&(f.gl.setRenderTarget(u),f.gl.render(f.scene,f.camera),f.gl.setRenderTarget(null),c++)}),u.depthTexture}function L9(n,e,t=1){const i=J(o=>o.viewport),r=e*(i.aspect>n/e?i.width/n:i.height/e);return[n*(i.aspect>n/e?i.width/n:i.height/e)*t,r*t,1]}function k9(n,e){const t=J(r=>r.pointer),[i]=l.useState(()=>{const r=new nc;return e&&Fn(r,e,{}),function(s,o){r.setFromCamera(t,n instanceof lA?n:n.current);const a=this.constructor.prototype.raycast.bind(this);a&&a(r,o)}});return i}function dl(n,e,t,i){return new(t||(t=Promise))(function(r,s){function o(u){try{c(i.next(u))}catch(f){s(f)}}function a(u){try{c(i.throw(u))}catch(f){s(f)}}function c(u){var f;u.done?r(u.value):(f=u.value,f instanceof t?f:new t(function(h){h(f)})).then(o,a)}c((i=i.apply(n,[])).next())})}const Ky=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function _1(n){return n=n.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const Zd=typeof window>"u",ui=(()=>{if(Zd)return;const{userAgent:n,platform:e,maxTouchPoints:t}=window.navigator,i=/(iphone|ipod|ipad)/i.test(n),r=e==="iPad"||e==="MacIntel"&&t>0&&!window.MSStream;return{isIpad:r,isMobile:/android/i.test(n)||i||r,isSafari12:/Version\/12.+Safari/.test(n),isFirefox:/Firefox/.test(n)}})();function Zy(n,e,t){if(!t)return[e];const i=function(u){const f=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,h=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,A=u.createShader(35633),y=u.createShader(35632),x=u.createProgram();if(!(y&&A&&x))return;u.shaderSource(A,f),u.shaderSource(y,h),u.compileShader(A),u.compileShader(y),u.attachShader(x,A),u.attachShader(x,y),u.linkProgram(x),u.detachShader(x,A),u.detachShader(x,y),u.deleteShader(A),u.deleteShader(y),u.useProgram(x);const d=u.createBuffer();u.bindBuffer(34962,d),u.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const v=u.getAttribLocation(x,"aPosition");u.vertexAttribPointer(v,3,5126,!1,0,0),u.enableVertexAttribArray(v),u.clearColor(1,1,1,1),u.clear(16384),u.viewport(0,0,1,1),u.drawArrays(4,0,3);const g=new Uint8Array(4);return u.readPixels(0,0,1,1,6408,5121,g),u.deleteProgram(x),u.deleteBuffer(d),g.join("")}(n),r="801621810",s="8016218135",o="80162181161",a=ui!=null&&ui.isIpad?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",r,15],["a12x",r,15],["a12z",r,15],["a14",r,15],["a15",r,15],["m1",r,15],["m2",r,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",r,15],["a12",r,15],["a13",r,15],["a14",r,15],["a15",r,15],["a16",r,15],["a17",r,15]];let c;return i==="80162181255"?c=a.filter(([,,u])=>u>=14):(c=a.filter(([,u])=>u===i),c.length||(c=a)),c.map(([u])=>`apple ${u} gpu`)}let C1=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};const ml=[],I1=[];function $y(n,e){if(n===e)return 0;const t=n;n.length>e.length&&(n=e,e=t);let i=n.length,r=e.length;for(;i>0&&n.charCodeAt(~-i)===e.charCodeAt(~-r);)i--,r--;let s,o=0;for(;o<i&&n.charCodeAt(o)===e.charCodeAt(o);)o++;if(i-=o,r-=o,i===0)return r;let a,c,u=0,f=0,h=0;for(;f<i;)I1[f]=n.charCodeAt(o+f),ml[f]=++f;for(;h<r;)for(s=e.charCodeAt(o+h),a=h++,u=h,f=0;f<i;f++)c=s===I1[f]?a:a+1,a=ml[f],u=ml[f]=a>u?c>u?u+1:c:c>a?a+1:c;return u}function Jy(n){return n!=null}const e6=({mobileTiers:n=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:t={},glContext:i,failIfMajorPerformanceCaveat:r=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.43/dist/benchmarks"}={})=>dl(void 0,void 0,void 0,function*(){const o={};if(Zd)return{tier:0,type:"SSR"};const{isIpad:a=!!(ui!=null&&ui.isIpad),isMobile:c=!!(ui!=null&&ui.isMobile),screenSize:u=window.screen,loadBenchmarks:f=w=>dl(void 0,void 0,void 0,function*(){const _=yield fetch(`${s}/${w}`).then(C=>C.json());if(parseInt(_.shift().split(".")[0],10)<4)throw new C1("Detect GPU benchmark data is out of date. Please update to version 4x");return _})}=t;let{renderer:h}=t;const A=(w,_,C,I,b)=>({device:b,fps:I,gpu:C,isMobile:c,tier:w,type:_});let y,x="";if(h)h=_1(h),y=[h];else{const w=i||function(C,I=!1){const b={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:I,powerPreference:"high-performance",stencil:!1};C&&delete b.powerPreference;const B=window.document.createElement("canvas"),Q=B.getContext("webgl",b)||B.getContext("experimental-webgl",b);return Q??void 0}(ui==null?void 0:ui.isSafari12,r);if(!w)return A(0,"WEBGL_UNSUPPORTED");const _=ui!=null&&ui.isFirefox?null:w.getExtension("WEBGL_debug_renderer_info");if(h=_?w.getParameter(_.UNMASKED_RENDERER_WEBGL):w.getParameter(w.RENDERER),!h)return A(1,"FALLBACK");x=h,h=_1(h),y=function(C,I,b){return I==="apple gpu"?Zy(C,I,b):[I]}(w,h,c)}const d=(yield Promise.all(y.map(function(w){var _;return dl(this,void 0,void 0,function*(){const C=(W=>{const P=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const z of P)if(W.includes(z))return z})(w);if(!C)return;const I=`${c?"m":"d"}-${C}${a?"-ipad":""}.json`,b=o[I]=(_=o[I])!==null&&_!==void 0?_:f(I);let B;try{B=yield b}catch(W){if(W instanceof C1)throw W;return}const Q=function(W){var P;const z=(W=W.replace(/\([^)]+\)/,"")).match(/\d+/)||W.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(P=z==null?void 0:z.join("").replace(/\W|amd/g,""))!==null&&P!==void 0?P:""}(w);let S=B.filter(([,W])=>W===Q);S.length||(S=B.filter(([W])=>W.includes(w)));const k=S.length;if(k===0)return;const L=w.split(/[.,()\[\]/\s]/g).sort().filter((W,P,z)=>P===0||W!==z[P-1]).join(" ");let O,[G,,,,V]=k>1?S.map(W=>[W,$y(L,W[2])]).sort(([,W],[,P])=>W-P)[0][0]:S[0],N=Number.MAX_VALUE;const{devicePixelRatio:j}=window,Y=u.width*j*u.height*j;for(const W of V){const[P,z]=W,D=P*z,R=Math.abs(Y-D);R<N&&(N=R,O=W)}if(!O)return;const[,,H,X]=O;return[N,H,G,X]})}))).filter(Jy).sort(([w=Number.MAX_VALUE,_],[C=Number.MAX_VALUE,I])=>w===C?_-I:w-C);if(!d.length){const w=Ky.find(_=>h.includes(_));return w?A(0,"BLOCKLISTED",w):A(1,"FALLBACK",`${h} (${x})`)}const[,v,g,p]=d[0];if(v===-1)return A(0,"BLOCKLISTED",g,v,p);const m=c?n:e;let E=0;for(let w=0;w<m.length;w++)v>=m[w]&&(E=w);return A(E,"BENCHMARK",g,v,p)}),t6=n=>mr(()=>e6(n),["useDetectGPU"]);function U9({children:n,...e}){const t=t6(e);return l.createElement(l.Fragment,null,n==null?void 0:n(t))}const $d=0,n6=1,vc=2,B1=2,pl=1.25,b1=1,Wi=6*4+4+4,xc=65535,i6=Math.pow(2,-24),gl=Symbol("SKIP_GENERATION");function Jd(n){return n.index?n.index.count:n.attributes.position.count}function As(n){return Jd(n)/3}function em(n,e=ArrayBuffer){return n>65535?new Uint32Array(new e(4*n)):new Uint16Array(new e(2*n))}function r6(n,e){if(!n.index){const t=n.attributes.position.count,i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=em(t,i);n.setIndex(new Mt(r,1));for(let s=0;s<t;s++)r[s]=s}}function tm(n){const e=As(n),t=n.drawRange,i=t.start/3,r=(t.start+t.count)/3,s=Math.max(0,i),o=Math.min(e,r)-s;return[{offset:Math.floor(s),count:Math.floor(o)}]}function nm(n){if(!n.groups||!n.groups.length)return tm(n);const e=[],t=new Set,i=n.drawRange,r=i.start/3,s=(i.start+i.count)/3;for(const a of n.groups){const c=a.start/3,u=(a.start+a.count)/3;t.add(Math.max(r,c)),t.add(Math.min(s,u))}const o=Array.from(t.values()).sort((a,c)=>a-c);for(let a=0;a<o.length-1;a++){const c=o[a],u=o[a+1];e.push({offset:Math.floor(c),count:Math.floor(u-c)})}return e}function s6(n){if(n.groups.length===0)return!1;const e=As(n),t=nm(n).sort((s,o)=>s.offset-o.offset),i=t[t.length-1];i.count=Math.min(e-i.offset,i.count);let r=0;return t.forEach(({count:s})=>r+=s),e!==r}function yl(n,e,t,i,r){let s=1/0,o=1/0,a=1/0,c=-1/0,u=-1/0,f=-1/0,h=1/0,A=1/0,y=1/0,x=-1/0,d=-1/0,v=-1/0;for(let g=e*6,p=(e+t)*6;g<p;g+=6){const m=n[g+0],E=n[g+1],w=m-E,_=m+E;w<s&&(s=w),_>c&&(c=_),m<h&&(h=m),m>x&&(x=m);const C=n[g+2],I=n[g+3],b=C-I,B=C+I;b<o&&(o=b),B>u&&(u=B),C<A&&(A=C),C>d&&(d=C);const Q=n[g+4],S=n[g+5],k=Q-S,L=Q+S;k<a&&(a=k),L>f&&(f=L),Q<y&&(y=Q),Q>v&&(v=Q)}i[0]=s,i[1]=o,i[2]=a,i[3]=c,i[4]=u,i[5]=f,r[0]=h,r[1]=A,r[2]=y,r[3]=x,r[4]=d,r[5]=v}function o6(n,e=null,t=null,i=null){const r=n.attributes.position,s=n.index?n.index.array:null,o=As(n),a=r.normalized;let c;e===null?(c=new Float32Array(o*6*4),t=0,i=o):(c=e,t=t||0,i=i||o);const u=r.array,f=r.offset||0;let h=3;r.isInterleavedBufferAttribute&&(h=r.data.stride);const A=["getX","getY","getZ"];for(let y=t;y<t+i;y++){const x=y*3,d=y*6;let v=x+0,g=x+1,p=x+2;s&&(v=s[v],g=s[g],p=s[p]),a||(v=v*h+f,g=g*h+f,p=p*h+f);for(let m=0;m<3;m++){let E,w,_;a?(E=r[A[m]](v),w=r[A[m]](g),_=r[A[m]](p)):(E=u[v+m],w=u[g+m],_=u[p+m]);let C=E;w<C&&(C=w),_<C&&(C=_);let I=E;w>I&&(I=w),_>I&&(I=_);const b=(I-C)/2,B=m*2;c[d+B+0]=C+b,c[d+B+1]=b+(Math.abs(C)+b)*i6}}return c}function Bt(n,e,t){return t.min.x=e[n],t.min.y=e[n+1],t.min.z=e[n+2],t.max.x=e[n+3],t.max.y=e[n+4],t.max.z=e[n+5],t}function S1(n){let e=-1,t=-1/0;for(let i=0;i<3;i++){const r=n[i+3]-n[i];r>t&&(t=r,e=i)}return e}function M1(n,e){e.set(n)}function T1(n,e,t){let i,r;for(let s=0;s<3;s++){const o=s+3;i=n[s],r=e[s],t[s]=i<r?i:r,i=n[o],r=e[o],t[o]=i>r?i:r}}function sa(n,e,t){for(let i=0;i<3;i++){const r=e[n+2*i],s=e[n+2*i+1],o=r-s,a=r+s;o<t[i]&&(t[i]=o),a>t[i+3]&&(t[i+3]=a)}}function Vs(n){const e=n[3]-n[0],t=n[4]-n[1],i=n[5]-n[2];return 2*(e*t+t*i+i*e)}const Si=32,a6=(n,e)=>n.candidate-e.candidate,Li=new Array(Si).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),oa=new Float32Array(6);function c6(n,e,t,i,r,s){let o=-1,a=0;if(s===$d)o=S1(e),o!==-1&&(a=(e[o]+e[o+3])/2);else if(s===n6)o=S1(n),o!==-1&&(a=l6(t,i,r,o));else if(s===vc){const c=Vs(n);let u=pl*r;const f=i*6,h=(i+r)*6;for(let A=0;A<3;A++){const y=e[A],v=(e[A+3]-y)/Si;if(r<Si/4){const g=[...Li];g.length=r;let p=0;for(let E=f;E<h;E+=6,p++){const w=g[p];w.candidate=t[E+2*A],w.count=0;const{bounds:_,leftCacheBounds:C,rightCacheBounds:I}=w;for(let b=0;b<3;b++)I[b]=1/0,I[b+3]=-1/0,C[b]=1/0,C[b+3]=-1/0,_[b]=1/0,_[b+3]=-1/0;sa(E,t,_)}g.sort(a6);let m=r;for(let E=0;E<m;E++){const w=g[E];for(;E+1<m&&g[E+1].candidate===w.candidate;)g.splice(E+1,1),m--}for(let E=f;E<h;E+=6){const w=t[E+2*A];for(let _=0;_<m;_++){const C=g[_];w>=C.candidate?sa(E,t,C.rightCacheBounds):(sa(E,t,C.leftCacheBounds),C.count++)}}for(let E=0;E<m;E++){const w=g[E],_=w.count,C=r-w.count,I=w.leftCacheBounds,b=w.rightCacheBounds;let B=0;_!==0&&(B=Vs(I)/c);let Q=0;C!==0&&(Q=Vs(b)/c);const S=b1+pl*(B*_+Q*C);S<u&&(o=A,u=S,a=w.candidate)}}else{for(let m=0;m<Si;m++){const E=Li[m];E.count=0,E.candidate=y+v+m*v;const w=E.bounds;for(let _=0;_<3;_++)w[_]=1/0,w[_+3]=-1/0}for(let m=f;m<h;m+=6){let _=~~((t[m+2*A]-y)/v);_>=Si&&(_=Si-1);const C=Li[_];C.count++,sa(m,t,C.bounds)}const g=Li[Si-1];M1(g.bounds,g.rightCacheBounds);for(let m=Si-2;m>=0;m--){const E=Li[m],w=Li[m+1];T1(E.bounds,w.rightCacheBounds,E.rightCacheBounds)}let p=0;for(let m=0;m<Si-1;m++){const E=Li[m],w=E.count,_=E.bounds,I=Li[m+1].rightCacheBounds;w!==0&&(p===0?M1(_,oa):T1(_,oa,oa)),p+=w;let b=0,B=0;p!==0&&(b=Vs(oa)/c);const Q=r-p;Q!==0&&(B=Vs(I)/c);const S=b1+pl*(b*p+B*Q);S<u&&(o=A,u=S,a=E.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}function l6(n,e,t,i){let r=0;for(let s=e,o=e+t;s<o;s++)r+=n[s*6+i*2];return r/t}class vl{constructor(){this.boundingData=new Float32Array(6)}}function u6(n,e,t,i,r,s){let o=i,a=i+r-1;const c=s.pos,u=s.axis*2;for(;;){for(;o<=a&&t[o*6+u]<c;)o++;for(;o<=a&&t[a*6+u]>=c;)a--;if(o<a){for(let f=0;f<3;f++){let h=e[o*3+f];e[o*3+f]=e[a*3+f],e[a*3+f]=h}for(let f=0;f<6;f++){let h=t[o*6+f];t[o*6+f]=t[a*6+f],t[a*6+f]=h}o++,a--}else return o}}function h6(n,e,t,i,r,s){let o=i,a=i+r-1;const c=s.pos,u=s.axis*2;for(;;){for(;o<=a&&t[o*6+u]<c;)o++;for(;o<=a&&t[a*6+u]>=c;)a--;if(o<a){let f=n[o];n[o]=n[a],n[a]=f;for(let h=0;h<6;h++){let A=t[o*6+h];t[o*6+h]=t[a*6+h],t[a*6+h]=A}o++,a--}else return o}}function ln(n,e){return e[n+15]===65535}function pn(n,e){return e[n+6]}function wn(n,e){return e[n+14]}function On(n){return n+8}function _n(n,e){return e[n+6]}function A0(n,e){return e[n+7]}let im,co,La,rm;const f6=Math.pow(2,32);function vu(n){return"count"in n?1:1+vu(n.left)+vu(n.right)}function A6(n,e,t){return im=new Float32Array(t),co=new Uint32Array(t),La=new Uint16Array(t),rm=new Uint8Array(t),xu(n,e)}function xu(n,e){const t=n/4,i=n/2,r="count"in e,s=e.boundingData;for(let o=0;o<6;o++)im[t+o]=s[o];if(r)if(e.buffer){const o=e.buffer;rm.set(new Uint8Array(o),n);for(let a=n,c=n+o.byteLength;a<c;a+=Wi){const u=a/2;ln(u,La)||(co[a/4+6]+=t)}return n+o.byteLength}else{const o=e.offset,a=e.count;return co[t+6]=o,La[i+14]=a,La[i+15]=xc,n+Wi}else{const o=e.left,a=e.right,c=e.splitAxis;let u;if(u=xu(n+Wi,o),u/4>f6)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return co[t+6]=u/4,u=xu(u,a),co[t+7]=c,u}}function d6(n,e){const t=(n.index?n.index.count:n.attributes.position.count)/3,i=t>2**16,r=i?4:2,s=e?new SharedArrayBuffer(t*r):new ArrayBuffer(t*r),o=i?new Uint32Array(s):new Uint16Array(s);for(let a=0,c=o.length;a<c;a++)o[a]=a;return o}function m6(n,e,t,i,r){const{maxDepth:s,verbose:o,maxLeafTris:a,strategy:c,onProgress:u,indirect:f}=r,h=n._indirectBuffer,A=n.geometry,y=A.index?A.index.array:null,x=f?h6:u6,d=As(A),v=new Float32Array(6);let g=!1;const p=new vl;return yl(e,t,i,p.boundingData,v),E(p,t,i,v),p;function m(w){u&&u(w/d)}function E(w,_,C,I=null,b=0){if(!g&&b>=s&&(g=!0,o&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(A))),C<=a||b>=s)return m(_+C),w.offset=_,w.count=C,w;const B=c6(w.boundingData,I,e,_,C,c);if(B.axis===-1)return m(_+C),w.offset=_,w.count=C,w;const Q=x(h,y,e,_,C,B);if(Q===_||Q===_+C)m(_+C),w.offset=_,w.count=C;else{w.splitAxis=B.axis;const S=new vl,k=_,L=Q-_;w.left=S,yl(e,k,L,S.boundingData,v),E(S,k,L,v,b+1);const O=new vl,G=Q,V=C-L;w.right=O,yl(e,G,V,O.boundingData,v),E(O,G,V,v,b+1)}return w}}function p6(n,e){const t=n.geometry;e.indirect&&(n._indirectBuffer=d6(t,e.useSharedArrayBuffer),s6(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),n._indirectBuffer||r6(t,e);const i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=o6(t),s=e.indirect?tm(t):nm(t);n._roots=s.map(o=>{const a=m6(n,r,o.offset,o.count,e),c=vu(a),u=new i(Wi*c);return A6(0,a,u),u})}class Pi{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let s=0,o=e.length;s<o;s++){const c=e[s][t];i=c<i?c:i,r=c>r?c:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let s=0,o=t.length;s<o;s++){const a=t[s],c=e.dot(a);i=c<i?c:i,r=c>r?c:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}Pi.prototype.setFromBox=function(){const n=new T;return function(t,i){const r=i.min,s=i.max;let o=1/0,a=-1/0;for(let c=0;c<=1;c++)for(let u=0;u<=1;u++)for(let f=0;f<=1;f++){n.x=r.x*c+s.x*(1-c),n.y=r.y*u+s.y*(1-u),n.z=r.z*f+s.z*(1-f);const h=t.dot(n);o=Math.min(h,o),a=Math.max(h,a)}this.min=o,this.max=a}}();const g6=function(){const n=new T,e=new T,t=new T;return function(r,s,o){const a=r.start,c=n,u=s.start,f=e;t.subVectors(a,u),n.subVectors(r.end,r.start),e.subVectors(s.end,s.start);const h=t.dot(f),A=f.dot(c),y=f.dot(f),x=t.dot(c),v=c.dot(c)*y-A*A;let g,p;v!==0?g=(h*A-x*y)/v:g=0,p=(h+g*A)/y,o.x=g,o.y=p}}(),d0=function(){const n=new _e,e=new T,t=new T;return function(r,s,o,a){g6(r,s,n);let c=n.x,u=n.y;if(c>=0&&c<=1&&u>=0&&u<=1){r.at(c,o),s.at(u,a);return}else if(c>=0&&c<=1){u<0?s.at(0,a):s.at(1,a),r.closestPointToPoint(a,!0,o);return}else if(u>=0&&u<=1){c<0?r.at(0,o):r.at(1,o),s.closestPointToPoint(o,!0,a);return}else{let f;c<0?f=r.start:f=r.end;let h;u<0?h=s.start:h=s.end;const A=e,y=t;if(r.closestPointToPoint(h,!0,e),s.closestPointToPoint(f,!0,t),A.distanceToSquared(h)<=y.distanceToSquared(f)){o.copy(A),a.copy(h);return}else{o.copy(f),a.copy(y);return}}}}(),y6=function(){const n=new T,e=new T,t=new Di,i=new yi;return function(s,o){const{radius:a,center:c}=s,{a:u,b:f,c:h}=o;if(i.start=u,i.end=f,i.closestPointToPoint(c,!0,n).distanceTo(c)<=a||(i.start=u,i.end=h,i.closestPointToPoint(c,!0,n).distanceTo(c)<=a)||(i.start=f,i.end=h,i.closestPointToPoint(c,!0,n).distanceTo(c)<=a))return!0;const d=o.getPlane(t);if(Math.abs(d.distanceToPoint(c))<=a){const g=d.projectPoint(c,e);if(o.containsPoint(g))return!0}return!1}}(),v6=1e-15;function xl(n){return Math.abs(n)<v6}class ei extends Zr{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new T),this.satBounds=new Array(4).fill().map(()=>new Pi),this.points=[this.a,this.b,this.c],this.sphere=new Nn,this.plane=new Di,this.needsUpdate=!0}intersectsSphere(e){return y6(e,this)}update(){const e=this.a,t=this.b,i=this.c,r=this.points,s=this.satAxes,o=this.satBounds,a=s[0],c=o[0];this.getNormal(a),c.setFromPoints(a,r);const u=s[1],f=o[1];u.subVectors(e,t),f.setFromPoints(u,r);const h=s[2],A=o[2];h.subVectors(t,i),A.setFromPoints(h,r);const y=s[3],x=o[3];y.subVectors(i,e),x.setFromPoints(y,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}ei.prototype.closestPointToSegment=function(){const n=new T,e=new T,t=new yi;return function(r,s=null,o=null){const{start:a,end:c}=r,u=this.points;let f,h=1/0;for(let A=0;A<3;A++){const y=(A+1)%3;t.start.copy(u[A]),t.end.copy(u[y]),d0(t,r,n,e),f=n.distanceToSquared(e),f<h&&(h=f,s&&s.copy(n),o&&o.copy(e))}return this.closestPointToPoint(a,n),f=a.distanceToSquared(n),f<h&&(h=f,s&&s.copy(n),o&&o.copy(a)),this.closestPointToPoint(c,n),f=c.distanceToSquared(n),f<h&&(h=f,s&&s.copy(n),o&&o.copy(c)),Math.sqrt(h)}}();ei.prototype.intersectsTriangle=function(){const n=new ei,e=new Array(3),t=new Array(3),i=new Pi,r=new Pi,s=new T,o=new T,a=new T,c=new T,u=new T,f=new yi,h=new yi,A=new yi,y=new T;function x(d,v,g){const p=d.points;let m=0,E=-1;for(let w=0;w<3;w++){const{start:_,end:C}=f;_.copy(p[w]),C.copy(p[(w+1)%3]),f.delta(o);const I=xl(v.distanceToPoint(_));if(xl(v.normal.dot(o))&&I){g.copy(f),m=2;break}const b=v.intersectLine(f,y);if(!b&&I&&y.copy(_),(b||I)&&!xl(y.distanceTo(C))){if(m<=1)(m===1?g.start:g.end).copy(y),I&&(E=m);else if(m>=2){(E===1?g.start:g.end).copy(y),m=2;break}if(m++,m===2&&E===-1)break}}return m}return function(v,g=null,p=!1){this.needsUpdate&&this.update(),v.isExtendedTriangle?v.needsUpdate&&v.update():(n.copy(v),n.update(),v=n);const m=this.plane,E=v.plane;if(Math.abs(m.normal.dot(E.normal))>1-1e-10){const w=this.satBounds,_=this.satAxes;t[0]=v.a,t[1]=v.b,t[2]=v.c;for(let b=0;b<4;b++){const B=w[b],Q=_[b];if(i.setFromPoints(Q,t),B.isSeparated(i))return!1}const C=v.satBounds,I=v.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let b=0;b<4;b++){const B=C[b],Q=I[b];if(i.setFromPoints(Q,e),B.isSeparated(i))return!1}for(let b=0;b<4;b++){const B=_[b];for(let Q=0;Q<4;Q++){const S=I[Q];if(s.crossVectors(B,S),i.setFromPoints(s,e),r.setFromPoints(s,t),i.isSeparated(r))return!1}}return g&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),g.start.set(0,0,0),g.end.set(0,0,0)),!0}else{const w=x(this,E,h);if(w===1&&v.containsPoint(h.end))return g&&(g.start.copy(h.end),g.end.copy(h.end)),!0;if(w!==2)return!1;const _=x(v,m,A);if(_===1&&this.containsPoint(A.end))return g&&(g.start.copy(A.end),g.end.copy(A.end)),!0;if(_!==2)return!1;if(h.delta(a),A.delta(c),a.dot(c)<0){let k=A.start;A.start=A.end,A.end=k}const C=h.start.dot(a),I=h.end.dot(a),b=A.start.dot(a),B=A.end.dot(a),Q=I<b,S=C<B;return C!==B&&b!==I&&Q===S?!1:(g&&(u.subVectors(h.start,A.start),u.dot(a)>0?g.start.copy(h.start):g.start.copy(A.start),u.subVectors(h.end,A.end),u.dot(a)<0?g.end.copy(h.end):g.end.copy(A.end)),!0)}}}();ei.prototype.distanceToPoint=function(){const n=new T;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}}();ei.prototype.distanceToTriangle=function(){const n=new T,e=new T,t=["a","b","c"],i=new yi,r=new yi;return function(o,a=null,c=null){const u=a||c?i:null;if(this.intersectsTriangle(o,u))return(a||c)&&(a&&u.getCenter(a),c&&u.getCenter(c)),0;let f=1/0;for(let h=0;h<3;h++){let A;const y=t[h],x=o[y];this.closestPointToPoint(x,n),A=x.distanceToSquared(n),A<f&&(f=A,a&&a.copy(n),c&&c.copy(x));const d=this[y];o.closestPointToPoint(d,n),A=d.distanceToSquared(n),A<f&&(f=A,a&&a.copy(d),c&&c.copy(n))}for(let h=0;h<3;h++){const A=t[h],y=t[(h+1)%3];i.set(this[A],this[y]);for(let x=0;x<3;x++){const d=t[x],v=t[(x+1)%3];r.set(o[d],o[v]),d0(i,r,n,e);const g=n.distanceToSquared(e);g<f&&(f=g,a&&a.copy(n),c&&c.copy(e))}}return Math.sqrt(f)}}();class hn{constructor(e,t,i){this.isOrientedBox=!0,this.min=new T,this.max=new T,this.matrix=new ue,this.invMatrix=new ue,this.points=new Array(8).fill().map(()=>new T),this.satAxes=new Array(3).fill().map(()=>new T),this.satBounds=new Array(3).fill().map(()=>new Pi),this.alignedSatBounds=new Array(3).fill().map(()=>new Pi),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}hn.prototype.update=function(){return function(){const e=this.matrix,t=this.min,i=this.max,r=this.points;for(let u=0;u<=1;u++)for(let f=0;f<=1;f++)for(let h=0;h<=1;h++){const A=1*u|2*f|4*h,y=r[A];y.x=u?i.x:t.x,y.y=f?i.y:t.y,y.z=h?i.z:t.z,y.applyMatrix4(e)}const s=this.satBounds,o=this.satAxes,a=r[0];for(let u=0;u<3;u++){const f=o[u],h=s[u],A=1<<u,y=r[A];f.subVectors(a,y),h.setFromPoints(f,r)}const c=this.alignedSatBounds;c[0].setFromPointsField(r,"x"),c[1].setFromPointsField(r,"y"),c[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();hn.prototype.intersectsBox=function(){const n=new Pi;return function(t){this.needsUpdate&&this.update();const i=t.min,r=t.max,s=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(n.min=i.x,n.max=r.x,a[0].isSeparated(n)||(n.min=i.y,n.max=r.y,a[1].isSeparated(n))||(n.min=i.z,n.max=r.z,a[2].isSeparated(n)))return!1;for(let c=0;c<3;c++){const u=o[c],f=s[c];if(n.setFromBox(u,t),f.isSeparated(n))return!1}return!0}}();hn.prototype.intersectsTriangle=function(){const n=new ei,e=new Array(3),t=new Pi,i=new Pi,r=new T;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(n.copy(o),n.update(),o=n);const a=this.satBounds,c=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let A=0;A<3;A++){const y=a[A],x=c[A];if(t.setFromPoints(x,e),y.isSeparated(t))return!1}const u=o.satBounds,f=o.satAxes,h=this.points;for(let A=0;A<3;A++){const y=u[A],x=f[A];if(t.setFromPoints(x,h),y.isSeparated(t))return!1}for(let A=0;A<3;A++){const y=c[A];for(let x=0;x<4;x++){const d=f[x];if(r.crossVectors(y,d),t.setFromPoints(r,e),i.setFromPoints(r,h),t.isSeparated(i))return!1}}return!0}}();hn.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();hn.prototype.distanceToPoint=function(){const n=new T;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}}();hn.prototype.distanceToBox=function(){const n=["x","y","z"],e=new Array(12).fill().map(()=>new yi),t=new Array(12).fill().map(()=>new yi),i=new T,r=new T;return function(o,a=0,c=null,u=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(c||u)&&(o.getCenter(r),this.closestPointToPoint(r,i),o.closestPointToPoint(i,r),c&&c.copy(i),u&&u.copy(r)),0;const f=a*a,h=o.min,A=o.max,y=this.points;let x=1/0;for(let v=0;v<8;v++){const g=y[v];r.copy(g).clamp(h,A);const p=g.distanceToSquared(r);if(p<x&&(x=p,c&&c.copy(g),u&&u.copy(r),p<f))return Math.sqrt(p)}let d=0;for(let v=0;v<3;v++)for(let g=0;g<=1;g++)for(let p=0;p<=1;p++){const m=(v+1)%3,E=(v+2)%3,w=g<<m|p<<E,_=1<<v|g<<m|p<<E,C=y[w],I=y[_];e[d].set(C,I);const B=n[v],Q=n[m],S=n[E],k=t[d],L=k.start,O=k.end;L[B]=h[B],L[Q]=g?h[Q]:A[Q],L[S]=p?h[S]:A[Q],O[B]=A[B],O[Q]=g?h[Q]:A[Q],O[S]=p?h[S]:A[Q],d++}for(let v=0;v<=1;v++)for(let g=0;g<=1;g++)for(let p=0;p<=1;p++){r.x=v?A.x:h.x,r.y=g?A.y:h.y,r.z=p?A.z:h.z,this.closestPointToPoint(r,i);const m=r.distanceToSquared(i);if(m<x&&(x=m,c&&c.copy(i),u&&u.copy(r),m<f))return Math.sqrt(m)}for(let v=0;v<12;v++){const g=e[v];for(let p=0;p<12;p++){const m=t[p];d0(g,m,i,r);const E=i.distanceToSquared(r);if(E<x&&(x=E,c&&c.copy(i),u&&u.copy(r),E<f))return Math.sqrt(E)}}return Math.sqrt(x)}}();class m0{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class x6 extends m0{constructor(){super(()=>new ei)}}const Un=new x6;class E6{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=i=>{t&&e.push(t),t=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const gt=new E6;let Yi,ts;const Dr=[],aa=new m0(()=>new Et);function w6(n,e,t,i,r,s){Yi=aa.getPrimitive(),ts=aa.getPrimitive(),Dr.push(Yi,ts),gt.setBuffer(n._roots[e]);const o=Eu(0,n.geometry,t,i,r,s);gt.clearBuffer(),aa.releasePrimitive(Yi),aa.releasePrimitive(ts),Dr.pop(),Dr.pop();const a=Dr.length;return a>0&&(ts=Dr[a-1],Yi=Dr[a-2]),o}function Eu(n,e,t,i,r=null,s=0,o=0){const{float32Array:a,uint16Array:c,uint32Array:u}=gt;let f=n*2;if(ln(f,c)){const A=pn(n,u),y=wn(f,c);return Bt(n,a,Yi),i(A,y,!1,o,s+n,Yi)}else{let B=function(S){const{uint16Array:k,uint32Array:L}=gt;let O=S*2;for(;!ln(O,k);)S=On(S),O=S*2;return pn(S,L)},Q=function(S){const{uint16Array:k,uint32Array:L}=gt;let O=S*2;for(;!ln(O,k);)S=_n(S,L),O=S*2;return pn(S,L)+wn(O,k)};const A=On(n),y=_n(n,u);let x=A,d=y,v,g,p,m;if(r&&(p=Yi,m=ts,Bt(x,a,p),Bt(d,a,m),v=r(p),g=r(m),g<v)){x=y,d=A;const S=v;v=g,g=S,p=m}p||(p=Yi,Bt(x,a,p));const E=ln(x*2,c),w=t(p,E,v,o+1,s+x);let _;if(w===B1){const S=B(x),L=Q(x)-S;_=i(S,L,!0,o+1,s+x,p)}else _=w&&Eu(x,e,t,i,r,s,o+1);if(_)return!0;m=ts,Bt(d,a,m);const C=ln(d*2,c),I=t(m,C,g,o+1,s+d);let b;if(I===B1){const S=B(d),L=Q(d)-S;b=i(S,L,!0,o+1,s+d,m)}else b=I&&Eu(d,e,t,i,r,s,o+1);return!!b}}const qs=new T,El=new T;function _6(n,e,t={},i=0,r=1/0){const s=i*i,o=r*r;let a=1/0,c=null;if(n.shapecast({boundsTraverseOrder:f=>(qs.copy(e).clamp(f.min,f.max),qs.distanceToSquared(e)),intersectsBounds:(f,h,A)=>A<a&&A<o,intersectsTriangle:(f,h)=>{f.closestPointToPoint(e,qs);const A=e.distanceToSquared(qs);return A<a&&(El.copy(qs),a=A,c=h),A<s}}),a===1/0)return null;const u=Math.sqrt(a);return t.point?t.point.copy(El):t.point=El.clone(),t.distance=u,t.faceIndex=c,t}const Qr=new T,Rr=new T,zr=new T,ca=new _e,la=new _e,ua=new _e,P1=new T,D1=new T,Q1=new T,ha=new T;function C6(n,e,t,i,r,s,o,a){let c;if(s===us?c=n.intersectTriangle(i,t,e,!0,r):c=n.intersectTriangle(e,t,i,s!==on,r),c===null)return null;const u=n.origin.distanceTo(r);return u<o||u>a?null:{distance:u,point:r.clone()}}function I6(n,e,t,i,r,s,o,a,c,u,f){Qr.fromBufferAttribute(e,s),Rr.fromBufferAttribute(e,o),zr.fromBufferAttribute(e,a);const h=C6(n,Qr,Rr,zr,ha,c,u,f);if(h){i&&(ca.fromBufferAttribute(i,s),la.fromBufferAttribute(i,o),ua.fromBufferAttribute(i,a),h.uv=Zr.getInterpolation(ha,Qr,Rr,zr,ca,la,ua,new _e)),r&&(ca.fromBufferAttribute(r,s),la.fromBufferAttribute(r,o),ua.fromBufferAttribute(r,a),h.uv1=Zr.getInterpolation(ha,Qr,Rr,zr,ca,la,ua,new _e)),t&&(P1.fromBufferAttribute(t,s),D1.fromBufferAttribute(t,o),Q1.fromBufferAttribute(t,a),h.normal=Zr.getInterpolation(ha,Qr,Rr,zr,P1,D1,Q1,new T),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const A={a:s,b:o,c:a,normal:new T,materialIndex:0};Zr.getNormal(Qr,Rr,zr,A.normal),h.face=A,h.faceIndex=s}return h}function Ec(n,e,t,i,r,s,o){const a=i*3;let c=a+0,u=a+1,f=a+2;const h=n.index;n.index&&(c=h.getX(c),u=h.getX(u),f=h.getX(f));const{position:A,normal:y,uv:x,uv1:d}=n.attributes,v=I6(t,A,y,x,d,c,u,f,e,s,o);return v?(v.faceIndex=i,r&&r.push(v),v):null}function Dt(n,e,t,i){const r=n.a,s=n.b,o=n.c;let a=e,c=e+1,u=e+2;t&&(a=t.getX(a),c=t.getX(c),u=t.getX(u)),r.x=i.getX(a),r.y=i.getY(a),r.z=i.getZ(a),s.x=i.getX(c),s.y=i.getY(c),s.z=i.getZ(c),o.x=i.getX(u),o.y=i.getY(u),o.z=i.getZ(u)}function B6(n,e,t,i,r,s,o,a){const{geometry:c,_indirectBuffer:u}=n;for(let f=i,h=i+r;f<h;f++)Ec(c,e,t,f,s,o,a)}function b6(n,e,t,i,r,s,o){const{geometry:a,_indirectBuffer:c}=n;let u=1/0,f=null;for(let h=i,A=i+r;h<A;h++){let y;y=Ec(a,e,t,h,null,s,o),y&&y.distance<u&&(f=y,u=y.distance)}return f}function S6(n,e,t,i,r,s,o){const{geometry:a}=t,{index:c}=a,u=a.attributes.position;for(let f=n,h=e+n;f<h;f++){let A;if(A=f,Dt(o,A*3,c,u),o.needsUpdate=!0,i(o,A,r,s))return!0}return!1}function M6(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=n.geometry,i=t.index?t.index.array:null,r=t.attributes.position;let s,o,a,c,u=0;const f=n._roots;for(let A=0,y=f.length;A<y;A++)s=f[A],o=new Uint32Array(s),a=new Uint16Array(s),c=new Float32Array(s),h(0,u),u+=s.byteLength;function h(A,y,x=!1){const d=A*2;if(a[d+15]===xc){const g=o[A+6],p=a[d+14];let m=1/0,E=1/0,w=1/0,_=-1/0,C=-1/0,I=-1/0;for(let b=3*g,B=3*(g+p);b<B;b++){let Q=i[b];const S=r.getX(Q),k=r.getY(Q),L=r.getZ(Q);S<m&&(m=S),S>_&&(_=S),k<E&&(E=k),k>C&&(C=k),L<w&&(w=L),L>I&&(I=L)}return c[A+0]!==m||c[A+1]!==E||c[A+2]!==w||c[A+3]!==_||c[A+4]!==C||c[A+5]!==I?(c[A+0]=m,c[A+1]=E,c[A+2]=w,c[A+3]=_,c[A+4]=C,c[A+5]=I,!0):!1}else{const g=A+8,p=o[A+6],m=g+y,E=p+y;let w=x,_=!1,C=!1;e?w||(_=e.has(m),C=e.has(E),w=!_&&!C):(_=!0,C=!0);const I=w||_,b=w||C;let B=!1;I&&(B=h(g,y,w));let Q=!1;b&&(Q=h(p,y,w));const S=B||Q;if(S)for(let k=0;k<3;k++){const L=g+k,O=p+k,G=c[L],V=c[L+3],N=c[O],j=c[O+3];c[A+k]=G<N?G:N,c[A+k+3]=V>j?V:j}return S}}}function $i(n,e,t,i,r){let s,o,a,c,u,f;const h=1/t.direction.x,A=1/t.direction.y,y=1/t.direction.z,x=t.origin.x,d=t.origin.y,v=t.origin.z;let g=e[n],p=e[n+3],m=e[n+1],E=e[n+3+1],w=e[n+2],_=e[n+3+2];return h>=0?(s=(g-x)*h,o=(p-x)*h):(s=(p-x)*h,o=(g-x)*h),A>=0?(a=(m-d)*A,c=(E-d)*A):(a=(E-d)*A,c=(m-d)*A),s>c||a>o||((a>s||isNaN(s))&&(s=a),(c<o||isNaN(o))&&(o=c),y>=0?(u=(w-v)*y,f=(_-v)*y):(u=(_-v)*y,f=(w-v)*y),s>f||u>o)?!1:((u>s||s!==s)&&(s=u),(f<o||o!==o)&&(o=f),s<=r&&o>=i)}function T6(n,e,t,i,r,s,o,a){const{geometry:c,_indirectBuffer:u}=n;for(let f=i,h=i+r;f<h;f++){let A=u?u[f]:f;Ec(c,e,t,A,s,o,a)}}function P6(n,e,t,i,r,s,o){const{geometry:a,_indirectBuffer:c}=n;let u=1/0,f=null;for(let h=i,A=i+r;h<A;h++){let y;y=Ec(a,e,t,c?c[h]:h,null,s,o),y&&y.distance<u&&(f=y,u=y.distance)}return f}function D6(n,e,t,i,r,s,o){const{geometry:a}=t,{index:c}=a,u=a.attributes.position;for(let f=n,h=e+n;f<h;f++){let A;if(A=t.resolveTriangleIndex(f),Dt(o,A*3,c,u),o.needsUpdate=!0,i(o,A,r,s))return!0}return!1}function Q6(n,e,t,i,r,s,o){gt.setBuffer(n._roots[e]),wu(0,n,t,i,r,s,o),gt.clearBuffer()}function wu(n,e,t,i,r,s,o){const{float32Array:a,uint16Array:c,uint32Array:u}=gt,f=n*2;if(ln(f,c)){const A=pn(n,u),y=wn(f,c);B6(e,t,i,A,y,r,s,o)}else{const A=On(n);$i(A,a,i,s,o)&&wu(A,e,t,i,r,s,o);const y=_n(n,u);$i(y,a,i,s,o)&&wu(y,e,t,i,r,s,o)}}const R6=["x","y","z"];function z6(n,e,t,i,r,s){gt.setBuffer(n._roots[e]);const o=_u(0,n,t,i,r,s);return gt.clearBuffer(),o}function _u(n,e,t,i,r,s){const{float32Array:o,uint16Array:a,uint32Array:c}=gt;let u=n*2;if(ln(u,a)){const h=pn(n,c),A=wn(u,a);return b6(e,t,i,h,A,r,s)}else{const h=A0(n,c),A=R6[h],x=i.direction[A]>=0;let d,v;x?(d=On(n),v=_n(n,c)):(d=_n(n,c),v=On(n));const p=$i(d,o,i,r,s)?_u(d,e,t,i,r,s):null;if(p){const w=p.point[A];if(x?w<=o[v+h]:w>=o[v+h+3])return p}const E=$i(v,o,i,r,s)?_u(v,e,t,i,r,s):null;return p&&E?p.distance<=E.distance?p:E:p||E||null}}const fa=new Et,Fr=new ei,Lr=new ei,Ys=new ue,R1=new hn,Aa=new hn;function F6(n,e,t,i){gt.setBuffer(n._roots[e]);const r=Cu(0,n,t,i);return gt.clearBuffer(),r}function Cu(n,e,t,i,r=null){const{float32Array:s,uint16Array:o,uint32Array:a}=gt;let c=n*2;if(r===null&&(t.boundingBox||t.computeBoundingBox(),R1.set(t.boundingBox.min,t.boundingBox.max,i),r=R1),ln(c,o)){const f=e.geometry,h=f.index,A=f.attributes.position,y=t.index,x=t.attributes.position,d=pn(n,a),v=wn(c,o);if(Ys.copy(i).invert(),t.boundsTree)return Bt(n,s,Aa),Aa.matrix.copy(Ys),Aa.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:p=>Aa.intersectsBox(p),intersectsTriangle:p=>{p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let m=d*3,E=(v+d)*3;m<E;m+=3)if(Dt(Lr,m,h,A),Lr.needsUpdate=!0,p.intersectsTriangle(Lr))return!0;return!1}});for(let g=d*3,p=(v+d)*3;g<p;g+=3){Dt(Fr,g,h,A),Fr.a.applyMatrix4(Ys),Fr.b.applyMatrix4(Ys),Fr.c.applyMatrix4(Ys),Fr.needsUpdate=!0;for(let m=0,E=y.count;m<E;m+=3)if(Dt(Lr,m,y,x),Lr.needsUpdate=!0,Fr.intersectsTriangle(Lr))return!0}}else{const f=n+8,h=a[n+6];return Bt(f,s,fa),!!(r.intersectsBox(fa)&&Cu(f,e,t,i,r)||(Bt(h,s,fa),r.intersectsBox(fa)&&Cu(h,e,t,i,r)))}}const da=new ue,wl=new hn,js=new hn,L6=new T,k6=new T,O6=new T,U6=new T;function N6(n,e,t,i={},r={},s=0,o=1/0){e.boundingBox||e.computeBoundingBox(),wl.set(e.boundingBox.min,e.boundingBox.max,t),wl.needsUpdate=!0;const a=n.geometry,c=a.attributes.position,u=a.index,f=e.attributes.position,h=e.index,A=Un.getPrimitive(),y=Un.getPrimitive();let x=L6,d=k6,v=null,g=null;r&&(v=O6,g=U6);let p=1/0,m=null,E=null;return da.copy(t).invert(),js.matrix.copy(da),n.shapecast({boundsTraverseOrder:w=>wl.distanceToBox(w),intersectsBounds:(w,_,C)=>C<p&&C<o?(_&&(js.min.copy(w.min),js.max.copy(w.max),js.needsUpdate=!0),!0):!1,intersectsRange:(w,_)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:I=>js.distanceToBox(I),intersectsBounds:(I,b,B)=>B<p&&B<o,intersectsRange:(I,b)=>{for(let B=I,Q=I+b;B<Q;B++){Dt(y,3*B,h,f),y.a.applyMatrix4(t),y.b.applyMatrix4(t),y.c.applyMatrix4(t),y.needsUpdate=!0;for(let S=w,k=w+_;S<k;S++){Dt(A,3*S,u,c),A.needsUpdate=!0;const L=A.distanceToTriangle(y,x,v);if(L<p&&(d.copy(x),g&&g.copy(v),p=L,m=S,E=B),L<s)return!0}}}});{const C=As(e);for(let I=0,b=C;I<b;I++){Dt(y,3*I,h,f),y.a.applyMatrix4(t),y.b.applyMatrix4(t),y.c.applyMatrix4(t),y.needsUpdate=!0;for(let B=w,Q=w+_;B<Q;B++){Dt(A,3*B,u,c),A.needsUpdate=!0;const S=A.distanceToTriangle(y,x,v);if(S<p&&(d.copy(x),g&&g.copy(v),p=S,m=B,E=I),S<s)return!0}}}}}),Un.releasePrimitive(A),Un.releasePrimitive(y),p===1/0?null:(i.point?i.point.copy(d):i.point=d.clone(),i.distance=p,i.faceIndex=m,r&&(r.point?r.point.copy(g):r.point=g.clone(),r.point.applyMatrix4(da),d.applyMatrix4(da),r.distance=d.sub(r.point).length(),r.faceIndex=E),i)}function G6(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=n.geometry,i=t.index?t.index.array:null,r=t.attributes.position;let s,o,a,c,u=0;const f=n._roots;for(let A=0,y=f.length;A<y;A++)s=f[A],o=new Uint32Array(s),a=new Uint16Array(s),c=new Float32Array(s),h(0,u),u+=s.byteLength;function h(A,y,x=!1){const d=A*2;if(a[d+15]===xc){const g=o[A+6],p=a[d+14];let m=1/0,E=1/0,w=1/0,_=-1/0,C=-1/0,I=-1/0;for(let b=g,B=g+p;b<B;b++){const Q=3*n.resolveTriangleIndex(b);for(let S=0;S<3;S++){let k=Q+S;k=i?i[k]:k;const L=r.getX(k),O=r.getY(k),G=r.getZ(k);L<m&&(m=L),L>_&&(_=L),O<E&&(E=O),O>C&&(C=O),G<w&&(w=G),G>I&&(I=G)}}return c[A+0]!==m||c[A+1]!==E||c[A+2]!==w||c[A+3]!==_||c[A+4]!==C||c[A+5]!==I?(c[A+0]=m,c[A+1]=E,c[A+2]=w,c[A+3]=_,c[A+4]=C,c[A+5]=I,!0):!1}else{const g=A+8,p=o[A+6],m=g+y,E=p+y;let w=x,_=!1,C=!1;e?w||(_=e.has(m),C=e.has(E),w=!_&&!C):(_=!0,C=!0);const I=w||_,b=w||C;let B=!1;I&&(B=h(g,y,w));let Q=!1;b&&(Q=h(p,y,w));const S=B||Q;if(S)for(let k=0;k<3;k++){const L=g+k,O=p+k,G=c[L],V=c[L+3],N=c[O],j=c[O+3];c[A+k]=G<N?G:N,c[A+k+3]=V>j?V:j}return S}}}function H6(n,e,t,i,r,s,o){gt.setBuffer(n._roots[e]),Iu(0,n,t,i,r,s,o),gt.clearBuffer()}function Iu(n,e,t,i,r,s,o){const{float32Array:a,uint16Array:c,uint32Array:u}=gt,f=n*2;if(ln(f,c)){const A=pn(n,u),y=wn(f,c);T6(e,t,i,A,y,r,s,o)}else{const A=On(n);$i(A,a,i,s,o)&&Iu(A,e,t,i,r,s,o);const y=_n(n,u);$i(y,a,i,s,o)&&Iu(y,e,t,i,r,s,o)}}const V6=["x","y","z"];function q6(n,e,t,i,r,s){gt.setBuffer(n._roots[e]);const o=Bu(0,n,t,i,r,s);return gt.clearBuffer(),o}function Bu(n,e,t,i,r,s){const{float32Array:o,uint16Array:a,uint32Array:c}=gt;let u=n*2;if(ln(u,a)){const h=pn(n,c),A=wn(u,a);return P6(e,t,i,h,A,r,s)}else{const h=A0(n,c),A=V6[h],x=i.direction[A]>=0;let d,v;x?(d=On(n),v=_n(n,c)):(d=_n(n,c),v=On(n));const p=$i(d,o,i,r,s)?Bu(d,e,t,i,r,s):null;if(p){const w=p.point[A];if(x?w<=o[v+h]:w>=o[v+h+3])return p}const E=$i(v,o,i,r,s)?Bu(v,e,t,i,r,s):null;return p&&E?p.distance<=E.distance?p:E:p||E||null}}const ma=new Et,kr=new ei,Or=new ei,Ws=new ue,z1=new hn,pa=new hn;function Y6(n,e,t,i){gt.setBuffer(n._roots[e]);const r=bu(0,n,t,i);return gt.clearBuffer(),r}function bu(n,e,t,i,r=null){const{float32Array:s,uint16Array:o,uint32Array:a}=gt;let c=n*2;if(r===null&&(t.boundingBox||t.computeBoundingBox(),z1.set(t.boundingBox.min,t.boundingBox.max,i),r=z1),ln(c,o)){const f=e.geometry,h=f.index,A=f.attributes.position,y=t.index,x=t.attributes.position,d=pn(n,a),v=wn(c,o);if(Ws.copy(i).invert(),t.boundsTree)return Bt(n,s,pa),pa.matrix.copy(Ws),pa.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:p=>pa.intersectsBox(p),intersectsTriangle:p=>{p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let m=d,E=v+d;m<E;m++)if(Dt(Or,3*e.resolveTriangleIndex(m),h,A),Or.needsUpdate=!0,p.intersectsTriangle(Or))return!0;return!1}});for(let g=d,p=v+d;g<p;g++){const m=e.resolveTriangleIndex(g);Dt(kr,3*m,h,A),kr.a.applyMatrix4(Ws),kr.b.applyMatrix4(Ws),kr.c.applyMatrix4(Ws),kr.needsUpdate=!0;for(let E=0,w=y.count;E<w;E+=3)if(Dt(Or,E,y,x),Or.needsUpdate=!0,kr.intersectsTriangle(Or))return!0}}else{const f=n+8,h=a[n+6];return Bt(f,s,ma),!!(r.intersectsBox(ma)&&bu(f,e,t,i,r)||(Bt(h,s,ma),r.intersectsBox(ma)&&bu(h,e,t,i,r)))}}const ga=new ue,_l=new hn,Xs=new hn,j6=new T,W6=new T,X6=new T,K6=new T;function Z6(n,e,t,i={},r={},s=0,o=1/0){e.boundingBox||e.computeBoundingBox(),_l.set(e.boundingBox.min,e.boundingBox.max,t),_l.needsUpdate=!0;const a=n.geometry,c=a.attributes.position,u=a.index,f=e.attributes.position,h=e.index,A=Un.getPrimitive(),y=Un.getPrimitive();let x=j6,d=W6,v=null,g=null;r&&(v=X6,g=K6);let p=1/0,m=null,E=null;return ga.copy(t).invert(),Xs.matrix.copy(ga),n.shapecast({boundsTraverseOrder:w=>_l.distanceToBox(w),intersectsBounds:(w,_,C)=>C<p&&C<o?(_&&(Xs.min.copy(w.min),Xs.max.copy(w.max),Xs.needsUpdate=!0),!0):!1,intersectsRange:(w,_)=>{if(e.boundsTree){const C=e.boundsTree;return C.shapecast({boundsTraverseOrder:I=>Xs.distanceToBox(I),intersectsBounds:(I,b,B)=>B<p&&B<o,intersectsRange:(I,b)=>{for(let B=I,Q=I+b;B<Q;B++){const S=C.resolveTriangleIndex(B);Dt(y,3*S,h,f),y.a.applyMatrix4(t),y.b.applyMatrix4(t),y.c.applyMatrix4(t),y.needsUpdate=!0;for(let k=w,L=w+_;k<L;k++){const O=n.resolveTriangleIndex(k);Dt(A,3*O,u,c),A.needsUpdate=!0;const G=A.distanceToTriangle(y,x,v);if(G<p&&(d.copy(x),g&&g.copy(v),p=G,m=k,E=B),G<s)return!0}}}})}else{const C=As(e);for(let I=0,b=C;I<b;I++){Dt(y,3*I,h,f),y.a.applyMatrix4(t),y.b.applyMatrix4(t),y.c.applyMatrix4(t),y.needsUpdate=!0;for(let B=w,Q=w+_;B<Q;B++){const S=n.resolveTriangleIndex(B);Dt(A,3*S,u,c),A.needsUpdate=!0;const k=A.distanceToTriangle(y,x,v);if(k<p&&(d.copy(x),g&&g.copy(v),p=k,m=B,E=I),k<s)return!0}}}}}),Un.releasePrimitive(A),Un.releasePrimitive(y),p===1/0?null:(i.point?i.point.copy(d):i.point=d.clone(),i.distance=p,i.faceIndex=m,r&&(r.point?r.point.copy(g):r.point=g.clone(),r.point.applyMatrix4(ga),d.applyMatrix4(ga),r.distance=d.sub(r.point).length(),r.faceIndex=E),i)}function $6(){return typeof SharedArrayBuffer<"u"}const vo=new gt.constructor,ec=new gt.constructor,Ni=new m0(()=>new Et),Ur=new Et,Nr=new Et,Cl=new Et,Il=new Et;let Bl=!1;function J6(n,e,t,i){if(Bl)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Bl=!0;const r=n._roots,s=e._roots;let o,a=0,c=0;const u=new ue().copy(t).invert();for(let f=0,h=r.length;f<h;f++){vo.setBuffer(r[f]),c=0;const A=Ni.getPrimitive();Bt(0,vo.float32Array,A),A.applyMatrix4(u);for(let y=0,x=s.length;y<x&&(ec.setBuffer(s[f]),o=Zn(0,0,t,u,i,a,c,0,0,A),ec.clearBuffer(),c+=s[y].length,!o);y++);if(Ni.releasePrimitive(A),vo.clearBuffer(),a+=r[f].length,o)break}return Bl=!1,o}function Zn(n,e,t,i,r,s=0,o=0,a=0,c=0,u=null,f=!1){let h,A;f?(h=ec,A=vo):(h=vo,A=ec);const y=h.float32Array,x=h.uint32Array,d=h.uint16Array,v=A.float32Array,g=A.uint32Array,p=A.uint16Array,m=n*2,E=e*2,w=ln(m,d),_=ln(E,p);let C=!1;if(_&&w)f?C=r(pn(e,g),wn(e*2,p),pn(n,x),wn(n*2,d),c,o+e,a,s+n):C=r(pn(n,x),wn(n*2,d),pn(e,g),wn(e*2,p),a,s+n,c,o+e);else if(_){const I=Ni.getPrimitive();Bt(e,v,I),I.applyMatrix4(t);const b=On(n),B=_n(n,x);Bt(b,y,Ur),Bt(B,y,Nr);const Q=I.intersectsBox(Ur),S=I.intersectsBox(Nr);C=Q&&Zn(e,b,i,t,r,o,s,c,a+1,I,!f)||S&&Zn(e,B,i,t,r,o,s,c,a+1,I,!f),Ni.releasePrimitive(I)}else{const I=On(e),b=_n(e,g);Bt(I,v,Cl),Bt(b,v,Il);const B=u.intersectsBox(Cl),Q=u.intersectsBox(Il);if(B&&Q)C=Zn(n,I,t,i,r,s,o,a,c+1,u,f)||Zn(n,b,t,i,r,s,o,a,c+1,u,f);else if(B)if(w)C=Zn(n,I,t,i,r,s,o,a,c+1,u,f);else{const S=Ni.getPrimitive();S.copy(Cl).applyMatrix4(t);const k=On(n),L=_n(n,x);Bt(k,y,Ur),Bt(L,y,Nr);const O=S.intersectsBox(Ur),G=S.intersectsBox(Nr);C=O&&Zn(I,k,i,t,r,o,s,c,a+1,S,!f)||G&&Zn(I,L,i,t,r,o,s,c,a+1,S,!f),Ni.releasePrimitive(S)}else if(Q)if(w)C=Zn(n,b,t,i,r,s,o,a,c+1,u,f);else{const S=Ni.getPrimitive();S.copy(Il).applyMatrix4(t);const k=On(n),L=_n(n,x);Bt(k,y,Ur),Bt(L,y,Nr);const O=S.intersectsBox(Ur),G=S.intersectsBox(Nr);C=O&&Zn(b,k,i,t,r,o,s,c,a+1,S,!f)||G&&Zn(b,L,i,t,r,o,s,c,a+1,S,!f),Ni.releasePrimitive(S)}}return C}const ya=new hn,F1=new Et,ev={strategy:$d,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class wc{static serialize(e,t={}){t={cloneBuffers:!0,...t};const i=e.geometry,r=e._roots,s=e._indirectBuffer,o=i.getIndex();let a;return t.cloneBuffers?a={roots:r.map(c=>c.slice()),index:o?o.array.slice():null,indirectBuffer:s?s.slice():null}:a={roots:r,index:o?o.array:null,indirectBuffer:s},a}static deserialize(e,t,i={}){i={setIndex:!0,indirect:!!e.indirectBuffer,...i};const{index:r,roots:s,indirectBuffer:o}=e,a=new wc(t,{...i,[gl]:!0});if(a._roots=s,a._indirectBuffer=o||null,i.setIndex){const c=t.getIndex();if(c===null){const u=new Mt(e.index,1,!1);t.setIndex(u)}else c.array!==r&&(c.array.set(r),c.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({...ev,[gl]:!1},t),t.useSharedArrayBuffer&&!$6())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[gl]||(p6(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Et))),this.resolveTriangleIndex=t.indirect?i=>this._indirectBuffer[i]:i=>i}refit(e=null){return(this.indirect?G6:M6)(this,e)}traverse(e,t=0){const i=this._roots[t],r=new Uint32Array(i),s=new Uint16Array(i);o(0);function o(a,c=0){const u=a*2,f=s[u+15]===xc;if(f){const h=r[a+6],A=s[u+14];e(c,f,new Float32Array(i,a*4,6),h,A)}else{const h=a+Wi/4,A=r[a+6],y=r[a+7];e(c,f,new Float32Array(i,a*4,6),y)||(o(h,c+1),o(A,c+1))}}}raycast(e,t=Na,i=0,r=1/0){const s=this._roots,o=this.geometry,a=[],c=t.isMaterial,u=Array.isArray(t),f=o.groups,h=c?t.side:t,A=this.indirect?H6:Q6;for(let y=0,x=s.length;y<x;y++){const d=u?t[f[y].materialIndex].side:h,v=a.length;if(A(this,y,d,e,a,i,r),u){const g=f[y].materialIndex;for(let p=v,m=a.length;p<m;p++)a[p].face.materialIndex=g}}return a}raycastFirst(e,t=Na,i=0,r=1/0){const s=this._roots,o=this.geometry,a=t.isMaterial,c=Array.isArray(t);let u=null;const f=o.groups,h=a?t.side:t,A=this.indirect?q6:z6;for(let y=0,x=s.length;y<x;y++){const d=c?t[f[y].materialIndex].side:h,v=A(this,y,d,e,i,r);v!=null&&(u==null||v.distance<u.distance)&&(u=v,c&&(v.face.materialIndex=f[y].materialIndex))}return u}intersectsGeometry(e,t){let i=!1;const r=this._roots,s=this.indirect?Y6:F6;for(let o=0,a=r.length;o<a&&(i=s(this,o,e,t),!i);o++);return i}shapecast(e){const t=Un.getPrimitive(),i=this.indirect?D6:S6;let{boundsTraverseOrder:r,intersectsBounds:s,intersectsRange:o,intersectsTriangle:a}=e;if(o&&a){const h=o;o=(A,y,x,d,v)=>h(A,y,x,d,v)?!0:i(A,y,this,a,x,d,t)}else o||(a?o=(h,A,y,x)=>i(h,A,this,a,y,x,t):o=(h,A,y)=>y);let c=!1,u=0;const f=this._roots;for(let h=0,A=f.length;h<A;h++){const y=f[h];if(c=w6(this,h,s,o,r,u),c)break;u+=y.byteLength}return Un.releasePrimitive(t),c}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:s}=i;const o=Un.getPrimitive(),a=this.geometry.index,c=this.geometry.attributes.position,u=this.indirect?x=>{const d=this.resolveTriangleIndex(x);Dt(o,d*3,a,c)}:x=>{Dt(o,x*3,a,c)},f=Un.getPrimitive(),h=e.geometry.index,A=e.geometry.attributes.position,y=e.indirect?x=>{const d=e.resolveTriangleIndex(x);Dt(f,d*3,h,A)}:x=>{Dt(f,x*3,h,A)};if(s){const x=(d,v,g,p,m,E,w,_)=>{for(let C=g,I=g+p;C<I;C++){y(C),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let b=d,B=d+v;b<B;b++)if(u(b),o.needsUpdate=!0,s(o,f,b,C,m,E,w,_))return!0}return!1};if(r){const d=r;r=function(v,g,p,m,E,w,_,C){return d(v,g,p,m,E,w,_,C)?!0:x(v,g,p,m,E,w,_,C)}}else r=x}return J6(this,e,t,r)}intersectsBox(e,t){return ya.set(e.min,e.max,t),ya.needsUpdate=!0,this.shapecast({intersectsBounds:i=>ya.intersectsBox(i),intersectsTriangle:i=>ya.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},s=0,o=1/0){return(this.indirect?Z6:N6)(this,e,t,i,r,s,o)}closestPointToPoint(e,t={},i=0,r=1/0){return _6(this,e,t,i,r)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{Bt(0,new Float32Array(i),F1),e.union(F1)}),e}}function L1(n,e,t){return n===null?null:(n.point.applyMatrix4(e.matrixWorld),n.distance=n.point.distanceTo(t.ray.origin),n.object=e,n)}const va=new Mo,k1=new T,O1=new ue,tv=be.prototype.raycast,U1=new T;function sm(n,e){if(this.geometry.boundsTree){if(this.material===void 0)return;O1.copy(this.matrixWorld).invert(),va.copy(n.ray).applyMatrix4(O1),nv(this.matrixWorld,U1),k1.copy(va.direction).multiply(U1);const t=k1.length(),i=n.near/t,r=n.far/t,s=this.geometry.boundsTree;if(n.firstHitOnly===!0){const o=L1(s.raycastFirst(va,this.material,i,r),this,n);o&&e.push(o)}else{const o=s.raycast(va,this.material,i,r);for(let a=0,c=o.length;a<c;a++){const u=L1(o[a],this,n);u&&e.push(u)}}}else tv.call(this,n,e)}function om(n){return this.boundsTree=new wc(this,n),this.boundsTree}function am(){this.boundsTree=null}function nv(n,e){const t=n.elements,i=e.set(t[0],t[1],t[2]).length(),r=e.set(t[4],t[5],t[6]).length(),s=e.set(t[8],t[9],t[10]).length();return e.set(i,r,s)}function iv(n){switch(n){case 1:return"R";case 2:return"RG";case 3:return"RGBA";case 4:return"RGBA"}throw new Error}function rv(n){switch(n){case 1:return pi;case 2:return $r;case 3:return Lt;case 4:return Lt}}function N1(n){switch(n){case 1:return z2;case 2:return hA;case 3:return Ua;case 4:return Ua}}class cm extends Ki{constructor(){super(),this.minFilter=dt,this.magFilter=dt,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){const t=this.overrideItemSize,i=e.itemSize,r=e.count;if(t!==null){if(i*r%t!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=t,e.count=r*i/t}const s=e.itemSize,o=e.count,a=e.normalized,c=e.array.constructor,u=c.BYTES_PER_ELEMENT;let f=this._forcedType,h=s;if(f===null)switch(c){case Float32Array:f=pt;break;case Uint8Array:case Uint16Array:case Uint32Array:f=ur;break;case Int8Array:case Int16Array:case Int32Array:f=Qa;break}let A,y,x,d,v=iv(s);switch(f){case pt:x=1,y=rv(s),a&&u===1?(d=c,v+="8",c===Uint8Array?A=qt:(A=Kl,v+="_SNORM")):(d=Float32Array,v+="32F",A=pt);break;case Qa:v+=u*8+"I",x=a?Math.pow(2,c.BYTES_PER_ELEMENT*8-1):1,y=N1(s),u===1?(d=Int8Array,A=Kl):u===2?(d=Int16Array,A=uA):(d=Int32Array,A=Qa);break;case ur:v+=u*8+"UI",x=a?Math.pow(2,c.BYTES_PER_ELEMENT*8-1):1,y=N1(s),u===1?(d=Uint8Array,A=qt):u===2?(d=Uint16Array,A=ac):(d=Uint32Array,A=ur);break}h===3&&(y===Lt||y===Ua)&&(h=4);const g=Math.ceil(Math.sqrt(o))||1,p=h*g*g,m=new d(p),E=e.normalized;e.normalized=!1;for(let w=0;w<o;w++){const _=h*w;m[_]=e.getX(w)/x,s>=2&&(m[_+1]=e.getY(w)/x),s>=3&&(m[_+2]=e.getZ(w)/x,h===4&&(m[_+3]=1)),s>=4&&(m[_+3]=e.getW(w)/x)}e.normalized=E,this.internalFormat=v,this.format=y,this.type=A,this.image.width=g,this.image.height=g,this.image.data=m,this.needsUpdate=!0,this.dispose(),e.itemSize=i,e.count=r}}class sv extends cm{constructor(){super(),this._forcedType=ur}}class ov extends cm{constructor(){super(),this._forcedType=pt}}class lm{constructor(){this.index=new sv,this.position=new ov,this.bvhBounds=new Ki,this.bvhContents=new Ki,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){const{geometry:t}=e;if(cv(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(t.attributes.position),e.indirect){const i=e._indirectBuffer;if(this._cachedIndexAttr===null||this._cachedIndexAttr.count!==i.length)if(t.index)this._cachedIndexAttr=t.index.clone();else{const r=em(Jd(t));this._cachedIndexAttr=new Mt(r,1,!1)}av(t,i,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(t.index)}dispose(){const{index:e,position:t,bvhBounds:i,bvhContents:r}=this;e&&e.dispose(),t&&t.dispose(),i&&i.dispose(),r&&r.dispose()}}function av(n,e,t){const i=t.array,r=n.index?n.index.array:null;for(let s=0,o=e.length;s<o;s++){const a=3*s,c=3*e[s];for(let u=0;u<3;u++)i[a+u]=r?r[c+u]:c+u}}function cv(n,e,t){const i=n._roots;if(i.length!==1)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const r=i[0],s=new Uint16Array(r),o=new Uint32Array(r),a=new Float32Array(r),c=r.byteLength/Wi,u=2*Math.ceil(Math.sqrt(c/2)),f=new Float32Array(4*u*u),h=Math.ceil(Math.sqrt(c)),A=new Uint32Array(2*h*h);for(let y=0;y<c;y++){const x=y*Wi/4,d=x*2,v=x;for(let g=0;g<3;g++)f[8*y+0+g]=a[v+0+g],f[8*y+4+g]=a[v+3+g];if(ln(d,s)){const g=wn(d,s),p=pn(x,o),m=4294901760|g;A[y*2+0]=m,A[y*2+1]=p}else{const g=4*_n(x,o)/Wi,p=A0(x,o);A[y*2+0]=p,A[y*2+1]=g}}e.image.data=f,e.image.width=u,e.image.height=u,e.format=Lt,e.type=pt,e.internalFormat="RGBA32F",e.minFilter=dt,e.magFilter=dt,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),t.image.data=A,t.image.width=h,t.image.height=h,t.format=hA,t.type=ur,t.internalFormat="RG32UI",t.minFilter=dt,t.magFilter=dt,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose()}const lv=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,uv=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,hv=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,fv=hv,Av=`
	${lv}
	${uv}
`,G1=n=>n.isMesh;function N9(n,e){e={strategy:vc,verbose:!1,setBoundingBox:!0,maxDepth:40,maxLeafTris:10,indirect:!1,...e},l.useEffect(()=>{if(n.current){n.current.raycast=sm;const t=n.current.geometry;return t.computeBoundsTree=om,t.disposeBoundsTree=am,t.computeBoundsTree(e),()=>{t.boundsTree&&t.disposeBoundsTree()}}},[n,JSON.stringify(e)])}const G9=l.forwardRef(({enabled:n=!0,firstHitOnly:e=!1,children:t,strategy:i=vc,verbose:r=!1,setBoundingBox:s=!0,maxDepth:o=40,maxLeafTris:a=10,indirect:c=!1,...u},f)=>{const h=l.useRef(null),A=J(y=>y.raycaster);return l.useImperativeHandle(f,()=>h.current,[]),l.useEffect(()=>{if(n){const y={strategy:i,verbose:r,setBoundingBox:s,maxDepth:o,maxLeafTris:a,indirect:c},x=h.current;return A.firstHitOnly=e,x.traverse(d=>{G1(d)&&!d.geometry.boundsTree&&d.raycast===be.prototype.raycast&&(d.raycast=sm,d.geometry.computeBoundsTree=om,d.geometry.disposeBoundsTree=am,d.geometry.computeBoundsTree(y))}),()=>{delete A.firstHitOnly,x.traverse(d=>{G1(d)&&d.geometry.boundsTree&&(d.geometry.disposeBoundsTree(),d.raycast=be.prototype.raycast)})}}},[]),l.createElement("group",ce({ref:h},u),t)});function H9(...n){const e=l.useRef([]);return e.current=n.map(t=>l.useContext(t)),l.useMemo(()=>({children:t})=>n.reduceRight((i,r,s)=>l.createElement(r.Provider,{value:e.current[s],children:i}),t),[])}function dv(n){const e=l.useRef(null),t=l.useRef(!1),i=l.useRef(!1),r=l.useRef(n);return l.useLayoutEffect(()=>void(r.current=n),[n]),l.useEffect(()=>{const s=e.current;if(s){const o=Su(()=>(t.current=!1,!0)),a=s.onBeforeRender;s.onBeforeRender=()=>t.current=!0;const c=Ru(()=>(t.current!==i.current&&(r.current==null||r.current(i.current=t.current)),!0));return()=>{s.onBeforeRender=a,o(),c()}}},[]),e}const mv=`
#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
  #ifdef BOX_PROJECTED_ENV_MAP
    vWorldPosition = worldPosition.xyz;
  #endif
#endif
`,pv=`
#ifdef BOX_PROJECTED_ENV_MAP
  uniform vec3 envMapSize;
  uniform vec3 envMapPosition;
  varying vec3 vWorldPosition;
    
  vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {
    vec3 nDir = normalize( v );
    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbminmax;
    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;
    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;
    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;
    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );
    vec3 boxIntersection = vWorldPosition + nDir * correction;    
    return boxIntersection - cubePos;
  }
#endif
`,gv=`
#ifdef BOX_PROJECTED_ENV_MAP
  worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );
#endif
`,yv=`
#ifdef BOX_PROJECTED_ENV_MAP
  reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );
#endif
`;function vv(n,e,t){n.defines.BOX_PROJECTED_ENV_MAP=!0,n.uniforms.envMapPosition={value:e},n.uniforms.envMapSize={value:t},n.vertexShader=`
  varying vec3 vWorldPosition;
  ${n.vertexShader.replace("#include <worldpos_vertex>",mv)}`,n.fragmentShader=`
    ${pv}
    ${n.fragmentShader.replace("#include <envmap_physical_pars_fragment>",io.envmap_physical_pars_fragment).replace("vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );",`vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
         ${gv}
         `).replace("reflectVec = inverseTransformDirection( reflectVec, viewMatrix );",`reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
         ${yv}
        `)}`}function V9(n=new T,e=new T){const[t]=l.useState(()=>({position:new T,size:new T}));Fn(t,{position:n,size:e});const i=l.useRef(null),r=l.useMemo(()=>({ref:i,onBeforeCompile:s=>vv(s,t.position,t.size),customProgramCacheKey:()=>JSON.stringify(t.position.toArray())+JSON.stringify(t.size.toArray())}),[...t.position.toArray(),...t.size.toArray()]);return l.useLayoutEffect(()=>void(i.current.needsUpdate=!0),[t]),r}const H1=new Et,xa=new T,q9=({anchor:n,...e})=>{const t=l.useRef(null),i=l.useRef(null);return l.useEffect(()=>{var r;(r=t.current)!=null&&(r=r.parent)!=null&&r.parent&&(i.current=t.current.parent,t.current.parent.parent.add(t.current))},[]),Se(()=>{i.current&&(H1.setFromObject(i.current),H1.getSize(xa),t.current.position.set(i.current.position.x+xa.x*(Array.isArray(n)?n[0]:n.x)/2,i.current.position.y+xa.y*(Array.isArray(n)?n[1]:n.y)/2,i.current.position.z+xa.z*(Array.isArray(n)?n[2]:n.z)/2))}),l.createElement("group",ce({ref:t},e))};function xv(n,e,t=.9){return e*t+n*(1-t)}const Ev=n=>Math.sqrt(1-Math.pow(n-1,2));class wv{constructor({size:e=256,maxAge:t=750,radius:i=.3,intensity:r=.2,interpolate:s=0,smoothing:o=0,minForce:a=.3,blend:c="screen",ease:u=Ev}={}){this.size=e,this.maxAge=t,this.radius=i,this.intensity=r,this.ease=u,this.interpolate=s,this.smoothing=o,this.minForce=a,this.blend=c,this.trail=[],this.force=0,this.initTexture()}initTexture(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=this.size;const e=this.canvas.getContext("2d");if(e===null)throw new Error("2D not available");this.ctx=e,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture=new un(this.canvas),this.canvas.id="touchTexture",this.canvas.style.width=this.canvas.style.height=`${this.canvas.width}px`}update(e){this.clear(),this.trail.forEach((t,i)=>{t.age+=e*1e3,t.age>this.maxAge&&this.trail.splice(i,1)}),this.trail.length||(this.force=0),this.trail.forEach(t=>{this.drawTouch(t)}),this.texture.needsUpdate=!0}clear(){this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}addTouch(e){const t=this.trail[this.trail.length-1];if(t){const i=t.x-e.x,r=t.y-e.y,s=i*i+r*r,o=Math.max(this.minForce,Math.min(s*1e4,1));if(this.force=xv(o,this.force,this.smoothing),this.interpolate){const a=Math.ceil(s/Math.pow(this.radius*.5/this.interpolate,2));if(a>1)for(let c=1;c<a;c++)this.trail.push({x:t.x-i/a*c,y:t.y-r/a*c,age:0,force:o})}}this.trail.push({x:e.x,y:e.y,age:0,force:this.force})}drawTouch(e){const t={x:e.x*this.size,y:(1-e.y)*this.size};let i=1;e.age<this.maxAge*.3?i=this.ease(e.age/(this.maxAge*.3)):i=this.ease(1-(e.age-this.maxAge*.3)/(this.maxAge*.7)),i*=e.force,this.ctx.globalCompositeOperation=this.blend;const r=this.size*this.radius*i,s=this.ctx.createRadialGradient(t.x,t.y,Math.max(0,r*.25),t.x,t.y,Math.max(0,r));s.addColorStop(0,`rgba(255, 255, 255, ${this.intensity})`),s.addColorStop(1,"rgba(0, 0, 0, 0.0)"),this.ctx.beginPath(),this.ctx.fillStyle=s,this.ctx.arc(t.x,t.y,Math.max(0,r),0,Math.PI*2),this.ctx.fill()}}function _v(n={}){const{size:e,maxAge:t,radius:i,intensity:r,interpolate:s,smoothing:o,minForce:a,blend:c,ease:u}=n,f=l.useMemo(()=>new wv(n),[e,t,i,r,s,o,a,c,u]);Se((A,y)=>void f.update(y));const h=l.useCallback(A=>f.addTouch(A.uv),[f]);return[f.texture,h]}const Y9=({children:n,...e})=>{const t=_v(e);return l.createElement(l.Fragment,null,n==null?void 0:n(t))},um=l.forwardRef(function({children:e,disable:t,disableX:i,disableY:r,disableZ:s,left:o,right:a,top:c,bottom:u,front:f,back:h,onCentered:A,precise:y=!0,cacheKey:x=0,...d},v){const g=l.useRef(null),p=l.useRef(null),m=l.useRef(null);return l.useLayoutEffect(()=>{p.current.matrixWorld.identity();const E=new Et().setFromObject(m.current,y),w=new T,_=new Nn,C=E.max.x-E.min.x,I=E.max.y-E.min.y,b=E.max.z-E.min.z;E.getCenter(w),E.getBoundingSphere(_);const B=c?I/2:u?-I/2:0,Q=o?-C/2:a?C/2:0,S=f?b/2:h?-b/2:0;p.current.position.set(t||i?0:-w.x+Q,t||r?0:-w.y+B,t||s?0:-w.z+S),typeof A<"u"&&A({parent:g.current.parent,container:g.current,width:C,height:I,depth:b,boundingBox:E,boundingSphere:_,center:w,verticalAlignment:B,horizontalAlignment:Q,depthAlignment:S})},[x,A,c,o,f,t,i,r,s,y,a,u,h]),l.useImperativeHandle(v,()=>g.current,[]),l.createElement("group",ce({ref:g},d),l.createElement("group",{ref:p},l.createElement("group",{ref:m},e)))}),j9=l.forwardRef(({font:n,color:e="#cbcbcb",bevelSize:t=.04,debug:i=!1,children:r,...s},o)=>{const[a,c]=l.useState(0),u=l.useCallback((A=1)=>c(a+A),[a]),f=l.useCallback((A=1)=>c(a-A),[a]),h=l.useMemo(()=>({incr:u,decr:f}),[u,f]);return l.useImperativeHandle(o,()=>h,[h]),l.createElement("group",s,l.createElement(l.Suspense,{fallback:null},l.createElement(um,{top:!0,cacheKey:JSON.stringify({counter:a,font:n})},l.createElement(Z5,{bevelEnabled:!0,bevelSize:t,font:n},i?l.createElement("meshNormalMaterial",{wireframe:!0}):l.createElement("meshStandardMaterial",{color:e}),a))),r)});function hm(n){return fm(n.children,n.components)}hm.propTypes={children:gs.func.isRequired,components:gs.arrayOf(gs.oneOfType([gs.element,gs.func])).isRequired};function fm(n,e,t){if(t=t||[],!e[0])return n(t);function i(r){return fm(n,e.slice(1),t.concat([r]))}return typeof e[0]=="function"?e[0]({results:t,render:i}):l.cloneElement(e[0],{children:i})}const xo=(n,e)=>{"updateRanges"in n?n.updateRanges[0]=e:n.updateRange=e},Cv=3e3,Iv=3001;function Bv(n){return typeof n=="function"}const V1=new ue,q1=new ue,Ea=[],Ks=new be;class bv extends Eo{constructor(){super(),this.color=new ze("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,t){const i=this.instance.current;if(!i||!i.geometry||!i.material)return;Ks.geometry=i.geometry;const r=i.matrixWorld,s=i.userData.instances.indexOf(this.instanceKey);if(!(s===-1||s>i.count)){i.getMatrixAt(s,V1),q1.multiplyMatrices(r,V1),Ks.matrixWorld=q1,i.material instanceof F2?Ks.material.side=i.material.side:Ks.material.side=i.material[0].side,Ks.raycast(e,Ea);for(let o=0,a=Ea.length;o<a;o++){const c=Ea[o];c.instanceId=s,c.object=this,t.push(c)}Ea.length=0}}}const Am=l.createContext(null),Y1=new ue,j1=new ue,Sv=new ue,W1=new T,X1=new Fe,K1=new T,Mv=n=>n.isInstancedBufferAttribute,p0=l.forwardRef(({context:n,children:e,...t},i)=>{l.useMemo(()=>Pt({PositionMesh:bv}),[]);const r=l.useRef();l.useImperativeHandle(i,()=>r.current,[]);const{subscribe:s,getParent:o}=l.useContext(n||Am);return l.useLayoutEffect(()=>s(r),[]),l.createElement("positionMesh",ce({instance:o(),instanceKey:r,ref:r},t),e)}),g0=l.forwardRef(({context:n,children:e,range:t,limit:i=1e3,frames:r=1/0,...s},o)=>{const[{localContext:a,instance:c}]=l.useState(()=>{const p=l.createContext(null);return{localContext:p,instance:l.forwardRef((m,E)=>l.createElement(p0,ce({context:p},m,{ref:E})))}}),u=l.useRef(null);l.useImperativeHandle(o,()=>u.current,[]);const[f,h]=l.useState([]),[[A,y]]=l.useState(()=>{const p=new Float32Array(i*16);for(let m=0;m<i;m++)Sv.identity().toArray(p,m*16);return[p,new Float32Array([...new Array(i*3)].map(()=>1))]});l.useEffect(()=>{u.current.instanceMatrix.needsUpdate=!0});let x=0,d=0;const v=l.useRef([]);l.useLayoutEffect(()=>{v.current=Object.entries(u.current.geometry.attributes).filter(([p,m])=>Mv(m))}),Se(()=>{if(r===1/0||x<r){u.current.updateMatrix(),u.current.updateMatrixWorld(),Y1.copy(u.current.matrixWorld).invert(),d=Math.min(i,t!==void 0?t:i,f.length),u.current.count=d,xo(u.current.instanceMatrix,{offset:0,count:d*16}),xo(u.current.instanceColor,{offset:0,count:d*3});for(let p=0;p<f.length;p++){const m=f[p].current;m.matrixWorld.decompose(W1,X1,K1),j1.compose(W1,X1,K1).premultiply(Y1),j1.toArray(A,p*16),u.current.instanceMatrix.needsUpdate=!0,m.color.toArray(y,p*3),u.current.instanceColor.needsUpdate=!0}x++}});const g=l.useMemo(()=>({getParent:()=>u,subscribe:p=>(h(m=>[...m,p]),()=>h(m=>m.filter(E=>E.current!==p.current)))}),[]);return l.createElement("instancedMesh",ce({userData:{instances:f,limit:i,frames:r},matrixAutoUpdate:!1,ref:u,args:[null,null,0],raycast:()=>null},s),l.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:A.length/16,array:A,itemSize:16,usage:sn}),l.createElement("instancedBufferAttribute",{attach:"instanceColor",count:y.length/3,array:y,itemSize:3,usage:sn}),Bv(e)?l.createElement(a.Provider,{value:g},e(c)):n?l.createElement(n.Provider,{value:g},e):l.createElement(Am.Provider,{value:g},e))}),W9=l.forwardRef(function({meshes:e,children:t,...i},r){const s=Array.isArray(e);if(!s)for(const o of Object.keys(e))e[o].isMesh||delete e[o];return l.createElement("group",{ref:r},l.createElement(hm,{components:(s?e:Object.values(e)).map(({geometry:o,material:a})=>l.createElement(g0,ce({key:o.uuid,geometry:o,material:a},i)))},o=>s?t(...o):t(Object.keys(e).filter(a=>e[a].isMesh).reduce((a,c,u)=>({...a,[c]:o[u]}),{}))))});function X9(){const n=l.createContext(null);return[l.forwardRef((e,t)=>l.createElement(g0,ce({ref:t,context:n},e))),l.forwardRef((e,t)=>l.createElement(p0,ce({ref:t,context:n},e)))]}const K9=l.forwardRef(({name:n,defaultValue:e},t)=>{const i=l.useRef(null);l.useImperativeHandle(t,()=>i.current,[]),l.useLayoutEffect(()=>{const s=i.current.__r3f.parent,o=Array.isArray(e)?e:[e],a=Array.from({length:s.userData.limit},()=>o).flat();i.current.array=new Float32Array(a),i.current.itemSize=o.length,i.current.count=a.length/i.current.itemSize},[n]);let r=0;return Se(()=>{const s=i.current.__r3f.parent;if(s.userData.frames===1/0||r<s.userData.frames){for(let o=0;o<s.userData.instances.length;o++){const c=s.userData.instances[o].current[n];c!==void 0&&(i.current.set(Array.isArray(c)?c:typeof c.toArray=="function"?c.toArray():[c],o*i.current.itemSize),i.current.needsUpdate=!0)}r++}}),l.createElement("instancedBufferAttribute",{ref:i,attach:`geometry-attributes-${n}`,usage:sn})}),dm=l.createContext(null);function Z9(){return l.useContext(dm)}const $9=l.forwardRef(({startFrame:n,endFrame:e,fps:t,frameName:i,textureDataURL:r,textureImageURL:s,loop:o,numberOfFrames:a,autoPlay:c,animationNames:u,onStart:f,onEnd:h,onLoopEnd:A,onFrame:y,play:x,pause:d,flipX:v,alphaTest:g,children:p,asSprite:m,offset:E,playBackwards:w,resetOnEnd:_,maxItems:C,instanceItems:I,spriteDataset:b,...B},Q)=>{var S;const k=l.useRef(),L=l.useRef(null),O=l.useRef(),G=l.useRef(),V=l.useRef(window.performance.now()),N=l.useRef(n||0),j=l.useRef(i||""),Y=1e3/(t||30),[H,X]=l.useState(new un),W=l.useRef(0),[P,z]=l.useState([1,1,1]),D=v?-1:1,[R,$]=l.useState(m??!0),se=l.useRef(d),Z=l.useRef(E),oe=l.useRef(!1),Ae=l.useRef([]),{spriteObj:de,loadJsonAndTexture:le}=f0(null,null,u,a);function he(){}const Ie=l.useMemo(()=>({current:Z.current,offset:Z.current,imageUrl:s,reset:he,hasEnded:!1,ref:Q}),[s,b]);l.useImperativeHandle(Q,()=>k.current,[]),l.useLayoutEffect(()=>{Z.current=E},[E]);const Be=(Me,Qe)=>{const je=Qe/Me;return G.current&&G.current.scale.set(1,je,1),[1,je,1]};l.useEffect(()=>{if(b){var Me;K(b==null||(Me=b.spriteTexture)==null?void 0:Me.clone(),b.spriteData)}else le(s,r)},[b]),l.useEffect(()=>{if(de){var Me;K(de==null||(Me=de.spriteTexture)==null?void 0:Me.clone(),de==null?void 0:de.spriteData)}},[de]),l.useEffect(()=>{$(m??!0)},[m]),l.useEffect(()=>{Ie.hasEnded=!1,L.current&&w===!0?N.current=L.current.frames.length-1:N.current=0},[w]),l.useLayoutEffect(()=>{U()},[H,v]),l.useEffect(()=>{c&&(se.current=!1)},[c]),l.useLayoutEffect(()=>{if(j.current!==i&&i&&(N.current=0,j.current=i,Ie.hasEnded=!1,L.current)){const{w:Me,h:Qe}=yt(L.current.frames).sourceSize,je=Be(Me,Qe);z(je)}},[i]);const K=(Me,Qe=null)=>{if(Qe===null){if(a){const Ve=Me.image.width,st=Me.image.height;W.current=a,w&&(N.current=a-1),L.current={frames:[],meta:{version:"1.0",size:{w:Ve,h:st},scale:"1"}},L.current.frames=Qe}}else{L.current=Qe,W.current=L.current.frames.length,w&&(N.current=W.current-1);const{w:Ve,h:st}=yt(L.current.frames).sourceSize,ut=Be(Ve,st);z(ut),O.current&&(O.current.map=Me)}if(I)for(var je=0;je<I.length;je++){const Ve=Object.keys(L.current.frames),st=Ve[Math.floor(Math.random()*Ve.length)];Ae.current.push({key:je,frames:L.current.frames,selectedFrame:st,offset:{x:0,y:0}})}X(Me)},U=()=>{if(!L.current)return;const{meta:{size:Me},frames:Qe}=L.current,{w:je,h:Ve}=Array.isArray(Qe)?Qe[0].sourceSize:i?Qe[i]?Qe[i][0].sourceSize:{w:0,h:0}:{w:0,h:0};O.current.map.wrapS=O.current.map.wrapT=os,O.current.map.center.set(0,0),O.current.map.repeat.set(1*D/(Me.w/je),1/(Me.h/Ve));const ut=1/((Me.h-1)/Ve);O.current.map.offset.x=0,O.current.map.offset.y=1-ut,f&&f({currentFrameName:i,currentFrame:N.current})},ge=()=>{const Me=window.performance.now(),Qe=Me-V.current,{meta:{size:je},frames:Ve}=L.current,{w:st,h:ut}=yt(Ve).sourceSize,Nt=Array.isArray(Ve)?Ve:i?Ve[i]:[],Gt=e||Nt.length-1;var fn=E===void 0?Ie.current:E,gn=w?N.current<0:N.current>Gt,wt=w?N.current===Gt:N.current===0,Qi=w?N.current<0:N.current>=Gt;if(gn){if(N.current=o?n??0:0,w&&(N.current=Gt),o?A==null||A({currentFrameName:i,currentFrame:N.current}):(h==null||h({currentFrameName:i,currentFrame:N.current}),Ie.hasEnded=!_,_&&(se.current=!0)),!o)return}else wt&&(f==null||f({currentFrameName:i,currentFrame:N.current}));fn!==void 0&&Qi?oe.current===!1&&(h==null||h({currentFrameName:i,currentFrame:N.current}),oe.current=!0):oe.current=!1,!(Qe<=Y)&&(V.current=Me-Qe%Y,Ue(st,ut,je,Nt))},Ue=(Me,Qe,je,Ve)=>{var st=E===void 0?Ie.current:E;const ut=N.current;let Nt=0,Gt=0;Be(Me,Qe);const fn=Math.round((je.w-1)/Me),gn=Math.round((je.h-1)/Qe);if(!Ve[ut])return;const{frame:{x:wt,y:Qi},sourceSize:{w:Gn,h:nn}}=Ve[ut],ht=1/fn,ni=1/gn;if(Nt=D>0?ht*(wt/Gn):ht*(wt/Gn)-O.current.map.repeat.x,Gt=Math.abs(1-ni)-ni*(Qi/nn),O.current.map.offset.x=Nt,O.current.map.offset.y=Gt,st!=null){let Ce=Math.floor(st*Ve.length);Ce=Math.max(0,Math.min(Ce,Ve.length-1)),isNaN(Ce)&&(Ce=0),N.current=Ce}else w?N.current-=1:N.current+=1};Se((Me,Qe)=>{var je,Ve;!((je=L.current)!=null&&je.frames)||!((Ve=O.current)!=null&&Ve.map)||se.current||!Ie.hasEnded&&(c||x)&&(ge(),y&&y({currentFrameName:j.current,currentFrame:N.current}))});const yt=Me=>{if(Array.isArray(Me))return Me[0];if(typeof Me=="object"&&Me!==null){const Qe=Object.keys(Me);return i?Me[i][0]:Me[Qe[0]][0]}else return{w:0,h:0}};function bt(Me,Qe){let je=[];return typeof Qe=="number"?je=[Qe,Qe,Qe]:Array.isArray(Qe)?je=Qe:Qe instanceof T&&(je=[Qe.x,Qe.y,Qe.z]),Me.map((st,ut)=>st*je[ut])}return l.createElement("group",ce({},B,{ref:k,scale:bt(P??[1,1,1],(S=B.scale)!==null&&S!==void 0?S:1)}),l.createElement(dm.Provider,{value:Ie},l.createElement(l.Suspense,{fallback:null},R&&l.createElement("sprite",{ref:G,scale:1},l.createElement("spriteMaterial",{premultipliedAlpha:!1,toneMapped:!1,ref:O,map:H,transparent:!0,alphaTest:g??0})),!R&&l.createElement(g0,{limit:C??1},l.createElement("planeGeometry",{args:[1,1]}),l.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:on,ref:O,map:H,transparent:!0,alphaTest:g??0}),(I??[0]).map((Me,Qe)=>l.createElement(p0,{key:Qe,ref:(I==null?void 0:I.length)===1?G:null,position:Me,scale:1})))),p))}),J9=l.forwardRef(({children:n,curve:e},t)=>{const[i]=l.useState(()=>new Ji),[r,s]=l.useState(),o=l.useRef();return l.useEffect(()=>{o.current=new Mg(i.children[0]),s(o.current.object3D)},[n]),l.useEffect(()=>{var a;e&&((a=o.current)==null||a.updateCurve(0,e))},[e]),l.useImperativeHandle(t,()=>({moveAlongCurve:a=>{var c;(c=o.current)==null||c.moveAlongCurve(a)}})),l.createElement(l.Fragment,null,pr(n,i),r&&l.createElement("primitive",{object:r}))});var Tv=`#define GLSLIFY 1
vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`;class Pv extends fA{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`
      uniform float time;
      uniform float radius;
      uniform float distort;
      ${Tv}
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`
        float updateTime = time / 50.0;
        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));
        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));
        `)}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}const ex=l.forwardRef(({speed:n=1,...e},t)=>{const[i]=l.useState(()=>new Pv);return Se(r=>i&&(i.time=r.clock.getElapsedTime()*n)),l.createElement("primitive",ce({object:i,ref:t,attach:"material"},e))});class Dv extends AA{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`
      uniform float time;
      uniform float factor;
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`float theta = sin( time + position.y ) / 2.0 * factor;
        float c = cos( theta );
        float s = sin( theta );
        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );
        vec3 transformed = vec3( position ) * m;
        vNormal = vNormal * m;`)}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}const tx=l.forwardRef(({speed:n=1,...e},t)=>{const[i]=l.useState(()=>new Dv);return Se(r=>i&&(i.time=r.clock.getElapsedTime()*n)),l.createElement("primitive",ce({object:i,ref:t,attach:"material"},e))});class Qv extends jt{constructor(e=new _e){super({uniforms:{inputBuffer:new vn(null),depthBuffer:new vn(null),resolution:new vn(new _e),texelSize:new vn(new _e),halfTexelSize:new vn(new _e),kernel:new vn(0),scale:new vn(1),cameraNear:new vn(0),cameraFar:new vn(1),minDepthThreshold:new vn(0),maxDepthThreshold:new vn(1),depthScale:new vn(0),depthToBlurRatioBias:new vn(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${Cn>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:Mu,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class mm{constructor({gl:e,resolution:t,width:i=500,height:r=500,minDepthThreshold:s=0,maxDepthThreshold:o=1,depthScale:a=0,depthToBlurRatioBias:c=.25}){this.renderToScreen=!1,this.renderTargetA=new Tt(t,t,{minFilter:lt,magFilter:lt,stencilBuffer:!1,depthBuffer:!1,type:xt}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new Qv,this.convolutionMaterial.setTexelSize(1/i,1/r),this.convolutionMaterial.setResolution(new _e(i,r)),this.scene=new Ji,this.camera=new lA,this.convolutionMaterial.uniforms.minDepthThreshold.value=s,this.convolutionMaterial.uniforms.maxDepthThreshold.value=o,this.convolutionMaterial.uniforms.depthScale.value=a,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=c,this.convolutionMaterial.defines.USE_DEPTH=a>0;const u=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),f=new Float32Array([0,0,2,0,0,2]),h=new tn;h.setAttribute("position",new Mt(u,3)),h.setAttribute("uv",new Mt(f,2)),this.screen=new be(h,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,i){const r=this.scene,s=this.camera,o=this.renderTargetA,a=this.renderTargetB;let c=this.convolutionMaterial,u=c.uniforms;u.depthBuffer.value=t.depthTexture;const f=c.kernel;let h=t,A,y,x;for(y=0,x=f.length-1;y<x;++y)A=y&1?a:o,u.kernel.value=f[y],u.inputBuffer.value=h.texture,e.setRenderTarget(A),e.render(r,s),h=A;u.kernel.value=f[y],u.inputBuffer.value=h.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(r,s)}}let pm=class extends AA{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;(t=e.defines)!=null&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),e.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}};const ix=l.forwardRef(({mixBlur:n=0,mixStrength:e=1,resolution:t=256,blur:i=[0,0],minDepthThreshold:r=.9,maxDepthThreshold:s=1,depthScale:o=0,depthToBlurRatioBias:a=.25,mirror:c=0,distortion:u=1,mixContrast:f=1,distortionMap:h,reflectorOffset:A=0,...y},x)=>{Pt({MeshReflectorMaterialImpl:pm});const d=J(({gl:H})=>H),v=J(({camera:H})=>H),g=J(({scene:H})=>H);i=Array.isArray(i)?i:[i,i];const p=i[0]+i[1]>0,m=l.useRef(null);l.useImperativeHandle(x,()=>m.current,[]);const[E]=l.useState(()=>new Di),[w]=l.useState(()=>new T),[_]=l.useState(()=>new T),[C]=l.useState(()=>new T),[I]=l.useState(()=>new ue),[b]=l.useState(()=>new T(0,0,-1)),[B]=l.useState(()=>new Qt),[Q]=l.useState(()=>new T),[S]=l.useState(()=>new T),[k]=l.useState(()=>new Qt),[L]=l.useState(()=>new ue),[O]=l.useState(()=>new It),G=l.useCallback(()=>{var H;const X=m.current.parent||((H=m.current)==null?void 0:H.__r3f.parent);if(!X||(_.setFromMatrixPosition(X.matrixWorld),C.setFromMatrixPosition(v.matrixWorld),I.extractRotation(X.matrixWorld),w.set(0,0,1),w.applyMatrix4(I),_.addScaledVector(w,A),Q.subVectors(_,C),Q.dot(w)>0))return;Q.reflect(w).negate(),Q.add(_),I.extractRotation(v.matrixWorld),b.set(0,0,-1),b.applyMatrix4(I),b.add(C),S.subVectors(_,b),S.reflect(w).negate(),S.add(_),O.position.copy(Q),O.up.set(0,1,0),O.up.applyMatrix4(I),O.up.reflect(w),O.lookAt(S),O.far=v.far,O.updateMatrixWorld(),O.projectionMatrix.copy(v.projectionMatrix),L.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),L.multiply(O.projectionMatrix),L.multiply(O.matrixWorldInverse),L.multiply(X.matrixWorld),E.setFromNormalAndCoplanarPoint(w,_),E.applyMatrix4(O.matrixWorldInverse),B.set(E.normal.x,E.normal.y,E.normal.z,E.constant);const W=O.projectionMatrix;k.x=(Math.sign(B.x)+W.elements[8])/W.elements[0],k.y=(Math.sign(B.y)+W.elements[9])/W.elements[5],k.z=-1,k.w=(1+W.elements[10])/W.elements[14],B.multiplyScalar(2/B.dot(k)),W.elements[2]=B.x,W.elements[6]=B.y,W.elements[10]=B.z+1,W.elements[14]=B.w},[v,A]),[V,N,j,Y]=l.useMemo(()=>{const H={minFilter:lt,magFilter:lt,type:xt},X=new Tt(t,t,H);X.depthBuffer=!0,X.depthTexture=new sc(t,t),X.depthTexture.format=zu,X.depthTexture.type=ac;const W=new Tt(t,t,H),P=new mm({gl:d,resolution:t,width:i[0],height:i[1],minDepthThreshold:r,maxDepthThreshold:s,depthScale:o,depthToBlurRatioBias:a}),z={mirror:c,textureMatrix:L,mixBlur:n,tDiffuse:X.texture,tDepth:X.depthTexture,tDiffuseBlur:W.texture,hasBlur:p,mixStrength:e,minDepthThreshold:r,maxDepthThreshold:s,depthScale:o,depthToBlurRatioBias:a,distortion:u,distortionMap:h,mixContrast:f,"defines-USE_BLUR":p?"":void 0,"defines-USE_DEPTH":o>0?"":void 0,"defines-USE_DISTORTION":h?"":void 0};return[X,W,P,z]},[d,i,L,t,c,p,n,e,r,s,o,a,u,h,f]);return Se(()=>{var H;const X=m.current.parent||((H=m.current)==null?void 0:H.__r3f.parent);if(!X)return;X.visible=!1;const W=d.xr.enabled,P=d.shadowMap.autoUpdate;G(),d.xr.enabled=!1,d.shadowMap.autoUpdate=!1,d.setRenderTarget(V),d.state.buffers.depth.setMask(!0),d.autoClear||d.clear(),d.render(g,O),p&&j.render(d,V,N),d.xr.enabled=W,d.shadowMap.autoUpdate=P,X.visible=!0,d.setRenderTarget(null)}),l.createElement("meshReflectorMaterialImpl",ce({attach:"material",key:"key"+Y["defines-USE_BLUR"]+Y["defines-USE_DEPTH"]+Y["defines-USE_DISTORTION"],ref:m},Y,y))}),Rv=ti({envMap:null,bounces:3,ior:2.4,correctMips:!0,aberrationStrength:.01,fresnel:0,bvh:new lm,color:new ze("white"),opacity:1,resolution:new _e,viewMatrixInverse:new ue,projectionMatrixInverse:new ue},`
  uniform mat4 viewMatrixInverse;

  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_vertex>

  void main() {
    #include <color_vertex>

    vec4 transformedNormal = vec4(normal, 0.0);
    vec4 transformedPosition = vec4(position, 1.0);
    #ifdef USE_INSTANCING
      transformedNormal = instanceMatrix * transformedNormal;
      transformedPosition = instanceMatrix * transformedPosition;
    #endif

    #ifdef USE_INSTANCING
      vModelMatrixInverse = inverse(modelMatrix * instanceMatrix);
    #else
      vModelMatrixInverse = inverse(modelMatrix);
    #endif

    vWorldPosition = (modelMatrix * transformedPosition).xyz;
    vNormal = normalize((viewMatrixInverse * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz);
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;
  }`,`
  #define ENVMAP_TYPE_CUBE_UV
  precision highp isampler2D;
  precision highp usampler2D;
  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    uniform samplerCube envMap;
  #else
    uniform sampler2D envMap;
  #endif

  uniform float bounces;
  ${fv}
  ${Av}
  uniform BVH bvh;
  uniform float ior;
  uniform bool correctMips;
  uniform vec2 resolution;
  uniform float fresnel;
  uniform mat4 modelMatrix;
  uniform mat4 projectionMatrixInverse;
  uniform mat4 viewMatrixInverse;
  uniform float aberrationStrength;
  uniform vec3 color;
  uniform float opacity;

  float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {
    return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );
  }

  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {
    vec3 rayOrigin = ro;
    vec3 rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = vWorldPosition + rayDirection * 0.001;
    rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;
    rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);
    for(float i = 0.0; i < bounces; i++) {
      uvec4 faceIndices = uvec4( 0u );
      vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
      vec3 barycoord = vec3( 0.0 );
      float side = 1.0;
      float dist = 0.0;
      bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );
      vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);
      vec3 tempDir = refract(rayDirection, faceNormal, ior);
      if (length(tempDir) != 0.0) {
        rayDirection = tempDir;
        break;
      }
      rayDirection = reflect(rayDirection, faceNormal);
      rayOrigin = hitPos + rayDirection * 0.01;
    }
    rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);
    return rayDirection;
  }

  #include <common>
  #include <cube_uv_reflection_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));
    }
  #else
    vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      vec2 uvv = equirectUv( rayDirection );
      vec2 smoothUv = equirectUv( directionCamPerfect );
      return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));
    }
  #endif

  void main() {
    vec2 uv = gl_FragCoord.xy / resolution;
    vec3 directionCamPerfect = (projectionMatrixInverse * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;
    directionCamPerfect = (viewMatrixInverse * vec4(directionCamPerfect, 0.0)).xyz;
    directionCamPerfect = normalize(directionCamPerfect);
    vec3 normal = vNormal;
    vec3 rayOrigin = cameraPosition;
    vec3 rayDirection = normalize(vWorldPosition - cameraPosition);

    vec4 diffuseColor = vec4(color, opacity);
    #include <color_fragment>

    #ifdef CHROMATIC_ABERRATIONS
      vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      #ifdef FAST_CHROMA
        vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));
        vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));
      #else
        vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), vModelMatrixInverse);
        vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), vModelMatrixInverse);
      #endif
      float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;
      float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;
      float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;
      diffuseColor.rgb *= vec3(finalColorR, finalColorG, finalColorB);
    #else
      rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      diffuseColor.rgb *= textureGradient(envMap, rayDirection, directionCamPerfect).rgb;
    #endif

    vec3 viewDirection = normalize(vWorldPosition - cameraPosition);
    float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;
    gl_FragColor = vec4(mix(diffuseColor.rgb, vec3(1.0), nFresnel), diffuseColor.a);

    #include <tonemapping_fragment>
    #include <${Cn>=154?"colorspace_fragment":"encodings_fragment"}>
  }`),zv=n=>n&&n.isCubeTexture;function rx({aberrationStrength:n=0,fastChroma:e=!0,envMap:t,...i}){Pt({MeshRefractionMaterial:Rv});const r=l.useRef(),{size:s}=J(),o=l.useMemo(()=>{var a,c;const u={},f=zv(t),A=((a=f?(c=t.image[0])==null?void 0:c.width:t.image.width)!==null&&a!==void 0?a:1024)/4,y=Math.floor(Math.log2(A)),x=Math.pow(2,y),d=3*Math.max(x,16*7),v=4*x;return f&&(u.ENVMAP_TYPE_CUBEM=""),u.CUBEUV_TEXEL_WIDTH=`${1/d}`,u.CUBEUV_TEXEL_HEIGHT=`${1/v}`,u.CUBEUV_MAX_MIP=`${y}.0`,n>0&&(u.CHROMATIC_ABERRATIONS=""),e&&(u.FAST_CHROMA=""),u},[n,e]);return l.useLayoutEffect(()=>{var a;const c=(a=r.current)==null||(a=a.__r3f)==null||(a=a.parent)==null?void 0:a.geometry;c&&(r.current.bvh=new lm,r.current.bvh.updateFrom(new wc(c.clone().toNonIndexed(),{strategy:vc})))},[]),Se(({camera:a})=>{r.current.viewMatrixInverse=a.matrixWorld,r.current.projectionMatrixInverse=a.projectionMatrixInverse}),l.createElement("meshRefractionMaterial",ce({key:JSON.stringify(o),defines:o,ref:r,resolution:[s.width,s.height],aberrationStrength:n,envMap:t},i))}const y0=ti({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class Fv extends fA{constructor(e=6,t=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new ze("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=i=>{i.uniforms={...i.uniforms,...this.uniforms},this.anisotropy>0&&(i.defines.USE_ANISOTROPY=""),t?i.defines.USE_SAMPLER="":i.defines.USE_TRANSMISSION="",i.fragmentShader=`
      uniform float chromaticAberration;         
      uniform float anisotropicBlur;      
      uniform float time;
      uniform float distortion;
      uniform float distortionScale;
      uniform float temporalDistortion;
      uniform sampler2D buffer;

      vec3 random3(vec3 c) {
        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
        vec3 r;
        r.z = fract(512.0*j);
        j *= .125;
        r.x = fract(512.0*j);
        j *= .125;
        r.y = fract(512.0*j);
        return r-0.5;
      }

      uint hash( uint x ) {
        x += ( x << 10u );
        x ^= ( x >>  6u );
        x += ( x <<  3u );
        x ^= ( x >> 11u );
        x += ( x << 15u );
        return x;
      }

      // Compound versions of the hashing algorithm I whipped together.
      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }
      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }
      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }

      // Construct a float with half-open range [0:1] using low 23 bits.
      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.
      float floatConstruct( uint m ) {
        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask
        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32
        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)
        m |= ieeeOne;                          // Add fractional part to 1.0
        float  f = uintBitsToFloat( m );       // Range [1:2]
        return f - 1.0;                        // Range [0:1]
      }

      // Pseudo-random value in half-open range [0:1].
      float randomBase( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }
      float randomBase( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float rand(float seed) {
        float result = randomBase(vec3(gl_FragCoord.xy, seed));
        return result;
      }

      const float F3 =  0.3333333;
      const float G3 =  0.1666667;

      float snoise(vec3 p) {
        vec3 s = floor(p + dot(p, vec3(F3)));
        vec3 x = p - s + dot(s, vec3(G3));
        vec3 e = step(vec3(0.0), x - x.yzx);
        vec3 i1 = e*(1.0 - e.zxy);
        vec3 i2 = 1.0 - e.zxy*(1.0 - e);
        vec3 x1 = x - i1 + G3;
        vec3 x2 = x - i2 + 2.0*G3;
        vec3 x3 = x - 1.0 + 3.0*G3;
        vec4 w, d;
        w.x = dot(x, x);
        w.y = dot(x1, x1);
        w.z = dot(x2, x2);
        w.w = dot(x3, x3);
        w = max(0.6 - w, 0.0);
        d.x = dot(random3(s), x);
        d.y = dot(random3(s + i1), x1);
        d.z = dot(random3(s + i2), x2);
        d.w = dot(random3(s + 1.0), x3);
        w *= w;
        w *= w;
        d *= w;
        return dot(d, vec4(52.0));
      }

      float snoiseFractal(vec3 m) {
        return 0.5333333* snoise(m)
              +0.2666667* snoise(2.0*m)
              +0.1333333* snoise(4.0*m)
              +0.0666667* snoise(8.0*m);
      }
`+i.fragmentShader,i.fragmentShader=i.fragmentShader.replace("#include <transmission_pars_fragment>",`
        #ifdef USE_TRANSMISSION
          // Transmission code is based on glTF-Sampler-Viewer
          // https://github.com/KhronosGroup/glTF-Sample-Viewer
          uniform float _transmission;
          uniform float thickness;
          uniform float attenuationDistance;
          uniform vec3 attenuationColor;
          #ifdef USE_TRANSMISSIONMAP
            uniform sampler2D transmissionMap;
          #endif
          #ifdef USE_THICKNESSMAP
            uniform sampler2D thicknessMap;
          #endif
          uniform vec2 transmissionSamplerSize;
          uniform sampler2D transmissionSamplerMap;
          uniform mat4 modelMatrix;
          uniform mat4 projectionMatrix;
          varying vec3 vWorldPosition;
          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
            // Direction of refracted light.
            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
            // Compute rotation-independant scaling of the model matrix.
            vec3 modelScale;
            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
            // The thickness is specified in local space.
            return normalize( refractionVector ) * thickness * modelScale;
          }
          float applyIorToRoughness( const in float roughness, const in float ior ) {
            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
            // an IOR of 1.5 results in the default amount of microfacet refraction.
            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
          }
          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            
            #ifdef USE_SAMPLER
              #ifdef texture2DLodEXT
                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #else
                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #endif
            #else
              return texture2D(buffer, fragCoord.xy);
            #endif
          }
          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
            if ( isinf( attenuationDistance ) ) {
              // Attenuation distance is +∞, i.e. the transmitted color is not attenuated at all.
              return radiance;
            } else {
              // Compute light attenuation using Beer's law.
              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
              return transmittance * radiance;
            }
          }
          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
            const in vec3 attenuationColor, const in float attenuationDistance ) {
            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
            vec3 refractedRayExit = position + transmissionRay;
            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
            vec2 refractionCoords = ndcPos.xy / ndcPos.w;
            refractionCoords += 1.0;
            refractionCoords /= 2.0;
            // Sample framebuffer to get pixel the refracted ray hits.
            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
            // Get the specular component.
            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
          }
        #endif
`),i.fragmentShader=i.fragmentShader.replace("#include <transmission_fragment>",`  
        // Improve the refraction to use the world pos
        material.transmission = _transmission;
        material.transmissionAlpha = 1.0;
        material.thickness = thickness;
        material.attenuationDistance = attenuationDistance;
        material.attenuationColor = attenuationColor;
        #ifdef USE_TRANSMISSIONMAP
          material.transmission *= texture2D( transmissionMap, vUv ).r;
        #endif
        #ifdef USE_THICKNESSMAP
          material.thickness *= texture2D( thicknessMap, vUv ).g;
        #endif
        
        vec3 pos = vWorldPosition;
        float runningSeed = 0.0;
        vec3 v = normalize( cameraPosition - pos );
        vec3 n = inverseTransformDirection( normal, viewMatrix );
        vec3 transmission = vec3(0.0);
        float transmissionR, transmissionB, transmissionG;
        float randomCoords = rand(runningSeed++);
        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);
        vec3 distortionNormal = vec3(0.0);
        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;
        if (distortion > 0.0) {
          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));
        }
        for (float i = 0.0; i < ${e}.0; i ++) {
          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5)) * pow(rand(runningSeed++), 0.33) + distortionNormal);
          transmissionR = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).r;
          transmissionG = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).g;
          transmissionB = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).b;
          transmission.r += transmissionR;
          transmission.g += transmissionG;
          transmission.b += transmissionB;
        }
        transmission /= ${e}.0;
        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
`)},Object.keys(this.uniforms).forEach(i=>Object.defineProperty(this,i,{get:()=>this.uniforms[i].value,set:r=>this.uniforms[i].value=r}))}}const sx=l.forwardRef(({buffer:n,transmissionSampler:e=!1,backside:t=!1,side:i=Na,transmission:r=1,thickness:s=0,backsideThickness:o=0,backsideEnvMapIntensity:a=1,samples:c=10,resolution:u,backsideResolution:f,background:h,anisotropy:A,anisotropicBlur:y,...x},d)=>{Pt({MeshTransmissionMaterial:Fv});const v=l.useRef(null),[g]=l.useState(()=>new y0),p=mn(f||u),m=mn(u);let E,w,_,C;return Se(I=>{v.current.time=I.clock.getElapsedTime(),v.current.buffer===m.texture&&!e&&(C=v.current.__r3f.parent,C&&(_=I.gl.toneMapping,E=I.scene.background,w=v.current.envMapIntensity,I.gl.toneMapping=L2,h&&(I.scene.background=h),C.material=g,t&&(I.gl.setRenderTarget(p),I.gl.render(I.scene,I.camera),C.material=v.current,C.material.buffer=p.texture,C.material.thickness=o,C.material.side=us,C.material.envMapIntensity=a),I.gl.setRenderTarget(m),I.gl.render(I.scene,I.camera),C.material=v.current,C.material.thickness=s,C.material.side=i,C.material.buffer=m.texture,C.material.envMapIntensity=w,I.scene.background=E,I.gl.setRenderTarget(null),I.gl.toneMapping=_))}),l.useImperativeHandle(d,()=>v.current,[]),l.createElement("meshTransmissionMaterial",ce({args:[c,e],ref:v},x,{buffer:n||m.texture,_transmission:r,anisotropicBlur:y??A,transmission:e?r:0,thickness:s,side:i}))}),ox=l.forwardRef((n,e)=>(Pt({DiscardMaterialImpl:y0}),l.createElement("discardMaterialImpl",ce({ref:e},n)))),bl=Cn>=154?"opaque_fragment":"output_fragment";class Lv extends k2{constructor(e){super(e),this.onBeforeCompile=(t,i)=>{const{isWebGL2:r}=i.capabilities;t.fragmentShader=t.fragmentShader.replace(`#include <${bl}>`,`
        ${r?`#include <${bl}>`:`#extension GL_OES_standard_derivatives : enable
#include <${bl}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${Cn>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const ax=l.forwardRef((n,e)=>{const[t]=l.useState(()=>new Lv(null));return l.createElement("primitive",ce({},n,{object:t,ref:e,attach:"material"}))}),kv=({focus:n=0,size:e=25,samples:t=10}={})=>`
#define PENUMBRA_FILTER_SIZE float(${e})
#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
vec3 randRGB(vec2 uv) {
  return vec3(
    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
  );
}

vec3 lowPassRandRGB(vec2 uv) {
  // 3x3 convolution (average)
  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
  vec3 result = vec3(0);
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
  result *= 0.111111111; // 1.0 / 9.0
  return result;
}
vec3 highPassRandRGB(vec2 uv) {
  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
  // hp(x) = x - lp(x)
  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
}


vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}
float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
  return (zReceiver - zBlocker) / zBlocker;
}
float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float blockerDepthSum = float(${n});
  float blockers = 0.0;

  int j = 0;
  vec2 offset = vec2(0.);
  float depth = 0.;

  #pragma unroll_loop_start
  for(int i = 0; i < ${t}; i ++) {
    offset = (vogelDiskSample(j, ${t}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
    if (depth < compare) {
      blockerDepthSum += depth;
      blockers++;
    }
    j++;
  }
  #pragma unroll_loop_end

  if (blockers > 0.0) {
    return blockerDepthSum / blockers;
  }
  return -1.0;
}

        
float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float shadow = 0.0f;
  int j = 0;
  vec2 vogelSample = vec2(0.0);
  vec2 offset = vec2(0.0);
  #pragma unroll_loop_start
  for (int i = 0; i < ${t}; i++) {
    vogelSample = vogelDiskSample(j, ${t}, angle) * texelSize;
    offset = vogelSample * (1.0 + filterRadius * float(${e}));
    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    j++;
  }
  #pragma unroll_loop_end
  return shadow * 1.0 / ${t}.0;
}

float PCSS (sampler2D shadowMap, vec4 coords) {
  vec2 uv = coords.xy;
  float zReceiver = coords.z; // Assumed to be eye-space z in this code
  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
  if (avgBlockerDepth == -1.0) {
    return 1.0;
  }
  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
}`;function Z1(n,e,t){e.traverse(i=>{i.material&&(n.properties.remove(i.material),i.material.dispose==null||i.material.dispose())}),n.info.programs.length=0,n.compile(e,t)}function cx({focus:n=0,samples:e=10,size:t=25}){const i=J(o=>o.gl),r=J(o=>o.scene),s=J(o=>o.camera);return l.useEffect(()=>{const o=io.shadowmap_pars_fragment;return io.shadowmap_pars_fragment=io.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP",`#ifdef USE_SHADOWMAP
`+kv({size:t,samples:e,focus:n})).replace("#if defined( SHADOWMAP_TYPE_PCF )",`
return PCSS(shadowMap, shadowCoord);
#if defined( SHADOWMAP_TYPE_PCF )`),Z1(i,r,s),()=>{io.shadowmap_pars_fragment=o,Z1(i,r,s)}},[n,t,e]),null}function Ut(n,e){const t=n+"Geometry";return l.forwardRef(({args:i,children:r,...s},o)=>{const a=l.useRef(null);return l.useImperativeHandle(o,()=>a.current),l.useLayoutEffect(()=>void(e==null?void 0:e(a.current))),l.createElement("mesh",ce({ref:a},s),l.createElement(t,{attach:"geometry",args:i}),r)})}const lx=Ut("box"),ux=Ut("circle"),hx=Ut("cone"),fx=Ut("cylinder"),Ax=Ut("sphere"),dx=Ut("plane"),mx=Ut("tube"),px=Ut("torus"),gx=Ut("torusKnot"),yx=Ut("tetrahedron"),vx=Ut("ring"),xx=Ut("polyhedron"),Ex=Ut("icosahedron"),wx=Ut("octahedron"),_x=Ut("dodecahedron"),Cx=Ut("extrude"),Ix=Ut("lathe"),Bx=Ut("capsule"),bx=Ut("shape",({geometry:n})=>{const e=n.attributes.position,t=new Et().setFromBufferAttribute(e),i=new T;t.getSize(i);const r=[];let s=0,o=0,a=0,c=0;for(let u=0;u<e.count;u++)s=e.getX(u),o=e.getY(u),a=(s-t.min.x)/i.x,c=(o-t.min.y)/i.y,r.push(a,c);n.setAttribute("uv",new Yt(r,2))}),li=1e-5;function Ov(n,e,t){const i=new Jf,r=t-li;return i.absarc(li,li,li,-Math.PI/2,-Math.PI,!0),i.absarc(li,e-r*2,li,Math.PI,Math.PI/2,!0),i.absarc(n-r*2,e-r*2,li,Math.PI/2,0,!0),i.absarc(n-r*2,li,li,0,-Math.PI/2,!0),i}const Sx=l.forwardRef(function({args:[e=1,t=1,i=1]=[],radius:r=.05,steps:s=1,smoothness:o=4,bevelSegments:a=4,creaseAngle:c=.4,children:u,...f},h){const A=l.useMemo(()=>Ov(e,t,r),[e,t,r]),y=l.useMemo(()=>({depth:i-r*2,bevelEnabled:!0,bevelSegments:a*2,steps:s,bevelSize:r-li,bevelThickness:r,curveSegments:o}),[i,r,o]),x=l.useRef(null);return l.useLayoutEffect(()=>{x.current&&(x.current.center(),nA(x.current,c))},[A,y]),l.createElement("mesh",ce({ref:h},f),l.createElement("extrudeGeometry",{ref:x,args:[A,y]}),u)});function Uv(){const n=new tn,e=new Float32Array([-1,-1,3,-1,-1,3]);return n.boundingSphere=new Nn,n.boundingSphere.set(new T,1/0),n.setAttribute("position",new Mt(e,2)),n}const Mx=l.forwardRef(function({children:e,...t},i){const r=l.useMemo(Uv,[]);return l.createElement("mesh",ce({ref:i,geometry:r,frustumCulled:!1},t),e)}),Tx=l.forwardRef(({children:n,width:e,height:t,depth:i,box3:r,precise:s=!0,...o},a)=>{const c=l.useRef(null),u=l.useRef(null),f=l.useRef(null);return l.useLayoutEffect(()=>{u.current.matrixWorld.identity();let h=r||new Et().setFromObject(f.current,s);const A=h.max.x-h.min.x,y=h.max.y-h.min.y,x=h.max.z-h.min.z;let d=Math.max(A,y,x);e&&(d=A),t&&(d=y),i&&(d=x),u.current.scale.setScalar(1/d)},[e,t,i,r,s]),l.useImperativeHandle(a,()=>c.current,[]),l.createElement("group",ce({ref:c},o),l.createElement("group",{ref:u},l.createElement("group",{ref:f},n)))});var Pn=function(n){return n[n.NONE=0]="NONE",n[n.START=1]="START",n[n.ACTIVE=2]="ACTIVE",n}(Pn||{});const Gr=n=>n&&n.isOrthographicCamera,Nv=n=>n&&n.isBox3,Gv=n=>1-Math.exp(-5*n)+.007*n,gm=l.createContext(null);function Hv({children:n,maxDuration:e=1,margin:t=1.2,observe:i,fit:r,clip:s,interpolateFunc:o=Gv,onFit:a}){const c=l.useRef(null),{camera:u,size:f,invalidate:h}=J(),A=J(w=>w.controls),y=l.useRef(a);y.current=a;const x=l.useRef({camPos:new T,camRot:new Fe,camZoom:1}),d=l.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),v=l.useRef(Pn.NONE),g=l.useRef(0),[p]=l.useState(()=>new Et),m=l.useMemo(()=>{function w(){const _=p.getSize(new T),C=p.getCenter(new T),I=Math.max(_.x,_.y,_.z),b=Gr(u)?I*4:I/(2*Math.atan(Math.PI*u.fov/360)),B=Gr(u)?I*4:b/u.aspect,Q=t*Math.max(b,B);return{box:p,size:_,center:C,distance:Q}}return{getSize:w,refresh(_){if(Nv(_))p.copy(_);else{const C=_||c.current;if(!C)return this;C.updateWorldMatrix(!0,!0),p.setFromObject(C)}if(p.isEmpty()){const C=u.position.length()||10;p.setFromCenterAndSize(new T,new T(C,C,C))}return x.current.camPos.copy(u.position),x.current.camRot.copy(u.quaternion),Gr(u)&&(x.current.camZoom=u.zoom),d.current.camPos=void 0,d.current.camRot=void 0,d.current.camZoom=void 0,d.current.camUp=void 0,d.current.target=void 0,this},reset(){const{center:_,distance:C}=w(),I=u.position.clone().sub(_).normalize();d.current.camPos=_.clone().addScaledVector(I,C),d.current.target=_.clone();const b=new ue().lookAt(d.current.camPos,d.current.target,u.up);return d.current.camRot=new Fe().setFromRotationMatrix(b),v.current=Pn.START,g.current=0,this},moveTo(_){return d.current.camPos=Array.isArray(_)?new T(..._):_.clone(),v.current=Pn.START,g.current=0,this},lookAt({target:_,up:C}){d.current.target=Array.isArray(_)?new T(..._):_.clone(),C?d.current.camUp=Array.isArray(C)?new T(...C):C.clone():d.current.camUp=u.up.clone();const I=new ue().lookAt(d.current.camPos||u.position,d.current.target,d.current.camUp);return d.current.camRot=new Fe().setFromRotationMatrix(I),v.current=Pn.START,g.current=0,this},to({position:_,target:C}){return this.moveTo(_).lookAt({target:C})},fit(){if(!Gr(u))return this.reset();let _=0,C=0;const I=[new T(p.min.x,p.min.y,p.min.z),new T(p.min.x,p.max.y,p.min.z),new T(p.min.x,p.min.y,p.max.z),new T(p.min.x,p.max.y,p.max.z),new T(p.max.x,p.max.y,p.max.z),new T(p.max.x,p.max.y,p.min.z),new T(p.max.x,p.min.y,p.max.z),new T(p.max.x,p.min.y,p.min.z)],b=d.current.camPos||u.position,B=d.current.target||(A==null?void 0:A.target),Q=d.current.camUp||u.up,S=B?new ue().lookAt(b,B,Q).setPosition(b).invert():u.matrixWorldInverse;for(const O of I)O.applyMatrix4(S),_=Math.max(_,Math.abs(O.y)),C=Math.max(C,Math.abs(O.x));_*=2,C*=2;const k=(u.top-u.bottom)/_,L=(u.right-u.left)/C;return d.current.camZoom=Math.min(k,L)/t,v.current=Pn.START,g.current=0,y.current&&y.current(this.getSize()),this},clip(){const{distance:_}=w();return u.near=_/100,u.far=_*100,u.updateProjectionMatrix(),A&&(A.maxDistance=_*10,A.update()),h(),this}}},[p,u,A,t,h]);l.useLayoutEffect(()=>{if(A){const w=()=>{if(A&&d.current.target&&v.current!==Pn.NONE){const _=new T().setFromMatrixColumn(u.matrix,2),C=x.current.camPos.distanceTo(A.target),I=(d.current.camPos||x.current.camPos).distanceTo(d.current.target),b=(1-g.current)*C+g.current*I;A.target.copy(u.position).addScaledVector(_,-b),A.update()}v.current=Pn.NONE};return A.addEventListener("start",w),()=>A.removeEventListener("start",w)}},[A]);const E=l.useRef(0);return l.useLayoutEffect(()=>{(i||E.current++===0)&&(m.refresh(),r&&m.reset().fit(),s&&m.clip())},[f,s,r,i,u,A]),Se((w,_)=>{if(v.current===Pn.START)v.current=Pn.ACTIVE,h();else if(v.current===Pn.ACTIVE){if(g.current+=_/e,g.current>=1)d.current.camPos&&u.position.copy(d.current.camPos),d.current.camRot&&u.quaternion.copy(d.current.camRot),d.current.camUp&&u.up.copy(d.current.camUp),d.current.camZoom&&Gr(u)&&(u.zoom=d.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix(),A&&d.current.target&&(A.target.copy(d.current.target),A.update()),v.current=Pn.NONE;else{const C=o(g.current);d.current.camPos&&u.position.lerpVectors(x.current.camPos,d.current.camPos,C),d.current.camRot&&u.quaternion.slerpQuaternions(x.current.camRot,d.current.camRot,C),d.current.camUp&&u.up.set(0,1,0).applyQuaternion(u.quaternion),d.current.camZoom&&Gr(u)&&(u.zoom=(1-C)*x.current.camZoom+C*d.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix()}h()}}),l.createElement("group",{ref:c},l.createElement(gm.Provider,{value:m},n))}function Vv(){return l.useContext(gm)}const Px=l.forwardRef(({intensity:n=1,decay:e,decayRate:t=.65,maxYaw:i=.1,maxPitch:r=.1,maxRoll:s=.1,yawFrequency:o=.1,pitchFrequency:a=.1,rollFrequency:c=.1},u)=>{const f=J(p=>p.camera),h=J(p=>p.controls),A=l.useRef(n),y=l.useRef(f.rotation.clone()),[x]=l.useState(()=>new Oc),[d]=l.useState(()=>new Oc),[v]=l.useState(()=>new Oc),g=()=>{(A.current<0||A.current>1)&&(A.current=A.current<0?0:1)};return l.useImperativeHandle(u,()=>({getIntensity:()=>A.current,setIntensity:p=>{A.current=p,g()}}),[]),l.useEffect(()=>{if(h){const p=()=>void(y.current=f.rotation.clone());return h.addEventListener("change",p),p(),()=>void h.removeEventListener("change",p)}},[f,h]),Se((p,m)=>{const E=Math.pow(A.current,2),w=i*E*x.noise(p.clock.elapsedTime*o,1),_=r*E*d.noise(p.clock.elapsedTime*a,1),C=s*E*v.noise(p.clock.elapsedTime*c,1);f.rotation.set(y.current.x+_,y.current.y+w,y.current.z+C),e&&A.current>0&&(A.current-=t*m,g())}),null}),Dx=l.forwardRef(({children:n,enabled:e=!0,speed:t=1,rotationIntensity:i=1,floatIntensity:r=1,floatingRange:s=[-.1,.1],autoInvalidate:o=!1,...a},c)=>{const u=l.useRef(null);l.useImperativeHandle(c,()=>u.current,[]);const f=l.useRef(Math.random()*1e4);return Se(h=>{var A,y;if(!e||t===0)return;o&&h.invalidate();const x=f.current+h.clock.getElapsedTime();u.current.rotation.x=Math.cos(x/4*t)/8*i,u.current.rotation.y=Math.sin(x/4*t)/8*i,u.current.rotation.z=Math.sin(x/4*t)/20*i;let d=Math.sin(x/4*t)/10;d=De.mapLinear(d,-.1,.1,(A=s==null?void 0:s[0])!==null&&A!==void 0?A:-.1,(y=s==null?void 0:s[1])!==null&&y!==void 0?y:.1),u.current.position.y=d*r,u.current.updateMatrix()}),l.createElement("group",a,l.createElement("group",{ref:u,matrixAutoUpdate:!1},n))}),ym=(n,e,t)=>{let i;switch(n){case qt:i=new Uint8ClampedArray(e*t*4);break;case xt:i=new Uint16Array(e*t*4);break;case ur:i=new Uint32Array(e*t*4);break;case Kl:i=new Int8Array(e*t*4);break;case uA:i=new Int16Array(e*t*4);break;case Qa:i=new Int32Array(e*t*4);break;case pt:i=new Float32Array(e*t*4);break;default:throw new Error("Unsupported data type")}return i};let wa;const qv=(n,e,t,i)=>{if(wa!==void 0)return wa;const r=new Tt(1,1,i);e.setRenderTarget(r);const s=new be(new fi,new So({color:16777215}));e.render(s,t),e.setRenderTarget(null);const o=ym(n,r.width,r.height);return e.readRenderTargetPixels(r,0,0,r.width,r.height,o),r.dispose(),s.geometry.dispose(),s.material.dispose(),wa=o[0]!==0,wa};class v0{constructor(e){var t,i,r,s,o,a,c,u,f,h,A,y,x,d,v,g;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(m){throw this._renderer.setRenderTarget(null),m}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const p={format:Lt,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((t=e.renderTargetOptions)===null||t===void 0?void 0:t.anisotropy)!==void 0?(i=e.renderTargetOptions)===null||i===void 0?void 0:i.anisotropy:1,generateMipmaps:((r=e.renderTargetOptions)===null||r===void 0?void 0:r.generateMipmaps)!==void 0?(s=e.renderTargetOptions)===null||s===void 0?void 0:s.generateMipmaps:!1,magFilter:((o=e.renderTargetOptions)===null||o===void 0?void 0:o.magFilter)!==void 0?(a=e.renderTargetOptions)===null||a===void 0?void 0:a.magFilter:lt,minFilter:((c=e.renderTargetOptions)===null||c===void 0?void 0:c.minFilter)!==void 0?(u=e.renderTargetOptions)===null||u===void 0?void 0:u.minFilter:lt,samples:((f=e.renderTargetOptions)===null||f===void 0?void 0:f.samples)!==void 0?(h=e.renderTargetOptions)===null||h===void 0?void 0:h.samples:void 0,wrapS:((A=e.renderTargetOptions)===null||A===void 0?void 0:A.wrapS)!==void 0?(y=e.renderTargetOptions)===null||y===void 0?void 0:y.wrapS:Ln,wrapT:((x=e.renderTargetOptions)===null||x===void 0?void 0:x.wrapT)!==void 0?(d=e.renderTargetOptions)===null||d===void 0?void 0:d.wrapT:Ln};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=v0.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Ji,this._camera=new Vt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!qv(this._type,this._renderer,this._camera,p)){let m;switch(this._type){case xt:m=this._renderer.extensions.has("EXT_color_buffer_float")?pt:void 0;break}m!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${pt}`),this._type=m):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new be(new fi,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Tt(this.width,this.height,p),this._renderTarget.texture.mapping=((v=e.renderTargetOptions)===null||v===void 0?void 0:v.mapping)!==void 0?(g=e.renderTargetOptions)===null||g===void 0?void 0:g.mapping:Ga}static instantiateRenderer(){const e=new O2;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=ym(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new Ki(this.toArray(),this.width,this.height,Lt,this._type,(e==null?void 0:e.mapping)||Ga,(e==null?void 0:e.wrapS)||Ln,(e==null?void 0:e.wrapT)||Ln,(e==null?void 0:e.magFilter)||lt,(e==null?void 0:e.minFilter)||lt,(e==null?void 0:e.anisotropy)||1,Zl);return t.generateMipmaps=(e==null?void 0:e.generateMipmaps)!==void 0?e==null?void 0:e.generateMipmaps:!1,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof jt&&Object.values(this.material.uniforms).forEach(t=>{t.value instanceof un&&t.value.dispose()}),Object.values(this.material).forEach(t=>{t instanceof un&&t.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const Yv=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,jv=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Wv extends jt{constructor({gamma:e,offsetHdr:t,offsetSdr:i,gainMapMin:r,gainMapMax:s,maxDisplayBoost:o,hdrCapacityMin:a,hdrCapacityMax:c,sdr:u,gainMap:f}){super({name:"GainMapDecoderMaterial",vertexShader:Yv,fragmentShader:jv,uniforms:{sdr:{value:u},gainMap:{value:f},gamma:{value:new T(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new T().fromArray(t)},offsetSdr:{value:new T().fromArray(i)},gainMapMin:{value:new T().fromArray(r)},gainMapMax:{value:new T().fromArray(s)},weightFactor:{value:(Math.log2(o)-a)/(c-a)}},blending:Mu,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=o,this._hdrCapacityMin=a,this._hdrCapacityMax=c,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class vm extends Error{}class xm extends Error{}const Zs=(n,e,t)=>{var i;let r;const s=(i=n.attributes.getNamedItem(e))===null||i===void 0?void 0:i.nodeValue;if(s)r=s;else{const o=n.getElementsByTagName(e)[0];if(o){const a=o.getElementsByTagName("rdf:li");if(a.length===3)r=Array.from(a).map(c=>c.innerHTML);else throw new Error(`Gainmap metadata contains an array of items for ${e} but its length is not 3`)}else{if(t)return t;throw new Error(`Can't find ${e} in gainmap metadata`)}}return r},Xv=n=>{var e,t;let i;typeof TextDecoder<"u"?i=new TextDecoder().decode(n):i=n.toString();let r=i.indexOf("<x:xmpmeta");const s=new DOMParser;for(;r!==-1;){const o=i.indexOf("x:xmpmeta>",r);i.slice(r,o+10);const a=i.slice(r,o+10);try{const u=s.parseFromString(a,"text/xml").getElementsByTagName("rdf:Description")[0],f=Zs(u,"hdrgm:GainMapMin","0"),h=Zs(u,"hdrgm:GainMapMax"),A=Zs(u,"hdrgm:Gamma","1"),y=Zs(u,"hdrgm:OffsetSDR","0.015625"),x=Zs(u,"hdrgm:OffsetHDR","0.015625");let d=(e=u.attributes.getNamedItem("hdrgm:HDRCapacityMin"))===null||e===void 0?void 0:e.nodeValue;d||(d="0");const v=(t=u.attributes.getNamedItem("hdrgm:HDRCapacityMax"))===null||t===void 0?void 0:t.nodeValue;if(!v)throw new Error("Incomplete gainmap metadata");return{gainMapMin:Array.isArray(f)?f.map(g=>parseFloat(g)):[parseFloat(f),parseFloat(f),parseFloat(f)],gainMapMax:Array.isArray(h)?h.map(g=>parseFloat(g)):[parseFloat(h),parseFloat(h),parseFloat(h)],gamma:Array.isArray(A)?A.map(g=>parseFloat(g)):[parseFloat(A),parseFloat(A),parseFloat(A)],offsetSdr:Array.isArray(y)?y.map(g=>parseFloat(g)):[parseFloat(y),parseFloat(y),parseFloat(y)],offsetHdr:Array.isArray(x)?x.map(g=>parseFloat(g)):[parseFloat(x),parseFloat(x),parseFloat(x)],hdrCapacityMin:parseFloat(d),hdrCapacityMax:parseFloat(v)}}catch{}r=i.indexOf("<x:xmpmeta",o)}};class Kv{constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((t,i)=>{const r=this.options.debug,s=new DataView(e.buffer);if(s.getUint16(0)!==65496){i(new Error("Not a valid jpeg"));return}const o=s.byteLength;let a=2,c=0,u;for(;a<o;){if(++c>250){i(new Error(`Found no marker after ${c} loops 😵`));return}if(s.getUint8(a)!==255){i(new Error(`Not a valid marker at offset 0x${a.toString(16)}, found: 0x${s.getUint8(a).toString(16)}`));return}if(u=s.getUint8(a+1),r&&console.log(`Marker: ${u.toString(16)}`),u===226){r&&console.log("Found APP2 marker (0xffe2)");const f=a+4;if(s.getUint32(f)===1297106432){const h=f+4;let A;if(s.getUint16(h)===18761)A=!1;else if(s.getUint16(h)===19789)A=!0;else{i(new Error("No valid endianness marker found in TIFF header"));return}if(s.getUint16(h+2,!A)!==42){i(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const y=s.getUint32(h+4,!A);if(y<8){i(new Error("Not valid TIFF data! (First offset less than 8)"));return}const x=h+y,d=s.getUint16(x,!A),v=x+2;let g=0;for(let w=v;w<v+12*d;w+=12)s.getUint16(w,!A)===45057&&(g=s.getUint32(w+8,!A));const m=x+2+d*12+4,E=[];for(let w=m;w<m+g*16;w+=16){const _={MPType:s.getUint32(w,!A),size:s.getUint32(w+4,!A),dataOffset:s.getUint32(w+8,!A),dependantImages:s.getUint32(w+12,!A),start:-1,end:-1,isFII:!1};_.dataOffset?(_.start=h+_.dataOffset,_.isFII=!1):(_.start=0,_.isFII=!0),_.end=_.start+_.size,E.push(_)}if(this.options.extractNonFII&&E.length){const w=new Blob([s]),_=[];for(const C of E){if(C.isFII&&!this.options.extractFII)continue;const I=w.slice(C.start,C.end+1,"image/jpeg");_.push(I)}t(_)}}}a+=2+s.getUint16(a+2)}})}}const Zv=async n=>{const e=Xv(n);if(!e)throw new xm("Gain map XMP metadata not found");const i=await new Kv({extractFII:!0,extractNonFII:!0}).extract(n);if(i.length!==2)throw new vm("Gain map recovery image not found");return{sdr:new Uint8Array(await i[0].arrayBuffer()),gainMap:new Uint8Array(await i[1].arrayBuffer()),metadata:e}},$1=n=>new Promise((e,t)=>{const i=document.createElement("img");i.onload=()=>{e(i)},i.onerror=r=>{t(r)},i.src=URL.createObjectURL(n)});class Em extends hs{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new U2}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new Wv({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new un,sdr:new un});return new v0({width:16,height:16,type:xt,colorSpace:Zl,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,i,r){const s=r?new Blob([r],{type:"image/jpeg"}):void 0,o=new Blob([i],{type:"image/jpeg"});let a,c,u=!1;if(typeof createImageBitmap>"u"){const A=await Promise.all([s?$1(s):Promise.resolve(void 0),$1(o)]);c=A[0],a=A[1],u=!0}else{const A=await Promise.all([s?createImageBitmap(s,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(o,{imageOrientation:"flipY"})]);c=A[0],a=A[1]}const f=new un(c||new ImageData(2,2),Ga,Ln,Ln,lt,b0,Lt,qt,1,Zl);f.flipY=u,f.needsUpdate=!0;const h=new un(a,Ga,Ln,Ln,lt,b0,Lt,qt,1,cA);h.flipY=u,h.needsUpdate=!0,e.width=a.width,e.height=a.height,e.material.gainMap=f,e.material.sdr=h,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class $v extends Em{load([e,t,i],r,s,o){const a=this.prepareQuadRenderer();let c,u,f;const h=async()=>{if(c&&u&&f){try{await this.render(a,f,c,u)}catch(b){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(i),typeof o=="function"&&o(b),a.disposeOnDemandRenderer();return}typeof r=="function"&&r(a),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(i),a.disposeOnDemandRenderer()}};let A=!0,y=0,x=0,d=!0,v=0,g=0,p=!0,m=0,E=0;const w=()=>{if(typeof s=="function"){const b=y+v+m,B=x+g+E,Q=A&&d&&p;s(new ProgressEvent("progress",{lengthComputable:Q,loaded:B,total:b}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(i);const _=new gi(this._internalLoadingManager);_.setResponseType("arraybuffer"),_.setRequestHeader(this.requestHeader),_.setPath(this.path),_.setWithCredentials(this.withCredentials),_.load(e,async b=>{if(typeof b=="string")throw new Error("Invalid sdr buffer");c=b,await h()},b=>{A=b.lengthComputable,x=b.loaded,y=b.total,w()},b=>{this.manager.itemError(e),typeof o=="function"&&o(b)});const C=new gi(this._internalLoadingManager);C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setPath(this.path),C.setWithCredentials(this.withCredentials),C.load(t,async b=>{if(typeof b=="string")throw new Error("Invalid gainmap buffer");u=b,await h()},b=>{d=b.lengthComputable,g=b.loaded,v=b.total,w()},b=>{this.manager.itemError(t),typeof o=="function"&&o(b)});const I=new gi(this._internalLoadingManager);return I.setRequestHeader(this.requestHeader),I.setPath(this.path),I.setWithCredentials(this.withCredentials),I.load(i,async b=>{if(typeof b!="string")throw new Error("Invalid metadata string");f=JSON.parse(b),await h()},b=>{p=b.lengthComputable,E=b.loaded,m=b.total,w()},b=>{this.manager.itemError(i),typeof o=="function"&&o(b)}),a}}class Jv extends Em{load(e,t,i,r){const s=this.prepareQuadRenderer(),o=new gi(this._internalLoadingManager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(this.withCredentials),this.manager.itemStart(e),o.load(e,async a=>{if(typeof a=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const c=new Uint8Array(a);let u,f,h;try{const A=await Zv(c);u=A.sdr,f=A.gainMap,h=A.metadata}catch(A){if(A instanceof xm||A instanceof vm)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),h={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},u=c;else throw A}try{await this.render(s,h,u,f)}catch(A){this.manager.itemError(e),typeof r=="function"&&r(A),s.disposeOnDemandRenderer();return}typeof t=="function"&&t(s),this.manager.itemEnd(e),s.disposeOnDemandRenderer()},i,a=>{this.manager.itemError(e),typeof r=="function"&&r(a)}),s}}const Sl={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},e8="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",_a=n=>Array.isArray(n);function wm({files:n=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:e="",preset:t=void 0,encoding:i=void 0,extensions:r}={}){var s;let o=null,a=!1;if(t){if(!(t in Sl))throw new Error("Preset must be one of: "+Object.keys(Sl).join(", "));n=Sl[t],e=e8}const c=_a(n)&&n.length===6,u=_a(n)&&n.length===3&&n.some(v=>v.endsWith("json")),f=_a(n)?n[0]:n;a=_a(n);const h=c?"cube":u?"webp":f.startsWith("data:application/exr")?"exr":f.startsWith("data:application/hdr")?"hdr":f.startsWith("data:image/jpeg")?"jpg":(s=f.split(".").pop())==null||(s=s.split("?"))==null||(s=s.shift())==null?void 0:s.toLowerCase();if(o=h==="cube"?Qu:h==="hdr"?R5:h==="exr"?z5:h==="jpg"||h==="jpeg"?Jv:h==="webp"?$v:null,!o)throw new Error("useEnvironment: Unrecognized file extension: "+n);const A=J(v=>v.gl);l.useLayoutEffect(()=>{if(h!=="webp"&&h!=="jpg"&&h!=="jpeg")return;function v(){Xt.clear(o,a?[n]:n)}A.domElement.addEventListener("webglcontextlost",v,{once:!0})},[n,A.domElement]);const y=Xt(o,a?[n]:n,v=>{(h==="webp"||h==="jpg"||h==="jpeg")&&v.setRenderer(A),v.setPath==null||v.setPath(e),r&&r(v)});let x=a?y[0]:y;if(h==="jpg"||h==="jpeg"||h==="webp"){var d;x=(d=x.renderTarget)==null?void 0:d.texture}return x.mapping=c?Zf:Wf,"colorSpace"in x?x.colorSpace=i??c?"srgb":"srgb-linear":x.encoding=i??c?Iv:Cv,x}const t8=n=>n.current&&n.current.isScene,n8=n=>t8(n)?n.current:n;function x0(n,e,t,i,r={}){var s,o,a,c,u;r={backgroundBlurriness:(s=r.blur)!==null&&s!==void 0?s:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const f=n8(e||t),h=f.background,A=f.environment,y={backgroundBlurriness:f.backgroundBlurriness,backgroundIntensity:f.backgroundIntensity,backgroundRotation:(o=(a=f.backgroundRotation)==null||a.clone==null?void 0:a.clone())!==null&&o!==void 0?o:[0,0,0],environmentIntensity:f.environmentIntensity,environmentRotation:(c=(u=f.environmentRotation)==null||u.clone==null?void 0:u.clone())!==null&&c!==void 0?c:[0,0,0]};return n!=="only"&&(f.environment=i),n&&(f.background=i),Fn(f,r),()=>{n!=="only"&&(f.environment=A),n&&(f.background=h),Fn(f,y)}}function E0({scene:n,background:e=!1,map:t,...i}){const r=J(s=>s.scene);return l.useLayoutEffect(()=>{if(t)return x0(e,n,r,t,i)}),null}function _m({background:n=!1,scene:e,blur:t,backgroundBlurriness:i,backgroundIntensity:r,backgroundRotation:s,environmentIntensity:o,environmentRotation:a,...c}){const u=wm(c),f=J(h=>h.scene);return l.useLayoutEffect(()=>x0(n,e,f,u,{blur:t,backgroundBlurriness:i,backgroundIntensity:r,backgroundRotation:s,environmentIntensity:o,environmentRotation:a})),null}function i8({children:n,near:e=1,far:t=1e3,resolution:i=256,frames:r=1,map:s,background:o=!1,blur:a,backgroundBlurriness:c,backgroundIntensity:u,backgroundRotation:f,environmentIntensity:h,environmentRotation:A,scene:y,files:x,path:d,preset:v=void 0,extensions:g}){const p=J(I=>I.gl),m=J(I=>I.scene),E=l.useRef(null),[w]=l.useState(()=>new Ji),_=l.useMemo(()=>{const I=new oc(i);return I.texture.type=xt,I},[i]);l.useLayoutEffect(()=>(r===1&&E.current.update(p,w),x0(o,y,m,_.texture,{blur:a,backgroundBlurriness:c,backgroundIntensity:u,backgroundRotation:f,environmentIntensity:h,environmentRotation:A})),[n,w,_.texture,y,m,o,r,p]);let C=1;return Se(()=>{(r===1/0||C<r)&&(E.current.update(p,w),C++)}),l.createElement(l.Fragment,null,pr(l.createElement(l.Fragment,null,n,l.createElement("cubeCamera",{ref:E,args:[e,t,_]}),x||v?l.createElement(_m,{background:!0,files:x,preset:v,path:d,extensions:g}):s?l.createElement(E0,{background:!0,map:s,extensions:g}):null),w))}function r8(n){var e,t,i,r;const s=wm(n),o=n.map||s;l.useMemo(()=>Pt({GroundProjectedEnvImpl:Kg}),[]);const a=l.useMemo(()=>[o],[o]),c=(e=n.ground)==null?void 0:e.height,u=(t=n.ground)==null?void 0:t.radius,f=(i=(r=n.ground)==null?void 0:r.scale)!==null&&i!==void 0?i:1e3;return l.createElement(l.Fragment,null,l.createElement(E0,ce({},n,{map:o})),l.createElement("groundProjectedEnvImpl",{args:a,scale:f,height:c,radius:u}))}function s8(n){return n.ground?l.createElement(r8,n):n.map?l.createElement(E0,n):n.children?l.createElement(i8,n):l.createElement(_m,n)}const o8=l.forwardRef(({scale:n=10,frames:e=1/0,opacity:t=1,width:i=1,height:r=1,blur:s=1,near:o=0,far:a=10,resolution:c=512,smooth:u=!0,color:f="#000000",depthWrite:h=!1,renderOrder:A,...y},x)=>{const d=l.useRef(null),v=J(L=>L.scene),g=J(L=>L.gl),p=l.useRef(null);i=i*(Array.isArray(n)?n[0]:n||1),r=r*(Array.isArray(n)?n[1]:n||1);const[m,E,w,_,C,I,b]=l.useMemo(()=>{const L=new Tt(c,c),O=new Tt(c,c);O.texture.generateMipmaps=L.texture.generateMipmaps=!1;const G=new fi(i,r).rotateX(Math.PI/2),V=new be(G),N=new N2;N.depthTest=N.depthWrite=!1,N.onBeforeCompile=H=>{H.uniforms={...H.uniforms,ucolor:{value:new ze(f)}},H.fragmentShader=H.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),H.fragmentShader=H.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const j=new jt(k4),Y=new jt(O4);return Y.depthTest=j.depthTest=!1,[L,G,N,V,j,Y,O]},[c,i,r,n,f]),B=L=>{_.visible=!0,_.material=C,C.uniforms.tDiffuse.value=m.texture,C.uniforms.h.value=L*1/256,g.setRenderTarget(b),g.render(_,p.current),_.material=I,I.uniforms.tDiffuse.value=b.texture,I.uniforms.v.value=L*1/256,g.setRenderTarget(m),g.render(_,p.current),_.visible=!1};let Q=0,S,k;return Se(()=>{p.current&&(e===1/0||Q<e)&&(Q++,S=v.background,k=v.overrideMaterial,d.current.visible=!1,v.background=null,v.overrideMaterial=w,g.setRenderTarget(m),g.render(v,p.current),B(s),u&&B(s*.4),g.setRenderTarget(null),d.current.visible=!0,v.overrideMaterial=k,v.background=S)}),l.useImperativeHandle(x,()=>d.current,[]),l.createElement("group",ce({"rotation-x":Math.PI/2},y,{ref:d}),l.createElement("mesh",{renderOrder:A,geometry:E,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},l.createElement("meshBasicMaterial",{transparent:!0,map:m.texture,opacity:t,depthWrite:h})),l.createElement("orthographicCamera",{ref:p,args:[-i/2,i/2,r/2,-r/2,o,a]}))});function a8(n){return n.isLight}function c8(n){return!!n.geometry}const Cm=l.createContext(null),l8=ti({color:new ze,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${Cn>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),u8=l.forwardRef(({children:n,temporal:e,frames:t=40,limit:i=1/0,blend:r=20,scale:s=10,opacity:o=1,alphaTest:a=.75,color:c="black",colorBlend:u=2,resolution:f=1024,toneMapped:h=!0,...A},y)=>{Pt({SoftShadowMaterial:l8});const x=J(_=>_.gl),d=J(_=>_.scene),v=J(_=>_.camera),g=J(_=>_.invalidate),p=l.useRef(null),m=l.useRef(null),[E]=l.useState(()=>new f8(x,d,f));l.useLayoutEffect(()=>{E.configure(p.current)},[]);const w=l.useMemo(()=>({lights:new Map,temporal:!!e,frames:Math.max(2,t),blend:Math.max(2,t===1/0?r:t),count:0,getMesh:()=>p.current,reset:()=>{E.clear();const _=p.current.material;_.opacity=0,_.alphaTest=0,w.count=0},update:(_=1)=>{const C=p.current.material;w.temporal?(C.opacity=Math.min(o,C.opacity+o/w.blend),C.alphaTest=Math.min(a,C.alphaTest+a/w.blend)):(C.opacity=o,C.alphaTest=a),m.current.visible=!0,E.prepare();for(let I=0;I<_;I++)w.lights.forEach(b=>b.update()),E.update(v,w.blend);m.current.visible=!1,E.finish()}}),[E,v,d,e,t,r,o,a]);return l.useLayoutEffect(()=>{w.reset(),!w.temporal&&w.frames!==1/0&&w.update(w.blend)}),l.useImperativeHandle(y,()=>w,[w]),Se(()=>{(w.temporal||w.frames===1/0)&&w.count<w.frames&&w.count<i&&(g(),w.update(),w.count++)}),l.createElement("group",A,l.createElement("group",{traverse:()=>null,ref:m},l.createElement(Cm.Provider,{value:w},n)),l.createElement("mesh",{receiveShadow:!0,ref:p,scale:s,rotation:[-Math.PI/2,0,0]},l.createElement("planeGeometry",null),l.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:h,color:c,blend:u,map:E.progressiveLightMap2.texture})))}),h8=l.forwardRef(({castShadow:n=!0,bias:e=.001,mapSize:t=512,size:i=5,near:r=.5,far:s=500,frames:o=1,position:a=[0,0,0],radius:c=1,amount:u=8,intensity:f=Cn>=155?Math.PI:1,ambient:h=.5,...A},y)=>{const x=l.useRef(null),d=new T(...a).length(),v=l.useContext(Cm),g=l.useCallback(()=>{let m;if(x.current)for(let E=0;E<x.current.children.length;E++)if(m=x.current.children[E],Math.random()>h)m.position.set(a[0]+De.randFloatSpread(c),a[1]+De.randFloatSpread(c),a[2]+De.randFloatSpread(c));else{let w=Math.acos(2*Math.random()-1)-Math.PI/2,_=2*Math.PI*Math.random();m.position.set(Math.cos(w)*Math.cos(_)*d,Math.abs(Math.cos(w)*Math.sin(_)*d),Math.sin(w)*d)}},[c,h,d,...a]),p=l.useMemo(()=>({update:g}),[g]);return l.useImperativeHandle(y,()=>p,[p]),l.useLayoutEffect(()=>{var m;const E=x.current;return v&&((m=v.lights)==null||m.set(E.uuid,p)),()=>{var w;return void(v==null||(w=v.lights)==null?void 0:w.delete(E.uuid))}},[v,p]),l.createElement("group",ce({ref:x},A),Array.from({length:u},(m,E)=>l.createElement("directionalLight",{key:E,castShadow:n,"shadow-bias":e,"shadow-mapSize":[t,t],intensity:f/u},l.createElement("orthographicCamera",{attach:"shadow-camera",args:[-i,i,i,-i,r,s]}))))});class f8{constructor(e,t,i=1024){this.renderer=e,this.res=i,this.scene=t,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new ze,this.clearAlpha=0;const r={type:xt,magFilter:dt,minFilter:dt};this.progressiveLightMap1=new Tt(this.res,this.res,r),this.progressiveLightMap2=new Tt(this.res,this.res,r),this.discardMat=new y0,this.targetMat=new Tu({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=s=>{s.vertexShader=`varying vec2 vUv;
`+s.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const o=s.fragmentShader.indexOf("void main() {");s.fragmentShader=`varying vec2 vUv;
`+s.fragmentShader.slice(0,o)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+s.fragmentShader.slice(o-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,s.uniforms.previousShadowMap=this.previousShadowMap,s.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{c8(e)?this.meshes.push({object:e,material:e.material}):a8(e)&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,t=100){if(!this.object)return;this.averagingWindow.value=t,this.object.material=this.targetMat;const i=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,r=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,s=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(i),this.previousShadowMap.value=r.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=s}}const A8={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function d8({radius:n,adjustCamera:e}){const t=Vv();return l.useEffect(()=>{e&&t.refresh().clip().fit()},[n,e]),null}function Qx({children:n,center:e,adjustCamera:t=!0,intensity:i=.5,shadows:r="contact",environment:s="city",preset:o="rembrandt",...a}){var c,u,f,h,A,y,x,d;const v=typeof o=="string"?A8[o]:o,[{radius:g,height:p},m]=l.useState({radius:0,width:0,height:0,depth:0}),E=(c=r==null?void 0:r.bias)!==null&&c!==void 0?c:-1e-4,w=(u=r==null?void 0:r.normalBias)!==null&&u!==void 0?u:0,_=(f=r==null?void 0:r.size)!==null&&f!==void 0?f:1024,C=(h=r==null?void 0:r.offset)!==null&&h!==void 0?h:0,I=r==="contact"||(r==null?void 0:r.type)==="contact",b=r==="accumulative"||(r==null?void 0:r.type)==="accumulative",B={...typeof r=="object"?r:{}},Q=s?typeof s=="string"?{preset:s}:s:null,S=l.useCallback(k=>{const{width:L,height:O,depth:G,boundingSphere:V}=k;m({radius:V.radius,width:L,height:O,depth:G}),e!=null&&e.onCentered&&e.onCentered(k)},[]);return l.createElement(l.Fragment,null,l.createElement("ambientLight",{intensity:i/3}),l.createElement("spotLight",{penumbra:1,position:[v.main[0]*g,v.main[1]*g,v.main[2]*g],intensity:i*2,castShadow:!!r,"shadow-bias":E,"shadow-normalBias":w,"shadow-mapSize":_}),l.createElement("pointLight",{position:[v.fill[0]*g,v.fill[1]*g,v.fill[2]*g],intensity:i}),l.createElement(Hv,ce({fit:!!t,clip:!!t,margin:Number(t),observe:!0},a),l.createElement(d8,{radius:g,adjustCamera:t}),l.createElement(um,ce({},e,{position:[0,C/2,0],onCentered:S}),n)),l.createElement("group",{position:[0,-p/2-C/2,0]},I&&l.createElement(o8,ce({scale:g*4,far:g,blur:2},B)),b&&l.createElement(u8,ce({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:g*4},B),l.createElement(h8,{amount:(A=B.amount)!==null&&A!==void 0?A:8,radius:(y=B.radius)!==null&&y!==void 0?y:g,ambient:(x=B.ambient)!==null&&x!==void 0?x:.5,intensity:(d=B.intensity)!==null&&d!==void 0?d:1,position:[v.main[0]*g,v.main[1]*g,v.main[2]*g],size:g*4,bias:-E,mapSize:_}))),s&&l.createElement(s8,Q))}const m8=n=>n===0?0:Math.pow(2,10*n-10);function Rx({children:n,floor:e=.25,segments:t=20,receiveShadow:i,...r}){const s=l.useRef(null);return l.useLayoutEffect(()=>{let o=0;const a=t/t/2,c=s.current.attributes.position;for(let u=0;u<t+1;u++)for(let f=0;f<t+1;f++)c.setXYZ(o++,u/t-a+(u===0?-e:0),f/t-a,m8(u/t));c.needsUpdate=!0,s.current.computeVertexNormals()},[t,e]),l.createElement("group",r,l.createElement("mesh",{receiveShadow:i,rotation:[-Math.PI/2,0,Math.PI/2]},l.createElement("planeGeometry",{ref:s,args:[1,1,t,t]}),n))}const zx=l.forwardRef(({fog:n=!1,renderOrder:e,depthWrite:t=!1,colorStop:i=0,color:r="black",opacity:s=.5,...o},a)=>{const c=l.useMemo(()=>{const u=document.createElement("canvas");u.width=128,u.height=128;const f=u.getContext("2d"),h=f.createRadialGradient(u.width/2,u.height/2,0,u.width/2,u.height/2,u.width/2);return h.addColorStop(i,new ze(r).getStyle()),h.addColorStop(1,"rgba(0,0,0,0)"),f.fillStyle=h,f.fillRect(0,0,u.width,u.height),u},[r,i]);return l.createElement("mesh",ce({renderOrder:e,ref:a,"rotation-x":-Math.PI/2},o),l.createElement("planeGeometry",null),l.createElement("meshBasicMaterial",{transparent:!0,opacity:s,fog:n,depthWrite:t,side:on},l.createElement("canvasTexture",{attach:"map",args:[c]})))});function J1(n=Na){const e={value:new ue};return Object.assign(new q2({side:n}),{viewMatrix:e,onBeforeCompile:t=>{t.uniforms.viewMatrix=e,t.fragmentShader=`vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
           return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
         }
`+t.fragmentShader.replace("#include <normal_fragment_maps>",`#include <normal_fragment_maps>
           normal = inverseTransformDirection( normal, viewMatrix );
`)}})}const p8=ti({causticsTexture:null,causticsTextureB:null,color:new ze,lightProjMatrix:new ue,lightViewMatrix:new ue},`varying vec3 vWorldPosition;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vec4 worldPosition = modelMatrix * vec4(position, 1.);
     vWorldPosition = worldPosition.xyz;
   }`,`varying vec3 vWorldPosition;
  uniform vec3 color;
  uniform sampler2D causticsTexture;
  uniform sampler2D causticsTextureB;
  uniform mat4 lightProjMatrix;
  uniform mat4 lightViewMatrix;
   void main() {
    // Apply caustics
    vec4 lightSpacePos = lightProjMatrix * lightViewMatrix * vec4(vWorldPosition, 1.0);
    lightSpacePos.xyz /= lightSpacePos.w;
    lightSpacePos.xyz = lightSpacePos.xyz * 0.5 + 0.5;
    vec3 front = texture2D(causticsTexture, lightSpacePos.xy).rgb;
    vec3 back = texture2D(causticsTextureB, lightSpacePos.xy).rgb;
    gl_FragColor = vec4((front + back) * color, 1.0);
    #include <tonemapping_fragment>
    #include <${Cn>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),g8=ti({cameraMatrixWorld:new ue,cameraProjectionMatrixInv:new ue,normalTexture:null,depthTexture:null,lightDir:new T(0,1,0),lightPlaneNormal:new T(0,1,0),lightPlaneConstant:0,near:.1,far:100,modelMatrix:new ue,worldRadius:1/40,ior:1.1,bounces:0,resolution:1024,size:10,intensity:.5},`
  varying vec2 vUv;
  void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,`
  uniform mat4 cameraMatrixWorld;
  uniform mat4 cameraProjectionMatrixInv;
  uniform vec3 lightDir;
  uniform vec3 lightPlaneNormal;
  uniform float lightPlaneConstant;
  uniform float near;
  uniform float far;
  uniform float time;
  uniform float worldRadius;
  uniform float resolution;
  uniform float size;
  uniform float intensity;
  uniform float ior;
  precision highp isampler2D;
  precision highp usampler2D;
  uniform sampler2D normalTexture;
  uniform sampler2D depthTexture;
  uniform float bounces;
  varying vec2 vUv;
  vec3 WorldPosFromDepth(float depth, vec2 coord) {
    float z = depth * 2.0 - 1.0;
    vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
    vec4 viewSpacePosition = cameraProjectionMatrixInv * clipSpacePosition;
    // Perspective division
    viewSpacePosition /= viewSpacePosition.w;
    vec4 worldSpacePosition = cameraMatrixWorld * viewSpacePosition;
    return worldSpacePosition.xyz;
  }
  float sdPlane( vec3 p, vec3 n, float h ) {
    // n must be normalized
    return dot(p,n) + h;
  }
  float planeIntersect( vec3 ro, vec3 rd, vec4 p ) {
    return -(dot(ro,p.xyz)+p.w)/dot(rd,p.xyz);
  }
  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 pos, vec3 normal, float ior, out vec3 rayOrigin, out vec3 rayDirection) {
    rayOrigin = ro;
    rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = pos + rayDirection * 0.1;
    return rayDirection;
  }
  void main() {
    // Each sample consists of random offset in the x and y direction
    float caustic = 0.0;
    float causticTexelSize = (1.0 / resolution) * size * 2.0;
    float texelsNeeded = worldRadius / causticTexelSize;
    float sampleRadius = texelsNeeded / resolution;
    float sum = 0.0;
    if (texture2D(depthTexture, vUv).x == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec2 offset1 = vec2(-0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset2 = vec2(-0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset3 = vec2(0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset4 = vec2(0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 uv1 = vUv + offset1 * sampleRadius;
    vec2 uv2 = vUv + offset2 * sampleRadius;
    vec2 uv3 = vUv + offset3 * sampleRadius;
    vec2 uv4 = vUv + offset4 * sampleRadius;
    vec3 normal1 = texture2D(normalTexture, uv1, -10.0).rgb * 2.0 - 1.0;
    vec3 normal2 = texture2D(normalTexture, uv2, -10.0).rgb * 2.0 - 1.0;
    vec3 normal3 = texture2D(normalTexture, uv3, -10.0).rgb * 2.0 - 1.0;
    vec3 normal4 = texture2D(normalTexture, uv4, -10.0).rgb * 2.0 - 1.0;
    float depth1 = texture2D(depthTexture, uv1, -10.0).x;
    float depth2 = texture2D(depthTexture, uv2, -10.0).x;
    float depth3 = texture2D(depthTexture, uv3, -10.0).x;
    float depth4 = texture2D(depthTexture, uv4, -10.0).x;
    // Sanity check the depths
    if (depth1 == 1.0 || depth2 == 1.0 || depth3 == 1.0 || depth4 == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec3 pos1 = WorldPosFromDepth(depth1, uv1);
    vec3 pos2 = WorldPosFromDepth(depth2, uv2);
    vec3 pos3 = WorldPosFromDepth(depth3, uv3);
    vec3 pos4 = WorldPosFromDepth(depth4, uv4);
    vec3 originPos1 = WorldPosFromDepth(0.0, uv1);
    vec3 originPos2 = WorldPosFromDepth(0.0, uv2);
    vec3 originPos3 = WorldPosFromDepth(0.0, uv3);
    vec3 originPos4 = WorldPosFromDepth(0.0, uv4);
    vec3 endPos1, endPos2, endPos3, endPos4;
    vec3 endDir1, endDir2, endDir3, endDir4;
    totalInternalReflection(originPos1, lightDir, pos1, normal1, ior, endPos1, endDir1);
    totalInternalReflection(originPos2, lightDir, pos2, normal2, ior, endPos2, endDir2);
    totalInternalReflection(originPos3, lightDir, pos3, normal3, ior, endPos3, endDir3);
    totalInternalReflection(originPos4, lightDir, pos4, normal4, ior, endPos4, endDir4);
    float lightPosArea = length(cross(originPos2 - originPos1, originPos3 - originPos1)) + length(cross(originPos3 - originPos1, originPos4 - originPos1));
    float t1 = planeIntersect(endPos1, endDir1, vec4(lightPlaneNormal, lightPlaneConstant));
    float t2 = planeIntersect(endPos2, endDir2, vec4(lightPlaneNormal, lightPlaneConstant));
    float t3 = planeIntersect(endPos3, endDir3, vec4(lightPlaneNormal, lightPlaneConstant));
    float t4 = planeIntersect(endPos4, endDir4, vec4(lightPlaneNormal, lightPlaneConstant));
    vec3 finalPos1 = endPos1 + endDir1 * t1;
    vec3 finalPos2 = endPos2 + endDir2 * t2;
    vec3 finalPos3 = endPos3 + endDir3 * t3;
    vec3 finalPos4 = endPos4 + endDir4 * t4;
    float finalArea = length(cross(finalPos2 - finalPos1, finalPos3 - finalPos1)) + length(cross(finalPos3 - finalPos1, finalPos4 - finalPos1));
    caustic += intensity * (lightPosArea / finalArea);
    // Calculate the area of the triangle in light spaces
    gl_FragColor = vec4(vec3(max(caustic, 0.0)), 1.0);
  }`),ef={depth:!0,minFilter:lt,magFilter:lt,type:qt},tf={minFilter:Pu,magFilter:lt,type:pt,generateMipmaps:!0},Fx=l.forwardRef(({debug:n,children:e,frames:t=1,ior:i=1.1,color:r="white",causticsOnly:s=!1,backside:o=!1,backsideIOR:a=1.1,worldRadius:c=.3125,intensity:u=.05,resolution:f=2024,lightSource:h=[5,5,5],...A},y)=>{Pt({CausticsProjectionMaterial:p8});const x=l.useRef(null),d=l.useRef(null),v=l.useRef(null),g=l.useRef(null),p=J(D=>D.gl),m=G2(n&&d,H2),E=mn(f,f,ef),w=mn(f,f,ef),_=mn(f,f,tf),C=mn(f,f,tf),[I]=l.useState(()=>J1()),[b]=l.useState(()=>J1(us)),[B]=l.useState(()=>new g8),[Q]=l.useState(()=>new Gi(B));l.useLayoutEffect(()=>{x.current.updateWorldMatrix(!1,!0)});let S=0;const k=new T,L=new jf,O=new ue,G=new Di,V=new T,N=new T,j=new Et,Y=new T,H=[],X=[],W=[],P=[],z=new T;for(let D=0;D<8;D++)H.push(new T),X.push(new T),W.push(new T),P.push(new T);return Se(()=>{if(t===1/0||S++<t){var D,R;Array.isArray(h)?V.fromArray(h).normalize():V.copy(x.current.worldToLocal(h.current.getWorldPosition(k)).normalize()),N.copy(V).multiplyScalar(-1),(D=v.current.parent)==null||D.matrixWorld.identity(),j.setFromObject(v.current,!0),H[0].set(j.min.x,j.min.y,j.min.z),H[1].set(j.min.x,j.min.y,j.max.z),H[2].set(j.min.x,j.max.y,j.min.z),H[3].set(j.min.x,j.max.y,j.max.z),H[4].set(j.max.x,j.min.y,j.min.z),H[5].set(j.max.x,j.min.y,j.max.z),H[6].set(j.max.x,j.max.y,j.min.z),H[7].set(j.max.x,j.max.y,j.max.z);for(let U=0;U<8;U++)X[U].copy(H[U]);j.getCenter(Y),H.map(U=>U.sub(Y));const $=G.set(N,0);H.map((U,ge)=>$.projectPoint(U,W[ge]));const se=W.reduce((U,ge)=>U.add(ge),k.set(0,0,0)).divideScalar(W.length),Z=W.map(U=>U.distanceTo(se)).reduce((U,ge)=>Math.max(U,ge)),oe=H.map(U=>U.dot(V)).reduce((U,ge)=>Math.max(U,ge));d.current.position.copy(z.copy(V).multiplyScalar(oe).add(Y)),d.current.lookAt(v.current.localToWorld(Y));const Ae=O.lookAt(d.current.position,Y,k.set(0,1,0));d.current.left=-Z,d.current.right=Z,d.current.top=Z,d.current.bottom=-Z;const de=k.set(0,Z,0).applyMatrix4(Ae),le=(d.current.position.y+de.y)/V.y;d.current.near=.1,d.current.far=le,d.current.updateProjectionMatrix(),d.current.updateMatrixWorld();const he=X.map((U,ge)=>U.add(P[ge].copy(V).multiplyScalar(-U.y/V.y))),Ie=he.reduce((U,ge)=>U.add(ge),k.set(0,0,0)).divideScalar(he.length),Be=2*he.map(U=>Math.hypot(U.x-Ie.x,U.z-Ie.z)).reduce((U,ge)=>Math.max(U,ge));g.current.scale.setScalar(Be),g.current.position.copy(Ie),n&&((R=m.current)==null||R.update()),b.viewMatrix.value=I.viewMatrix.value=d.current.matrixWorldInverse;const K=L.setFromProjectionMatrix(O.multiplyMatrices(d.current.projectionMatrix,d.current.matrixWorldInverse)).planes[4];B.cameraMatrixWorld=d.current.matrixWorld,B.cameraProjectionMatrixInv=d.current.projectionMatrixInverse,B.lightDir=N,B.lightPlaneNormal=K.normal,B.lightPlaneConstant=K.constant,B.near=d.current.near,B.far=d.current.far,B.resolution=f,B.size=Z,B.intensity=u,B.worldRadius=c,v.current.visible=!0,p.setRenderTarget(E),p.clear(),v.current.overrideMaterial=I,p.render(v.current,d.current),p.setRenderTarget(w),p.clear(),o&&(v.current.overrideMaterial=b,p.render(v.current,d.current)),v.current.overrideMaterial=null,B.ior=i,g.current.material.lightProjMatrix=d.current.projectionMatrix,g.current.material.lightViewMatrix=d.current.matrixWorldInverse,B.normalTexture=E.texture,B.depthTexture=E.depthTexture,p.setRenderTarget(_),p.clear(),Q.render(p),B.ior=a,B.normalTexture=w.texture,B.depthTexture=w.depthTexture,p.setRenderTarget(C),p.clear(),o&&Q.render(p),p.setRenderTarget(null),s&&(v.current.visible=!1)}}),l.useImperativeHandle(y,()=>x.current,[]),l.createElement("group",ce({ref:x},A),l.createElement("scene",{ref:v},l.createElement("orthographicCamera",{ref:d,up:[0,1,0]}),e),l.createElement("mesh",{renderOrder:2,ref:g,"rotation-x":-Math.PI/2},l.createElement("planeGeometry",null),l.createElement("causticsProjectionMaterial",{transparent:!0,color:r,causticsTexture:_.texture,causticsTextureB:C.texture,blending:iA,blendSrc:rA,blendDst:V2,depthWrite:!1}),n&&l.createElement(ey,null,l.createElement("lineBasicMaterial",{color:"#ffff00",toneMapped:!1}))))}),Lx=l.forwardRef(({mixBlur:n=0,mixStrength:e=.5,resolution:t=256,blur:i=[0,0],args:r=[1,1],minDepthThreshold:s=.9,maxDepthThreshold:o=1,depthScale:a=0,depthToBlurRatioBias:c=.25,mirror:u=0,children:f,debug:h=0,distortion:A=1,mixContrast:y=1,distortionMap:x,...d},v)=>{Pt({MeshReflectorMaterial:pm}),l.useEffect(()=>{console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")},[]);const g=J(({gl:W})=>W),p=J(({camera:W})=>W),m=J(({scene:W})=>W);i=Array.isArray(i)?i:[i,i];const E=i[0]+i[1]>0,w=l.useRef(null);l.useImperativeHandle(v,()=>w.current,[]);const[_]=l.useState(()=>new Di),[C]=l.useState(()=>new T),[I]=l.useState(()=>new T),[b]=l.useState(()=>new T),[B]=l.useState(()=>new ue),[Q]=l.useState(()=>new T(0,0,-1)),[S]=l.useState(()=>new Qt),[k]=l.useState(()=>new T),[L]=l.useState(()=>new T),[O]=l.useState(()=>new Qt),[G]=l.useState(()=>new ue),[V]=l.useState(()=>new It),N=l.useCallback(()=>{if(I.setFromMatrixPosition(w.current.matrixWorld),b.setFromMatrixPosition(p.matrixWorld),B.extractRotation(w.current.matrixWorld),C.set(0,0,1),C.applyMatrix4(B),k.subVectors(I,b),k.dot(C)>0)return;k.reflect(C).negate(),k.add(I),B.extractRotation(p.matrixWorld),Q.set(0,0,-1),Q.applyMatrix4(B),Q.add(b),L.subVectors(I,Q),L.reflect(C).negate(),L.add(I),V.position.copy(k),V.up.set(0,1,0),V.up.applyMatrix4(B),V.up.reflect(C),V.lookAt(L),V.far=p.far,V.updateMatrixWorld(),V.projectionMatrix.copy(p.projectionMatrix),G.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),G.multiply(V.projectionMatrix),G.multiply(V.matrixWorldInverse),G.multiply(w.current.matrixWorld),_.setFromNormalAndCoplanarPoint(C,I),_.applyMatrix4(V.matrixWorldInverse),S.set(_.normal.x,_.normal.y,_.normal.z,_.constant);const W=V.projectionMatrix;O.x=(Math.sign(S.x)+W.elements[8])/W.elements[0],O.y=(Math.sign(S.y)+W.elements[9])/W.elements[5],O.z=-1,O.w=(1+W.elements[10])/W.elements[14],S.multiplyScalar(2/S.dot(O)),W.elements[2]=S.x,W.elements[6]=S.y,W.elements[10]=S.z+1,W.elements[14]=S.w},[]),[j,Y,H,X]=l.useMemo(()=>{const W={type:xt,minFilter:lt,magFilter:lt},P=new Tt(t,t,W);P.depthBuffer=!0,P.depthTexture=new sc(t,t),P.depthTexture.format=zu,P.depthTexture.type=ac;const z=new Tt(t,t,W),D=new mm({gl:g,resolution:t,width:i[0],height:i[1],minDepthThreshold:s,maxDepthThreshold:o,depthScale:a,depthToBlurRatioBias:c}),R={mirror:u,textureMatrix:G,mixBlur:n,tDiffuse:P.texture,tDepth:P.depthTexture,tDiffuseBlur:z.texture,hasBlur:E,mixStrength:e,minDepthThreshold:s,maxDepthThreshold:o,depthScale:a,depthToBlurRatioBias:c,transparent:!0,debug:h,distortion:A,distortionMap:x,mixContrast:y,"defines-USE_BLUR":E?"":void 0,"defines-USE_DEPTH":a>0?"":void 0,"defines-USE_DISTORTION":x?"":void 0};return[P,z,D,R]},[g,i,G,t,u,E,n,e,s,o,a,c,h,A,x,y]);return Se(()=>{if(!(w!=null&&w.current))return;w.current.visible=!1;const W=g.xr.enabled,P=g.shadowMap.autoUpdate;N(),g.xr.enabled=!1,g.shadowMap.autoUpdate=!1,g.setRenderTarget(j),g.state.buffers.depth.setMask(!0),g.autoClear||g.clear(),g.render(m,V),E&&H.render(g,j,Y),g.xr.enabled=W,g.shadowMap.autoUpdate=P,w.current.visible=!0,g.setRenderTarget(null)}),l.createElement("mesh",ce({ref:w},d),l.createElement("planeGeometry",{args:r}),f?f("meshReflectorMaterial",X):l.createElement("meshReflectorMaterial",X))}),kx=l.forwardRef(({args:n,map:e,toneMapped:t=!1,color:i="white",form:r="rect",intensity:s=1,scale:o=1,target:a,children:c,...u},f)=>{const h=l.useRef(null);return l.useImperativeHandle(f,()=>h.current,[]),l.useLayoutEffect(()=>{!c&&!u.material&&(Fn(h.current.material,{color:i}),h.current.material.color.multiplyScalar(s))},[i,s,c,u.material]),l.useLayoutEffect(()=>{a&&h.current.lookAt(Array.isArray(a)?new T(...a):a)},[a]),o=Array.isArray(o)&&o.length===2?[o[0],o[1],1]:o,l.createElement("mesh",ce({ref:h,scale:o},u),r==="circle"?l.createElement("ringGeometry",{args:[0,1,64]}):r==="ring"?l.createElement("ringGeometry",{args:[.5,1,64]}):r==="rect"?l.createElement("planeGeometry",null):l.createElement(r,{args:n}),c||(u.material?null:l.createElement("meshBasicMaterial",{toneMapped:t,map:e,side:on})))});function y8(n,e,t=new T){const i=Math.PI*(n-.5),r=2*Math.PI*(e-.5);return t.x=Math.cos(r),t.y=Math.sin(i),t.z=Math.sin(r),t}const Ox=l.forwardRef(({inclination:n=.6,azimuth:e=.1,distance:t=1e3,mieCoefficient:i=.005,mieDirectionalG:r=.8,rayleigh:s=.5,turbidity:o=10,sunPosition:a=y8(n,e),...c},u)=>{const f=l.useMemo(()=>new T().setScalar(t),[t]),[h]=l.useState(()=>new t0);return l.createElement("primitive",ce({object:h,ref:u,"material-uniforms-mieCoefficient-value":i,"material-uniforms-mieDirectionalG-value":r,"material-uniforms-rayleigh-value":s,"material-uniforms-sunPosition-value":a,"material-uniforms-turbidity-value":o,scale:f},c))});class v8 extends jt{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:`
      uniform float time;
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
        gl_Position = projectionMatrix * mvPosition;
      }`,fragmentShader:`
      uniform sampler2D pointTexture;
      uniform float fade;
      varying vec3 vColor;
      void main() {
        float opacity = 1.0;
        if (fade == 1.0) {
          float d = distance(gl_PointCoord, vec2(0.5, 0.5));
          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
        }
        gl_FragColor = vec4(vColor, opacity);

        #include <tonemapping_fragment>
	      #include <${Cn>=154?"colorspace_fragment":"encodings_fragment"}>
      }`})}}const x8=n=>new T().setFromSpherical(new tc(n,Math.acos(1-Math.random()*2),Math.random()*2*Math.PI)),Ux=l.forwardRef(({radius:n=100,depth:e=50,count:t=5e3,saturation:i=0,factor:r=4,fade:s=!1,speed:o=1},a)=>{const c=l.useRef(),[u,f,h]=l.useMemo(()=>{const y=[],x=[],d=Array.from({length:t},()=>(.5+.5*Math.random())*r),v=new ze;let g=n+e;const p=e/t;for(let m=0;m<t;m++)g-=p*Math.random(),y.push(...x8(g).toArray()),v.setHSL(m/t,i,.9),x.push(v.r,v.g,v.b);return[new Float32Array(y),new Float32Array(x),new Float32Array(d)]},[t,e,r,n,i]);Se(y=>c.current&&(c.current.uniforms.time.value=y.clock.getElapsedTime()*o));const[A]=l.useState(()=>new v8);return l.createElement("points",{ref:a},l.createElement("bufferGeometry",null,l.createElement("bufferAttribute",{attach:"attributes-position",args:[u,3]}),l.createElement("bufferAttribute",{attach:"attributes-color",args:[f,3]}),l.createElement("bufferAttribute",{attach:"attributes-size",args:[h,1]})),l.createElement("primitive",{ref:c,object:A,attach:"material",blending:Y2,"uniforms-fade-value":s,depthWrite:!1,transparent:!0,vertexColors:!0}))});let Ca;const E8=new Uint8Array(16);function w8(){if(!Ca&&(Ca=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ca))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ca(E8)}const Jt=[];for(let n=0;n<256;++n)Jt.push((n+256).toString(16).slice(1));function _8(n,e=0){return Jt[n[e+0]]+Jt[n[e+1]]+Jt[n[e+2]]+Jt[n[e+3]]+"-"+Jt[n[e+4]]+Jt[n[e+5]]+"-"+Jt[n[e+6]]+Jt[n[e+7]]+"-"+Jt[n[e+8]]+Jt[n[e+9]]+"-"+Jt[n[e+10]]+Jt[n[e+11]]+Jt[n[e+12]]+Jt[n[e+13]]+Jt[n[e+14]]+Jt[n[e+15]]}const C8=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),nf={randomUUID:C8};function I8(n,e,t){if(nf.randomUUID&&!e&&!n)return nf.randomUUID();n=n||{};const i=n.random||(n.rng||w8)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,_8(i)}const B8="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",rf=new ue,Ia=new T,Ba=new Fe,sf=new T,of=new Fe,$s=new T,w0=l.createContext(null),b8=l.forwardRef(({children:n,material:e=Tu,texture:t=B8,range:i,limit:r=200,frustumCulled:s,...o},a)=>{var c,u;const f=l.useMemo(()=>class extends e{constructor(){super();const I=parseInt(bo.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=b=>{b.vertexShader=`attribute float opacity;
               varying float vOpacity;
              `+b.vertexShader.replace("#include <fog_vertex>",`#include <fog_vertex>
                 vOpacity = opacity;
                `),b.fragmentShader=`varying float vOpacity;
              `+b.fragmentShader.replace(`#include <${I}>`,`#include <${I}>
                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);
                `)}}},[e]);Pt({CloudMaterial:f});const h=l.useRef(null),A=l.useRef([]),y=l.useMemo(()=>new Float32Array(Array.from({length:r},()=>1)),[r]),x=l.useMemo(()=>new Float32Array(Array.from({length:r},()=>[1,1,1]).flat()),[r]),d=yr(t);let v=0,g=0,p;const m=new Fe,E=new T(0,0,1),w=new T;Se((I,b)=>{for(v=I.clock.getElapsedTime(),rf.copy(h.current.matrixWorld).invert(),I.camera.matrixWorld.decompose(sf,of,$s),g=0;g<A.current.length;g++)p=A.current[g],p.ref.current.matrixWorld.decompose(Ia,Ba,$s),Ia.add(w.copy(p.position).applyQuaternion(Ba).multiply($s)),Ba.copy(of).multiply(m.setFromAxisAngle(E,p.rotation+=b*p.rotationFactor)),$s.multiplyScalar(p.volume+(1+Math.sin(v*p.density*p.speed))/2*p.growth),p.matrix.compose(Ia,Ba,$s).premultiply(rf),p.dist=Ia.distanceTo(sf);for(A.current.sort((B,Q)=>Q.dist-B.dist),g=0;g<A.current.length;g++)p=A.current[g],y[g]=p.opacity*(p.dist<p.fade-1?p.dist/p.fade:1),h.current.setMatrixAt(g,p.matrix),h.current.setColorAt(g,p.color);h.current.geometry.attributes.opacity.needsUpdate=!0,h.current.instanceMatrix.needsUpdate=!0,h.current.instanceColor&&(h.current.instanceColor.needsUpdate=!0)}),l.useLayoutEffect(()=>{const I=Math.min(r,i!==void 0?i:r,A.current.length);h.current.count=I,xo(h.current.instanceMatrix,{offset:0,count:I*16}),h.current.instanceColor&&xo(h.current.instanceColor,{offset:0,count:I*3}),xo(h.current.geometry.attributes.opacity,{offset:0,count:I})});let _=[(c=d.image.width)!==null&&c!==void 0?c:1,(u=d.image.height)!==null&&u!==void 0?u:1],C=Math.max(_[0],_[1]);return _=[_[0]/C,_[1]/C],l.createElement("group",ce({ref:a},o),l.createElement(w0.Provider,{value:A},n,l.createElement("instancedMesh",{matrixAutoUpdate:!1,ref:h,args:[null,null,r],frustumCulled:s},l.createElement("instancedBufferAttribute",{usage:sn,attach:"instanceColor",args:[x,3]}),l.createElement("planeGeometry",{args:[..._]},l.createElement("instancedBufferAttribute",{usage:sn,attach:"attributes-opacity",args:[y,1]})),l.createElement("cloudMaterial",{key:e.name,map:d,transparent:!0,depthWrite:!1}))))}),af=l.forwardRef(({opacity:n=1,speed:e=0,bounds:t=[5,1,1],segments:i=20,color:r="#ffffff",fade:s=10,volume:o=6,smallestVolume:a=.25,distribute:c=null,growth:u=4,concentrate:f="inside",seed:h=Math.random(),...A},y)=>{function x(){const m=Math.sin(h++)*1e4;return m-Math.floor(m)}const d=l.useContext(w0),v=l.useRef(null),[g]=l.useState(()=>I8()),p=l.useMemo(()=>[...new Array(i)].map((m,E)=>({segments:i,bounds:new T(1,1,1),position:new T,uuid:g,index:E,ref:v,dist:0,matrix:new ue,color:new ze,rotation:E*(Math.PI/i)})),[i,g]);return l.useLayoutEffect(()=>{p.forEach((m,E)=>{var w;Fn(m,{volume:o,color:r,speed:e,growth:u,opacity:n,fade:s,bounds:t,density:Math.max(.5,x()),rotationFactor:Math.max(.2,.5*x())*e});const _=c==null?void 0:c(m,E);(_||i>1)&&m.position.copy(m.bounds).multiply((w=_==null?void 0:_.point)!==null&&w!==void 0?w:{x:x()*2-1,y:x()*2-1,z:x()*2-1});const C=Math.abs(m.position.x),I=Math.abs(m.position.y),b=Math.abs(m.position.z),B=Math.max(C,I,b);m.length=1,C===B&&(m.length-=C/m.bounds.x),I===B&&(m.length-=I/m.bounds.y),b===B&&(m.length-=b/m.bounds.z),m.volume=((_==null?void 0:_.volume)!==void 0?_.volume:Math.max(Math.max(0,a),f==="random"?x():f==="inside"?m.length:1-m.length))*o})},[f,t,s,r,n,u,o,h,i,e]),l.useLayoutEffect(()=>{const m=p;return d.current=[...d.current,...m],()=>{d.current=d.current.filter(E=>E.uuid!==g)}},[p]),l.useImperativeHandle(y,()=>v.current,[]),l.createElement("group",ce({ref:v},A))}),Nx=l.forwardRef((n,e)=>l.useContext(w0)?l.createElement(af,ce({ref:e},n)):l.createElement(b8,null,l.createElement(af,ce({ref:e},n))));function S8(n){switch(n){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}const M8="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json",T8="https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d";function P8(n=0,e=1024,t){const i=mr(()=>fetch(M8).then(f=>f.json()),["matcapList"]),r=i[0],s=l.useMemo(()=>Object.keys(i).length,[]),a=`${l.useMemo(()=>typeof n=="string"?n:typeof n=="number"?i[n]:null,[n])||r}${S8(e)}.png`,c=`${T8}/${e}/${a}`;return[yr(c,t),c,s]}const Gx=({children:n,id:e,format:t,onLoad:i})=>{const r=P8(e,t,i);return l.createElement(l.Fragment,null,n==null?void 0:n(r))},D8="https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb",Q8="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json";function R8(n=0,e={},t){const{repeat:i=[1,1],anisotropy:r=1,offset:s=[0,0]}=e,o=mr(()=>fetch(Q8).then(A=>A.json()),["normalsList"]),a=l.useMemo(()=>Object.keys(o).length,[]),c=o[0],u=o[n]||c,f=`${D8}/normals/${u}`,h=yr(f,t);return l.useLayoutEffect(()=>{h&&(h.wrapS=h.wrapT=os,h.repeat=new _e(i[0],i[1]),h.offset=new _e(s[0],s[1]),h.anisotropy=r)},[h,r,i,s]),[h,f,a]}const Hx=({children:n,id:e,onLoad:t,...i})=>{const r=R8(e,i,t);return l.createElement(l.Fragment,null,n==null?void 0:n(r))},Xi={uniforms:{strokeOpacity:1,fillOpacity:.25,fillMix:0,thickness:.05,colorBackfaces:!1,dashInvert:!0,dash:!1,dashRepeats:4,dashLength:.5,squeeze:!1,squeezeMin:.2,squeezeMax:1,stroke:new ze("#ff0000"),backfaceStroke:new ze("#0000ff"),fill:new ze("#00ff00")},vertex:`
	  attribute vec3 barycentric;
	
		varying vec3 v_edges_Barycentric;
		varying vec3 v_edges_Position;

		void initWireframe() {
			v_edges_Barycentric = barycentric;
			v_edges_Position = position.xyz;
		}
	  `,fragment:`
		#ifndef PI
	  	#define PI 3.1415926535897932384626433832795
		#endif
  
	  varying vec3 v_edges_Barycentric;
	  varying vec3 v_edges_Position;
  
	  uniform float strokeOpacity;
	  uniform float fillOpacity;
	  uniform float fillMix;
	  uniform float thickness;
	  uniform bool colorBackfaces;
  
	  // Dash
	  uniform bool dashInvert;
	  uniform bool dash;
	  uniform bool dashOnly;
	  uniform float dashRepeats;
	  uniform float dashLength;
  
	  // Squeeze
	  uniform bool squeeze;
	  uniform float squeezeMin;
	  uniform float squeezeMax;
  
	  // Colors
	  uniform vec3 stroke;
	  uniform vec3 backfaceStroke;
	  uniform vec3 fill;
  
	  // This is like
	  float wireframe_aastep(float threshold, float dist) {
		  float afwidth = fwidth(dist) * 0.5;
		  return smoothstep(threshold - afwidth, threshold + afwidth, dist);
	  }
  
	  float wireframe_map(float value, float min1, float max1, float min2, float max2) {
		  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
	  }
  
	  float getWireframe() {
			vec3 barycentric = v_edges_Barycentric;
		
			// Distance from center of each triangle to its edges.
			float d = min(min(barycentric.x, barycentric.y), barycentric.z);

			// for dashed rendering, we can use this to get the 0 .. 1 value of the line length
			float positionAlong = max(barycentric.x, barycentric.y);
			if (barycentric.y < barycentric.x && barycentric.y < barycentric.z) {
				positionAlong = 1.0 - positionAlong;
			}

			// the thickness of the stroke
			float computedThickness = wireframe_map(thickness, 0.0, 1.0, 0.0, 0.34);

			// if we want to shrink the thickness toward the center of the line segment
			if (squeeze) {
				computedThickness *= mix(squeezeMin, squeezeMax, (1.0 - sin(positionAlong * PI)));
			}

			// Create dash pattern
			if (dash) {
				// here we offset the stroke position depending on whether it
				// should overlap or not
				float offset = 1.0 / dashRepeats * dashLength / 2.0;
				if (!dashInvert) {
					offset += 1.0 / dashRepeats / 2.0;
				}

				// if we should animate the dash or not
				// if (dashAnimate) {
				// 	offset += time * 0.22;
				// }

				// create the repeating dash pattern
				float pattern = fract((positionAlong + offset) * dashRepeats);
				computedThickness *= 1.0 - wireframe_aastep(dashLength, pattern);
			}

			// compute the anti-aliased stroke edge  
			float edge = 1.0 - wireframe_aastep(computedThickness, d);

			return edge;
	  }
	  `},z8=ti(Xi.uniforms,Xi.vertex+`
  	void main() {
		initWireframe();
		gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	}
  `,Xi.fragment+`
  void main () {
		// Compute color

		float edge = getWireframe();
		vec4 colorStroke = vec4(stroke, edge);

		#ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		#endif
    
		vec4 colorFill = vec4(fill, fillOpacity);
		vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		gl_FragColor = outColor;
	}
  `);function F8(n,e){n.onBeforeCompile=t=>{t.uniforms={...t.uniforms,...e},t.vertexShader=t.vertexShader.replace("void main() {",`
		  ${Xi.vertex}
		  void main() {
			initWireframe();
		`),t.fragmentShader=t.fragmentShader.replace("void main() {",`
		  ${Xi.fragment}
		  void main() {
		`),t.fragmentShader=t.fragmentShader.replace("#include <color_fragment>",`
		  #include <color_fragment>
			  float edge = getWireframe();
		  vec4 colorStroke = vec4(stroke, edge);
		  #ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		  #endif
		  vec4 colorFill = vec4(mix(diffuseColor.rgb, fill, fillMix), mix(diffuseColor.a, fillOpacity, fillMix));
		  vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		  diffuseColor.rgb = outColor.rgb;
		  diffuseColor.a *= outColor.a;
		`)},n.side=on,n.transparent=!0}function L8(n,e){l.useEffect(()=>{var t;return void(n.fillOpacity.value=(t=e.fillOpacity)!==null&&t!==void 0?t:n.fillOpacity.value)},[e.fillOpacity]),l.useEffect(()=>{var t;return void(n.fillMix.value=(t=e.fillMix)!==null&&t!==void 0?t:n.fillMix.value)},[e.fillMix]),l.useEffect(()=>{var t;return void(n.strokeOpacity.value=(t=e.strokeOpacity)!==null&&t!==void 0?t:n.strokeOpacity.value)},[e.strokeOpacity]),l.useEffect(()=>{var t;return void(n.thickness.value=(t=e.thickness)!==null&&t!==void 0?t:n.thickness.value)},[e.thickness]),l.useEffect(()=>void(n.colorBackfaces.value=!!e.colorBackfaces),[e.colorBackfaces]),l.useEffect(()=>void(n.dash.value=!!e.dash),[e.dash]),l.useEffect(()=>void(n.dashInvert.value=!!e.dashInvert),[e.dashInvert]),l.useEffect(()=>{var t;return void(n.dashRepeats.value=(t=e.dashRepeats)!==null&&t!==void 0?t:n.dashRepeats.value)},[e.dashRepeats]),l.useEffect(()=>{var t;return void(n.dashLength.value=(t=e.dashLength)!==null&&t!==void 0?t:n.dashLength.value)},[e.dashLength]),l.useEffect(()=>void(n.squeeze.value=!!e.squeeze),[e.squeeze]),l.useEffect(()=>{var t;return void(n.squeezeMin.value=(t=e.squeezeMin)!==null&&t!==void 0?t:n.squeezeMin.value)},[e.squeezeMin]),l.useEffect(()=>{var t;return void(n.squeezeMax.value=(t=e.squeezeMax)!==null&&t!==void 0?t:n.squeezeMax.value)},[e.squeezeMax]),l.useEffect(()=>void(n.stroke.value=e.stroke?new ze(e.stroke):n.stroke.value),[e.stroke]),l.useEffect(()=>void(n.fill.value=e.fill?new ze(e.fill):n.fill.value),[e.fill]),l.useEffect(()=>void(n.backfaceStroke.value=e.backfaceStroke?new ze(e.backfaceStroke):n.backfaceStroke.value),[e.backfaceStroke])}function k8(n){return!!(n!=null&&n.geometry)}function O8(n){return!!(n!=null&&n.isBufferGeometry)}function U8(n){return!!(n!=null&&n.current)}function cf(n){return(n==null?void 0:n.current)!==void 0}function lf(n){return n.type==="WireframeGeometry"}function N8(){const n={};for(const e in Xi.uniforms)n[e]={value:Xi.uniforms[e]};return n}function G8(n,e){const i=n.getAttribute("position").count,r=[];for(let s=0;s<i;s++){const o=s%2===0,a=e?1:0;o?r.push(0,0,1,0,1,0,1,0,a):r.push(0,1,0,0,0,1,1,0,a)}return new Mt(Float32Array.from(r),3)}function Im(n){const e=U8(n)?n.current:n;if(O8(e))return e;{if(lf(e))throw new Error("Wireframe: WireframeGeometry is not supported.");const t=e.parent;if(k8(t)){if(lf(t.geometry))throw new Error("Wireframe: WireframeGeometry is not supported.");return t.geometry}}}function Bm(n,e){if(n.index){console.warn("Wireframe: Requires non-indexed geometry, converting to non-indexed geometry.");const i=n.toNonIndexed();n.copy(i),n.setIndex(null)}const t=G8(n,e);n.setAttribute("barycentric",t)}function H8({geometry:n,simplify:e=!1,...t}){Pt({MeshWireframeMaterial:z8});const[i,r]=l.useState(null);l.useLayoutEffect(()=>{const o=Im(n);if(!o)throw new Error("Wireframe: geometry prop must be a BufferGeometry or a ref to a BufferGeometry.");Bm(o,e),cf(n)&&r(o)},[e,n]);const s=cf(n)?i:n;return l.createElement(l.Fragment,null,s&&l.createElement("mesh",{geometry:s},l.createElement("meshWireframeMaterial",ce({attach:"material",transparent:!0,side:on,polygonOffset:!0,polygonOffsetFactor:-4},t,{extensions:{derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1}}))))}function V8({simplify:n=!1,...e}){const t=l.useRef(null),i=l.useMemo(()=>N8(),[Xi.uniforms]);return L8(i,e),l.useLayoutEffect(()=>{const r=Im(t);if(!r)throw new Error("Wireframe: Must be a child of a Mesh, Line or Points object or specify a geometry prop.");const s=r.clone();return Bm(r,n),()=>{r.copy(s),s.dispose()}},[n]),l.useLayoutEffect(()=>{const r=t.current.parent,s=r.material.clone();return F8(r.material,i),()=>{r.material.dispose(),r.material=s}},[]),l.createElement("object3D",{ref:t})}function Vx({geometry:n,...e}){return n?l.createElement(H8,ce({geometry:n},e)):l.createElement(V8,e)}function qx({opacity:n,alphaMap:e}){const t=l.useRef(null),i=l.useRef(null),r=l.useRef({value:1}),s=l.useRef({value:null}),o=l.useRef({value:!1});return l.useLayoutEffect(()=>{t.current.onBeforeCompile=i.current.onBeforeCompile=a=>{const c=a.fragmentShader.indexOf("void main");let u="",f,h=c;for(;f!==`
`&&h<c+100;)f=a.fragmentShader.charAt(h),u+=f,h++;u=u.trim(),a.vertexShader=a.vertexShader.replace("void main() {",`
        varying vec2 custom_vUv;

        void main() {
          custom_vUv = uv;
          
        `),a.fragmentShader=a.fragmentShader.replace(u,`
          uniform float uShadowOpacity;
          uniform sampler2D uAlphaMap;
          uniform bool uHasAlphaMap;

          varying vec2 custom_vUv;
  
          float bayerDither2x2( vec2 v ) {
            return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
          }
    
          float bayerDither4x4( vec2 v ) {
            vec2 P1 = mod( v, 2.0 );
            vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
            return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
          }
  
          void main() {
            float alpha = 
              uHasAlphaMap ? 
                uShadowOpacity * texture2D(uAlphaMap, custom_vUv).x
              : uShadowOpacity;

            if( ( bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) ) ) / 16.0 >= alpha ) discard;
            
          `),a.uniforms.uShadowOpacity=r.current,a.uniforms.uAlphaMap=s.current,a.uniforms.uHasAlphaMap=o.current}},[]),Se(()=>{var a;const c=(a=t.current.__r3f)==null?void 0:a.parent;if(c){const u=c.material;u&&(r.current.value=n??u.opacity,e===!1?(s.current.value=null,o.current.value=!1):(s.current.value=e||u.alphaMap,o.current.value=!!s.current.value))}}),l.createElement(l.Fragment,null,l.createElement("meshDepthMaterial",{ref:t,attach:"customDepthMaterial",depthPacking:j2}),l.createElement("meshDistanceMaterial",{ref:i,attach:"customDistanceMaterial"}))}const uf=new ue,Ml=new Mo,hf=new Nn,q8=new T;class Y8 extends Eo{constructor(){super(),this.size=0,this.color=new ze("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,t){var i,r;const s=this.instance.current;if(!s||!s.geometry)return;const o=s.userData.instances.indexOf(this.instanceKey);if(o===-1||o>s.geometry.drawRange.count)return;const a=(i=(r=e.params.Points)==null?void 0:r.threshold)!==null&&i!==void 0?i:1;if(hf.set(this.getWorldPosition(q8),a),e.ray.intersectsSphere(hf)===!1)return;uf.copy(s.matrixWorld).invert(),Ml.copy(e.ray).applyMatrix4(uf);const c=a/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,f=Ml.distanceSqToPoint(this.position);if(f<u){const h=new T;Ml.closestPointToPoint(this.position,h),h.applyMatrix4(this.matrixWorld);const A=e.ray.origin.distanceTo(h);if(A<e.near||A>e.far)return;t.push({distance:A,distanceToRay:Math.sqrt(f),point:h,index:o,face:null,object:this})}}}let cr,Js;const bm=l.createContext(null),ff=new ue,Af=new T,j8=l.forwardRef(({children:n,range:e,limit:t=1e3,...i},r)=>{const s=l.useRef(null);l.useImperativeHandle(r,()=>s.current,[]);const[o,a]=l.useState([]),[[c,u,f]]=l.useState(()=>[new Float32Array(t*3),Float32Array.from({length:t*3},()=>1),Float32Array.from({length:t},()=>1)]);l.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),Se(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),ff.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(t,e!==void 0?e:t,o.length),cr=0;cr<o.length;cr++)Js=o[cr].current,Js.getWorldPosition(Af).applyMatrix4(ff),Af.toArray(c,cr*3),s.current.geometry.attributes.position.needsUpdate=!0,Js.matrixWorldNeedsUpdate=!0,Js.color.toArray(u,cr*3),s.current.geometry.attributes.color.needsUpdate=!0,f.set([Js.size],cr),s.current.geometry.attributes.size.needsUpdate=!0});const h=l.useMemo(()=>({getParent:()=>s,subscribe:A=>(a(y=>[...y,A]),()=>a(y=>y.filter(x=>x.current!==A.current)))}),[]);return l.createElement("points",ce({userData:{instances:o},matrixAutoUpdate:!1,ref:s,raycast:()=>null},i),l.createElement("bufferGeometry",null,l.createElement("bufferAttribute",{attach:"attributes-position",count:c.length/3,array:c,itemSize:3,usage:sn}),l.createElement("bufferAttribute",{attach:"attributes-color",count:u.length/3,array:u,itemSize:3,usage:sn}),l.createElement("bufferAttribute",{attach:"attributes-size",count:f.length,array:f,itemSize:1,usage:sn})),l.createElement(bm.Provider,{value:h},n))}),Yx=l.forwardRef(({children:n,...e},t)=>{l.useMemo(()=>Pt({PositionPoint:Y8}),[]);const i=l.useRef(null);l.useImperativeHandle(t,()=>i.current,[]);const{subscribe:r,getParent:s}=l.useContext(bm);return l.useLayoutEffect(()=>r(i),[]),l.createElement("positionPoint",ce({instance:s(),instanceKey:i,ref:i},e),n)}),W8=l.forwardRef(({children:n,positions:e,colors:t,sizes:i,stride:r=3,...s},o)=>{const a=l.useRef(null);return l.useImperativeHandle(o,()=>a.current,[]),Se(()=>{const c=a.current.geometry.attributes;c.position.needsUpdate=!0,t&&(c.color.needsUpdate=!0),i&&(c.size.needsUpdate=!0)}),l.createElement("points",ce({ref:a},s),l.createElement("bufferGeometry",null,l.createElement("bufferAttribute",{attach:"attributes-position",count:e.length/r,array:e,itemSize:r,usage:sn}),t&&l.createElement("bufferAttribute",{attach:"attributes-color",count:t.length/r,array:t,itemSize:3,usage:sn}),i&&l.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/r,array:i,itemSize:1,usage:sn})),n)}),jx=l.forwardRef((n,e)=>n.positions instanceof Float32Array?l.createElement(W8,ce({},n,{ref:e})):l.createElement(j8,ce({},n,{ref:e}))),Sm=l.createContext(null),Wx=l.forwardRef((n,e)=>{l.useMemo(()=>Pt({SegmentObject:X8}),[]);const{limit:t=1e3,lineWidth:i=1,children:r,...s}=n,[o,a]=l.useState([]),[c]=l.useState(()=>new Fd),[u]=l.useState(()=>new yc),[f]=l.useState(()=>new gc),[h]=l.useState(()=>new _e(512,512)),[A]=l.useState(()=>Array(t*6).fill(0)),[y]=l.useState(()=>Array(t*6).fill(0)),x=l.useMemo(()=>({subscribe:d=>(a(v=>[...v,d]),()=>a(v=>v.filter(g=>g.current!==d.current)))}),[]);return Se(()=>{for(let v=0;v<t;v++){var d;const g=(d=o[v])==null?void 0:d.current;g&&(A[v*6+0]=g.start.x,A[v*6+1]=g.start.y,A[v*6+2]=g.start.z,A[v*6+3]=g.end.x,A[v*6+4]=g.end.y,A[v*6+5]=g.end.z,y[v*6+0]=g.color.r,y[v*6+1]=g.color.g,y[v*6+2]=g.color.b,y[v*6+3]=g.color.r,y[v*6+4]=g.color.g,y[v*6+5]=g.color.b)}f.setColors(y),f.setPositions(A),c.computeLineDistances()}),l.createElement("primitive",{object:c,ref:e},l.createElement("primitive",{object:f,attach:"geometry"}),l.createElement("primitive",ce({object:u,attach:"material",vertexColors:!0,resolution:h,linewidth:i},s)),l.createElement(Sm.Provider,{value:x},r))});class X8{constructor(){this.color=new ze("white"),this.start=new T(0,0,0),this.end=new T(0,0,0)}}const df=n=>n instanceof T?n:new T(...typeof n=="number"?[n,n,n]:n),Xx=l.forwardRef(({color:n,start:e,end:t},i)=>{const r=l.useContext(Sm);if(!r)throw"Segment must used inside Segments component.";const s=l.useRef(null);return l.useImperativeHandle(i,()=>s.current,[]),l.useLayoutEffect(()=>r.subscribe(s),[]),l.createElement("segmentObject",{ref:s,color:n,start:df(e),end:df(t)})}),Kx=l.forwardRef(({children:n,hysteresis:e=0,distances:t,...i},r)=>{const s=l.useRef(null);return l.useImperativeHandle(r,()=>s.current,[]),l.useLayoutEffect(()=>{const{current:o}=s;o.levels.length=0,o.children.forEach((a,c)=>o.levels.push({object:a,hysteresis:e,distance:t[c]}))}),Se(o=>{var a;return(a=s.current)==null?void 0:a.update(o.camera)}),l.createElement("lOD",ce({ref:s},i),n)});function Zx({all:n,scene:e,camera:t}){const i=J(({gl:o})=>o),r=J(({camera:o})=>o),s=J(({scene:o})=>o);return l.useLayoutEffect(()=>{const o=[];n&&(e||s).traverse(u=>{u.visible===!1&&(o.push(u),u.visible=!0)}),i.compile(e||s,t||r);const a=new oc(128);new sA(.01,1e5,a).update(i,e||s),a.dispose(),o.forEach(u=>u.visible=!1)},[]),null}function $x(){const n=J(e=>e.gl);return l.useEffect(()=>(n.shadowMap.autoUpdate=!1,n.shadowMap.needsUpdate=!0,()=>{n.shadowMap.autoUpdate=n.shadowMap.needsUpdate=!0}),[n.shadowMap]),null}const mf=new ue,pf=new Mo,Tl=new Nn,Pl=new T;function Jx(n,e){const t=this.geometry,i=this.material,r=this.matrixWorld;i!==void 0&&(t.boundingSphere===null&&t.computeBoundingSphere(),Tl.copy(t.boundingSphere),Tl.applyMatrix4(r),n.ray.intersectsSphere(Tl)!==!1&&(mf.copy(r).invert(),pf.copy(n.ray).applyMatrix4(mf),!(t.boundingBox!==null&&pf.intersectBox(t.boundingBox,Pl)===null)&&e.push({distance:Pl.distanceTo(n.ray.origin),point:Pl.clone(),object:this})))}function eE({pixelated:n}){const e=J(o=>o.gl),t=J(o=>o.internal.active),i=J(o=>o.performance.current),r=J(o=>o.viewport.initialDpr),s=J(o=>o.setDpr);return l.useEffect(()=>{const o=e.domElement;return()=>{t&&s(r),n&&o&&(o.style.imageRendering="auto")}},[]),l.useEffect(()=>{s(i*r),n&&e.domElement&&(e.domElement.style.imageRendering=i===1?"auto":"pixelated")},[i]),null}function tE(){const n=J(i=>i.get),e=J(i=>i.setEvents),t=J(i=>i.performance.current);return l.useEffect(()=>{const i=n().events.enabled;return()=>e({enabled:i})},[]),l.useEffect(()=>e({enabled:t===1}),[t]),null}const Mm=l.createContext(null);function nE({iterations:n=10,ms:e=250,threshold:t=.75,step:i=.1,factor:r=.5,flipflops:s=1/0,bounds:o=A=>A>100?[60,100]:[40,60],onIncline:a,onDecline:c,onChange:u,onFallback:f,children:h}){const A=Math.pow(10,0),[y,x]=l.useState(()=>({fps:0,index:0,factor:r,flipped:0,refreshrate:0,fallback:!1,frames:[],averages:[],subscriptions:new Map,subscribe:v=>{const g=Symbol();return y.subscriptions.set(g,v.current),()=>void y.subscriptions.delete(g)}}));let d=0;return Se(()=>{const{frames:v,averages:g}=y;if(!y.fallback&&g.length<n){v.push(performance.now());const p=v[v.length-1]-v[0];if(p>=e){if(y.fps=Math.round(v.length/p*1e3*A)/A,y.refreshrate=Math.max(y.refreshrate,y.fps),g[y.index++%n]=y.fps,g.length===n){const[m,E]=o(y.refreshrate),w=g.filter(C=>C>=E),_=g.filter(C=>C<m);w.length>n*t&&(y.factor=Math.min(1,y.factor+i),y.flipped++,a&&a(y),y.subscriptions.forEach(C=>C.onIncline&&C.onIncline(y))),_.length>n*t&&(y.factor=Math.max(0,y.factor-i),y.flipped++,c&&c(y),y.subscriptions.forEach(C=>C.onDecline&&C.onDecline(y))),d!==y.factor&&(d=y.factor,u&&u(y),y.subscriptions.forEach(C=>C.onChange&&C.onChange(y))),y.flipped>s&&!y.fallback&&(y.fallback=!0,f&&f(y),y.subscriptions.forEach(C=>C.onFallback&&C.onFallback(y))),y.averages=[]}y.frames=[]}}}),l.createElement(Mm.Provider,{value:y},h)}function iE({onIncline:n,onDecline:e,onChange:t,onFallback:i}){const r=l.useContext(Mm),s=l.useRef({onIncline:n,onDecline:e,onChange:t,onFallback:i});l.useLayoutEffect(()=>{s.current.onIncline=n,s.current.onDecline=e,s.current.onChange=t,s.current.onFallback=i},[n,e,t,i]),l.useLayoutEffect(()=>r.subscribe(s),[r])}const K8=l.forwardRef(({children:n,compute:e,width:t,height:i,samples:r=8,renderPriority:s=0,eventPriority:o=0,frames:a=1/0,stencilBuffer:c=!1,depthBuffer:u=!0,generateMipmaps:f=!1,...h},A)=>{const{size:y,viewport:x}=J(),d=mn((t||y.width)*x.dpr,(i||y.height)*x.dpr,{samples:r,stencilBuffer:c,depthBuffer:u,generateMipmaps:f}),[v]=l.useState(()=>new Ji),g=l.useCallback((p,m,E)=>{var w,_;let C=(w=d.texture)==null?void 0:w.__r3f.parent;for(;C&&!(C instanceof Ot);)C=C.__r3f.parent;if(!C)return!1;E.raycaster.camera||E.events.compute(p,E,(_=E.previousRoot)==null?void 0:_.getState());const[I]=E.raycaster.intersectObject(C);if(!I)return!1;const b=I.uv;if(!b)return!1;m.raycaster.setFromCamera(m.pointer.set(b.x*2-1,b.y*2-1),m.camera)},[]);return l.useImperativeHandle(A,()=>d.texture,[d]),l.createElement(l.Fragment,null,pr(l.createElement(Z8,{renderPriority:s,frames:a,fbo:d},n,l.createElement("group",{onPointerOver:()=>null})),v,{events:{compute:e||g,priority:o}}),l.createElement("primitive",ce({object:d.texture},h)))});function Z8({frames:n,renderPriority:e,children:t,fbo:i}){let r=0,s,o,a,c;return Se(u=>{(n===1/0||r<n)&&(s=u.gl.autoClear,o=u.gl.xr.enabled,a=u.gl.getRenderTarget(),c=u.gl.xr.isPresenting,u.gl.autoClear=!0,u.gl.xr.enabled=!1,u.gl.xr.isPresenting=!1,u.gl.setRenderTarget(i),u.gl.render(u.scene,u.camera),u.gl.setRenderTarget(a),u.gl.autoClear=s,u.gl.xr.enabled=o,u.gl.xr.isPresenting=c,r++)},e),l.createElement(l.Fragment,null,t)}const $8=l.forwardRef(({children:n,compute:e,renderPriority:t=-1,eventPriority:i=0,frames:r=1/0,stencilBuffer:s=!1,depthBuffer:o=!0,generateMipmaps:a=!1,resolution:c=896,near:u=.1,far:f=1e3,flip:h=!1,position:A,rotation:y,scale:x,quaternion:d,matrix:v,matrixAutoUpdate:g,...p},m)=>{const{size:E,viewport:w}=J(),_=l.useRef(null),C=l.useMemo(()=>{const b=new oc(Math.max((c||E.width)*w.dpr,(c||E.height)*w.dpr),{stencilBuffer:s,depthBuffer:o,generateMipmaps:a});return b.texture.isRenderTargetTexture=!h,b.texture.flipY=!0,b.texture.type=xt,b},[c,h]);l.useEffect(()=>()=>C.dispose(),[C]);const[I]=l.useState(()=>new Ji);return l.useImperativeHandle(m,()=>({scene:I,fbo:C,camera:_.current}),[C]),l.createElement(l.Fragment,null,pr(l.createElement(J8,{renderPriority:t,frames:r,camera:_},n,l.createElement("group",{onPointerOver:()=>null})),I,{events:{compute:e,priority:i}}),l.createElement("primitive",ce({object:C.texture},p)),l.createElement("cubeCamera",{ref:_,args:[u,f,C],position:A,rotation:y,scale:x,quaternion:d,matrix:v,matrixAutoUpdate:g}))});function J8({frames:n,renderPriority:e,children:t,camera:i}){let r=0;return Se(s=>{(n===1/0||r<n)&&(i.current.update(s.gl,s.scene),r++)},e),l.createElement(l.Fragment,null,t)}const rE=l.forwardRef(({id:n=1,colorWrite:e=!1,depthWrite:t=!1,...i},r)=>{const s=l.useRef(null),o=l.useMemo(()=>({colorWrite:e,depthWrite:t,stencilWrite:!0,stencilRef:n,stencilFunc:W2,stencilFail:bc,stencilZFail:bc,stencilZPass:bc}),[n,e,t]);return l.useLayoutEffect(()=>{Object.assign(s.current.material,o)}),l.useImperativeHandle(r,()=>s.current,[]),l.createElement("mesh",ce({ref:s,renderOrder:-n},i))});function sE(n,e=!1){return{stencilWrite:!0,stencilRef:n,stencilFunc:e?X2:K2,stencilFail:Sc,stencilZFail:Sc,stencilZPass:Sc}}function oE({renderPriority:n=1,zoom:e=0,segments:t=64,children:i,resolution:r=896,...s}){const o=l.useRef(null),a=l.useRef(null),{width:c,height:u}=J(v=>v.size),[f]=l.useState(()=>new Vt);l.useLayoutEffect(()=>{f.position.set(0,0,100),f.zoom=100,f.left=c/-2,f.right=c/2,f.top=u/2,f.bottom=u/-2,f.updateProjectionMatrix()},[c,u]);const h=Math.sqrt(c*c+u*u)/100*(.5+e/2),A=new T,y=new Nn(new T,h),x=new Qn,d=l.useCallback((v,g,p)=>{if(g.pointer.set(v.offsetX/g.size.width*2-1,-(v.offsetY/g.size.height)*2+1),g.raycaster.setFromCamera(g.pointer,f),g.raycaster.ray.intersectSphere(y,A))A.normalize();else return;x.getNormalMatrix(a.current.camera.matrixWorld),a.current.camera.getWorldPosition(g.raycaster.ray.origin),g.raycaster.ray.direction.set(0,0,1).reflect(A),g.raycaster.ray.direction.x*=-1,g.raycaster.ray.direction.applyNormalMatrix(x).multiplyScalar(-1)},[]);return Se(v=>{n&&v.gl.render(o.current,f)},n),l.createElement(l.Fragment,null,l.createElement("mesh",ce({ref:o},s,{scale:h}),l.createElement("sphereGeometry",{args:[1,t,t]}),l.createElement("meshBasicMaterial",null,l.createElement($8,{compute:d,attach:"envMap",flip:!0,resolution:r,ref:a},i,l.createElement(e7,{api:a})))))}function e7({api:n}){const e=new T,t=new Fe,i=new T,r=new En(0,Math.PI,0);return Se(s=>{s.camera.matrixWorld.decompose(e,t,i),n.current.camera.position.copy(e),n.current.camera.quaternion.setFromEuler(r).premultiply(t)}),null}const t7=ti({blur:0,map:null,sdf:null,blend:0,size:0,resolution:new _e},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
     vUv = uv;
   }`,`uniform sampler2D sdf;
   uniform sampler2D map;
   uniform float blur;
   uniform float size;
   uniform float time;
   uniform vec2 resolution;
   varying vec2 vUv;
   #include <packing>
   void main() {
     vec2 uv = gl_FragCoord.xy / resolution.xy;
     vec4 t = texture2D(map, uv);
     float k = blur;
     float d = texture2D(sdf, vUv).r/size;
     float alpha = 1.0 - smoothstep(0.0, 1.0, clamp(d/k + 1.0, 0.0, 1.0));
     gl_FragColor = vec4(t.rgb, blur == 0.0 ? t.a : t.a * alpha);
     #include <tonemapping_fragment>
     #include <${Cn>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),aE=l.forwardRef(({children:n,events:e=void 0,blur:t=0,eventPriority:i=0,renderPriority:r=0,worldUnits:s=!1,resolution:o=512,...a},c)=>{Pt({PortalMaterialImpl:t7});const u=l.useRef(null),{scene:f,gl:h,size:A,viewport:y,setEvents:x}=J(),d=mn(o,o),[v,g]=l.useState(0);Se(()=>{const _=u.current.blend>0?Math.max(1,r):0;v!==_&&g(_)}),l.useEffect(()=>{e!==void 0&&x({enabled:!e})},[e]);const[p,m]=l.useState(!0),E=dv(m);l.useLayoutEffect(()=>{var _;E.current=(_=u.current)==null?void 0:_.__r3f.parent},[]),l.useLayoutEffect(()=>{if(E.current&&t&&u.current.sdf===null){const _=new be(E.current.geometry,new So),C=new Et().setFromBufferAttribute(_.geometry.attributes.position),I=new Vt(C.min.x*(1+2/o),C.max.x*(1+2/o),C.max.y*(1+2/o),C.min.y*(1+2/o),.1,1e3);I.position.set(0,0,1),I.lookAt(0,0,0),h.setRenderTarget(d),h.render(_,I);const B=i7(o,o,h)(d.texture),Q=new Float32Array(o*o);h.readRenderTargetPixels(B,0,0,o,o,Q);let S=1/0;for(let k=0;k<Q.length;k++)Q[k]<S&&(S=Q[k]);S=-S,u.current.size=S,u.current.sdf=B.texture,h.setRenderTarget(null)}},[o,t]),l.useImperativeHandle(c,()=>u.current);const w=l.useCallback((_,C,I)=>{var b;if(!E.current)return!1;if(C.pointer.set(_.offsetX/C.size.width*2-1,-(_.offsetY/C.size.height)*2+1),C.raycaster.setFromCamera(C.pointer,C.camera),((b=u.current)==null?void 0:b.blend)===0){const[B]=C.raycaster.intersectObject(E.current);if(!B)return C.raycaster.camera=void 0,!1}},[]);return l.createElement("portalMaterialImpl",ce({ref:u,blur:t,blend:0,resolution:[A.width*y.dpr,A.height*y.dpr],attach:"material"},a),l.createElement(K8,{attach:"map",frames:p?1/0:0,eventPriority:i,renderPriority:r,compute:w},n,l.createElement(n7,{events:e,rootScene:f,priority:v,material:u,worldUnits:s})))});function n7({events:n=void 0,rootScene:e,material:t,priority:i,worldUnits:r}){const s=J(h=>h.scene),o=J(h=>h.setEvents),a=mn(),c=mn();l.useLayoutEffect(()=>{s.matrixAutoUpdate=!1},[]),l.useEffect(()=>{n!==void 0&&o({enabled:n})},[n]);const[u,f]=l.useMemo(()=>{const h={value:0};return[new Gi(new jt({uniforms:{a:{value:a.texture},b:{value:c.texture},blend:h},vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
          }`,fragmentShader:`
          uniform sampler2D a;
          uniform sampler2D b;
          uniform float blend;
          varying vec2 vUv;
          #include <packing>
          void main() {
            vec4 ta = texture2D(a, vUv);
            vec4 tb = texture2D(b, vUv);
            gl_FragColor = mix(tb, ta, blend);
            #include <tonemapping_fragment>
            #include <${Cn>=154?"colorspace_fragment":"encodings_fragment"}>
          }`})),h]},[]);return Se(h=>{var A;let y=t==null||(A=t.current)==null?void 0:A.__r3f.parent;if(y){if(r)s.matrixWorld.identity();else{var x;i&&((x=t.current)==null?void 0:x.blend)===1&&y.updateWorldMatrix(!0,!1),s.matrixWorld.copy(y.matrixWorld)}if(i){var d,v,g;((d=t.current)==null?void 0:d.blend)>0&&((v=t.current)==null?void 0:v.blend)<1?(f.value=t.current.blend,h.gl.setRenderTarget(a),h.gl.render(s,h.camera),h.gl.setRenderTarget(c),h.gl.render(e,h.camera),h.gl.setRenderTarget(null),u.render(h.gl)):((g=t.current)==null?void 0:g.blend)===1&&h.gl.render(s,h.camera)}}},i),l.createElement(l.Fragment,null)}const i7=(n,e,t)=>{let i=new Tt(n,e,{minFilter:Pu,magFilter:lt,type:pt,format:pi,generateMipmaps:!0}),r=new Tt(n,e,{minFilter:dt,magFilter:dt}),s=new Tt(n,e,{minFilter:dt,magFilter:dt}),o=new Tt(n,e,{minFilter:dt,magFilter:dt}),a=new Tt(n,e,{minFilter:dt,magFilter:dt}),c=new Tt(n,e,{minFilter:dt,magFilter:dt,type:pt,format:pi}),u=new Tt(n,e,{minFilter:dt,magFilter:dt,type:pt,format:pi});const f=new Gi(new jt({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (round(texture2D(tex, vUv).x)));
        }`})),h=new Gi(new jt({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (1.0 - round(texture2D(tex, vUv).x)));
        }`})),A=new Gi(new jt({uniforms:{tex:{value:null},offset:{value:0},level:{value:0},maxSteps:{value:0}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform float offset;
        uniform float level;
        uniform float maxSteps;
        #include <packing>
        void main() {
          float closestDist = 9999999.9;
          vec2 closestPos = vec2(0.0);
          for (float x = -1.0; x <= 1.0; x += 1.0) {
            for (float y = -1.0; y <= 1.0; y += 1.0) {
              vec2 voffset = vUv;
              voffset += vec2(x, y) * vec2(${1/n}, ${1/e}) * offset;
              vec2 pos = unpackRGBATo2Half(texture2D(tex, voffset));
              float dist = distance(pos.xy, vUv);
              if(pos.x != 0.0 && pos.y != 0.0 && dist < closestDist) {
                closestDist = dist;
                closestPos = pos;
              }
            }
          }
          gl_FragColor = pack2HalfToRGBA(closestPos);
        }`})),y=new Gi(new jt({uniforms:{tex:{value:null},size:{value:new _e(n,e)}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform vec2 size;
        #include <packing>
        void main() {
          gl_FragColor = vec4(distance(size * unpackRGBATo2Half(texture2D(tex, vUv)), size * vUv), 0.0, 0.0, 0.0);
        }`})),x=new Gi(new jt({uniforms:{inside:{value:u.texture},outside:{value:c.texture},tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D inside;
        uniform sampler2D outside;
        uniform sampler2D tex;
        #include <packing>
        void main() {
          float i = texture2D(inside, vUv).x;
          float o =texture2D(outside, vUv).x;
          if (texture2D(tex, vUv).x == 0.0) {
            gl_FragColor = vec4(o, 0.0, 0.0, 0.0);
          } else {
            gl_FragColor = vec4(-i, 0.0, 0.0, 0.0);
          }
        }`}));return d=>{let v=i;d.minFilter=dt,d.magFilter=dt,f.material.uniforms.tex.value=d,t.setRenderTarget(r),f.render(t);const g=Math.ceil(Math.log(Math.max(n,e))/Math.log(2));let p=r,m=null;for(let E=0;E<g;E++){const w=Math.pow(2,g-E-1);m=p===r?o:r,A.material.uniforms.level.value=E,A.material.uniforms.maxSteps.value=g,A.material.uniforms.offset.value=w,A.material.uniforms.tex.value=p.texture,t.setRenderTarget(m),A.render(t),p=m}t.setRenderTarget(c),y.material.uniforms.tex.value=m.texture,y.render(t),h.material.uniforms.tex.value=d,t.setRenderTarget(s),h.render(t),p=s;for(let E=0;E<g;E++){const w=Math.pow(2,g-E-1);m=p===s?a:s,A.material.uniforms.level.value=E,A.material.uniforms.maxSteps.value=g,A.material.uniforms.offset.value=w,A.material.uniforms.tex.value=p.texture,t.setRenderTarget(m),A.render(t),p=m}return t.setRenderTarget(u),y.material.uniforms.tex.value=m.texture,y.render(t),t.setRenderTarget(v),x.material.uniforms.tex.value=d,x.render(t),t.setRenderTarget(null),v}};var gf,yf;const vf=typeof window<"u"&&((gf=window.document)!=null&&gf.createElement||((yf=window.navigator)==null?void 0:yf.product)==="ReactNative")?Ha.useLayoutEffect:Ha.useEffect;function r7(){const n=Z2(e=>({current:new Array,version:0,set:e}));return{In:({children:e})=>{const t=n(r=>r.set),i=n(r=>r.version);return vf(()=>{t(r=>({version:r.version+1}))},[]),vf(()=>(t(({current:r})=>({current:[...r,e]})),()=>t(({current:r})=>({current:r.filter(s=>s!==e)}))),[e,i]),null},Out:()=>{const e=n(t=>t.current);return Ha.createElement(Ha.Fragment,null,e)}}}const s7=n=>n&&n.isOrthographicCamera,xf=new ze,Tm=r7();function Pm(n){return"top"in n}function Dl(n,e){const{right:t,top:i,left:r,bottom:s,width:o,height:a}=e,c=e.bottom<0||i>n.height||t<0||e.left>n.width;if(Pm(n)){const h=n.top+n.height-s,A=r-n.left;return{position:{width:o,height:a,left:A,top:i,bottom:h,right:t},isOffscreen:c}}const u=n.height-s;return{position:{width:o,height:a,top:i,left:r,bottom:u,right:t},isOffscreen:c}}function Ql(n,{left:e,bottom:t,width:i,height:r}){let s;const o=i/r;return s7(n.camera)?(n.camera.left!==i/-2||n.camera.right!==i/2||n.camera.top!==r/2||n.camera.bottom!==r/-2)&&(Object.assign(n.camera,{left:i/-2,right:i/2,top:r/2,bottom:r/-2}),n.camera.updateProjectionMatrix()):n.camera.aspect!==o&&(n.camera.aspect=o,n.camera.updateProjectionMatrix()),s=n.gl.autoClear,n.gl.autoClear=!1,n.gl.setViewport(e,t,i,r),n.gl.setScissor(e,t,i,r),n.gl.setScissorTest(!0),s}function Rl(n,e){n.gl.setScissorTest(!1),n.gl.autoClear=e}function Ef(n){n.gl.getClearColor(xf),n.gl.setClearColor(xf,n.gl.getClearAlpha()),n.gl.clear(!0,!0)}function o7({visible:n=!0,canvasSize:e,scene:t,index:i,children:r,frames:s,rect:o,track:a}){const c=J(),[u,f]=l.useState(!1);let h=0;return Se(A=>{if(s===1/0||h<=s){var y;a&&(o.current=(y=a.current)==null?void 0:y.getBoundingClientRect()),h++}if(o.current){const{position:x,isOffscreen:d}=Dl(e,o.current);if(u!==d&&f(d),n&&!u&&o.current){const v=Ql(A,x);A.gl.render(r?A.scene:t,A.camera),Rl(A,v)}}},i),l.useLayoutEffect(()=>{const A=o.current;if(A&&(!n||!u)){const{position:y}=Dl(e,A),x=Ql(c,y);Ef(c),Rl(c,x)}},[n,u]),l.useEffect(()=>{if(!a)return;const A=o.current,y=c.get().events.connected;return c.setEvents({connected:a.current}),()=>{if(A){const{position:x}=Dl(e,A),d=Ql(c,x);Ef(c),Rl(c,d)}c.setEvents({connected:y})}},[a]),l.useEffect(()=>{Pm(e)||console.warn(`Detected @react-three/fiber canvas size does not include position information. <View /> may not work as expected. Upgrade to @react-three/fiber ^8.1.0 for support.
 See https://github.com/pmndrs/drei/issues/944`)},[]),l.createElement(l.Fragment,null,r,l.createElement("group",{onPointerOver:()=>null}))}const Dm=l.forwardRef(({track:n,visible:e=!0,index:t=1,id:i,style:r,className:s,frames:o=1/0,children:a,...c},u)=>{var f,h,A,y;const x=l.useRef(null),{size:d,scene:v}=J(),[g]=l.useState(()=>new Ji),[p,m]=l.useReducer(()=>!0,!1),E=l.useCallback((w,_)=>{if(x.current&&n&&n.current&&w.target===n.current){const{width:C,height:I,left:b,top:B}=x.current,Q=w.clientX-b,S=w.clientY-B;_.pointer.set(Q/C*2-1,-(S/I)*2+1),_.raycaster.setFromCamera(_.pointer,_.camera)}},[x,n]);return l.useEffect(()=>{var w;n&&(x.current=(w=n.current)==null?void 0:w.getBoundingClientRect()),m()},[n]),l.createElement("group",ce({ref:u},c),p&&pr(l.createElement(o7,{visible:e,canvasSize:d,frames:o,scene:v,track:n,rect:x,index:t},a),g,{events:{compute:E,priority:t},size:{width:(f=x.current)==null?void 0:f.width,height:(h=x.current)==null?void 0:h.height,top:(A=x.current)==null?void 0:A.top,left:(y=x.current)==null?void 0:y.left}}))}),a7=l.forwardRef(({as:n="div",id:e,visible:t,className:i,style:r,index:s=1,track:o,frames:a=1/0,children:c,...u},f)=>{const h=l.useId(),A=l.useRef(null);return l.useImperativeHandle(f,()=>A.current),l.createElement(l.Fragment,null,l.createElement(n,ce({ref:A,id:e,className:i,style:r},u)),l.createElement(Tm.In,null,l.createElement(Dm,{visible:t,key:h,track:A,frames:a,index:s},c)))}),c7=l.forwardRef((n,e)=>l.useContext(Yl)?l.createElement(Dm,ce({ref:e},n)):l.createElement(a7,ce({ref:e},n)));c7.Port=()=>l.createElement(Tm.Out,null);const zo=l.createContext(null),ba=new T,wf=new T,l7=(n,e,t,i)=>{const r=e.dot(e),s=e.dot(n)-e.dot(t),o=e.dot(i);return o===0?-s/r:(ba.copy(i).multiplyScalar(r/o).sub(e),wf.copy(i).multiplyScalar(s/o).add(t).sub(n),-ba.dot(wf)/ba.dot(ba))},u7=new T(0,1,0),_f=new ue,zl=({direction:n,axis:e})=>{const{translation:t,translationLimits:i,annotations:r,annotationsClass:s,depthTest:o,scale:a,lineWidth:c,fixed:u,axisColors:f,hoveredColor:h,opacity:A,onDragStart:y,onDrag:x,onDragEnd:d,userData:v}=l.useContext(zo),g=J(V=>V.controls),p=l.useRef(null),m=l.useRef(null),E=l.useRef(null),w=l.useRef(0),[_,C]=l.useState(!1),I=l.useCallback(V=>{r&&(p.current.innerText=`${t.current[e].toFixed(2)}`,p.current.style.display="block"),V.stopPropagation();const N=new ue().extractRotation(m.current.matrixWorld),j=V.point.clone(),Y=new T().setFromMatrixPosition(m.current.matrixWorld),H=n.clone().applyMatrix4(N).normalize();E.current={clickPoint:j,dir:H},w.current=t.current[e],y({component:"Arrow",axis:e,origin:Y,directions:[H]}),g&&(g.enabled=!1),V.target.setPointerCapture(V.pointerId)},[r,n,g,y,t,e]),b=l.useCallback(V=>{if(V.stopPropagation(),_||C(!0),E.current){const{clickPoint:N,dir:j}=E.current,[Y,H]=(i==null?void 0:i[e])||[void 0,void 0];let X=l7(N,j,V.ray.origin,V.ray.direction);Y!==void 0&&(X=Math.max(X,Y-w.current)),H!==void 0&&(X=Math.min(X,H-w.current)),t.current[e]=w.current+X,r&&(p.current.innerText=`${t.current[e].toFixed(2)}`),_f.makeTranslation(j.x*X,j.y*X,j.z*X),x(_f)}},[r,x,_,t,i,e]),B=l.useCallback(V=>{r&&(p.current.style.display="none"),V.stopPropagation(),E.current=null,d(),g&&(g.enabled=!0),V.target.releasePointerCapture(V.pointerId)},[r,g,d]),Q=l.useCallback(V=>{V.stopPropagation(),C(!1)},[]),{cylinderLength:S,coneWidth:k,coneLength:L,matrixL:O}=l.useMemo(()=>{const V=u?c/a*1.6:a/20,N=u?.2:a/5,j=u?1-N:a-N,Y=new Fe().setFromUnitVectors(u7,n.clone().normalize()),H=new ue().makeRotationFromQuaternion(Y);return{cylinderLength:j,coneWidth:V,coneLength:N,matrixL:H}},[n,a,c,u]),G=_?h:f[e];return l.createElement("group",{ref:m},l.createElement("group",{matrix:O,matrixAutoUpdate:!1,onPointerDown:I,onPointerMove:b,onPointerUp:B,onPointerOut:Q},r&&l.createElement(cc,{position:[0,-L,0]},l.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:s,ref:p})),l.createElement("mesh",{visible:!1,position:[0,(S+L)/2,0],userData:v},l.createElement("cylinderGeometry",{args:[k*1.4,k*1.4,S+L,8,1]})),l.createElement(Ei,{transparent:!0,raycast:()=>null,depthTest:o,points:[0,0,0,0,S,0],lineWidth:c,side:on,color:G,opacity:A,polygonOffset:!0,renderOrder:1,polygonOffsetFactor:-10,fog:!1}),l.createElement("mesh",{raycast:()=>null,position:[0,S+L/2,0],renderOrder:500},l.createElement("coneGeometry",{args:[k,L,24,1]}),l.createElement("meshBasicMaterial",{transparent:!0,depthTest:o,color:G,opacity:A,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))))},Fl=new T,Ll=new T,kl=n=>n*180/Math.PI,h7=n=>n*Math.PI/180,f7=(n,e,t,i,r)=>{Fl.copy(n).sub(t),Ll.copy(e).sub(t);const s=i.dot(i),o=r.dot(r),a=Fl.dot(i)/s,c=Fl.dot(r)/o,u=Ll.dot(i)/s,f=Ll.dot(r)/o,h=Math.atan2(c,a);return Math.atan2(f,u)-h},A7=(n,e)=>{let t=Math.floor(n/e);return t=t<0?t+1:t,n-t*e},Cf=n=>{let e=A7(n,2*Math.PI);return Math.abs(e)<1e-6?0:(e<0&&(e+=2*Math.PI),e)},Sa=new ue,If=new T,Ma=new Mo,Ol=new T,Ul=({dir1:n,dir2:e,axis:t})=>{const{rotationLimits:i,annotations:r,annotationsClass:s,depthTest:o,scale:a,lineWidth:c,fixed:u,axisColors:f,hoveredColor:h,opacity:A,onDragStart:y,onDrag:x,onDragEnd:d,userData:v}=l.useContext(zo),g=J(G=>G.controls),p=l.useRef(null),m=l.useRef(null),E=l.useRef(0),w=l.useRef(0),_=l.useRef(null),[C,I]=l.useState(!1),b=l.useCallback(G=>{r&&(p.current.innerText=`${kl(w.current).toFixed(0)}º`,p.current.style.display="block"),G.stopPropagation();const V=G.point.clone(),N=new T().setFromMatrixPosition(m.current.matrixWorld),j=new T().setFromMatrixColumn(m.current.matrixWorld,0).normalize(),Y=new T().setFromMatrixColumn(m.current.matrixWorld,1).normalize(),H=new T().setFromMatrixColumn(m.current.matrixWorld,2).normalize(),X=new Di().setFromNormalAndCoplanarPoint(H,N);_.current={clickPoint:V,origin:N,e1:j,e2:Y,normal:H,plane:X},y({component:"Rotator",axis:t,origin:N,directions:[j,Y,H]}),g&&(g.enabled=!1),G.target.setPointerCapture(G.pointerId)},[r,g,y,t]),B=l.useCallback(G=>{if(G.stopPropagation(),C||I(!0),_.current){const{clickPoint:V,origin:N,e1:j,e2:Y,normal:H,plane:X}=_.current,[W,P]=(i==null?void 0:i[t])||[void 0,void 0];Ma.copy(G.ray),Ma.intersectPlane(X,Ol),Ma.direction.negate(),Ma.intersectPlane(X,Ol);let z=f7(V,Ol,N,j,Y),D=kl(z);G.shiftKey&&(D=Math.round(D/10)*10,z=h7(D)),W!==void 0&&P!==void 0&&P-W<2*Math.PI?(z=Cf(z),z=z>Math.PI?z-2*Math.PI:z,z=De.clamp(z,W-E.current,P-E.current),w.current=E.current+z):(w.current=Cf(E.current+z),w.current=w.current>Math.PI?w.current-2*Math.PI:w.current),r&&(D=kl(w.current),p.current.innerText=`${D.toFixed(0)}º`),Sa.makeRotationAxis(H,z),If.copy(N).applyMatrix4(Sa).sub(N).negate(),Sa.setPosition(If),x(Sa)}},[r,x,C,i,t]),Q=l.useCallback(G=>{r&&(p.current.style.display="none"),G.stopPropagation(),E.current=w.current,_.current=null,d(),g&&(g.enabled=!0),G.target.releasePointerCapture(G.pointerId)},[r,g,d]),S=l.useCallback(G=>{G.stopPropagation(),I(!1)},[]),k=l.useMemo(()=>{const G=n.clone().normalize(),V=e.clone().normalize();return new ue().makeBasis(G,V,G.clone().cross(V))},[n,e]),L=u?.65:a*.65,O=l.useMemo(()=>{const V=[];for(let N=0;N<=32;N++){const j=N*(Math.PI/2)/32;V.push(new T(Math.cos(j)*L,Math.sin(j)*L,0))}return V},[L]);return l.createElement("group",{ref:m,onPointerDown:b,onPointerMove:B,onPointerUp:Q,onPointerOut:S,matrix:k,matrixAutoUpdate:!1},r&&l.createElement(cc,{position:[L,L,0]},l.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:s,ref:p})),l.createElement(Ei,{points:O,lineWidth:c*4,visible:!1,userData:v}),l.createElement(Ei,{transparent:!0,raycast:()=>null,depthTest:o,points:O,lineWidth:c,side:on,color:C?h:f[t],opacity:A,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))},d7=(n,e,t)=>{const i=Math.abs(n.x)>=Math.abs(n.y)&&Math.abs(n.x)>=Math.abs(n.z)?0:Math.abs(n.y)>=Math.abs(n.x)&&Math.abs(n.y)>=Math.abs(n.z)?1:2,r=[0,1,2].sort((x,d)=>Math.abs(e.getComponent(d))-Math.abs(e.getComponent(x))),s=i===r[0]?r[1]:r[0],o=n.getComponent(i),a=n.getComponent(s),c=e.getComponent(i),u=e.getComponent(s),f=t.getComponent(i),A=(t.getComponent(s)-f*(a/o))/(u-c*(a/o));return[(f-A*c)/o,A]},Ta=new Mo,Pa=new T,Bf=new ue,Nl=({dir1:n,dir2:e,axis:t})=>{const{translation:i,translationLimits:r,annotations:s,annotationsClass:o,depthTest:a,scale:c,lineWidth:u,fixed:f,axisColors:h,hoveredColor:A,opacity:y,onDragStart:x,onDrag:d,onDragEnd:v,userData:g}=l.useContext(zo),p=J(j=>j.controls),m=l.useRef(null),E=l.useRef(null),w=l.useRef(null),_=l.useRef(0),C=l.useRef(0),[I,b]=l.useState(!1),B=l.useCallback(j=>{s&&(m.current.innerText=`${i.current[(t+1)%3].toFixed(2)}, ${i.current[(t+2)%3].toFixed(2)}`,m.current.style.display="block"),j.stopPropagation();const Y=j.point.clone(),H=new T().setFromMatrixPosition(E.current.matrixWorld),X=new T().setFromMatrixColumn(E.current.matrixWorld,0).normalize(),W=new T().setFromMatrixColumn(E.current.matrixWorld,1).normalize(),P=new T().setFromMatrixColumn(E.current.matrixWorld,2).normalize(),z=new Di().setFromNormalAndCoplanarPoint(P,H);w.current={clickPoint:Y,e1:X,e2:W,plane:z},_.current=i.current[(t+1)%3],C.current=i.current[(t+2)%3],x({component:"Slider",axis:t,origin:H,directions:[X,W,P]}),p&&(p.enabled=!1),j.target.setPointerCapture(j.pointerId)},[s,p,x,t]),Q=l.useCallback(j=>{if(j.stopPropagation(),I||b(!0),w.current){const{clickPoint:Y,e1:H,e2:X,plane:W}=w.current,[P,z]=(r==null?void 0:r[(t+1)%3])||[void 0,void 0],[D,R]=(r==null?void 0:r[(t+2)%3])||[void 0,void 0];Ta.copy(j.ray),Ta.intersectPlane(W,Pa),Ta.direction.negate(),Ta.intersectPlane(W,Pa),Pa.sub(Y);let[$,se]=d7(H,X,Pa);P!==void 0&&($=Math.max($,P-_.current)),z!==void 0&&($=Math.min($,z-_.current)),D!==void 0&&(se=Math.max(se,D-C.current)),R!==void 0&&(se=Math.min(se,R-C.current)),i.current[(t+1)%3]=_.current+$,i.current[(t+2)%3]=C.current+se,s&&(m.current.innerText=`${i.current[(t+1)%3].toFixed(2)}, ${i.current[(t+2)%3].toFixed(2)}`),Bf.makeTranslation($*H.x+se*X.x,$*H.y+se*X.y,$*H.z+se*X.z),d(Bf)}},[s,d,I,i,r,t]),S=l.useCallback(j=>{s&&(m.current.style.display="none"),j.stopPropagation(),w.current=null,v(),p&&(p.enabled=!0),j.target.releasePointerCapture(j.pointerId)},[s,p,v]),k=l.useCallback(j=>{j.stopPropagation(),b(!1)},[]),L=l.useMemo(()=>{const j=n.clone().normalize(),Y=e.clone().normalize();return new ue().makeBasis(j,Y,j.clone().cross(Y))},[n,e]),O=f?1/7:c/7,G=f?.225:c*.225,V=I?A:h[t],N=l.useMemo(()=>[new T(0,0,0),new T(0,G,0),new T(G,G,0),new T(G,0,0),new T(0,0,0)],[G]);return l.createElement("group",{ref:E,matrix:L,matrixAutoUpdate:!1},s&&l.createElement(cc,{position:[0,0,0]},l.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:o,ref:m})),l.createElement("group",{position:[O*1.7,O*1.7,0]},l.createElement("mesh",{visible:!0,onPointerDown:B,onPointerMove:Q,onPointerUp:S,onPointerOut:k,scale:G,userData:g},l.createElement("planeGeometry",null),l.createElement("meshBasicMaterial",{transparent:!0,depthTest:a,color:V,polygonOffset:!0,polygonOffsetFactor:-10,side:on,fog:!1})),l.createElement(Ei,{position:[-G/2,-G/2,0],transparent:!0,depthTest:a,points:N,lineWidth:u,color:V,opacity:y,polygonOffset:!0,polygonOffsetFactor:-10,userData:g,fog:!1})))},lo=new T,bf=new T,m7=(n,e,t,i)=>{const r=e.dot(e),s=e.dot(n)-e.dot(t),o=e.dot(i);return o===0?-s/r:(lo.copy(i).multiplyScalar(r/o).sub(e),bf.copy(i).multiplyScalar(s/o).add(t).sub(n),-lo.dot(bf)/lo.dot(lo))},p7=new T(0,1,0),eo=new T,Sf=new ue,Gl=({direction:n,axis:e})=>{const{scaleLimits:t,annotations:i,annotationsClass:r,depthTest:s,scale:o,lineWidth:a,fixed:c,axisColors:u,hoveredColor:f,opacity:h,onDragStart:A,onDrag:y,onDragEnd:x,userData:d}=l.useContext(zo),v=J(N=>N.size),g=J(N=>N.controls),p=l.useRef(null),m=l.useRef(null),E=l.useRef(null),w=l.useRef(1),_=l.useRef(1),C=l.useRef(null),[I,b]=l.useState(!1),B=c?1.2:1.2*o,Q=l.useCallback(N=>{i&&(p.current.innerText=`${_.current.toFixed(2)}`,p.current.style.display="block"),N.stopPropagation();const j=new ue().extractRotation(m.current.matrixWorld),Y=N.point.clone(),H=new T().setFromMatrixPosition(m.current.matrixWorld),X=n.clone().applyMatrix4(j).normalize(),W=m.current.matrixWorld.clone(),P=W.clone().invert(),z=c?1/o0(m.current.getWorldPosition(lo),o,N.camera,v):1;C.current={clickPoint:Y,dir:X,mPLG:W,mPLGInv:P,offsetMultiplier:z},A({component:"Sphere",axis:e,origin:H,directions:[X]}),g&&(g.enabled=!1),N.target.setPointerCapture(N.pointerId)},[i,g,n,A,e,c,o,v]),S=l.useCallback(N=>{if(N.stopPropagation(),I||b(!0),C.current){const{clickPoint:j,dir:Y,mPLG:H,mPLGInv:X,offsetMultiplier:W}=C.current,[P,z]=(t==null?void 0:t[e])||[1e-5,void 0],R=m7(j,Y,N.ray.origin,N.ray.direction)*W,$=c?R:R/o;let se=Math.pow(2,$*.2);N.shiftKey&&(se=Math.round(se*10)/10),se=Math.max(se,P/w.current),z!==void 0&&(se=Math.min(se,z/w.current)),_.current=w.current*se,E.current.position.set(0,B+R,0),i&&(p.current.innerText=`${_.current.toFixed(2)}`),eo.set(1,1,1),eo.setComponent(e,se),Sf.makeScale(eo.x,eo.y,eo.z).premultiply(H).multiply(X),y(Sf)}},[i,B,y,I,t,e]),k=l.useCallback(N=>{i&&(p.current.style.display="none"),N.stopPropagation(),w.current=_.current,C.current=null,E.current.position.set(0,B,0),x(),g&&(g.enabled=!0),N.target.releasePointerCapture(N.pointerId)},[i,g,x,B]),L=l.useCallback(N=>{N.stopPropagation(),b(!1)},[]),{radius:O,matrixL:G}=l.useMemo(()=>{const N=c?a/o*1.8:o/22.5,j=new Fe().setFromUnitVectors(p7,n.clone().normalize()),Y=new ue().makeRotationFromQuaternion(j);return{radius:N,matrixL:Y}},[n,o,a,c]),V=I?f:u[e];return l.createElement("group",{ref:m},l.createElement("group",{matrix:G,matrixAutoUpdate:!1,onPointerDown:Q,onPointerMove:S,onPointerUp:k,onPointerOut:L},i&&l.createElement(cc,{position:[0,B/2,0]},l.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:r,ref:p})),l.createElement("mesh",{ref:E,position:[0,B,0],renderOrder:500,userData:d},l.createElement("sphereGeometry",{args:[O,12,12]}),l.createElement("meshBasicMaterial",{transparent:!0,depthTest:s,color:V,opacity:h,polygonOffset:!0,polygonOffsetFactor:-10}))))},Mf=new ue,Tf=new ue,Pf=new ue,Da=new ue,Hl=new ue,Hr=new ue,Df=new ue,Qf=new ue,Rf=new ue,Vr=new Et,Vl=new Et,zf=new T,Ff=new T,Lf=new T,kf=new T,to=new T,qr=new T(1,0,0),Yr=new T(0,1,0),jr=new T(0,0,1),cE=l.forwardRef(({enabled:n=!0,matrix:e,onDragStart:t,onDrag:i,onDragEnd:r,autoTransform:s=!0,anchor:o,disableAxes:a=!1,disableSliders:c=!1,disableRotations:u=!1,disableScaling:f=!1,activeAxes:h=[!0,!0,!0],offset:A=[0,0,0],rotation:y=[0,0,0],scale:x=1,lineWidth:d=4,fixed:v=!1,translationLimits:g,rotationLimits:p,scaleLimits:m,depthTest:E=!0,axisColors:w=["#ff2060","#20df80","#2080ff"],hoveredColor:_="#ffff40",annotations:C=!1,annotationsClass:I,opacity:b=1,visible:B=!0,userData:Q,children:S,...k},L)=>{const O=J(z=>z.invalidate),G=l.useRef(null),V=l.useRef(null),N=l.useRef(null),j=l.useRef(null),Y=l.useRef([0,0,0]),H=l.useRef(new T(1,1,1)),X=l.useRef(new T(1,1,1));l.useLayoutEffect(()=>{o&&(j.current.updateWorldMatrix(!0,!0),Da.copy(j.current.matrixWorld).invert(),Vr.makeEmpty(),j.current.traverse(z=>{z.geometry&&(z.geometry.boundingBox||z.geometry.computeBoundingBox(),Hr.copy(z.matrixWorld).premultiply(Da),Vl.copy(z.geometry.boundingBox),Vl.applyMatrix4(Hr),Vr.union(Vl))}),zf.copy(Vr.max).add(Vr.min).multiplyScalar(.5),Ff.copy(Vr.max).sub(Vr.min).multiplyScalar(.5),Lf.copy(Ff).multiply(new T(...o)).add(zf),kf.set(...A).add(Lf),N.current.position.copy(kf),O())});const W=l.useMemo(()=>({onDragStart:z=>{Mf.copy(V.current.matrix),Tf.copy(V.current.matrixWorld),t&&t(z),O()},onDrag:z=>{Pf.copy(G.current.matrixWorld),Da.copy(Pf).invert(),Hl.copy(Tf).premultiply(z),Hr.copy(Hl).premultiply(Da),Df.copy(Mf).invert(),Qf.copy(Hr).multiply(Df),s&&V.current.matrix.copy(Hr),i&&i(Hr,Qf,Hl,z),O()},onDragEnd:()=>{r&&r(),O()},translation:Y,translationLimits:g,rotationLimits:p,axisColors:w,hoveredColor:_,opacity:b,scale:x,lineWidth:d,fixed:v,depthTest:E,userData:Q,annotations:C,annotationsClass:I}),[t,i,r,Y,g,p,m,E,x,d,v,...w,_,b,Q,s,C,I]),P=new T;return Se(z=>{if(v){const D=o0(N.current.getWorldPosition(P),x,z.camera,z.size);H.current.setScalar(D)}e&&e instanceof ue&&(V.current.matrix=e),V.current.updateWorldMatrix(!0,!0),Rf.makeRotationFromEuler(N.current.rotation).setPosition(N.current.position).premultiply(V.current.matrixWorld),X.current.setFromMatrixScale(Rf),to.copy(H.current).divide(X.current),(Math.abs(N.current.scale.x-to.x)>1e-4||Math.abs(N.current.scale.y-to.y)>1e-4||Math.abs(N.current.scale.z-to.z)>1e-4)&&(N.current.scale.copy(to),z.invalidate())}),l.useImperativeHandle(L,()=>V.current,[]),l.createElement(zo.Provider,{value:W},l.createElement("group",{ref:G},l.createElement("group",ce({ref:V,matrix:e,matrixAutoUpdate:!1},k),l.createElement("group",{visible:B,ref:N,position:A,rotation:y},n&&l.createElement(l.Fragment,null,!a&&h[0]&&l.createElement(zl,{axis:0,direction:qr}),!a&&h[1]&&l.createElement(zl,{axis:1,direction:Yr}),!a&&h[2]&&l.createElement(zl,{axis:2,direction:jr}),!c&&h[0]&&h[1]&&l.createElement(Nl,{axis:2,dir1:qr,dir2:Yr}),!c&&h[0]&&h[2]&&l.createElement(Nl,{axis:1,dir1:jr,dir2:qr}),!c&&h[2]&&h[1]&&l.createElement(Nl,{axis:0,dir1:Yr,dir2:jr}),!u&&h[0]&&h[1]&&l.createElement(Ul,{axis:2,dir1:qr,dir2:Yr}),!u&&h[0]&&h[2]&&l.createElement(Ul,{axis:1,dir1:jr,dir2:qr}),!u&&h[2]&&h[1]&&l.createElement(Ul,{axis:0,dir1:Yr,dir2:jr}),!f&&h[0]&&l.createElement(Gl,{axis:0,direction:qr}),!f&&h[1]&&l.createElement(Gl,{axis:1,direction:Yr}),!f&&h[2]&&l.createElement(Gl,{axis:2,direction:jr}))),l.createElement("group",{ref:j},S))))}),g7=new T(0,0,-1),y7=function(){const n=new T,e=new T,t=new T,i=new T,r=new T;return function(s,o,a,c){return n.copy(s),e.copy(o),t.copy(a),i.copy(e).sub(n),r.copy(t).sub(n),c.crossVectors(r,i).normalize()}}();function v7(n,e){return n.clone().add(e).multiplyScalar(.5)}const x7=l.forwardRef(({points:n=ql.SAMPLE_FACELANDMARKER_RESULT.faceLandmarks[0],face:e,facialTransformationMatrix:t,faceBlendshapes:i,offset:r,offsetScalar:s=80,width:o,height:a,depth:c=1,verticalTri:u=[159,386,152],origin:f,eyes:h=!0,eyesAsOrigin:A=!1,debug:y=!1,children:x,...d},v)=>{var g;e&&(n=e.keypoints,console.warn("Facemesh `face` prop is deprecated: use `points` instead"));const p=l.useRef(null),m=l.useRef(null),E=l.useRef(null),w=l.useRef(null),_=l.useRef(null),C=l.useRef(null),I=l.useRef(null),[b]=l.useState(()=>new T),[B]=l.useState(()=>new Ot),[Q]=l.useState(()=>new Fe),[S]=l.useState(()=>new T),{invalidate:k}=J();l.useEffect(()=>{var j;(j=_.current)==null||j.geometry.setIndex(ql.TRIANGULATION)},[]);const[L]=l.useState(()=>new T);l.useEffect(()=>{var j,Y;const H=(j=_.current)==null?void 0:j.geometry;if(!H)return;if(H.setFromPoints(n),H.setDrawRange(0,ql.TRIANGULATION.length),t)if(B.matrix.fromArray(t.data),B.matrix.decompose(B.position,B.quaternion,B.scale),B.rotation.y*=-1,B.rotation.z*=-1,Q.setFromEuler(B.rotation),r){var X;B.position.y*=-1,B.position.z*=-1,(X=p.current)==null||X.position.copy(B.position.divideScalar(s))}else{var W;(W=p.current)==null||W.position.set(0,0,0)}else y7(n[u[0]],n[u[1]],n[u[2]],b),Q.setFromUnitVectors(g7,b);const P=Q.clone().invert();if(H.computeBoundingBox(),y&&k(),H.center(),H.applyQuaternion(P),(Y=w.current)==null||Y.setRotationFromQuaternion(Q),h){if(!i)console.warn("Facemesh `eyes` option only works if `faceBlendshapes` is provided: skipping.");else if(C.current&&I.current&&E.current)if(A){const z=C.current._computeSphere(H),D=I.current._computeSphere(H);f=v7(z.center,D.center).negate(),C.current._update(H,i,z),I.current._update(H,i,D)}else C.current._update(H,i),I.current._update(H,i)}if(E.current){if(f!==void 0)if(typeof f=="number"){const z=H.getAttribute("position");S.set(-z.getX(f),-z.getY(f),-z.getZ(f))}else f.isVector3&&S.copy(f);else S.setScalar(0);E.current.position.copy(S)}if(m.current){let z=1;(o||a||c)&&(H.boundingBox.getSize(L),o&&(z=o/L.x),a&&(z=a/L.y),c&&(z=c/L.z)),m.current.scale.setScalar(z!==1?z:1)}H.computeVertexNormals(),H.attributes.position.needsUpdate=!0},[n,t,i,B,r,s,o,a,c,u,f,h,y,k,b,Q,L,S]);const O=l.useMemo(()=>({outerRef:w,meshRef:_,eyeRightRef:C,eyeLeftRef:I}),[]);l.useImperativeHandle(v,()=>O,[O]);const[G]=l.useState(()=>new T),V=(g=_.current)==null?void 0:g.geometry.boundingBox,N=(V==null?void 0:V.getSize(G).z)||1;return l.createElement("group",d,l.createElement("group",{ref:p},l.createElement("group",{ref:w},l.createElement("group",{ref:m},y?l.createElement(l.Fragment,null,l.createElement("axesHelper",{args:[N]}),l.createElement(Ei,{points:[[0,0,0],[0,0,-N]],color:65535})):null,l.createElement("group",{ref:E},h&&i&&l.createElement("group",{name:"eyes"},l.createElement(Of,{side:"left",ref:C,debug:y}),l.createElement(Of,{side:"right",ref:I,debug:y})),l.createElement("mesh",{ref:_,name:"face"},x,y?l.createElement(l.Fragment,null,V&&l.createElement("box3Helper",{args:[V]})):null))))))}),no={contourLandmarks:{right:[33,133,159,145,153],left:[263,362,386,374,380]},blendshapes:{right:[14,16,18,12],left:[13,15,17,11]},color:{right:"red",left:"#00ff00"},fov:{horizontal:100,vertical:90}},Of=l.forwardRef(({side:n,debug:e=!0},t)=>{const i=l.useRef(null),r=l.useRef(null),[s]=l.useState(()=>new Nn),o=l.useCallback(h=>{const A=h.getAttribute("position"),x=no.contourLandmarks[n].map(d=>new T(A.getX(d),A.getY(d),A.getZ(d)));return s.center.set(0,0,0),x.forEach(d=>s.center.add(d)),s.center.divideScalar(x.length),s.radius=x[0].sub(x[1]).length()/2,s},[s,n]),[a]=l.useState(()=>new En),c=l.useCallback((h,A,y)=>{if(i.current){var x;(x=y)!==null&&x!==void 0||(y=o(h)),i.current.position.copy(y.center),i.current.scale.setScalar(y.radius)}if(A&&r.current){const d=no.blendshapes[n],v=A.categories[d[0]].score,g=A.categories[d[1]].score,p=A.categories[d[2]].score,m=A.categories[d[3]].score,E=no.fov.horizontal*De.DEG2RAD,w=no.fov.vertical*De.DEG2RAD,_=E*.5*(m-p),C=w*.5*(v-g)*(n==="left"?1:-1);a.set(_,C,0),r.current.setRotationFromEuler(a)}},[o,n,a]),u=l.useMemo(()=>({eyeMeshRef:i,irisDirRef:r,_computeSphere:o,_update:c}),[o,c]);l.useImperativeHandle(t,()=>u,[u]);const f=no.color[n];return l.createElement("group",null,l.createElement("group",{ref:i},e&&l.createElement("axesHelper",null),l.createElement("group",{ref:r},l.createElement(l.Fragment,null,e&&l.createElement(Ei,{points:[[0,0,0],[0,0,-2]],lineWidth:1,color:f})))))}),ql={TRIANGULATION:[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255],SAMPLE_FACE:{keypoints:[{x:356.2804412841797,y:295.1960563659668,z:-23.786449432373047,name:"lips"},{x:354.8859405517578,y:264.69520568847656,z:-36.718435287475586},{x:355.2180862426758,y:275.3360366821289,z:-21.183712482452393},{x:347.349853515625,y:242.4400234222412,z:-25.093655586242676},{x:354.40135955810547,y:256.67933464050293,z:-38.23572635650635},{x:353.7689971923828,y:247.54886627197266,z:-34.5475435256958},{x:352.1288299560547,y:227.34312057495117,z:-13.095386028289795},{x:303.5013198852539,y:234.67002868652344,z:12.500141859054565,name:"rightEye"},{x:351.09378814697266,y:211.87547206878662,z:-6.413471698760986},{x:350.7115936279297,y:202.1251630783081,z:-6.413471698760986},{x:348.33667755126953,y:168.7741756439209,z:6.483500003814697,name:"faceOval"},{x:356.4806365966797,y:299.2995357513428,z:-23.144519329071045},{x:356.5511703491211,y:302.66146659851074,z:-21.020312309265137},{x:356.6239547729492,y:304.1536331176758,z:-18.137459754943848,name:"lips"},{x:356.5807342529297,y:305.1840591430664,z:-18.767719268798828,name:"lips"},{x:356.8241500854492,y:308.25711250305176,z:-20.16829490661621},{x:357.113037109375,y:312.26277351379395,z:-22.10575819015503},{x:357.34962463378906,y:317.1123218536377,z:-21.837315559387207,name:"lips"},{x:357.6658630371094,y:325.51036834716797,z:-16.27002477645874},{x:355.0201416015625,y:269.36279296875,z:-33.73054027557373},{x:348.5237503051758,y:270.33411026000977,z:-24.93025302886963},{x:279.97331619262695,y:213.24176788330078,z:47.759642601013184,name:"faceOval"},{x:322.66529083251953,y:238.5027265548706,z:5.535193085670471},{x:316.0983657836914,y:239.94489669799805,z:5.777376294136047},{x:309.9431610107422,y:240.24518966674805,z:7.510589361190796},{x:301.31994247436523,y:237.86138534545898,z:13.118728399276733},{x:328.14266204833984,y:235.80496788024902,z:6.646900177001953},{x:313.7326431274414,y:222.11161136627197,z:3.9887237548828125},{x:320.45196533203125,y:221.87729358673096,z:4.601476192474365},{x:307.35679626464844,y:223.63793849945068,z:5.932023525238037},{x:303.0031204223633,y:226.3743782043457,z:8.479321002960205},{x:296.80023193359375,y:242.94299125671387,z:15.931552648544312},{x:332.2352981567383,y:340.77341079711914,z:-10.165848731994629},{x:301.38587951660156,y:233.46447944641113,z:14.764405488967896,name:"rightEye"},{x:279.0147018432617,y:244.37155723571777,z:45.77549457550049},{x:289.60548400878906,y:239.1807460784912,z:23.191204071044922},{x:320.32257080078125,y:267.1292781829834,z:-4.954537749290466},{x:347.64583587646484,y:294.4955062866211,z:-23.062820434570312,name:"lips"},{x:349.28138732910156,y:303.1095886230469,z:-20.238323211669922},{x:338.9453125,y:298.19186210632324,z:-19.456336498260498,name:"lips"},{x:333.36788177490234,y:302.6706790924072,z:-14.776077270507812,name:"lips"},{x:342.89188385009766,y:304.3561363220215,z:-17.752301692962646},{x:337.7375030517578,y:306.0098361968994,z:-13.410515785217285},{x:325.6159210205078,y:316.22995376586914,z:-6.681914925575256},{x:349.0104675292969,y:264.9818515777588,z:-36.274919509887695},{x:347.7138900756836,y:257.5664806365967,z:-37.67549514770508},{x:291.79357528686523,y:218.88171672821045,z:11.578094959259033,name:"rightEyebrow"},{x:332.2689437866211,y:247.56946563720703,z:-3.3730539679527283},{x:332.0074462890625,y:267.1201229095459,z:-19.969879388809204},{x:331.27952575683594,y:263.6967658996582,z:-17.47218608856201},{x:301.04373931884766,y:269.56552505493164,z:3.61815482378006},{x:347.4863815307617,y:249.0706443786621,z:-32.633421421051025},{x:307.26118087768555,y:208.2646894454956,z:1.1591226607561111,name:"rightEyebrow"},{x:297.91919708251953,y:212.22604751586914,z:5.914516448974609,name:"rightEyebrow"},{x:285.1651382446289,y:197.98450469970703,z:36.391637325286865,name:"faceOval"},{x:337.04097747802734,y:211.25229835510254,z:-4.548954665660858},{x:326.5912628173828,y:223.16698551177979,z:6.670243740081787},{x:320.05664825439453,y:309.5834255218506,z:-4.055835008621216},{x:289.6866226196289,y:314.617395401001,z:53.875489234924316,name:"faceOval"},{x:337.4256896972656,y:270.8755302429199,z:-17.67060160636902},{x:343.69922637939453,y:273.0000400543213,z:-18.756048679351807},{x:327.4242401123047,y:309.22399520874023,z:-4.703601002693176,name:"lips"},{x:330.37220001220703,y:308.3323001861572,z:-6.442649960517883},{x:293.87027740478516,y:207.7961826324463,z:9.821539521217346,name:"rightEyebrow"},{x:332.11437225341797,y:271.22812271118164,z:-16.64351224899292},{x:320.1197814941406,y:207.40366458892822,z:-2.48164564371109,name:"rightEyebrow"},{x:318.59575271606445,y:201.07443809509277,z:-3.110446035861969,name:"rightEyebrow"},{x:310.72303771972656,y:175.75075149536133,z:13.328815698623657,name:"faceOval"},{x:289.67578887939453,y:202.29835510253906,z:21.370456218719482},{x:315.30879974365234,y:187.35260009765625,z:5.0304025411605835},{x:287.8936767578125,y:216.54793739318848,z:17.81065821647644,name:"rightEyebrow"},{x:283.9391899108887,y:215.01142501831055,z:32.04984903335571},{x:348.35330963134766,y:299.4155788421631,z:-22.47924566268921},{x:341.1790466308594,y:301.8221855163574,z:-18.977805376052856},{x:335.69713592529297,y:304.4266891479492,z:-14.682706594467163},{x:339.4615173339844,y:272.3654365539551,z:-16.38674020767212},{x:328.99600982666016,y:308.86685371398926,z:-5.616893768310547},{x:332.00313568115234,y:309.1875743865967,z:-10.335084199905396},{x:331.0068130493164,y:307.9274368286133,z:-6.681914925575256,name:"lips"},{x:341.13792419433594,y:266.4876937866211,z:-26.56425952911377},{x:339.02950286865234,y:305.6663703918457,z:-12.33674168586731,name:"lips"},{x:344.22935485839844,y:304.9452781677246,z:-15.161235332489014,name:"lips"},{x:350.1844024658203,y:304.374303817749,z:-17.5305438041687,name:"lips"},{x:348.52630615234375,y:325.9562301635742,z:-16.164982318878174},{x:348.6581802368164,y:317.1624183654785,z:-21.510512828826904,name:"lips"},{x:348.9766311645508,y:312.1923065185547,z:-21.708929538726807},{x:349.2427444458008,y:308.0660820007324,z:-19.643079042434692},{x:349.67491149902344,y:305.42747497558594,z:-18.16080331802368,name:"lips"},{x:337.95589447021484,y:306.6535949707031,z:-12.803598642349243,name:"lips"},{x:337.06878662109375,y:307.63169288635254,z:-14.274203777313232},{x:335.77449798583984,y:309.8449516296387,z:-15.698124170303345},{x:334.6099090576172,y:312.7997016906738,z:-14.764405488967896,name:"lips"},{x:327.2330856323242,y:293.80866050720215,z:-11.864047050476074},{x:280.97679138183594,y:279.79928970336914,z:68.90834331512451,name:"faceOval"},{x:355.13843536376953,y:271.7875671386719,z:-25.350427627563477},{x:334.7235870361328,y:307.4656391143799,z:-9.302158951759338,name:"lips"},{x:333.5293960571289,y:307.89782524108887,z:-10.200862884521484},{x:346.29688262939453,y:276.4256286621094,z:-19.748122692108154},{x:335.16246795654297,y:276.22097969055176,z:-12.313398122787476},{x:345.09132385253906,y:274.7082996368408,z:-19.304605722427368},{x:325.4267883300781,y:252.95130729675293,z:-1.6661019623279572},{x:315.347843170166,y:259.05200958251953,z:-.25604281574487686},{x:330.44933319091797,y:267.7570152282715,z:-14.017432928085327},{x:294.96768951416016,y:185.26001930236816,z:23.903164863586426,name:"faceOval"},{x:299.63531494140625,y:192.7913761138916,z:12.640198469161987},{x:304.5452117919922,y:202.4142837524414,z:3.244667649269104,name:"rightEyebrow"},{x:331.6915512084961,y:320.0467872619629,z:-10.632705688476562},{x:334.5911407470703,y:201.27566814422607,z:-6.133356094360352,name:"rightEyebrow"},{x:331.4815902709961,y:185.44180870056152,z:.6627205014228821},{x:328.05816650390625,y:170.8385467529297,z:7.358860373497009,name:"faceOval"},{x:304.49764251708984,y:239.76297855377197,z:10.387605428695679},{x:290.6382179260254,y:248.85257720947266,z:19.03616428375244},{x:331.5682601928711,y:233.20727348327637,z:7.837390303611755},{x:295.5115509033203,y:228.9834451675415,z:14.41426157951355},{x:336.94332122802734,y:241.8259334564209,z:-5.27842104434967},{x:336.2792205810547,y:262.7049922943115,z:-26.12074375152588},{x:284.4102478027344,y:255.3262710571289,z:25.467140674591064},{x:295.1420593261719,y:253.02655220031738,z:12.430112361907959},{x:303.5196113586426,y:254.20703887939453,z:6.139191389083862},{x:315.73450088500977,y:251.64799690246582,z:3.3788898587226868},{x:324.69661712646484,y:247.56494522094727,z:2.3328344523906708},{x:331.57970428466797,y:243.02241325378418,z:1.1423448473215103},{x:345.6210708618164,y:229.9976634979248,z:-10.825285911560059},{x:286.26644134521484,y:270.37991523742676,z:21.708929538726807},{x:290.2525520324707,y:228.4921360015869,z:17.71728754043579},{x:351.65367126464844,y:269.3400764465332,z:-33.450424671173096},{x:333.1378936767578,y:253.88388633728027,z:-7.230473756790161},{x:277.8318977355957,y:246.95331573486328,z:68.20805549621582,name:"faceOval"},{x:336.6680908203125,y:238.10003757476807,z:.7688578963279724},{x:329.95800018310547,y:269.18323516845703,z:-7.207130789756775},{x:299.17491912841797,y:234.13324356079102,z:15.95489501953125},{x:335.61729431152344,y:258.71752738952637,z:-23.016133308410645},{x:284.1079330444336,y:297.0343494415283,z:63.25934886932373,name:"faceOval"},{x:331.44542694091797,y:230.6892442703247,z:9.92658257484436,name:"rightEye"},{x:341.41536712646484,y:253.01264762878418,z:-29.038610458374023},{x:303.5472869873047,y:327.5896739959717,z:16.725212335586548},{x:304.7756576538086,y:337.4389457702637,z:27.38126277923584,name:"faceOval"},{x:280.80501556396484,y:275.32050132751465,z:45.0752067565918},{x:295.43582916259766,y:318.4501647949219,z:26.2608003616333},{x:281.4303207397461,y:228.7355661392212,z:40.94350814819336},{x:331.2549591064453,y:349.4216537475586,z:-7.376367449760437},{x:352.4247741699219,y:271.7330074310303,z:-24.953596591949463},{x:327.5672912597656,y:260.41900634765625,z:-5.456410646438599},{x:284.5432472229004,y:241.7647933959961,z:29.668869972229004},{x:310,y:235.66174507141113,z:8.502663969993591,name:"rightEye"},{x:315.7071113586426,y:235.7572603225708,z:6.938687562942505,name:"rightEye"},{x:330.41088104248047,y:311.04143142700195,z:-9.325502514839172,name:"lips"},{x:288.5377502441406,y:285.31983375549316,z:21.837315559387207},{x:344.55039978027344,y:359.4300842285156,z:-6.705257892608643,name:"faceOval"},{x:323.41880798339844,y:351.67362213134766,z:7.802375555038452,name:"faceOval"},{x:314.64088439941406,y:346.11894607543945,z:16.36339783668518,name:"faceOval"},{x:349.4945526123047,y:184.8434829711914,z:-.21847527474164963},{x:359.24694061279297,y:359.8348903656006,z:-8.403456211090088,name:"faceOval"},{x:321.26182556152344,y:234.64492321014404,z:6.90950870513916,name:"rightEye"},{x:326.318359375,y:232.90250301361084,z:8.029969334602356,name:"rightEye"},{x:329.6211624145508,y:231.6195774078369,z:9.722331762313843,name:"rightEye"},{x:285.9398078918457,y:228.2351303100586,z:24.650139808654785},{x:325.79288482666016,y:227.88007736206055,z:7.469738721847534,name:"rightEye"},{x:320.1699447631836,y:227.5934886932373,z:6.168370842933655,name:"rightEye"},{x:314.85408782958984,y:227.85282611846924,z:6.2675780057907104,name:"rightEye"},{x:309.3084907531738,y:229.1516876220703,z:7.7031683921813965,name:"rightEye"},{x:305.5621337890625,y:230.92366218566895,z:9.722331762313843,name:"rightEye"},{x:277.8681945800781,y:228.5354232788086,z:59.71122741699219,name:"faceOval"},{x:306.1444664001465,y:235.1954698562622,z:10.603528022766113,name:"rightEye"},{x:355.4478454589844,y:281.96210861206055,z:-20.565123558044434},{x:333.02661895751953,y:288.0105400085449,z:-14.72939133644104},{x:337.15728759765625,y:269.2059516906738,z:-19.8414945602417},{x:345.9898376464844,y:283.5453128814697,z:-20.4834246635437},{x:351.48963928222656,y:219.98916149139404,z:-7.0378947257995605},{x:312.39574432373047,y:336.50628089904785,z:8.671900033950806},{x:321.32152557373047,y:343.1755256652832,z:.9067271649837494},{x:343.78379821777344,y:353.2975959777832,z:-14.355905055999756},{x:296.8791389465332,y:327.91497230529785,z:41.01353645324707,name:"faceOval"},{x:329.6939468383789,y:229.27897453308105,z:8.934508562088013,name:"rightEye"},{x:341.6905212402344,y:241.4073657989502,z:-14.589333534240723},{x:359.03079986572266,y:353.48859786987305,z:-15.803166627883911},{x:333.1861877441406,y:356.43213272094727,z:-1.0234417766332626,name:"faceOval"},{x:283.97483825683594,y:291.4318656921387,z:41.94725513458252},{x:343.33770751953125,y:305.830135345459,z:-15.756480693817139,name:"lips"},{x:342.40283966064453,y:307.7453899383545,z:-17.4021577835083},{x:341.53621673583984,y:311.0595703125,z:-19.047834873199463},{x:340.9107208251953,y:315.4837703704834,z:-18.5576331615448,name:"lips"},{x:339.1478729248047,y:323.42233657836914,z:-14.367576837539673},{x:333.3201599121094,y:307.4406337738037,z:-9.617288708686829},{x:331.2411117553711,y:306.9811820983887,z:-9.669809937477112},{x:329.23255920410156,y:306.0508346557617,z:-9.582273960113525,name:"lips"},{x:322.4586486816406,y:301.33323669433594,z:-7.720675468444824},{x:297.1712112426758,y:286.9552803039551,z:8.240055441856384},{x:341.3060760498047,y:235.4432201385498,z:-7.504753470420837},{x:336.9318389892578,y:224.3451976776123,z:5.829898118972778},{x:332.65323638916016,y:226.70403957366943,z:8.105834126472473},{x:334.67357635498047,y:306.4397621154785,z:-8.981193900108337,name:"lips"},{x:297.4601936340332,y:306.29210472106934,z:15.476365089416504},{x:342.9119110107422,y:222.37077713012695,z:-2.754466235637665},{x:335.4629898071289,y:332.20250129699707,z:-11.823196411132812},{x:353.2412338256836,y:240.56339263916016,z:-27.147831916809082},{x:346.3080596923828,y:236.41446590423584,z:-18.452589511871338},{x:352.6475143432617,y:234.1420555114746,z:-19.748122692108154},{x:337.3209762573242,y:253.39937210083008,z:-16.024924516677856},{x:358.6122131347656,y:344.90861892700195,z:-18.592647314071655},{x:358.1117248535156,y:334.64990615844727,z:-17.49552845954895},{x:346.4450454711914,y:335.0321102142334,z:-16.32838249206543},{x:319.17640686035156,y:320.2833938598633,z:-3.276764452457428},{x:325.2540588378906,y:276.2369728088379,z:-6.460157036781311},{x:326.7214584350586,y:327.3939514160156,z:-7.417217493057251},{x:310.7190132141113,y:277.2265148162842,z:-3.5452082753181458},{x:319.78355407714844,y:284.8238182067871,z:-6.4543211460113525},{x:305.773983001709,y:290.83580017089844,z:.06907138042151928},{x:344.4001770019531,y:344.85408782958984,z:-16.946970224380493},{x:333.1879425048828,y:258.74256134033203,z:-11.90489649772644},{x:313.80598068237305,y:327.08919525146484,z:2.2277912497520447},{x:322.9637908935547,y:334.6819496154785,z:-3.3643004298210144},{x:313.4055519104004,y:311.2166690826416,z:-1.1175429821014404},{x:291.0865783691406,y:298.2831001281738,z:22.467575073242188},{x:305.6580924987793,y:313.3707904815674,z:5.561453700065613},{x:288.23760986328125,y:305.9941864013672,z:36.765122413635254},{x:315.10692596435547,y:296.26991271972656,z:-4.604393839836121},{x:337.50518798828125,y:247.5944423675537,z:-10.597691535949707},{x:338.8450622558594,y:265.47778129577637,z:-27.778091430664062},{x:334.25254821777344,y:269.0671920776367,z:-20.938611030578613},{x:341.64512634277344,y:259.6387195587158,z:-32.189905643463135},{x:331.44081115722656,y:219.0976095199585,z:4.207563698291779},{x:320.56339263916016,y:216.49658203125,z:2.930997312068939},{x:311.21912002563477,y:216.57853603363037,z:2.9674705862998962},{x:303.46256256103516,y:218.54614734649658,z:5.357203483581543},{x:297.99999237060547,y:222.505202293396,z:9.325502514839172},{x:294.93839263916016,y:236.39654159545898,z:18.534289598464966},{x:278.87489318847656,y:259.7095584869385,z:45.68212032318115},{x:300.3782653808594,y:245.38593292236328,z:12.278382778167725},{x:307.06348419189453,y:246.36857986450195,z:8.164191246032715},{x:315.5229187011719,y:245.3949737548828,z:5.503097176551819},{x:323.71395111083984,y:242.75178909301758,z:4.6335723996162415},{x:330.2785873413086,y:239.34658527374268,z:4.937030673027039},{x:334.6982192993164,y:236.0460376739502,z:4.823233783245087},{x:279.3412208557129,y:263.5196113586426,z:70.91583728790283,name:"faceOval"},{x:334.65972900390625,y:271.6648578643799,z:-17.775644063949585},{x:342.05677032470703,y:246.99846267700195,z:-20.84523916244507},{x:344.0357971191406,y:264.5701503753662,z:-32.936880588531494},{x:348.25531005859375,y:268.6645030975342,z:-30.695960521697998},{x:344.12227630615234,y:266.34212493896484,z:-29.808926582336426},{x:337.12318420410156,y:274.2556858062744,z:-15.768152475357056},{x:349.49047088623047,y:269.071683883667,z:-32.51670837402344},{x:350.1683044433594,y:271.4691352844238,z:-24.93025302886963},{x:333.9634704589844,y:230.56639194488525,z:8.89949381351471},{x:338.2147979736328,y:231.4807891845703,z:4.6715047955513},{x:340.4712677001953,y:231.74463272094727,z:-.34996166825294495},{x:303.28975677490234,y:232.24980354309082,z:11.916568279266357,name:"rightEye"},{x:299.4649124145508,y:229.53842639923096,z:12.325069904327393},{x:359.09618377685547,y:241.77349090576172,z:-24.650139808654785},{x:399.46216583251953,y:229.89503860473633,z:15.919880867004395,name:"leftEye"},{x:361.38919830322266,y:269.6129894256592,z:-24.510080814361572},{x:416.9973373413086,y:206.0895538330078,z:53.26857566833496,name:"faceOval"},{x:381.32179260253906,y:235.5476474761963,z:7.6214683055877686},{x:387.8068542480469,y:236.25958442687988,z:8.345099091529846},{x:393.95751953125,y:235.8660364151001,z:10.475142002105713},{x:401.84600830078125,y:232.77019500732422,z:16.760226488113403},{x:375.70568084716797,y:233.48456382751465,z:8.234220147132874},{x:388.17752838134766,y:218.94717693328857,z:6.810300946235657},{x:381.64928436279297,y:219.2656660079956,z:6.711093783378601},{x:394.4760513305664,y:219.66821193695068,z:9.173773527145386},{x:398.8843536376953,y:221.8837022781372,z:12.03328251838684},{x:406.5454864501953,y:237.12156772613525,z:19.7131085395813},{x:383.87447357177734,y:337.6932907104492,z:-8.631049990653992},{x:401.2682342529297,y:228.5916566848755,z:18.359217643737793,name:"leftEye"},{x:422.0449447631836,y:236.73934936523438,z:51.16771221160889},{x:412.69153594970703,y:232.80198097229004,z:27.52131938934326},{x:387.3497772216797,y:263.298397064209,z:-2.8609684109687805},{x:364.5124053955078,y:293.39221000671387,z:-22.397546768188477,name:"lips"},{x:363.62987518310547,y:302.1291446685791,z:-19.643079042434692},{x:373.2334518432617,y:295.8647060394287,z:-18.125789165496826,name:"lips"},{x:378.83365631103516,y:299.5177745819092,z:-13.153743743896484,name:"lips"},{x:369.91477966308594,y:302.5704002380371,z:-16.65518283843994},{x:374.9167251586914,y:303.5416603088379,z:-11.963253021240234},{x:387.58888244628906,y:312.2716999053955,z:-4.680258631706238},{x:360.6635284423828,y:264.31986808776855,z:-35.94811677932739},{x:361.04564666748047,y:256.8225860595703,z:-37.278664112091064},{x:408.3855438232422,y:213.52088928222656,z:15.756480693817139,name:"leftEyebrow"},{x:373.2946014404297,y:245.38101196289062,z:-1.9316278398036957},{x:376.83860778808594,y:264.3721103668213,z:-18.510947227478027},{x:376.9546127319336,y:261.0010528564453,z:-15.989909172058105},{x:406.1498260498047,y:263.5030174255371,z:7.072908878326416},{x:360.07205963134766,y:248.3631706237793,z:-32.16656446456909},{x:393.11119079589844,y:205.10473251342773,z:3.7786373496055603,name:"leftEyebrow"},{x:402.12791442871094,y:207.89000988006592,z:9.383859634399414,name:"leftEyebrow"},{x:410.8693313598633,y:191.6182279586792,z:41.27030849456787,name:"faceOval"},{x:364.9509811401367,y:210.40483474731445,z:-3.758212625980377},{x:375.94444274902344,y:221.1331844329834,z:8.368442058563232},{x:392.1904754638672,y:305.0360298156738,z:-1.752179116010666},{x:419.50225830078125,y:307.25592613220215,z:58.96425247192383,name:"faceOval"},{x:372.0027160644531,y:268.7212657928467,z:-16.631840467453003},{x:366.1614227294922,y:271.6237449645996,z:-18.219159841537476},{x:385.00938415527344,y:305.3863334655762,z:-2.567722797393799},{x:381.99771881103516,y:304.9723720550537,z:-4.575215280056},{x:405.078125,y:203.21216583251953,z:13.713973760604858,name:"leftEyebrow"},{x:377.13207244873047,y:268.4710121154785,z:-15.266278982162476},{x:380.9713363647461,y:205.36980628967285,z:-.7250899076461792,name:"leftEyebrow"},{x:381.7788314819336,y:198.9268398284912,z:-1.184653863310814,name:"leftEyebrow"},{x:385.5204772949219,y:172.1484375,z:16.04826807975769,name:"faceOval"},{x:407.94189453125,y:196.76236152648926,z:25.723915100097656},{x:383.03890228271484,y:184.5157527923584,z:7.393874526023865},{x:411.61781311035156,y:210.79241752624512,z:22.315845489501953,name:"leftEyebrow"},{x:414.30870056152344,y:208.4643030166626,z:37.021894454956055},{x:364.28722381591797,y:298.35777282714844,z:-21.86065673828125},{x:371.3682556152344,y:299.78848457336426,z:-17.834001779556274},{x:376.88201904296875,y:301.6696071624756,z:-13.153743743896484},{x:370.2193832397461,y:270.49095153808594,z:-15.569736957550049},{x:383.5081100463867,y:305.2726364135742,z:-3.673594295978546},{x:380.73760986328125,y:305.96869468688965,z:-8.660228252410889},{x:381.2334442138672,y:304.63574409484863,z:-4.820316135883331,name:"lips"},{x:368.1698989868164,y:264.8884963989258,z:-25.653886795043945},{x:373.5087203979492,y:303.4233856201172,z:-10.95950722694397,name:"lips"},{x:368.4544372558594,y:303.29601287841797,z:-14.169161319732666,name:"lips"},{x:362.76554107666016,y:303.5735607147217,z:-16.911956071853638,name:"lips"},{x:366.60980224609375,y:324.8870658874512,z:-15.616422891616821},{x:365.7067108154297,y:315.95678329467773,z:-20.903596878051758,name:"lips"},{x:365.0083923339844,y:311.2232208251953,z:-21.066999435424805},{x:364.1508102416992,y:307.0583438873291,z:-18.907777070999146},{x:363.37512969970703,y:304.5721435546875,z:-17.42550015449524,name:"lips"},{x:374.580078125,y:304.3059539794922,z:-11.40302300453186,name:"lips"},{x:375.55362701416016,y:305.0998020172119,z:-12.861957550048828},{x:377.2437286376953,y:307.1674346923828,z:-14.215847253799438},{x:378.68587493896484,y:309.9015712738037,z:-13.223772048950195,name:"lips"},{x:383.8992691040039,y:290.29629707336426,z:-9.97326910495758},{x:423.3871841430664,y:271.91688537597656,z:74.37058925628662,name:"faceOval"},{x:377.68043518066406,y:304.62209701538086,z:-7.603961229324341,name:"lips"},{x:379.00428771972656,y:304.9314594268799,z:-8.57852816581726},{x:364.00279998779297,y:275.2813911437988,z:-19.25792098045349},{x:374.68231201171875,y:273.82555961608887,z:-11.28047227859497},{x:365.0354766845703,y:273.4548568725586,z:-18.791062831878662},{x:380.61901092529297,y:249.8848056793213,z:.15501167625188828},{x:391.14158630371094,y:254.7934627532959,z:2.0906515419483185},{x:378.1761169433594,y:264.9612236022949,z:-12.605184316635132},{x:400.9540557861328,y:179.99592304229736,z:27.82477855682373,name:"faceOval"},{x:398.0038833618164,y:188.50656509399414,z:16.094952821731567},{x:394.8717498779297,y:199.0359592437744,z:6.226727366447449,name:"leftEyebrow"},{x:382.10926055908203,y:316.83926582336426,z:-8.946179747581482},{x:366.51588439941406,y:200.32583713531494,z:-5.24632453918457,name:"leftEyebrow"},{x:367.4893569946289,y:183.87210845947266,z:1.9039081037044525},{x:368.6243438720703,y:168.8127565383911,z:8.736093044281006,name:"faceOval"},{x:398.96175384521484,y:234.9675178527832,z:13.713973760604858},{x:412.9645538330078,y:242.23042488098145,z:23.272905349731445},{x:372.05257415771484,y:231.41919136047363,z:9.226294755935669},{x:406.0722351074219,y:223.58965873718262,z:18.370890617370605},{x:368.27442169189453,y:240.2039337158203,z:-4.166713654994965},{x:372.3575210571289,y:260.66442489624023,z:-24.976940155029297},{x:419.2244338989258,y:247.9079246520996,z:30.299127101898193},{x:409.43885803222656,y:246.60913467407227,z:16.398411989212036},{x:401.69139862060547,y:248.76328468322754,z:9.395531415939331},{x:389.7608184814453,y:247.56915092468262,z:5.841569304466248},{x:380.5461883544922,y:244.55984115600586,z:4.263003468513489},{x:373.25817108154297,y:240.80214500427246,z:2.5356262922286987},{x:358.77086639404297,y:229.35615062713623,z:-10.387605428695679},{x:419.5793914794922,y:262.8478717803955,z:26.5175724029541},{x:410.8808898925781,y:222.51372814178467,z:22.199130058288574},{x:358.45714569091797,y:268.91467094421387,z:-33.17030906677246},{x:373.4129333496094,y:251.6385841369629,z:-5.771540403366089},{x:422.5408172607422,y:239.23919677734375,z:74.04378890991211,name:"faceOval"},{x:367.8171920776367,y:236.58040523529053,z:1.820748895406723},{x:378.51959228515625,y:266.2532329559326,z:-5.74819803237915},{x:403.3472442626953,y:229.05112266540527,z:19.689764976501465},{x:372.34840393066406,y:256.6451168060303,z:-21.872329711914062},{x:422.54566192626953,y:289.1587829589844,z:68.67491245269775,name:"faceOval"},{x:371.9297409057617,y:228.90116214752197,z:11.432201862335205,name:"leftEye"},{x:366.21360778808594,y:251.6158962249756,z:-28.19826364517212},{x:409.1571807861328,y:321.3156223297119,z:20.2266526222229},{x:408.52943420410156,y:331.44238471984863,z:31.09278917312622,name:"faceOval"},{x:424.2788314819336,y:267.1992301940918,z:50.467424392700195},{x:415.60352325439453,y:311.6528606414795,z:30.579242706298828},{x:418.12793731689453,y:221.59927368164062,z:46.26569747924805},{x:385.68286895751953,y:346.0184955596924,z:-5.70151150226593},{x:357.82936096191406,y:271.3758373260498,z:-24.836881160736084},{x:379.588623046875,y:257.5071716308594,z:-3.755294680595398},{x:417.4592590332031,y:234.71948146820068,z:34.5475435256958},{x:393.4684371948242,y:231.58967971801758,z:11.408859491348267,name:"leftEye"},{x:387.8864288330078,y:232.14245796203613,z:9.51808214187622,name:"leftEye"},{x:382.4981689453125,y:307.5654888153076,z:-7.522260546684265,name:"lips"},{x:419.00169372558594,y:277.8332805633545,z:26.424202919006348},{x:373.62953186035156,y:357.6375102996826,z:-5.75986921787262,name:"faceOval"},{x:392.8708267211914,y:347.72446632385254,z:10.154176950454712,name:"faceOval"},{x:400.3953552246094,y:341.0005187988281,z:19.39797878265381,name:"faceOval"},{x:382.25440979003906,y:231.66935920715332,z:8.998700976371765,name:"leftEye"},{x:377.14550018310547,y:230.4228687286377,z:9.804032444953918,name:"leftEye"},{x:373.8358688354492,y:229.64950561523438,z:11.292144060134888,name:"leftEye"},{x:414.5794677734375,y:221.67891025543213,z:29.412097930908203},{x:377.00672149658203,y:225.66201210021973,z:9.360517263412476,name:"leftEye"},{x:382.29530334472656,y:224.8431158065796,z:8.32175612449646,name:"leftEye"},{x:387.5133514404297,y:224.49507236480713,z:8.917000889778137,name:"leftEye"},{x:393.15906524658203,y:225.24795055389404,z:10.737749338150024,name:"leftEye"},{x:397.05554962158203,y:226.55359268188477,z:13.002015352249146,name:"leftEye"},{x:420.5299377441406,y:221.014666557312,z:65.40690422058105,name:"faceOval"},{x:397.06920623779297,y:230.6661558151245,z:13.807345628738403,name:"leftEye"},{x:377.94647216796875,y:285.1647090911865,z:-13.305472135543823},{x:372.1118927001953,y:267.1267318725586,z:-18.83774757385254},{x:364.9968719482422,y:282.24411964416504,z:-19.818150997161865},{x:401.973876953125,y:331.20131492614746,z:11.566424369812012},{x:394.3083190917969,y:338.86693954467773,z:3.142542541027069},{x:373.9820861816406,y:351.4504623413086,z:-13.50388765335083},{x:414.3888854980469,y:321.24735832214355,z:45.51872253417969,name:"faceOval"},{x:373.44234466552734,y:227.33163356781006,z:10.626870393753052,name:"leftEye"},{x:364.0731430053711,y:240.31539916992188,z:-13.807345628738403},{x:384.2658233642578,y:353.3793067932129,z:.7385850697755814,name:"faceOval"},{x:423.20526123046875,y:283.5176181793213,z:47.152724266052246},{x:369.42798614501953,y:304.0898895263672,z:-14.647691249847412,name:"lips"},{x:370.63812255859375,y:305.90051651000977,z:-16.211668252944946},{x:371.91192626953125,y:309.0167713165283,z:-17.84567356109619},{x:373.0583953857422,y:313.3545398712158,z:-17.378815412521362,name:"lips"},{x:375.39905548095703,y:321.09289169311523,z:-13.118728399276733},{x:379.2567825317383,y:304.3582534790039,z:-7.924926280975342},{x:381.18797302246094,y:303.7031364440918,z:-7.843226194381714},{x:383.0918502807617,y:302.4884605407715,z:-7.6506465673446655,name:"lips"},{x:389.09461975097656,y:297.1475315093994,z:-5.5497825145721436},{x:411.6408920288086,y:280.24898529052734,z:12.02161192893982},{x:363.3110809326172,y:234.27620887756348,z:-6.775286793708801},{x:366.0474395751953,y:223.29872131347656,z:6.827808618545532},{x:370.34427642822266,y:225.1457118988037,z:9.558931589126587},{x:377.5371551513672,y:303.60079765319824,z:-7.358860373497009,name:"lips"},{x:412.9557800292969,y:299.53579902648926,z:19.39797878265381},{x:360.0810241699219,y:221.72012329101562,z:-2.153385728597641},{x:379.82784271240234,y:329.47723388671875,z:-10.48097848892212},{x:359.08477783203125,y:235.7911491394043,z:-18.079102039337158},{x:369.6688461303711,y:251.5407943725586,z:-14.962821006774902},{x:369.5555114746094,y:333.5307312011719,z:-15.67478060722351},{x:394.0193176269531,y:315.6973171234131,z:-.9920747578144073},{x:383.78997802734375,y:272.7268695831299,z:-4.689012169837952},{x:387.67765045166016,y:323.6722755432129,z:-5.640236139297485},{x:397.8769302368164,y:272.1331214904785,z:-.9395531564950943},{x:389.87476348876953,y:280.5630111694336,z:-4.29218202829361},{x:403.83888244628906,y:285.1167869567871,z:3.0229100584983826},{x:372.5467300415039,y:343.1070327758789,z:-16.153310537338257},{x:374.1112518310547,y:256.3721466064453,z:-10.574349164962769},{x:399.73785400390625,y:321.77515983581543,z:4.849494695663452},{x:392.03365325927734,y:330.56447982788086,z:-1.3407598435878754},{x:398.59134674072266,y:305.93902587890625,z:1.517290621995926},{x:417.95997619628906,y:290.9716987609863,z:26.89105987548828},{x:406.04541778564453,y:307.35154151916504,z:8.666064143180847},{x:420.75328826904297,y:298.40752601623535,z:41.78385257720947},{x:395.4522705078125,y:291.4153575897217,z:-2.1752697229385376},{x:368.6452102661133,y:245.8882999420166,z:-9.453888535499573},{x:370.34900665283203,y:263.56690406799316,z:-26.75100326538086},{x:374.98477935791016,y:266.6126346588135,z:-19.77146625518799},{x:366.99840545654297,y:258.12140464782715,z:-31.372904777526855},{x:371.00616455078125,y:217.63479709625244,z:5.60522198677063},{x:381.30577087402344,y:214.14087295532227,z:4.983716309070587},{x:390.1496124267578,y:213.38221549987793,z:5.593550801277161},{x:397.7696990966797,y:214.3659782409668,z:8.57852816581726},{x:403.1652069091797,y:217.65509605407715,z:13.013685941696167},{x:407.3551940917969,y:230.72525024414062,z:22.444231510162354},{x:424.0876770019531,y:251.7839241027832,z:51.16771221160889},{x:403.50196838378906,y:239.88757610321045,z:15.803166627883911},{x:397.31719970703125,y:241.49806022644043,z:11.233787536621094},{x:388.99425506591797,y:241.4366912841797,z:7.948269248008728},{x:380.7804489135742,y:239.78078842163086,z:6.600214838981628},{x:374.01336669921875,y:237.11946487426758,z:6.349278092384338},{x:369.39125061035156,y:234.35351371765137,z:5.987462401390076},{x:422.9730987548828,y:255.76455116271973,z:76.61150932312012,name:"faceOval"},{x:374.73915100097656,y:269.24214363098145,z:-16.608498096466064},{x:364.61681365966797,y:245.71088790893555,z:-20.02823829650879},{x:365.3834533691406,y:263.34174156188965,z:-32.32996463775635},{x:361.58252716064453,y:267.8273677825928,z:-30.345816612243652},{x:365.37208557128906,y:265.0249671936035,z:-29.178667068481445},{x:372.72605895996094,y:272.05135345458984,z:-14.834434986114502},{x:360.48614501953125,y:268.34827423095703,z:-32.189905643463135},{x:359.9516296386719,y:270.8049201965332,z:-24.650139808654785},{x:369.5049285888672,y:229.01945114135742,z:10.107489824295044},{x:365.5447769165039,y:230.24096488952637,z:5.593550801277161},{x:363.50669860839844,y:230.6208372116089,z:.43622106313705444},{x:399.3529510498047,y:227.65677452087402,z:15.35965085029602,name:"leftEye"},{x:402.5693130493164,y:224.60190296173096,z:15.931552648544312}],box:{xMin:277.8318977355957,yMin:168.7741756439209,xMax:424.2788314819336,yMax:359.8348903656006,width:146.4469337463379,height:191.0607147216797}},SAMPLE_FACELANDMARKER_RESULT:{faceLandmarks:[[{x:.5760777592658997,y:.8639070391654968,z:-.030997956171631813},{x:.572094738483429,y:.7886289358139038,z:-.07189624011516571},{x:.5723551511764526,y:.8075382709503174,z:-.03578168898820877},{x:.5548420548439026,y:.7188365459442139,z:-.057787876576185226},{x:.5706077814102173,y:.7674974799156189,z:-.07740399986505508},{x:.5681378245353699,y:.7387768030166626,z:-.07356284558773041},{x:.5621535181999207,y:.6681165099143982,z:-.04189874976873398},{x:.46613582968711853,y:.6679812073707581,z:.011289681307971478},{x:.5579932928085327,y:.6174106597900391,z:-.03502821549773216},{x:.5563451647758484,y:.5905600190162659,z:-.03928658738732338},{x:.5487832427024841,y:.4900572597980499,z:-.029898937791585922},{x:.5765544176101685,y:.8692144751548767,z:-.02831427752971649},{x:.5771114230155945,y:.873644232749939,z:-.02345779910683632},{x:.5771905779838562,y:.877016007900238,z:-.016658689826726913},{x:.5778058767318726,y:.8770116567611694,z:-.014505492523312569},{x:.5783766508102417,y:.8835000991821289,z:-.015996402129530907},{x:.5792440176010132,y:.8913810849189758,z:-.01924579218029976},{x:.5796768069267273,y:.8996334671974182,z:-.018261712044477463},{x:.5817288160324097,y:.9255813956260681,z:-.007126849144697189},{x:.5726592540740967,y:.7992473244667053,z:-.0643521398305893},{x:.5579419136047363,y:.7996989488601685,z:-.04566684365272522},{x:.4216199815273285,y:.5958762764930725,z:.06776496022939682},{x:.5052269697189331,y:.6796539425849915,z:-.0010737782577052712},{x:.49243026971817017,y:.6838865876197815,z:-.0005227324436418712},{x:.4796970784664154,y:.6856290102005005,z:.002684245817363262},{x:.4618356227874756,y:.6764569878578186,z:.013439622707664967},{x:.5160380601882935,y:.6737282276153564,z:-17607348127057776e-21},{x:.48070961236953735,y:.6255870461463928,z:-.008339674212038517},{x:.49719780683517456,y:.6256808042526245,z:-.008027955889701843},{x:.46674346923828125,y:.6317623853683472,z:-.004460199736058712},{x:.4582492709159851,y:.641118049621582,z:.0011905613355338573},{x:.45408669114112854,y:.6911458969116211,z:.020514748990535736},{x:.535312294960022,y:.9619986414909363,z:.012499462813138962},{x:.4608460068702698,y:.6628725528717041,z:.01517564244568348},{x:.4206731915473938,y:.6828458309173584,z:.07848648726940155},{x:.4390624463558197,y:.6796106696128845,z:.03283142298460007},{x:.5029968619346619,y:.7701570391654968,z:-.009734481573104858},{x:.5595027208328247,y:.8607323169708252,z:-.030043255537748337},{x:.5621269941329956,y:.8738374710083008,z:-.021709579974412918},{x:.5451499819755554,y:.865527331829071,z:-.022014077752828598},{x:.5351184010505676,y:.8705098032951355,z:-.011602800339460373},{x:.5495014190673828,y:.8744956254959106,z:-.016490943729877472},{x:.5395170450210571,y:.8759440779685974,z:-.007333362940698862},{x:.5183624029159546,y:.8959754705429077,z:.010520773939788342},{x:.5604349374771118,y:.7895449995994568,z:-.07082037627696991},{x:.557381272315979,y:.7687489986419678,z:-.07590588927268982},{x:.4432901442050934,y:.6308897733688354,z:.0027153254486620426},{x:.5258325338363647,y:.7151225805282593,z:-.014676518738269806},{x:.5271827578544617,y:.7833116054534912,z:-.037643320858478546},{x:.5257382988929749,y:.7717816233634949,z:-.03401920944452286},{x:.46516409516334534,y:.7705106735229492,z:.0065747760236263275},{x:.5558893084526062,y:.7420997619628906,z:-.0694495290517807},{x:.4720408320426941,y:.6066038608551025,z:-.021204356104135513},{x:.45432573556900024,y:.6158540844917297,z:-.011054684408009052},{x:.4305151402950287,y:.5608053803443909,z:.0396830290555954},{x:.5310865640640259,y:.6157484650611877,z:-.03081176057457924},{x:.5114666223526001,y:.6329749226570129,z:-.00335998204536736},{x:.506435751914978,y:.8786543607711792,z:.012980876490473747},{x:.4480472207069397,y:.8640613555908203,z:.12569651007652283},{x:.5372058153152466,y:.7942581176757812,z:-.03168361634016037},{x:.5488379597663879,y:.8001630306243896,z:-.03280917927622795},{x:.5213388204574585,y:.8794381618499756,z:.011892606504261494},{x:.5242055654525757,y:.8789222240447998,z:.008370225317776203},{x:.4477175176143646,y:.6039950251579285,z:-.0050799972377717495},{x:.526964008808136,y:.7916748523712158,z:-.02968614175915718},{x:.4971255660057068,y:.6050706505775452,z:-.028175678104162216},{x:.4938119053840637,y:.5882453918457031,z:-.03210941329598427},{x:.4757143557071686,y:.5094879865646362,z:-.01300730835646391},{x:.43947282433509827,y:.5816648006439209,z:.01415177434682846},{x:.485664039850235,y:.5477864146232605,z:-.023685332387685776},{x:.43635931611061096,y:.6226438283920288,z:.013606148771941662},{x:.42910251021385193,y:.6102726459503174,z:.03926564007997513},{x:.5605402588844299,y:.8680099248886108,z:-.027318159118294716},{x:.5474816560745239,y:.8702861070632935,z:-.019686367362737656},{x:.5373021364212036,y:.8728838562965393,z:-.010484928265213966},{x:.540735125541687,y:.7979167103767395,z:-.029073253273963928},{x:.5228585004806519,y:.87913578748703,z:.009915109723806381},{x:.530497670173645,y:.8815253973007202,z:.0020524784922599792},{x:.5259912610054016,y:.8790552616119385,z:.007895970717072487},{x:.5433906316757202,y:.7882310748100281,z:-.05121905356645584},{x:.541388213634491,y:.8777219653129578,z:-.00466804439201951},{x:.5515822172164917,y:.8767023086547852,z:-.010475946590304375},{x:.5637003779411316,y:.877059817314148,z:-.015273625031113625},{x:.5640299320220947,y:.9263423085212708,z:-.00658724969252944},{x:.5642300248146057,y:.8993074893951416,z:-.017653480172157288},{x:.5637336373329163,y:.8910360932350159,z:-.01852807030081749},{x:.5637134313583374,y:.8837276697158813,z:-.01482592523097992},{x:.564205527305603,y:.8768964409828186,z:-.01331155002117157},{x:.5419867634773254,y:.8778373599052429,z:-.0037720394320786},{x:.5404468774795532,y:.880696177482605,z:-.005610354244709015},{x:.5392338633537292,y:.8845721483230591,z:-.007352025713771582},{x:.538469672203064,y:.8891173601150513,z:-.005154991988092661},{x:.5189250111579895,y:.8452741503715515,z:-.009755070321261883},{x:.4258975088596344,y:.7662280797958374,z:.1387351155281067},{x:.5725725293159485,y:.8041572570800781,z:-.04583907872438431},{x:.5342061519622803,y:.8785833120346069,z:.002659974154084921},{x:.5324031114578247,y:.8804071545600891,z:.0017832003068178892},{x:.5538818836212158,y:.8078407645225525,z:-.03254539892077446},{x:.5325431823730469,y:.8026832938194275,z:-.019140373915433884},{x:.5514076948165894,y:.8043903112411499,z:-.03313535451889038},{x:.5131856203079224,y:.7284771800041199,z:-.009399853646755219},{x:.49331504106521606,y:.7443980574607849,z:-.005225230939686298},{x:.5239617824554443,y:.7807451486587524,z:-.025881027802824974},{x:.4473606050014496,y:.5315827131271362,z:.011164786294102669},{x:.45718759298324585,y:.5604941248893738,z:-.005943301599472761},{x:.4670005738735199,y:.5909327268600464,z:-.019681761041283607},{x:.5311570167541504,y:.9076261520385742,z:.00389476353302598},{x:.5249923467636108,y:.5893563628196716,z:-.037981919944286346},{x:.5166932344436646,y:.5429551005363464,z:-.03319704160094261},{x:.5085030198097229,y:.49676206707954407,z:-.02691275253891945},{x:.4687720239162445,y:.6834565997123718,z:.008113506250083447},{x:.4426414966583252,y:.7069531679153442,z:.028577271848917007},{x:.5230373740196228,y:.6675713658332825,z:.001773772411979735},{x:.4481240212917328,y:.6527872085571289,z:.012414850294589996},{x:.5339856743812561,y:.7012367844581604,z:-.020220188423991203},{x:.5347223281860352,y:.7761190533638,z:-.05141595005989075},{x:.4315067231655121,y:.7211957573890686,z:.04381405934691429},{x:.45203351974487305,y:.7206180095672607,z:.017288070172071457},{x:.46892452239990234,y:.7265436053276062,z:.005602988880127668},{x:.49314674735069275,y:.7202282547950745,z:-.0006408205372281373},{x:.5104925632476807,y:.7091827392578125,z:-.00362918758764863},{x:.5232142210006714,y:.698553740978241,z:-.00787867046892643},{x:.5497883558273315,y:.6743605136871338,z:-.036349106580019},{x:.43658503890037537,y:.7627100348472595,z:.042555369436740875},{x:.4397648870944977,y:.6528646349906921,z:.017956094816327095},{x:.5653332471847534,y:.7992802858352661,z:-.06365057826042175},{x:.5285563468933105,y:.736810564994812,z:-.018836988136172295},{x:.4180678725242615,y:.6792560815811157,z:.12284679710865021},{x:.5328429937362671,y:.6865872144699097,z:-.010484723374247551},{x:.5230283141136169,y:.7809416055679321,z:-.011922398582100868},{x:.4551771283149719,y:.6650775074958801,z:.01774493046104908},{x:.5337203741073608,y:.7618928551673889,z:-.04697106033563614},{x:.43463975191116333,y:.8133478164672852,z:.1354849934577942},{x:.5225707292556763,y:.6605283617973328,z:.004980515688657761},{x:.5441933870315552,y:.7497199773788452,z:-.06091512367129326},{x:.4774007797241211,y:.9159183502197266,z:.059622734785079956},{x:.48068761825561523,y:.9364941716194153,z:.08404944837093353},{x:.4268292486667633,y:.7657528519630432,z:.09051097184419632},{x:.46051913499832153,y:.8880485892295837,z:.0738474428653717},{x:.4243420660495758,y:.6434382200241089,z:.06230505183339119},{x:.5342157483100891,y:.9835634231567383,z:.021662971004843712},{x:.5668109655380249,y:.8042187094688416,z:-.044937074184417725},{x:.5176341533660889,y:.7530587315559387,z:-.012967454269528389},{x:.430206298828125,y:.6835605502128601,z:.04612284153699875},{x:.4794231951236725,y:.6732114553451538,z:.003970044665038586},{x:.49073347449302673,y:.6722435355186462,z:.0008692514384165406},{x:.5294116139411926,y:.884677529335022,z:.004413890186697245},{x:.4430122375488281,y:.80235356092453,z:.04987282305955887},{x:.5603825449943542,y:1.0092442035675049,z:.026417359709739685},{x:.5186598300933838,y:.9828659892082214,z:.0513598807156086},{x:.5010536909103394,y:.9640932679176331,z:.06591596454381943},{x:.5524769425392151,y:.539441704750061,z:-.035816047340631485},{x:.5879997611045837,y:1.0091472864151,z:.02285068854689598},{x:.5016193985939026,y:.6684437990188599,z:.00028415941051207483},{x:.511952817440033,y:.6642197370529175,z:.0021144719794392586},{x:.5194343328475952,y:.6623469591140747,z:.004674181342124939},{x:.4321230351924896,y:.6496355533599854,z:.03124697133898735},{x:.508686363697052,y:.6479565501213074,z:-.00044765998609364033},{x:.4963986277580261,y:.6431032419204712,z:-.0032507688738405704},{x:.4845542013645172,y:.6430778503417969,z:-.002903624437749386},{x:.4733612537384033,y:.647506833076477,z:.00023347247042693198},{x:.4668654501438141,y:.653346598148346,z:.004762572236359119},{x:.41815051436424255,y:.633708119392395,z:.09809435904026031},{x:.47159942984580994,y:.6711485385894775,z:.007849935442209244},{x:.5734396576881409,y:.8256140351295471,z:-.03155219927430153},{x:.5306524038314819,y:.8337990641593933,z:-.018351426348090172},{x:.5371729135513306,y:.7910830974578857,z:-.037286680191755295},{x:.5549534559249878,y:.8275275826454163,z:-.030664825811982155},{x:.5597432255744934,y:.6418541669845581,z:-.03318847343325615},{x:.4958484172821045,y:.9429569244384766,z:.048340678215026855},{x:.5140507817268372,y:.9634028077125549,z:.03589847311377525},{x:.5587693452835083,y:.9951097369194031,z:.00908728688955307},{x:.46411189436912537,y:.9051855206489563,z:.10601935535669327},{x:.5181609392166138,y:.6554316878318787,z:.002546071307733655},{x:.5436590909957886,y:.7085841298103333,z:-.03844436630606651},{x:.5872187614440918,y:.9960382580757141,z:.0063423276878893375},{x:.5379653573036194,y:.9989125728607178,z:.03636329993605614},{x:.4350326955318451,y:.8088565468788147,z:.09147704392671585},{x:.5523084998130798,y:.8773422837257385,z:-.009068487212061882},{x:.5510149598121643,y:.8816931843757629,z:-.011043853126466274},{x:.5503793954849243,y:.88776695728302,z:-.01348799467086792},{x:.5501549243927002,y:.8954370617866516,z:-.012142189778387547},{x:.546072781085968,y:.9192524552345276,z:-.003157563041895628},{x:.5314661860466003,y:.8771666884422302,z:.0005075141089037061},{x:.5293324589729309,y:.8762547969818115,z:.00039177737198770046},{x:.5275698900222778,y:.8750609755516052,z:47732755774632096e-21},{x:.5104271173477173,y:.8607332110404968,z:.0012934643309563398},{x:.45938700437545776,y:.8134918212890625,z:.023569690063595772},{x:.5418947339057922,y:.6864100694656372,z:-.027333909645676613},{x:.531914234161377,y:.6456130743026733,z:-.005434140563011169},{x:.523697018623352,y:.647885262966156,z:-.0002466466394253075},{x:.5338191390037537,y:.8783687353134155,z:.002268768846988678},{x:.46226605772972107,y:.8610277771949768,z:.04718952998518944},{x:.5434442758560181,y:.6456181406974792,z:-.02327350154519081},{x:.5399754643440247,y:.940219521522522,z:.005075343884527683},{x:.5661457777023315,y:.71457839012146,z:-.06242101639509201},{x:.5523148775100708,y:.6974870562553406,z:-.04863070324063301},{x:.5639959573745728,y:.6923378109931946,z:-.05180761218070984},{x:.5367592573165894,y:.7423217296600342,z:-.03623027727007866},{x:.5853689908981323,y:.9752064943313599,z:-.002361974213272333},{x:.5835235118865967,y:.9493685960769653,z:-.003941743168979883},{x:.5615018606185913,y:.949194610118866,z:-.0015953965485095978},{x:.5068561434745789,y:.9048219323158264,z:.01862684078514576},{x:.5134067535400391,y:.7971825003623962,z:-.008485661819577217},{x:.5223897099494934,y:.925589919090271,z:.01249657291918993},{x:.48500555753707886,y:.7959478497505188,z:-.0032065745908766985},{x:.5037734508514404,y:.8184596300125122,z:-.004932103678584099},{x:.4766361117362976,y:.828806459903717,z:.01027688942849636},{x:.5589827299118042,y:.974656343460083,z:.0009666886180639267},{x:.5294582843780518,y:.7541216611862183,z:-.025603046640753746},{x:.4973002076148987,y:.9208990931510925,z:.031931452453136444},{x:.5163551568984985,y:.9432790875434875,z:.024321340024471283},{x:.49399662017822266,y:.8814862370491028,z:.018687399104237556},{x:.44948166608810425,y:.836137592792511,z:.05702034756541252},{x:.47898444533348083,y:.8836610913276672,z:.03150695189833641},{x:.4454479217529297,y:.8499438166618347,z:.08868525922298431},{x:.49572959542274475,y:.8452823758125305,z:.0036111653316766024},{x:.5362502336502075,y:.7222585678100586,z:-.027912352234125137},{x:.5393770337104797,y:.7850722074508667,z:-.05415399745106697},{x:.531399667263031,y:.7898418307304382,z:-.03883346915245056},{x:.5451627373695374,y:.7717036604881287,z:-.06480253487825394},{x:.5206395983695984,y:.6287745833396912,z:-.010521138086915016},{x:.4974782466888428,y:.6191938519477844,z:-.014098240062594414},{x:.4774145185947418,y:.6193130612373352,z:-.013643337413668633},{x:.4616098403930664,y:.6259890198707581,z:-.008448202162981033},{x:.4516478478908539,y:.6368461847305298,z:9050309745362028e-20},{x:.4485096037387848,y:.6719120740890503,z:.022984720766544342},{x:.42177659273147583,y:.7240667343139648,z:.08511673659086227},{x:.4616215229034424,y:.6988231539726257,z:.014238474890589714},{x:.4755798876285553,y:.7034608721733093,z:.00625590980052948},{x:.4924992024898529,y:.7005885243415833,z:.0009391739731654525},{x:.5082254409790039,y:.693384051322937,z:-.0009464038303121924},{x:.5203112959861755,y:.6849707961082458,z:-.0022114769089967012},{x:.52867591381073,y:.6779075860977173,z:-.002962538506835699},{x:.4213953912258148,y:.7219811677932739,z:.1350894570350647},{x:.5320829749107361,y:.794858992099762,z:-.03181503340601921},{x:.5452795028686523,y:.7286570072174072,z:-.04771539941430092},{x:.5496407747268677,y:.7866933345794678,z:-.06452003121376038},{x:.557040274143219,y:.7962084412574768,z:-.05837344378232956},{x:.549176812171936,y:.7895247936248779,z:-.057761140167713165},{x:.5362890362739563,y:.8005836606025696,z:-.026903774589300156},{x:.560200035572052,y:.7983731031417847,z:-.06172555685043335},{x:.5616944432258606,y:.8022753596305847,z:-.045200999826192856},{x:.5273328423500061,y:.6611284017562866,z:.0029021520167589188},{x:.534850537776947,y:.6660012006759644,z:-.005215510260313749},{x:.5394860506057739,y:.6701375246047974,z:-.014931917190551758},{x:.4634307324886322,y:.658291757106781,z:.009295716881752014},{x:.4538393020629883,y:.6519932150840759,z:.00930330716073513},{x:.5776031613349915,y:.7159298658370972,z:-.057365912944078445},{x:.6504855155944824,y:.6461779475212097,z:.014184834435582161},{x:.5860154032707214,y:.7962266206741333,z:-.04522843658924103},{x:.6842049360275269,y:.5631637573242188,z:.07207967340946198},{x:.6152560710906982,y:.6674962639808655,z:.0007529259892180562},{x:.6280948519706726,y:.6684326529502869,z:.0016892586136236787},{x:.6408625245094299,y:.6663892269134521,z:.005331226624548435},{x:.6557814478874207,y:.6534678936004639,z:.01646413467824459},{x:.6035663485527039,y:.6639701724052429,z:.0013799630105495453},{x:.6329053044319153,y:.608010470867157,z:-.006195899099111557},{x:.6167260408401489,y:.6117533445358276,z:-.006319951266050339},{x:.6471013426780701,y:.6112449765205383,z:-.0017843559617176652},{x:.6560901999473572,y:.6185776591300964,z:.004047257360070944},{x:.6666946411132812,y:.6651176810264587,z:.023647578433156013},{x:.6311345100402832,y:.9495396018028259,z:.014004078693687916},{x:.6544655561447144,y:.6397901773452759,z:.01809609681367874},{x:.6965808868408203,y:.6482675075531006,z:.08304904401302338},{x:.679817259311676,y:.650188148021698,z:.03632688894867897},{x:.6336516737937927,y:.7541458010673523,z:-.007742783520370722},{x:.5921701192855835,y:.8567668199539185,z:-.029399123042821884},{x:.591663658618927,y:.870215654373169,z:-.02103729173541069},{x:.6068367958068848,y:.8584195375442505,z:-.020668085664510727},{x:.6176617741584778,y:.860965371131897,z:-.009790095500648022},{x:.6040634512901306,y:.8686612844467163,z:-.015289564616978168},{x:.6143736839294434,y:.8671170473098755,z:-.005712216719985008},{x:.6373105049133301,y:.8815656900405884,z:.012672550976276398},{x:.5832505822181702,y:.7866312861442566,z:-.07051534950733185},{x:.5836675763130188,y:.7658692598342896,z:-.07566110789775848},{x:.6709531545639038,y:.604898989200592,z:.005951565690338612},{x:.6029891967773438,y:.705652117729187,z:-.013388276100158691},{x:.6131622195243835,y:.7728396058082581,z:-.036248479038476944},{x:.6123163104057312,y:.7612020373344421,z:-.03264721855521202},{x:.6696187853813171,y:.744706928730011,z:.009673702530562878},{x:.5803102254867554,y:.7385968565940857,z:-.0689152330160141},{x:.6404349207878113,y:.5877999663352966,z:-.01929756999015808},{x:.6588467955589294,y:.5929454565048218,z:-.008487257175147533},{x:.6720337867736816,y:.530631422996521,z:.043437421321868896},{x:.584305465221405,y:.6099005341529846,z:-.030301367864012718},{x:.6034283638000488,y:.6217452883720398,z:-.001970183802768588},{x:.6460927724838257,y:.8608663082122803,z:.015541625209152699},{x:.6957815289497375,y:.8326103091239929,z:.13015234470367432},{x:.6043362617492676,y:.7861682772636414,z:-.030476901680231094},{x:.594293475151062,y:.7942103147506714,z:-.032218821346759796},{x:.6324057579040527,y:.8665139675140381,z:.014255806803703308},{x:.6296147704124451,y:.8667733669281006,z:.010388285852968693},{x:.663644552230835,y:.5798642635345459,z:-.0022301070857793093},{x:.6140630841255188,y:.7809288501739502,z:-.02835679054260254},{x:.615908145904541,y:.5921698212623596,z:-.026804860681295395},{x:.617181122303009,y:.5748661756515503,z:-.03060605563223362},{x:.6222207546234131,y:.49137672781944275,z:-.011151673272252083},{x:.6669357419013977,y:.5541607141494751,z:.017466170713305473},{x:.6182981729507446,y:.5320425629615784,z:-.021793590858578682},{x:.6760554313659668,y:.595052182674408,z:.017115700989961624},{x:.6801463961601257,y:.5800720453262329,z:.043127160519361496},{x:.5922210812568665,y:.8644017577171326,z:-.02662893570959568},{x:.6054555177688599,y:.8637874722480774,z:-.018363753333687782},{x:.6161889433860779,y:.8641164898872375,z:-.008808949030935764},{x:.6017249822616577,y:.7901403307914734,z:-.028126630932092667},{x:.631446123123169,y:.8664817810058594,z:.012112865224480629},{x:.6249198913574219,y:.8716511130332947,z:.003882825840264559},{x:.6281915903091431,y:.867301881313324,z:.009891441091895103},{x:.5986843109130859,y:.7813931703567505,z:-.050227612257003784},{x:.6126407384872437,y:.869275689125061,z:-.0031255714129656553},{x:.6027271151542664,y:.8711842894554138,z:-.009324162267148495},{x:.59088134765625,y:.8742044568061829,z:-.014608660712838173},{x:.5984604358673096,y:.9216185212135315,z:-.005981989670544863},{x:.5950398445129395,y:.8964707255363464,z:-.01703473925590515},{x:.5941568613052368,y:.8882410526275635,z:-.017784785479307175},{x:.5928806662559509,y:.8803883194923401,z:-.014153128489851952},{x:.5909661054611206,y:.8748103976249695,z:-.012609979137778282},{x:.6128016710281372,y:.8702545762062073,z:-.0022550546564161777},{x:.6150846481323242,y:.8726804256439209,z:-.00414019962772727},{x:.6173093914985657,y:.8770190477371216,z:-.005970994010567665},{x:.619335412979126,y:.8814800977706909,z:-.0036864024586975574},{x:.6292637586593628,y:.8314558267593384,z:-.007714875973761082},{x:.702275276184082,y:.7320667505264282,z:.1433621346950531},{x:.6204835176467896,y:.8689177632331848,z:.0044869170524179935},{x:.6223508715629578,y:.8704851269721985,z:.00352082890458405},{x:.590448260307312,y:.8029727935791016,z:-.03200828656554222},{x:.6097423434257507,y:.7933741211891174,z:-.018042555078864098},{x:.59229576587677,y:.7993767261505127,z:-.032564569264650345},{x:.6171364188194275,y:.7153720259666443,z:-.007672437466681004},{x:.6389747858047485,y:.726390540599823,z:-.002999067772179842},{x:.6151940226554871,y:.769412100315094,z:-.024427521973848343},{x:.6526776552200317,y:.505868136882782,z:.01412637997418642},{x:.6475822329521179,y:.5375454425811768,z:-.0033899128902703524},{x:.6433356404304504,y:.5714520215988159,z:-.017428796738386154},{x:.626949667930603,y:.8962116837501526,z:.005602736957371235},{x:.5868416428565979,y:.5829002261161804,z:-.03727729618549347},{x:.5877229571342468,y:.5345035791397095,z:-.032396964728832245},{x:.5887066125869751,y:.48655083775520325,z:-.025856535881757736},{x:.6507197618484497,y:.6612282991409302,z:.011114613153040409},{x:.6803066730499268,y:.677992045879364,z:.032125361263751984},{x:.5963194370269775,y:.6598632335662842,z:.002976928371936083},{x:.667536199092865,y:.6274255514144897,z:.015618261881172657},{x:.5930740833282471,y:.6940041780471802,z:-.019217798486351967},{x:.6053346395492554,y:.7676517963409424,z:-.050308309495449066},{x:.6934473514556885,y:.6884298920631409,z:.04794462397694588},{x:.6738007664680481,y:.6934011578559875,z:.020697161555290222},{x:.6588084697723389,y:.7033141851425171,z:.008462334051728249},{x:.6346072554588318,y:.7029502391815186,z:.001542167621664703},{x:.6157816648483276,y:.6966525912284851,z:-.002009218093007803},{x:.6015574336051941,y:.688928484916687,z:-.006588225718587637},{x:.5746836066246033,y:.6711069345474243,z:-.03597589209675789},{x:.6947521567344666,y:.7309479117393494,z:.046707939356565475},{x:.6759101152420044,y:.6249120831489563,z:.021654341369867325},{x:.5794773101806641,y:.7971615195274353,z:-.06339326500892639},{x:.6041849851608276,y:.727514922618866,z:-.017512541264295578},{x:.6968844532966614,y:.6440950036048889,z:.12727996706962585},{x:.5910853147506714,y:.679325520992279,z:-.009497715160250664},{x:.6157375574111938,y:.7695677280426025,z:-.010624290443956852},{x:.6606494784355164,y:.6410489678382874,z:.0208158977329731},{x:.6040687561035156,y:.7531470656394958,z:-.045887019485235214},{x:.7012156248092651,y:.780247151851654,z:.14028730988502502},{x:.595149576663971,y:.6527782678604126,z:.006308757700026035},{x:.5925500392913818,y:.7436665892601013,z:-.060151755809783936},{x:.6780198812484741,y:.8905693888664246,z:.0626060739159584},{x:.676746666431427,y:.9113880395889282,z:.08726003766059875},{x:.7030686140060425,y:.7312687635421753,z:.09529774636030197},{x:.688987135887146,y:.8588417172431946,z:.07752864807844162},{x:.6883691549301147,y:.6109960675239563,z:.06669612973928452},{x:.6358906030654907,y:.9702065587043762,z:.023120900616049767},{x:.5781539678573608,y:.8023634552955627,z:-.044763918966054916},{x:.6170316934585571,y:.7408350706100464,z:-.011375460773706436},{x:.688542366027832,y:.6516284346580505,z:.050206027925014496},{x:.6385149359703064,y:.6540714502334595,z:.006462941411882639},{x:.6279382109642029,y:.6563615798950195,z:.003062846139073372},{x:.6268895268440247,y:.8736732006072998,z:.00627936702221632},{x:.6944946050643921,y:.7709181308746338,z:.053824134171009064},{x:.614617109298706,y:1.0022112131118774,z:.02719894051551819},{x:.6493719220161438,y:.9665167927742004,z:.053563784807920456},{x:.6624587178230286,y:.943530797958374,z:.068605437874794},{x:.6162528991699219,y:.6558693051338196,z:.002187855076044798},{x:.6058168411254883,y:.654328465461731,z:.0036193584091961384},{x:.5987918972969055,y:.6536934971809387,z:.006134530063718557},{x:.6831037402153015,y:.6195642948150635,z:.03511790186166763},{x:.6062582731246948,y:.6356398463249207,z:.001280312892049551},{x:.6174948811531067,y:.62776118516922,z:-.0013642468256875873},{x:.6297246217727661,y:.6253792643547058,z:-.0007034156005829573},{x:.6407091617584229,y:.627578616142273,z:.0028144705574959517},{x:.6479622721672058,y:.6322650909423828,z:.00750273372977972},{x:.6915091276168823,y:.5990704298019409,z:.10270945727825165},{x:.6457163095474243,y:.6504453420639038,z:.010696077719330788},{x:.6164222955703735,y:.8231936097145081,z:-.016772059723734856},{x:.6042401194572449,y:.7830976843833923,z:-.03630910441279411},{x:.5922216773033142,y:.8228387236595154,z:-.029992375522851944},{x:.6646111011505127,y:.92097008228302,z:.050967294722795486},{x:.651232898235321,y:.9460107088088989,z:.038000158965587616},{x:.6140977144241333,y:.9882472157478333,z:.009882091544568539},{x:.6870781183242798,y:.8768675327301025,z:.10980932414531708},{x:.5986856818199158,y:.6456438899040222,z:.003999010659754276},{x:.585981547832489,y:.7034481763839722,z:-.0377722829580307},{x:.6342031359672546,y:.9867448806762695,z:.03786521404981613},{x:.7013950943946838,y:.776049017906189,z:.09598205983638763},{x:.6030206680297852,y:.8719133138656616,z:-.007931148633360863},{x:.6050592064857483,y:.8767156004905701,z:-.009791925549507141},{x:.6073468923568726,y:.8831382393836975,z:-.012361008673906326},{x:.6087977290153503,y:.890143632888794,z:-.01098148338496685},{x:.6147705316543579,y:.9110084772109985,z:-.0018823575228452682},{x:.622577965259552,y:.8670604825019836,z:.002609190298244357},{x:.6241236329078674,y:.8651344180107117,z:.0025534380692988634},{x:.6257084608078003,y:.8638408184051514,z:.0023300074972212315},{x:.639931321144104,y:.8449671268463135,z:.0038123116828501225},{x:.6810906529426575,y:.7856625318527222,z:.02717764675617218},{x:.583532452583313,y:.6811994910240173,z:-.026588857173919678},{x:.5855660438537598,y:.6393819451332092,z:-.004512844607234001},{x:.5932201743125916,y:.6398029327392578,z:.0008020466193556786},{x:.6200879812240601,y:.8683351874351501,z:.00417016725987196},{x:.6842559576034546,y:.8330534100532532,z:.050836317241191864},{x:.5754412412643433,y:.6418221592903137,z:-.022838059812784195},{x:.6232790350914001,y:.9295297265052795,z:.006339520215988159},{x:.5764067769050598,y:.694546639919281,z:-.04825803264975548},{x:.59778892993927,y:.7343927621841431,z:-.035004377365112305},{x:.6042810678482056,y:.9441440105438232,z:-.0010970570147037506},{x:.6496372222900391,y:.8869078159332275,z:.021036235615611076},{x:.6274012327194214,y:.7830310463905334,z:-.006658440921455622},{x:.637792706489563,y:.9104999899864197,z:.014290250837802887},{x:.6549934148788452,y:.7748609185218811,z:-.0006672973395325243},{x:.6404005289077759,y:.801220715045929,z:-.0026642554439604282},{x:.6671456694602966,y:.8045546412467957,z:.013180811889469624},{x:.6107483506202698,y:.9680658578872681,z:.001778992242179811},{x:.6060343980789185,y:.744587242603302,z:-.024382334202528},{x:.6602751612663269,y:.8998945355415344,z:.0344940721988678},{x:.6463775038719177,y:.9262562394142151,z:.02617623284459114},{x:.6579852104187012,y:.8602304458618164,z:.021586716175079346},{x:.6926165223121643,y:.8053340315818787,z:.061075080186128616},{x:.6724731922149658,y:.8594399690628052,z:.03457934781908989},{x:.6975721716880798,y:.8183245062828064,z:.09300774335861206},{x:.6512877941131592,y:.8258221745491028,z:.006324059329926968},{x:.594887375831604,y:.7148372530937195,z:-.026898479089140892},{x:.6017440557479858,y:.7773507833480835,z:-.05312420800328255},{x:.6096571683883667,y:.7806998491287231,z:-.037646256387233734},{x:.5952993035316467,y:.7654367685317993,z:-.06398405134677887},{x:.5950021147727966,y:.6201304793357849,z:-.009297547861933708},{x:.6165438890457153,y:.6052900552749634,z:-.012455573305487633},{x:.6362661719322205,y:.6015968918800354,z:-.011649220250546932},{x:.6522727608680725,y:.6046400666236877,z:-.005903332494199276},{x:.6625409722328186,y:.6128141283988953,z:.0030042496509850025},{x:.6688099503517151,y:.6457712054252625,z:.026322703808546066},{x:.7013440728187561,y:.6893666386604309,z:.08984331786632538},{x:.6608623266220093,y:.6749406456947327,z:.0172116681933403},{x:.6482325196266174,y:.6823726296424866,z:.008881398476660252},{x:.6313265562057495,y:.6842025518417358,z:.0031308617908507586},{x:.6147016286849976,y:.6809731721878052,z:.0007630771724507213},{x:.6018834114074707,y:.6755372285842896,z:-.0008834321051836014},{x:.5925027132034302,y:.670681357383728,z:-.001968748401850462},{x:.700127363204956,y:.6871103644371033,z:.13980500400066376},{x:.6095665693283081,y:.7853189706802368,z:-.03074747882783413},{x:.5880423784255981,y:.7229287028312683,z:-.04691500961780548},{x:.5930182337760925,y:.7811514139175415,z:-.06398335844278336},{x:.5867722034454346,y:.7922660112380981,z:-.05794971063733101},{x:.5933279991149902,y:.7842848896980286,z:-.05714067071676254},{x:.6063535809516907,y:.7920218706130981,z:-.02590685710310936},{x:.5839452743530273,y:.794978141784668,z:-.0615212507545948},{x:.5828126072883606,y:.8000800013542175,z:-.0449722595512867},{x:.5909603834152222,y:.6541213393211365,z:.003991890233010054},{x:.5852181911468506,y:.6602938771247864,z:-.004428438376635313},{x:.5825737714767456,y:.6651063561439514,z:-.014345290139317513},{x:.6517343521118164,y:.6362385153770447,z:.012151890434324741},{x:.6615052819252014,y:.6281577944755554,z:.0123682152479887},{x:.4856873154640198,y:.6568945646286011,z:.000720038078725338},{x:.49988406896591187,y:.6547410488128662,z:.0006949726957827806},{x:.48438939452171326,y:.6392973065376282,z:.000705525919329375},{x:.47143134474754333,y:.6589511632919312,z:.0006980331381782889},{x:.48704618215560913,y:.6752797961235046,z:.0006921177846379578},{x:.6243702173233032,y:.640461802482605,z:-6592126737814397e-20},{x:.6390967965126038,y:.6385173797607422,z:-.00016105435497593135},{x:.6230536699295044,y:.6224825382232666,z:-.00016136496560648084},{x:.6095397472381592,y:.641917884349823,z:-.0001803556369850412},{x:.6250996589660645,y:.6586247682571411,z:-.0001785515050869435}]],faceBlendshapes:[{categories:[{index:0,score:5187174338061595e-21,categoryName:"_neutral",displayName:""},{index:1,score:.24521504342556,categoryName:"browDownLeft",displayName:""},{index:2,score:.1987743377685547,categoryName:"browDownRight",displayName:""},{index:3,score:.013400448486208916,categoryName:"browInnerUp",displayName:""},{index:4,score:.012361560948193073,categoryName:"browOuterUpLeft",displayName:""},{index:5,score:.019305096939206123,categoryName:"browOuterUpRight",displayName:""},{index:6,score:28426356948330067e-21,categoryName:"cheekPuff",displayName:""},{index:7,score:34500112633395474e-23,categoryName:"cheekSquintLeft",displayName:""},{index:8,score:483789051486383e-21,categoryName:"cheekSquintRight",displayName:""},{index:9,score:.07650448381900787,categoryName:"eyeBlinkLeft",displayName:""},{index:10,score:.05070012807846069,categoryName:"eyeBlinkRight",displayName:""},{index:11,score:.13978900015354156,categoryName:"eyeLookDownLeft",displayName:""},{index:12,score:.14198613166809082,categoryName:"eyeLookDownRight",displayName:""},{index:13,score:.2177766114473343,categoryName:"eyeLookInLeft",displayName:""},{index:14,score:.014739357866346836,categoryName:"eyeLookInRight",displayName:""},{index:15,score:.02361512929201126,categoryName:"eyeLookOutLeft",displayName:""},{index:16,score:.19679604470729828,categoryName:"eyeLookOutRight",displayName:""},{index:17,score:.04874616861343384,categoryName:"eyeLookUpLeft",displayName:""},{index:18,score:.049392376095056534,categoryName:"eyeLookUpRight",displayName:""},{index:19,score:.34944331645965576,categoryName:"eyeSquintLeft",displayName:""},{index:20,score:.2939716875553131,categoryName:"eyeSquintRight",displayName:""},{index:21,score:.005955042317509651,categoryName:"eyeWideLeft",displayName:""},{index:22,score:.006776117719709873,categoryName:"eyeWideRight",displayName:""},{index:23,score:16942436559475027e-21,categoryName:"jawForward",displayName:""},{index:24,score:.0045165494084358215,categoryName:"jawLeft",displayName:""},{index:25,score:.07803940027952194,categoryName:"jawOpen",displayName:""},{index:26,score:2090057751047425e-20,categoryName:"jawRight",displayName:""},{index:27,score:.06032035872340202,categoryName:"mouthClose",displayName:""},{index:28,score:.00228882092051208,categoryName:"mouthDimpleLeft",displayName:""},{index:29,score:.00781762320548296,categoryName:"mouthDimpleRight",displayName:""},{index:30,score:.0017093931091949344,categoryName:"mouthFrownLeft",displayName:""},{index:31,score:.0019319106359034777,categoryName:"mouthFrownRight",displayName:""},{index:32,score:8485237776767462e-20,categoryName:"mouthFunnel",displayName:""},{index:33,score:.0009051355300471187,categoryName:"mouthLeft",displayName:""},{index:34,score:.0003630454302765429,categoryName:"mouthLowerDownLeft",displayName:""},{index:35,score:.00017601238505449146,categoryName:"mouthLowerDownRight",displayName:""},{index:36,score:.12865161895751953,categoryName:"mouthPressLeft",displayName:""},{index:37,score:.20137207210063934,categoryName:"mouthPressRight",displayName:""},{index:38,score:.0022203284315764904,categoryName:"mouthPucker",displayName:""},{index:39,score:.0009096377179957926,categoryName:"mouthRight",displayName:""},{index:40,score:.34189721941947937,categoryName:"mouthRollLower",displayName:""},{index:41,score:.11409689486026764,categoryName:"mouthRollUpper",displayName:""},{index:42,score:.17172536253929138,categoryName:"mouthShrugLower",displayName:""},{index:43,score:.004038424696773291,categoryName:"mouthShrugUpper",displayName:""},{index:44,score:.00023205230536404997,categoryName:"mouthSmileLeft",displayName:""},{index:45,score:.00019313619122840464,categoryName:"mouthSmileRight",displayName:""},{index:46,score:.0018571305554360151,categoryName:"mouthStretchLeft",displayName:""},{index:47,score:.0023813238367438316,categoryName:"mouthStretchRight",displayName:""},{index:48,score:24323100660694763e-21,categoryName:"mouthUpperUpLeft",displayName:""},{index:49,score:3161552012898028e-20,categoryName:"mouthUpperUpRight",displayName:""},{index:50,score:108198406678639e-21,categoryName:"noseSneerLeft",displayName:""},{index:51,score:12652527630052646e-22,categoryName:"noseSneerRight",displayName:""}],headIndex:-1,headName:""}],facialTransformationMatrixes:[{rows:4,columns:4,data:[.9947517514228821,.10230544209480286,.0013679931871592999,0,-.10230997204780579,.9947447776794434,.003816320328041911,0,-.000970348424743861,-.0039362297393381596,.9999914169311523,0,2.8888821601867676,-7.808934211730957,-30.52109146118164,1]}]}},Qm=l.createContext({}),Uf={basePath:"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.8/wasm",options:{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",outputFaceBlendshapes:!0,outputFacialTransformationMatrixes:!0}};function lE({basePath:n=Uf.basePath,options:e=Uf.options,children:t}){const i=JSON.stringify(e),r=mr(async()=>{const{FilesetResolver:s,FaceLandmarker:o}=await aA(async()=>{const{FilesetResolver:c,FaceLandmarker:u}=await import("./vision_bundle-DAfdqQjW.js");return{FilesetResolver:c,FaceLandmarker:u}},[]),a=await s.forVisionTasks(n);return o.createFromOptions(a,e)},[n,i]);return l.useEffect(()=>()=>{r==null||r.close(),Du([n,i])},[r,n,i]),l.createElement(Qm.Provider,{value:r},t)}function E7(){return l.useContext(Qm)}function Nf(n,e){return n.clone().add(e).multiplyScalar(.5)}function Wr(n,e,t){const i=n.localToWorld(e);return t.worldToLocal(i)}const Rm=l.createContext({}),uE=l.forwardRef(({camera:n,autostart:e=!0,webcam:t=!0,webcamVideoTextureSrc:i,manualUpdate:r=!1,manualDetect:s=!1,onVideoFrame:o,smoothTime:a=.25,offset:c=!0,offsetScalar:u=80,eyes:f=!1,eyesAsOrigin:h=!0,depth:A=.15,debug:y=!1,facemesh:x,makeDefault:d},v)=>{var g,p;const m=J(D=>D.scene),E=J(D=>D.camera),w=J(D=>D.set),_=J(D=>D.get),C=n||E,I=l.useRef(null),b=l.useRef(null),[B]=l.useState(()=>new Ot),[Q]=l.useState(()=>new T),[S]=l.useState(()=>new T),[k]=l.useState(()=>new T),[L]=l.useState(()=>new T),O=l.useCallback(()=>{B.parent=C.parent;const D=b.current;if(D){const{outerRef:R,eyeRightRef:$,eyeLeftRef:se}=D;if($.current&&se.current){const{irisDirRef:Z}=$.current,{irisDirRef:oe}=se.current;Z.current&&oe.current&&R.current&&(Q.copy(Wr(Z.current,new T(0,0,0),R.current)),S.copy(Wr(oe.current,new T(0,0,0),R.current)),B.position.copy(Wr(R.current,Nf(Q,S),C.parent||m)),k.copy(Wr(Z.current,new T(0,0,1),R.current)),L.copy(Wr(oe.current,new T(0,0,1),R.current)),B.lookAt(R.current.localToWorld(Nf(k,L))))}else R.current&&(B.position.copy(Wr(R.current,new T(0,0,0),C.parent||m)),B.lookAt(R.current.localToWorld(new T(0,0,1))))}return B},[C,S,L,Q,k,m,B]),[G]=l.useState(()=>new Ot),V=l.useCallback(function(D,R){if(C){var $;($=R)!==null&&$!==void 0||(R=O()),a>0?(as.damp3(G.position,R.position,a,D,void 0,void 0,1e-9),as.dampE(G.rotation,R.rotation,a,D,void 0,void 0,1e-9)):(G.position.copy(R.position),G.rotation.copy(R.rotation)),C.position.copy(G.position),C.rotation.copy(G.rotation)}},[C,O,a,G.position,G.rotation]),[N,j]=l.useState(),Y=E7(),H=l.useCallback((D,R)=>{const $=Y==null?void 0:Y.detectForVideo(D,R);j($)},[Y]);Se((D,R)=>{r||V(R)});const X=l.useMemo(()=>Object.assign(Object.create(dr.prototype),{detect:H,computeTarget:O,update:V,facemeshApiRef:b,webcamApiRef:I,play:()=>{var D;(D=I.current)==null||(D=D.videoTextureApiRef.current)==null||D.texture.source.data.play()},pause:()=>{var D;(D=I.current)==null||(D=D.videoTextureApiRef.current)==null||D.texture.source.data.pause()}}),[H,O,V]);l.useImperativeHandle(v,()=>X,[X]),l.useEffect(()=>{const D=R=>{s||H(R.texture.source.data,R.time),o&&o(R)};return X.addEventListener("videoFrame",D),()=>{X.removeEventListener("videoFrame",D)}},[X,H,Y,s,o]),l.useEffect(()=>{if(d){const D=_().controls;return w({controls:X}),()=>w({controls:D})}},[d,X,_,w]);const W=N==null?void 0:N.faceLandmarks[0],P=N==null||(g=N.facialTransformationMatrixes)==null?void 0:g[0],z=N==null||(p=N.faceBlendshapes)==null?void 0:p[0];return l.createElement(Rm.Provider,{value:X},t&&l.createElement(l.Suspense,{fallback:null},l.createElement(w7,{ref:I,autostart:e,videoTextureSrc:i})),l.createElement(x7,ce({ref:b},x,{points:W,depth:A,facialTransformationMatrix:P,faceBlendshapes:z,eyes:f,eyesAsOrigin:h,offset:c,offsetScalar:u,debug:y,"rotation-z":Math.PI,visible:y}),l.createElement("meshBasicMaterial",{side:on})))}),zm=()=>l.useContext(Rm),w7=l.forwardRef(({videoTextureSrc:n,autostart:e=!0},t)=>{const i=l.useRef(null),r=zm(),s=mr(async()=>n?Promise.resolve(null):await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}}),[n]);l.useEffect(()=>(r.dispatchEvent({type:"stream",stream:s}),()=>{s==null||s.getTracks().forEach(a=>a.stop()),Du([n])}),[s,r,n]);const o=l.useMemo(()=>({videoTextureApiRef:i}),[]);return l.useImperativeHandle(t,()=>o,[o]),l.createElement(l.Suspense,{fallback:null},l.createElement(_7,{ref:i,src:n||s,start:e}))}),_7=l.forwardRef(({src:n,start:e},t)=>{const i=Wd(n,{start:e}),r=i.source.data,s=zm(),o=l.useCallback(c=>{s.dispatchEvent({type:"videoFrame",texture:i,time:c})},[i,s]);C7(r,o);const a=l.useMemo(()=>({texture:i}),[i]);return l.useImperativeHandle(t,()=>a,[a]),l.createElement(l.Fragment,null)}),C7=(n,e)=>{l.useEffect(()=>{if(!n||!n.requestVideoFrameCallback)return;let t;function i(...r){e(...r),t=n.requestVideoFrameCallback(i)}return n.requestVideoFrameCallback(i),()=>n.cancelVideoFrameCallback(t)},[n,e])};export{u8 as AccumulativeShadows,eE as AdaptiveDpr,tE as AdaptiveEvents,x9 as ArcballControls,h9 as AsciiRenderer,q9 as BBAnchor,Rx as Backdrop,$x as BakeShadows,q7 as Billboard,Hv as Bounds,lx as Box,G9 as Bvh,C9 as CameraControls,Px as CameraShake,Bx as Capsule,K7 as CatmullRomLine,Fx as Caustics,um as Center,ux as Circle,P2 as Clone,Nx as Cloud,af as CloudInstance,b8 as Clouds,s9 as ComputedAttribute,hx as Cone,o8 as ContactShadows,m9 as CubeCamera,T9 as CubeTexture,X7 as CubicBezierLine,J9 as CurveModifier,B7 as CycleRaycast,fx as Cylinder,l9 as Decal,Kx as Detailed,U9 as DetectGPU,p9 as DeviceOrientationControls,_x as Dodecahedron,T7 as DragControls,ey as Edges,$7 as Effects,s8 as Environment,_m as EnvironmentCube,E0 as EnvironmentMap,i8 as EnvironmentPortal,j9 as Example,Cx as Extrude,uE as FaceControls,lE as FaceLandmarker,Uf as FaceLandmarkerDefaults,x7 as Facemesh,ql as FacemeshDatas,Of as FacemeshEye,no as FacemeshEyeDefaults,A9 as Fbo,P9 as Fbx,_9 as FirstPersonControls,oE as Fisheye,Dx as Float,g9 as FlyControls,B9 as GizmoHelper,b9 as GizmoViewcube,S9 as GizmoViewport,AE as Gltf,J7 as GradientTexture,i1 as GradientType,M9 as Grid,dE as Helper,cc as Html,Py as Hud,Ex as Icosahedron,t9 as Image,p0 as Instance,K9 as InstancedAttribute,g0 as Instances,yo as IsObject,mE as KeyboardControls,D9 as Ktx2,Ix as Lathe,kx as Lightformer,Ei as Line,M7 as Loader,y9 as MapControls,a9 as MarchingCube,o9 as MarchingCubes,c9 as MarchingPlane,rE as Mask,Gx as MatcapTexture,W9 as Merged,ox as MeshDiscardMaterial,ex as MeshDistortMaterial,aE as MeshPortalMaterial,ix as MeshReflectorMaterial,rx as MeshRefractionMaterial,sx as MeshTransmissionMaterial,tx as MeshWobbleMaterial,I9 as MotionPathControls,Hx as NormalTexture,wx as Octahedron,pE as OrbitControls,Ey as OrthographicCamera,n9 as Outlines,nE as PerformanceMonitor,d9 as PerspectiveCamera,cE as PivotControls,dx as Plane,Yx as Point,ax as PointMaterial,Lv as PointMaterialImpl,w9 as PointerLockControls,jx as Points,W8 as PointsBuffer,xx as Polyhedron,Y8 as PositionPoint,gE as PositionalAudio,Zx as Preload,Q7 as PresentationControls,S7 as Progress,W7 as QuadraticBezierLine,h8 as RandomizedLight,Lx as Reflector,$8 as RenderCubeTexture,K8 as RenderTexture,Tx as Resize,vx as Ring,Sx as RoundedBox,r9 as Sampler,Mx as ScreenQuad,j7 as ScreenSizer,Y7 as ScreenSpace,D7 as Scroll,P7 as ScrollControls,Xx as Segment,X8 as SegmentObject,Wx as Segments,H7 as Select,zx as Shadow,qx as ShadowAlpha,bx as Shape,Ox as Sky,cx as SoftShadows,yE as Sparkles,Ax as Sphere,f9 as Splat,vE as SpotLight,xE as SpotLightShadow,$9 as SpriteAnimator,Qx as Stage,Ux as Stars,R9 as Stats,z9 as StatsGl,u9 as Svg,yx as Tetrahedron,EE as Text,Z5 as Text3D,e9 as Texture,px as Torus,gx as TorusKnot,v9 as TrackballControls,i9 as Trail,Y9 as TrailTexture,E9 as TransformControls,mx as Tube,Q9 as VideoTexture,c7 as View,Vx as Wireframe,Cm as accumulativeContext,y8 as calcPosFromAngles,w1 as calculateAspectRatio,o0 as calculateScaleFactor,Vy as checkIfFrameIsEmpty,X9 as createInstances,Hy as getFirstItem,Z7 as isWebGL2Available,Jx as meshBounds,ti as shaderMaterial,wE as useAnimations,L9 as useAspect,N9 as useBVH,Vv as useBounds,V9 as useBoxProjectedEnv,k9 as useCamera,H9 as useContextBridge,_y as useCubeCamera,Yd as useCubeTexture,b7 as useCursor,F9 as useDepthBuffer,t6 as useDetectGPU,wm as useEnvironment,mn as useFBO,u0 as useFBX,zm as useFaceControls,E7 as useFaceLandmarker,a0 as useFont,_E as useGLTF,l0 as useGizmoContext,G2 as useHelper,dv as useIntersect,h0 as useKTX2,CE as useKeyboardControls,sE as useMask,P8 as useMatcapTexture,Sy as useMotion,R8 as useNormalTexture,iE as usePerformanceMonitor,mA as useProgress,IA as useScroll,V7 as useSelect,Z9 as useSpriteAnimator,f0 as useSpriteLoader,fy as useSurfaceSampler,yr as useTexture,hy as useTrail,_v as useTrailTexture,Wd as useVideoTexture};
